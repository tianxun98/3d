!function(d,l,S){"use strict";function U(){this.el=[1,0,0,0,1,0,0,0,1]}function $(b){var v={};return{get:function(q){if(v[q]!==S)return v[q];var C;switch(q){case"WEBGL_depth_texture":C=b.getExtension("WEBGL_depth_texture")||b.getExtension("MOZ_WEBGL_depth_texture")||b.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":C=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":C=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":C=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":C=b.getExtension("WEBGL_compressed_texture_etc1");break;default:C=b.getExtension(q)}return v[q]=C,C}}}function n(Q,v,d){function R(){if(r!==S)return r;var k=v.get("EXT_texture_filter_anisotropic");return r=null!==k?Q.getParameter(k.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function C(U){if("highp"===U){if(Q.getShaderPrecisionFormat(Q.VERTEX_SHADER,Q.HIGH_FLOAT).precision>0&&Q.getShaderPrecisionFormat(Q.FRAGMENT_SHADER,Q.HIGH_FLOAT).precision>0)return"highp";U="mediump"}return"mediump"===U&&Q.getShaderPrecisionFormat(Q.VERTEX_SHADER,Q.MEDIUM_FLOAT).precision>0&&Q.getShaderPrecisionFormat(Q.FRAGMENT_SHADER,Q.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var r;d=d||{};var l="undefined"!=typeof WebGL2RenderingContext&&Q instanceof WebGL2RenderingContext,F=d.precision!==S?d.precision:"highp",T=C(F);T!==F&&(console.warn("WebGL:",F,"not supported, using",T,"instead."),F=T);var b=d.logarithmicDepthBuffer===!0,k=Q.getParameter(Q.MAX_TEXTURE_IMAGE_UNITS),e=Q.getParameter(Q.MAX_VERTEX_TEXTURE_IMAGE_UNITS),t=Q.getParameter(Q.MAX_TEXTURE_SIZE),I=Q.getParameter(Q.MAX_CUBE_MAP_TEXTURE_SIZE),A=Q.getParameter(Q.MAX_VERTEX_ATTRIBS),z=Q.getParameter(Q.MAX_VERTEX_UNIFORM_VECTORS),G=Q.getParameter(Q.MAX_VARYING_VECTORS),D=Q.getParameter(Q.MAX_FRAGMENT_UNIFORM_VECTORS),c=e>0,u=l||!!v.get("OES_texture_float"),P=c&&u,j=l?Q.getParameter(Q.MAX_SAMPLES):0;return{getMaxAnisotropy:R,getMaxPrecision:C,precision:F,logarithmicDepthBuffer:b,maxTextures:k,maxVertexTextures:e,maxTextureSize:t,maxCubemapSize:I,maxAttributes:A,maxVertexUniforms:z,maxVaryings:G,maxFragmentUniforms:D,vertexTextures:c,floatFragmentTextures:u,floatVertexTextures:P,maxSamples:j}}var x="ht";if(!d[x]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),d.performance&&d.performance.now||function(){var F=Date.now();d.performance||(d.performance={}),d.performance.now=function(){return Date.now()-F}}();for(var v=Date.now(),u=16,c=["ms","moz","webkit","o"],q=0;q<c.length&&!d.requestAnimationFrame;++q)d.requestAnimationFrame=d[c[q]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[c[q]+"CancelAnimationFrame"]||d[c[q]+"CancelRequestAnimationFrame"];d.requestAnimationFrame||(d.requestAnimationFrame=function(Z){var S=Date.now(),p=u+v-S;return 0>p&&(p=0),v=S,d.setTimeout(function(){v=Date.now(),Z(performance.now())},p)}),d.cancelAnimationFrame||(d.cancelAnimationFrame=function(x){return d.clearTimeout(x)}),l.assign===S&&(l.assign=function(N){if(N===S||null===N)throw new TypeError("Cannot convert undefined or null to object");for(var H=l(N),e=1;e<arguments.length;e++){var j=arguments[e];if(j!==S&&null!==j)for(var D in j)l.prototype.hasOwnProperty.call(j,D)&&(H[D]=j[D])}return H})}();var L=d.document,o=null,E=d[x]={},F=d[x+"config"],N=E.Default=F&&F.Default||{},t=E.Style=F&&F.Style||{},k=E.Attr=F&&F.Attr||{},f=E.Color=F&&F.Color||{},a=E.IsGetter=F&&F.IsGetter||{};!function(){var W=!1;try{var s=l.defineProperty({},"passive",{get:function(){W=!0}});d.addEventListener("test",s,s),d.removeEventListener("test",s,s)}catch(E){W=!1}N.passiveSupported=W}();var p,c,C,O,i=N.passiveSupported,H=N.eventListenerOptionsFalse=i?{passive:!1,capture:!1}:!1,Y=N.eventListenerOptionsTrue=i?{passive:!1,capture:!0}:!0,A=function(j,g,C,h){j.addEventListener(g,C,h?Y:H)},u=function(J,O,U,E){J.removeEventListener(O,U,E?Y:H)},I=Math,h=I.round,P=I.floor,Z=I.ceil,T=I.sqrt,r=I.max,Q=I.min,D=I.abs,X=I.cos,G=I.acos,V=I.sin,q=I.pow,R=I.asin,s=I.PI,j=2*s,v=s/2,K=I.tan,g=I.atan2,M=I.random,m=I.log,y=!1,e=!1,B=d.parseInt||global.parseInt,b="2020-07-15",z=d.navigator?d.navigator.platform.indexOf("Win")>-1:!1,J=function(j){return j*j},W=d.setTimeout,w=d.clearTimeout,_=d.location,Ue=d.navigator?d.navigator.userAgent.toLowerCase():"",aj=function(z){return z.test(Ue)},sc=aj(/msie/),dl=aj(/msie/)||aj(/trident/),Uk=aj(/msie 10/),Vi=aj(/edge/),hr=aj(/firefox/),Kb=aj(/mac/),Tk=N.isTouchable===S?z?!1:L?"ontouchend"in L:!1:N.isTouchable,pn="default",Wf="single",ys="multiple",ph="front",Ic="back",Ec="left",zn="right",md="top",Il="bottom",Oj="center",Ob="eye",fr="middle",Sb="east",ns="west",Ee="north",hg="none",Yg="px",El="absolute",Wo="border",gi="triangle",ir="rect",xf="circle",Qq="cylinder",Fl="shape",or="items",qg="normal",cf="remove",ms="clear",Ij="width",hk="height",ei="ingroup",We="check",He="uncheck",cp="radio",kq="radioOn",Hp="radioOff",Zq="points",hc="values",Qk="series",Zr="body",$h="label",Hr="label2",Fc="note",Hn="note2",ss="icons",Qj="labelFont",ql="labelColor",Nn="labelSelectColor",dr="note.expanded",yk="note2.expanded",Vh="edge.expanded",Mo="edge.points",os="edge.type",Bb="rotation",rc="hidden",Tr="visible",_h="tuv",Kh="no",Ci="draw",ih="select",Oc="currentSubGraph",cm="selectBackground",wh="autoMakeVisible",jo="autoHideScrollBar",kj="scrollBarColor",ge="scrollBarSize",an="indent",tj="rowHeight",un="columnLineColor",Hc="rowLineColor",Eq="columnLineVisible",Nm="rowLineVisible",ll="visibleFunc",Hb="expandIcon",Td="collapseIcon",Zd="checkMode",Rn="sortFunc",Ko="editable",$m="batchEditable",hp="tristate",Or="asc",fi="desc",ie="position",Kc="elevation",lf="children",og="translateX",zb="translateY",Nh="dataModel",Oo="maxSize",Cc="state",dh="shape3d",Ve="shape3d.resolution",pq="shape3d.visible",nf="shape3d.from.visible",ws="shape3d.to.visible",kh="shape3d.top.visible",oe="shape3d.bottom.visible",Jo="repeat.uv.length",jh="serializeValue",vl="deserializeValue",Ki="centerUniform",ki="uniform",Pp="rgba(255,255,255,0)",Th="style",rh="attr",ln="field",Tg="string",xc="boolean",lq="color",wc="int",sk="number",Ac="ew-resize",Mh="ns-resize",Nq="pointer",ud="auto",Bn="mousedown",Ti="mousemove",Xk="mouseup",Ok="mouseout",mi="touchstart",ar="touchmove",Po="touchend",qm="keydown",gp="keyup",ne=["DOMMouseScroll","mousewheel"],Nf=hr?ne[0]:ne[1],zj=Tk?[mi,ar,Po,qm,gp,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[qm,gp,"keypress","input",Bn,Ti,Xk,Ok,Nf,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],rm=o,um=o,mn=o,se=Xk.length,Mi=function(){mn&&(w(mn.timeout),mn=o)},sg=function(){mn&&zd(mn.e,mn.info)};d.addEventListener&&(Tk||(A(d,Ok,function(){Mi()}),A(d,Nf,function(){mh()})),A(d,gp,function(W){91===W.keyCode?qj={}:delete qj[W.keyCode]},!0),A(d,qm,function(q){qj[q.keyCode]=!0},!0),A(d,"blur",function(){qj={}}));var Yl,le,Vb,cn=0,To=o,$j=function(F,m){var q=W(function(){delete To[q],de(To)&&(To=o),F()},m);return q},Yq=o,lh=o,Dh={},lb={},tr={},oq={},pp={},qj={},Zc={},Nj={},Dl={},dp={},vf=/.json$/,Cd=/^data:image\/svg\+xml/,nd={},Bi=[],ec={},xn=o,pj=o,Hj=function(){},eh=function(){throw"Oops!"},$n=[0,0,0],qb={x:0,y:0,width:0,height:0},Rl=o,rs=o,kr=o,Gq=function(y,H){lb[y]=H,H&&H.comps&&!H.uuid&&(H.uuid=E.Math.generateUUID()),ts[y]&&(H.cacheRule=ts[y],delete ts[y])},ul=function(B){rs&&!B._72O&&(kr||(kr={}),kr[B._72O=Gk()]=B),Yl!=o?Oi()<.05&&O&&!le&&(yr=Mi):yr=Vd},Nd=function(b,E,s,j){rs||(rs={});var F=rs[b];if(F){if(F.url===E)return;F.image?(F.image.onload=Hj,F.image.onerror=Hj):F.request&&(F.request.onload=Hj,F.request.onerror=Hj)}if(vf.test(E)){var O=new nk;if(rs[b]={request:O,url:E},E=N.beforeLoadURL(E),E.data){var w=N.parse(E.data);Cj(b,w),N.handleImageLoaded(b,w)}else{O.onload=function(){if(200===this.status||0===this.status){var J=N.parse(O.getResponseText());Cj(b,J),N.handleImageLoaded(b,J)}else Cj(b,N.handleUnfoundImage(b,E)||o)},O.onerror=function(){Cj(b,N.handleUnfoundImage(b,E)||o)};var z={};z.url=encodeURI(E),z.sync=!1,O.send(z)}}else{var w=new Image;rs[b]={image:w,url:E},/^data:image/.test(E)||(E=N.beforeLoadURL(E),E=N.appendTimeStamp(E),E=encodeURI(E),w.crossOrigin=N.crossOrigin),N.convertImageSrc(E,function(H){dl&&(E.toLowerCase().indexOf(".svg")>0||Cd.test(E))?(L.body.appendChild(w),w.style.visibility="hidden",w.onload=function(){W(function(){if(s&&(w.width=s),j&&(w.height=j),!w.width||!w.height){var Z=w.width||w.clientWidth,O=w.height||w.clientHeight;w.width=Z,w.height=O}N.handleImageLoaded(b,w),Cj(b,w),L.body.removeChild(w),w.style.visibility=""},180)},w.onerror=function(){Cj(b,N.handleUnfoundImage(b,E)||o),L.body.removeChild(w),w.style.visibility=""}):(w.onload=function(){s&&(w.width=s),j&&(w.height=j),N.handleImageLoaded(b,w),Cj(b,w)},w.onerror=function(){Cj(b,N.handleUnfoundImage(b,E)||o)}),w.src=H})}},Cj=function(u,$){if(Gq(u,$),delete rs[u],de(rs)&&(rs=o,kr)){for(var R in kr){var V=kr[R];V._2O&&V._2O[u]&&(V.deleteTexture(u),delete V._2O[u]),V.invalidateAll&&V.invalidateAll(S,"imageLoaded",u),V.redraw&&V.redraw(),V.iv(),delete V._72O}kr=o}if($&&kr)for(var R in kr){var V=kr[R];V.invalidateAll&&V.invalidateAll(S,"imageLoading",u),V.redraw&&V.redraw(),V.iv()}},Hg=function(){return m=I&&Date,function(){return d.performance&&d.performance.now?d.performance.now():Date.now()}}(),zl=function(G,r,x){return{width:G,height:r,comps:Si(x)?x:[x]}},Mg=function(n,V){return{type:xf,rect:[n,V,1.6,1.6],borderWidth:1,borderColor:dd,gradient:Qi,gradientColor:ah,background:dd}},sf=function(j,z){return zl(16,16,{type:gi,rect:[4,4,10,8],background:j,rotation:z?1.57:3.14})},Gp=function(x,G){return zl(16,16,{type:gi,rect:[4,4,8,7],background:x,rotation:G?3.14:0})},Xr=function(Z){var l=Z._orientation;return"horizontal"===l||"h"===l},yp=function(z,Q){var C=o||4,t=o||1,U=o||1;0>C?C=0:C>.25&&(C=.25);var W,T,u,b,E,Z,R,L=.5,g=[],a=[],P=[],I=j/U,S=j/t,K=L-C;for(T=0;t>=T;T++)for(b=-s+T*S,Z=X(b),E=V(b),W=0;U>=W;W++)u=W*I,R=K+C*Z,g.push(X(u)*R,E*C,-V(u)*R),(c=[z,Q])&&a.push(W/U,1-T/t);for(T=0;t>T;T++){var n=T*(U+1),d=(T+1)*(U+1);for(W=0;U>W;W++)P.push(n+W,d+W+1,d+W,n+W,n+W+1,d+W+1),Cr.z=Hf.z=[z,Q]}},ho=function(j){var S=2,z=0;for(var a in j)a.length===S&&B(a,32)===sp&&(xn=pj=j[a]),z++;return z},Dn=function(o,B,T,y){return T||(T=Tk?5:3,T/=y||1),{x:o-T,y:B-T,width:2*T,height:2*T}},hs=function(f,W,U,p){var e=this;W||(W=Tk?5:3,U=20,p=20);var N={x:f,y:W,width:U,height:p};if(U)for(var J=0;U>J;J++)if(3===U)p=20;else for(var z=0;p>z;z++)e=d?d:U;var B={x:s,y:2*s};if(Ib(N,B)){var E=hk[0]+md[0]+ms[1]+Or.length,i=rc[0]+hp[0]+ms[1]+Zr.length;_r[Ob]=[e[E],e[i]],e[E]=In[Ob],e[i]=In[dh]}},Vr=function(D){return(/ble$/.test(D)||/ed$/.test(D)||a[D]?"is":"get")+D.charAt(0).toUpperCase()+D.slice(1)},In=function(U){return"set"+U.charAt(0).toUpperCase()+U.slice(1)},rb=function(s){return typeof s===Tg||s instanceof String},Ie=function(S){return typeof S===sk},Vd=function(I){return typeof I===xc},uq=function(u){return u&&"object"==typeof u},fd=function(m){return"function"==typeof m},Si=function(X){return X instanceof Array},oc=function(c){return c instanceof Fj},Ai=function(x){return Si(x)?new Fj(x):x},Sl=function(r){return r instanceof Rd},Ej=function(U){return U instanceof Gm},sj=function(Y){return Y instanceof Oq},qq=function(a,s){if(!(a instanceof E.Group))return!1;if(!s)return a.isExpanded();var G=s.getDataUI(a);return G&&G._88I?!0:!1},ff=function(v){return v instanceof zm},Jn=function(O){return O&&"IFRAME"===O.tagName},Wr=function(f){return f==o||N.numberDigits==o?f:parseFloat(f.toFixed(N.numberDigits))},ad=function(H,j,c){var Q,l=j.length;if(c)for(var G=0;c>G;G++)if(3===l)H.push(j[0]),H.push(j[1]),H.push(j[2]);else for(Q=0;l>Q;Q++)H.push(j[Q]);else if(3===l)H.push(j[0]),H.push(j[1]),H.push(j[2]);else for(Q=0;l>Q;Q++)H.push(j[Q])},zg=function(R){return R?uq(R)?R:{}:!1},vq=function(c,w,i){var v,H=uq(c)?c:c.prototype;for(v in w)i&&v in H?H[v]===S&&console.warn("class",H,"has own undefined property",v,", keep exist!"):H[v]=w[v];return c},Uh=function(Q,w){if(!("wheelDelta"in w)){var B=w.deltaMode;w.wheelDelta=B===w.DOM_DELTA_PIXEL?-w.deltaY:B===w.DOM_DELTA_LINE?40*-w.deltaY:120*-w.deltaY}Q.handle_mousewheel(w)},rg=function(l){return String.fromCharCode(l)},Xg=function(W){for(var z,y=0,O="";y<W.length;y++)z=W[W.length-1-y],"%"===z?z="'":"a"===z?z='"':"]"===z&&(z="\\"),O+=rg(z.charCodeAt(0)-1);return O},ii=function(m,F,I){m.superClass.constructor.apply(F,I)},de=function(X){for(var u in X)return!1;return!0},Ad=function(c){return c?0===c.length:!0},Tl=function(){var O="";return[He[0],Hc[0],$h[0]].forEach(function(J){O+=In(J).slice(3)}),ki=L&&L[O]||Ki,function(e,Z){return e===Z?!0:e.x===Z.x&&e.y===Z.y&&e.width===Z.width&&e.height===Z.height}}(),Ud=function(W,e,k){return e>W?e:W>k?k:W},Co=function(U){return 0>U?-1:U>0?1:0},Oi=function(){var z=1e4*V(se++);return z-P(z)},ce=function(P,c,O){return Cq(P.x,P.y,c.x,c.y,O.x,O.y,O.x+O.width,O.y,!0)||Cq(P.x,P.y,c.x,c.y,O.x+O.width,O.y,O.x+O.width,O.y+O.height,!0)||Cq(P.x,P.y,c.x,c.y,O.x+O.width,O.y+O.height,O.x,O.y+O.height,!0)||Cq(P.x,P.y,c.x,c.y,O.x,O.y+O.height,O.x,O.y,!0)},Cq=function(U,g,R,_,h,A,F,c,K){var O=(F-h)*(g-A)-(c-A)*(U-h),n=(c-A)*(R-U)-(F-h)*(_-g);if(0!==n){var s=O/n,Z=U+s*(R-U),I=g+s*(_-g);return K&&(Z+So<Q(U,R)||Z-So>r(U,R)||Z+So<Q(h,F)||Z-So>r(h,F)||I+So<Q(g,_)||I-So>r(g,_)||I+So<Q(A,c)||I-So>r(A,c))?o:[Z,I]}return o},jl=function(o,n,h){if(o&&h)if(n){if(n===Th)return o.getStyle(h);if(n===rh)return o.getAttr(h);if(n===ln)return o[h]}else if(h=Vr(h),o[h])return o[h]();return S},dq=function(h,H,E,z){if(h&&E)if(H){if(H===Th)h.s(E,z);else if(H===rh)h.a(E,z);else if(H===ln){var $=h[E];h[E]=z,h.fp("f:"+E,$,z)}}else E=In(E),h[E]&&h[E](z)},vs=function(S,I,u){return I&&"top"!==I?"bottom"===I?{x:S.x,y:S.y,width:S.width,height:S.height*u}:"right"===I?{x:S.x,y:S.y,width:S.width*u,height:S.height}:"left"===I?{x:S.x+S.width*(1-u),y:S.y,width:S.width*u,height:S.height}:void 0:{x:S.x,y:S.y+S.height*(1-u),width:S.width,height:S.height*u}},Kn=function(G,l,E,U,i){l&&xe(G,E,U,1,i,l)},Mk=function(w,G,L,f){var O=1-w;return O*O*G+2*w*O*L+w*w*f},Cr=function(W,Q,d,F,D){var g=1-W;return g*g*g*Q+3*g*g*W*d+3*g*W*W*F+W*W*W*D},hh=function(l){var D,S,W,w,p=0;return l.forEach(function(x){if(D=x.length,D>0)for(S=x[0],w=1;D>w;w++)W=x[w],p+=Qm(S,W),S=W}),p},Vk=function(f,s,P){var Z="__"+f,k=function(J){P.disabled||P["handle_"+f](J)};P[Z]||(P[Z]=k,A(s,f,k))},rl=function(h,x,d){var s="__"+h,G=d[s];G&&(u(x,h,G),delete d[s])},ti=function(p,q){var v="_"+q;p[Vr(q)]=function(){return this[v]},p[In(q)]=function(g){var L=this[v];this[v]=g,this.fp(q,L,g)}},qd=function(Q){return l.create(Q)},Fb=function(V){if(!V.element){var y,Q;(y=V.textField)?Q=ur(yn.TextField,y):(y=V.textArea)?Q=ur(yn.TextArea,y):(y=V.button)?Q=ur(yn.Button,y):(y=V.comboBox)?Q=ur(yn.ComboBox,y):(y=V.checkBox)?Q=ur(yn.CheckBox,y):(y=V.radioButton)?Q=ur(yn.RadioButton,y):(y=V.slider)?Q=ur(yn.Slider,y):(y=V.colorPicker)?Q=ur(yn.ColorPicker,y):(y=V.image)&&(Q=ur(yn.Image,y)),Q&&(V.element=Q)}},kb=function(l,s){var j=Pd(l);return j._ht=s,j},Pd=function(C,e){var D=L.createElement("div"),_=D.style;return D.tabIndex=-1,D.onkeydown=Ge,_.msTouchAction=hg,Zh(D,o,0),Tk&&_.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",o),C&&(_.overflow=rc),e&&xh(e,D),D},ib=function(Y,I){var F=L.createElement("canvas"),G=F.style;return G.msTouchAction=hg,I||(G.pointerEvents=hg),Zh(F,o,0),Y&&xh(Y,F),F},Zh=function(m,r,V){var l=m.style;l.border=r?r+" solid 1px":0,l.outline=0,l.padding=V?"0 "+V+Yg:0,Kf(m)},Kf=function(Q){var b=Q.style;b.position=El,b.margin=0,b.setProperty("box-sizing","border-box",o),b.setProperty("-moz-box-sizing","border-box",o)},km=function(h,J,d,L){L||(L=bq),J!=o&&(h.width=J*L,h.style.width=J+Yg),d!=o&&(h.height=d*L,h.style.height=d+Yg)},xh=function(L,e,p){L.appendChild(e),p&&(e.style.position=El)},Re=function(r,q){q.split||(q+="");for(var N,w=q.split("\n"),J=0,c=w.length,V=0;c>V;V++){var x=np(r.font,w[V]);x.width>J&&(J=x.width),N||(N=x.height)}return r.ss=w,{width:J,height:N*c}},xq=function(K,O,b,N,D,R){var H=O.length;if(1===H)Om(K,O[0],b,N,D);else for(var i=b.height/H,d={x:b.x,y:b.y,width:b.width,height:i},F=0;F<O.length;F++)R?qh(K,O[F],N,D,d.x,d.y,d.width,d.height,R):Om(K,O[F],d,N,D),d.y+=i},Om=function(R,j,y,p,L){R.font=p?p:ej,R.fillStyle=L?L:Se,R.textAlign=Oj,R.textBaseline=fr;var M,W;y?y.width===S?(M=y.x,W=y.y):(M=y.x+y.width/2,W=y.y+y.height/2):(M=0,W=0),R.fillText(j,h(M),h(W))},Jb=function(f){f.getView&&(f=f.getView());var $=f.offsetWidth||f.scrollWidth;return!$&&f.style.width&&($=B(f.style.width)),$},Tp=function(_){_.getView&&(_=_.getView());var Z=_.offsetHeight||_.scrollHeight;return!Z&&_.style.height&&(Z=B(_.style.height)),Z},Jr=function(v,H,o){var X=H[0].toUpperCase()+H.substring(1,H.length);v["webkit"+X]=o,v["moz"+X]=o,v["ms"+X]=o,v["o"+X]=o,v[H]=o},uj=function(){var l=function(x){Ge(x),x.stopPropagation()},W=function(n){Ge(n)},M=Tk?[mi]:[qm,Bn];return function(c,v){var U=Pd(),D=U.style;return D.backgroundColor=N.disabledBackground,c&&(D.backgroundImage="url("+c+")",D.backgroundPosition="50% 50%",D.backgroundRepeat="no-repeat no-repeat"),v===!1?M.forEach(function(Q){A(U,Q,W)}):M.forEach(function(C){A(U,C,l)}),U}}(),Vn=function(y){var L=y.getContext("2d");return L.save(),L.lineCap=zo,L.lineJoin=Yd,L},yr=function(J,n,N,H){te(J,n*bq,N*bq),H*=bq,1!==H&&J.scale(H,H)},te=function(i,X,B){i.translate(X,B)},Rh=function(H,j){j&&H.rotate(j)},tl=function(f,g,G){g===S&&(g=1),G===S&&(G=1),(1!==g||1!==G)&&f.scale(g,G)},Xf=!1,qf=function(b){var N=L.activeElement;if(L.activeElement!==b){N&&N.forceOnblur&&N.forceOnblur();for(var _=[],M=b.parentNode;M;)_.push([M,M.scrollLeft,M.scrollTop]),M=M.parentNode;if(!Xf){var U=[],F=[];try{for(var O=d.parent,D=d;O!==D;)U.push([O,O.scrollX,O.scrollY]),D=O,O=d.parent;var h=d.frameElement;if(h)for(var u=h.parentNode;u;)F.push([u,u.scrollLeft,u.scrollTop]),u=u.parentNode}catch(n){Xf=!0}}if(Tk)b.focus();else{var p=ri(),k=p.target;b.focus(),k.scrollLeft=p.left,k.scrollTop=p.top}_.forEach(function(d){d[0].scrollLeft=d[1],d[0].scrollTop=d[2]}),Xf||(U.forEach(function(e){e[0].scrollTo(e[1],e[2])}),F.forEach(function(d){d[0].scrollLeft=d[1],d[0].scrollTop=d[2]}))}},mm=function(N){return N&&N.getView?N.getView():N},_o=function(H,K,n,X,e){if(2===arguments.length&&(n=K.y,X=K.width,e=K.height,K=K.x),H.isSelfViewEvent)H.setX(K),H.setY(n),H.setWidth(X),H.setHeight(e);else{var f=mm(H),q=f.style;if((L.fullscreenElement||L.mozFullScreenElement||L.webkitFullscreenElement||L.msFullscreenElement)!==f)K!==S&&(q.left=K+Yg),n!==S&&(q.top=n+Yg),X!==S&&(q.width=X+Yg),e!==S&&(q.height=e+Yg);else{var o=N.getWindowInfo();q.left=(K=o.left)+Yg,q.top=(n=o.top)+Yg,q.width=(X=o.width)+Yg,q.height=(e=o.height)+Yg}H.endEditing&&!Tk&&H.endEditing(),H.redraw&&H.redraw(),H.invalidate&&H.invalidate(),H.onLayouted&&H.onLayouted(K,n,X,e),H.fireViewEvent&&H.fireViewEvent("layout")}},Ln=function(F){if(!F.touches)return F;var D=F.touches[0];return D?D:F.changedTouches[0]},qs=function(v){return Tk?Ln(v).target:v.target},Ed=function(C){N.popup&&N.popup.close(),N.popup=C},Wc=o,Do=function(p){Wc.handleWindowTouchMove(p)},hm=function(K){Wc.handleWindowTouchEnd(K),u(d,ar,Do),u(d,Po,hm),Wc=o},gk=function(N){Wc.handleWindowMouseMove(N)},Qo=function(r){Wc.handleWindowMouseUp(r),u(d,Ti,gk),u(d,Xk,Qo),Wc=o},df=function(_){return 1===_f(_)},ob=function(K,E){return E?E.keyCode===K:qj[K]},qo=function(d){return Xl(d)&&ob(65,d)},Lc=function(w){return ob(46,w)||ob(8,w)},pb=function(A){return function(F){return F?F.keyCode===A:qj[A]}},sp=573,gf=[65,83,68,87,37,38,39,40,32,13,27],il=pb(gf[0]),Bo=pb(gf[1]),hb=pb(gf[2]),jc=pb(gf[3]),Di=pb(gf[4]),mr=pb(gf[5]),vc=pb(gf[6]),jn=pb(gf[7]),Pe=pb(gf[8]),lo=pb(gf[9]),Lq=pb(gf[10]),ik={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Ei=[2,2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,11,839],bg=o,Op=o,yc=function(L,i){bg||(bg=ib()),km(bg,L,i,1);var A=Vn(bg);return A.clearRect(0,0,L,i),A},$i=function(){var z,$={};for(var C in d){var S=ys.length;if(C.length==S&&C[0]===ys[2]&&C[1]===hg[1]&&C[4]===ys[3]&&C[5]===ys[4]&&C.substr(S-2)===hg[1]+hg[2]){var P=d[C];for(var R in P)R.length===S&&R.substr(0,3)===zn[3]+cf[3]+ih[0]&&R.substr(S-2)===ys[0]+Fc[3]&&(ne=P[R])}}return function(g){var n,p=$[g];return p||(z||(z=ib(),km(z,1,1,1)),n=z.getContext("2d"),n.clearRect(0,0,1,1),xe(n,0,0,1,1,g),p=n.getImageData(0,0,1,1).data,p=$[g]=[p[0],p[1],p[2],p[3]]),p}}(),zh=function(H){if(!rb(H))return H;var L=$i(H);return L.CA||(L.CA=[L[0]/255,L[1]/255,L[2]/255,L[3]/255]),L.CA},Ug=function(k,n,Y,O,d){var T=ib();T.width=Y,T.height=O;var x=T.getContext("2d");x.drawImage(k,0,0,Y,O);try{for(var S=x.getImageData(0,0,Y,O),F=S.data,u=0,o=F.length;o>u;u+=4){var m=F[u+0],L=F[u+1],f=F[u+2],X=F[u+3];"override_a"===d?F[u+3]=255*n[3]:"override_rgb"===d?(F[u+0]=255*n[0],F[u+1]=255*n[1],F[u+2]=255*n[2]):"override"===d?(F[u+0]=255*n[0],F[u+1]=255*n[1],F[u+2]=255*n[2],F[u+3]=255*n[3]):(F[u+0]=n[0]*m,F[u+1]=n[1]*L,F[u+2]=n[2]*f,F[u+3]=n[3]*X)}x.putImageData(S,0,0)}catch(g){return k}return T},_r=function(D,N,J){return N&&(N="miter"===J?8*N+20:N+1,D&&me(D,N)),N},zi=function(M,O){if(O){var N=new bm(O),l=M.width/2,P=M.height/2,B=uh([N.tf(-l,-P),N.tf(l,-P),N.tf(l,P),N.tf(-l,P)]);return B.x+=M.x+l,B.y+=M.y+P,B}return M},fk=function(s,a,K,x,r,l,B,G){x*=Math.PI/180;var W={x:Math.cos(x)*(s.x-B.x)/2+Math.sin(x)*(s.y-B.y)/2,y:-Math.sin(x)*(s.x-B.x)/2+Math.cos(x)*(s.y-B.y)/2},t=Math.pow(W.x,2)/Math.pow(a,2)+Math.pow(W.y,2)/Math.pow(K,2);t>1&&(a*=Math.sqrt(t),K*=Math.sqrt(t));var j=(r==l?-1:1)*Math.sqrt((Math.pow(a,2)*Math.pow(K,2)-Math.pow(a,2)*Math.pow(W.y,2)-Math.pow(K,2)*Math.pow(W.x,2))/(Math.pow(a,2)*Math.pow(W.y,2)+Math.pow(K,2)*Math.pow(W.x,2)));isNaN(j)&&(j=0);var o={x:j*a*W.y/K,y:j*-K*W.x/a},A={x:(s.x+B.x)/2+Math.cos(x)*o.x-Math.sin(x)*o.y,y:(s.y+B.y)/2+Math.sin(x)*o.x+Math.cos(x)*o.y},w=function(C){return Math.sqrt(Math.pow(C[0],2)+Math.pow(C[1],2))},h=function(d,s){return(d[0]*s[0]+d[1]*s[1])/(w(d)*w(s))},p=function(i,A){return(i[0]*A[1]<i[1]*A[0]?-1:1)*Math.acos(h(i,A))},D=p([1,0],[(W.x-o.x)/a,(W.y-o.y)/K]),Z=[(W.x-o.x)/a,(W.y-o.y)/K],e=[(-W.x-o.x)/a,(-W.y-o.y)/K],k=p(Z,e);h(Z,e)<=-1&&(k=Math.PI),h(Z,e)>=1&&(k=0);var h=a>K?a:K,S=a>K?1:a/K,I=a>K?K/a:1;if(null==G){var O={x:0,y:0,width:0,height:0};me(O,h),O.x*=S,O.width*=S,O.y*=I,O.height*=I;var N=new bm(x);return O=uh([N.tf(O.x,O.y),N.tf(O.x+O.width,O.y),N.tf(O.x+O.width,O.y+O.height),N.tf(O.x,O.y+O.height)]),O.x+=A.x,O.y+=A.y,[{x:O.x,y:O.y},{x:O.x+O.width,y:O.y},{x:O.x+O.width,y:O.y+O.height},{x:O.x,y:O.y+O.height}]}G.translate(A.x,A.y),G.rotate(x),G.scale(S,I),G.arc(0,0,h,D,D+k,1-l),G.scale(1/S,1/I),G.rotate(-x),G.translate(-A.x,-A.y)},ue=function(g,A){g&&g.beginPath();for(var J,Z,p,K=[],D=function(z){for(var l,d=/(\-{0,1}[\d\.]+)/gi,y=[];l=d.exec(z);)y.push(parseFloat(l[0]));return y},v=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,B={x:0,y:0};J=v.exec(A);){var d=J[0],c=d.substr(0,1);if("M"===c||"m"===c){for(var V=D(d),t=0;t<V.length;t+=2){var s=V[t],k=V[t+1];"m"===c&&(s+=B.x,k+=B.y),g&&g.moveTo(s,k),K.push({x:s,y:k}),B.x=s,B.y=k}Z=p=null}else if("H"===c||"h"===c){for(var V=D(d),t=0;t<V.length;t+=1){var s=V[t];"h"===c&&(s+=B.x),g&&g.lineTo(s,B.y),K.push({x:s,y:B.y}),B.x=s}Z=p=null}else if("C"===c||"c"===c){for(var V=D(d),t=0;t<V.length;t+=6){var S=V[t],n=V[t+1],L=V[t+2],X=V[t+3],s=V[t+4],k=V[t+5];"c"===c&&(S+=B.x,n+=B.y,L+=B.x,X+=B.y,s+=B.x,k+=B.y),g&&g.bezierCurveTo(S,n,L,X,s,k),K.push({x:S,y:n}),K.push({x:L,y:X}),K.push({x:s,y:k}),B.x=s,B.y=k}Z=[S,n,L,X,s,k],p=null}else if("S"===c||"s"===c){for(var V=D(d),t=0;t<V.length;t+=4){var S,n;Z?(S=2*Z[4]-Z[2],n=2*Z[5]-Z[3]):(S=B.x,n=B.y);var L=V[t],X=V[t+1],s=V[t+2],k=V[t+3];"s"===c&&(L+=B.x,X+=B.y,s+=B.x,k+=B.y),g&&g.bezierCurveTo(S,n,L,X,s,k),K.push({x:S,y:n}),K.push({x:L,y:X}),K.push({x:s,y:k}),B.x=s,B.y=k}Z=[S,n,L,X,s,k],p=null}else if("Q"===c||"q"===c){for(var V=D(d),t=0;t<V.length;t+=4){var S=V[t],n=V[t+1],s=V[t+2],k=V[t+3];"q"===c&&(S+=B.x,n+=B.y,s+=B.x,k+=B.y),g&&g.quadraticCurveTo(S,n,s,k),K.push({x:S,y:n}),K.push({x:s,y:k}),B.x=s,B.y=k}Z=null,p=[S,n,s,k]}else if("T"===c||"t"===c){for(var V=D(d),t=0;t<V.length;t+=2){var S,n;p?(S=2*p[2]-p[0],n=2*p[3]-p[1]):(S=B.x,n=B.y);var s=V[t],k=V[t+1];"t"===c&&(s+=B.x,k+=B.y),g&&g.quadraticCurveTo(S,n,s,k),K.push({x:S,y:n}),K.push({x:s,y:k}),B.x=s,B.y=k}Z=null,p=[S,n,s,k]}else if("V"===c||"v"===c){for(var V=D(d),t=0;t<V.length;t+=1){var k=V[t];"v"===c&&(k+=B.y),g&&g.lineTo(B.x,k),K.push({x:B.x,y:k}),B.y=k}Z=p=null}else if("L"===c||"l"===c){for(var V=D(d),t=0;t<V.length;t+=2){var s=V[t],k=V[t+1];"l"===c&&(s+=B.x,k+=B.y),g&&g.lineTo(s,k),K.push({x:s,y:k}),B.x=s,B.y=k}Z=p=null}else if("A"===c||"a"===c){for(var V=D(d),t=0;t<V.length;t+=7){var M=V[t],T=V[t+1],m=V[t+2],W=V[t+3],Q=V[t+4],s=V[t+5],k=V[t+6];"a"===c&&(s+=B.x,k+=B.y);var l=fk(B,M,T,m,W,Q,{x:s,y:k},g);l&&(K=K.concat(l)),B.x=s,B.y=k}Z=p=null}var f=d.substr(d.length-1);("z"===f||"Z"===f)&&g&&g.closePath()}return K},On=function($,P){var S,L,Q="L"===P[0],B=P.length;$.save(),Q?($.transform(P[5],P[6],P[7],P[8],P[9],P[10]),S=$.createLinearGradient(P[1],P[2],P[3],P[4]),L=11):($.transform(P[7],P[8],P[9],P[10],P[11],P[12]),S=$.createRadialGradient(P[1],P[2],P[3],P[4],P[5],P[6]),L=13);for(var w=$.compGray;B>L;)S.addColorStop(P[L],w?N.toGrayColor(P[L+1]):P[L+1]),L+=2;$.fillStyle=S},Hf=function(X,c){var k=X.s("shape.gradient.pack");if(k){for(var p=k.length,m=new Array(p),R=0;p>R;R++)m[R]=k[R];var r,z,f,d,M,l,w,S,K,T,Y,i,J,N="L"===m[0];r=N?5:7,z=m[r],f=m[r+1],d=m[r+2],M=m[r+3],l=m[r+4],w=m[r+5],S=c[0],K=c[1],T=c[2],Y=c[3],i=c[4],J=c[5],m[r]=S*z+T*f,m[r+1]=K*z+Y*f,m[r+2]=S*d+T*M,m[r+3]=K*d+Y*M,m[r+4]=S*l+T*w+i,m[r+5]=K*l+Y*w+J,X.s("shape.gradient.pack",m)}},Dc=function(d,L,z,D){var I=!1;if(d.beginPath?d.beginPath():I=!0,oc(L)&&(L=L._as),oc(z)&&(z=z._as),z&&z.length){for(var m,n,A,J,U=0,B=0,b=z.length;b>B;B++)m=z[B],1===m?(n=L[U++],d.moveTo(n.x,I?-n.y:n.y)):2===m?(n=L[U++],d.lineTo(n.x,I?-n.y:n.y)):3===m?(n=L[U++],A=L[U++],d.quadraticCurveTo(n.x,I?-n.y:n.y,A.x,I?-A.y:A.y)):4===m?(n=L[U++],A=L[U++],J=L[U++],d.bezierCurveTo(n.x,I?-n.y:n.y,A.x,I?-A.y:A.y,J.x,I?-J.y:J.y)):5===m&&d.closePath();D&&5!==m&&d.closePath()}else{var f,X,w,W=L.length;if(W>0){for(f=L[0],d.moveTo(f.x,I?-f.y:f.y),X=1;W>X;X++)w=L[X],d.lineTo(w.x,I?-w.y:w.y);D&&d.closePath()}}},Qc=function(V,M,T,U){if(oc(V)&&(V=V._as),oc(M)&&(M=M._as),M&&M.length){T=T||zc;for(var J,x,$,m,e,Q,i,t,b=[],g=o,u=0,l=0,A=M.length;A>l;l++)if(J=M[l],1===J)b.push(g=[]),g.push(V[u++]);else if(2===J)g.push(V[u++]);else if(3===J){for(x=g[g.length-1],$=V[u++],m=V[u++],Q=1;T>Q;Q++)i=Mk(Q/T,x.x,$.x,m.x),t=Mk(Q/T,x.y,$.y,m.y),g.push({x:i,y:t,b:!0});g.push(m)}else if(4===J){for(x=g[g.length-1],$=V[u++],m=V[u++],e=V[u++],Q=1;T>Q;Q++)i=Cr(Q/T,x.x,$.x,m.x,e.x),t=Cr(Q/T,x.y,$.y,m.y,e.y),g.push({x:i,y:t,b:!0});g.push(e)}else 5===J&&g.push(g[0]);return U&&5!==J&&g&&g.length>2&&g.push(g[0]),b}return U&&V.length>2&&(V=V.slice(),V.push(V[0])),V?[V]:[]},ij=function(A,D,z,y,C,l){var x,f,k,d=$i(D),j=y,S=d[0],$=d[1],W=d[2];if(z){var p=$i(z);x=p[0]-S,f=p[1]-$,k=p[2]-W}else x=255-S,f=255-$,k=255-W;for(l||(l=y>10?1:.5,l=1>C?Q(l/C,2):l),A.save(),A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowBlur=0,A.shadowColor=0;(y-=l)>0;){var H=1-y/j,F=S+x*H,I=$+f*H,u=W+k*H;F=Q(Z(F),255),I=Q(Z(I),255),u=Q(Z(u),255),A.strokeStyle="rgb("+F+","+I+","+u+")",A.lineWidth=y,A.stroke()}A.restore()},kl=function(){var Y={};return function(P,h){var R=P+"-"+h,B=Y[R];if(B)return B;var i,d,_,F=$i(P);return 0>h?(h=(100+h)/100,i=Z(F[0]*h),d=Z(F[1]*h),_=Z(F[2]*h)):(h/=100,i=F[0],d=F[1],_=F[2],i+=(255-i)*h,d+=(255-d)*h,_+=(255-_)*h,i=Q(Z(i),255),d=Q(Z(d),255),_=Q(Z(_),255)),Y[R]="rgb("+i+","+d+","+_+")"}}(),xe=function(p,e,M,P,V,F){F&&(p.fillStyle=F),p.beginPath(),p.rect(e,M,P,V),p.fill()},_c=function(w,G,P,j,Z,E,Y){w.beginPath(),Mc[G](w,P.x,P.y,P.width,P.height,j,Z,E,Y)},Ub=function(v,P,b,J,u){var S=Mc[b];v.fillStyle=S?S(v,P,J?J:ah,u.x,u.y,u.width,u.height):P},Li=function(g,v,R,q,w,S){try{if(!v.tagName&&v.comps){v._cacheImage_||(v._cacheImage_={});var D;D="override"===q?"colors_override":"override_rgb"===q?"colors_override_rgb":"override_a"===q?"colors_override_a":"colors",v._cacheImage_[D]||(v._cacheImage_[D]={__count__:0});var z=v._cacheImage_[D][R];z||(v._cacheImage_[D].__count__>N.imageCacheThreshold&&(v._cacheImage_[D]={__count__:0}),z=E.Default.toCanvas(v,rr(v),cc(v),null,w,S,R,null,q),v._cacheImage_[D][R]=z,v._cacheImage_[D].__count__++),v=z}g.fillStyle=g.createPattern(v,"repeat")}catch(P){g.fillStyle="black"}},_p=function(u,f,S,Z,s,Q,v){u.save(),u.translate(f,S),u.scale(1,v/Q),u.arc(0,0,Q,Z,s),u.restore()},rq=function(h,o,C,O,j,Q,F,G){var S,y,x,E,M,H,A,c,R,p,f;if(D(j)>2*s&&(j=2*s),M=Z(D(j)/(s/4)),S=j/M,y=-S,x=-O,M>0){H=o+X(O)*Q,A=C+V(-O)*F,G?h.lineTo(H,A):h.moveTo(H,A);for(var i=0;M>i;i++)x+=y,E=x-y/2,c=o+X(x)*Q,R=C+V(x)*F,p=o+X(E)*(Q/X(y/2)),f=C+V(E)*(F/X(y/2)),h.quadraticCurveTo(p,f,c,R)}},mf=function(C,$,X,l,j,B,O,Y,H){6===arguments.length&&(O=B,Y=B,H=B);var e=$+l,q=X+j,T=j>l?2*l:2*j;B=T>B?B:T,O=T>O?O:T,Y=T>Y?Y:T,H=T>H?H:T;var s=.29*H,Z=.58*H;C.moveTo(e,q-H),C.quadraticCurveTo(e,q-Z,e-s,q-s),C.quadraticCurveTo(e-Z,q,e-H,q),s=.29*Y,Z=.58*Y,C.lineTo($+Y,q),C.quadraticCurveTo($+Z,q,$+s,q-s),C.quadraticCurveTo($,q-Z,$,q-Y),s=.29*B,Z=.58*B,C.lineTo($,X+B),C.quadraticCurveTo($,X+Z,$+s,X+s),C.quadraticCurveTo($+Z,X,$+B,X),s=.29*O,Z=.58*O,C.lineTo(e-O,X),C.quadraticCurveTo(e-Z,X,e-s,X+s),C.quadraticCurveTo(e,X+Z,e,X+O),C.lineTo(e,q-H)},Ml=function(k,Y,A,V,y,b,I){Y&&(A=h(A),V=h(V),I||(I=1),k.fillStyle=Y,k.beginPath(),k.rect(A,V,I,b),k.rect(A,V,y,I),b-I>0&&k.rect(A,V+b-I,y,I),y-I>0&&k.rect(A+y-I,V,I,b),k.fill())},Xh=function(k,r,j,F){var t=F.x,y=F.y,G=F.width,J=F.height;if(!(!r||!j||0>=G||0>=J)){var K,_=Sm(r),R=br(r),n=j>0;1===j||-1===j?(k.fillStyle=n?_:R,k.beginPath(),k.rect(t,y,1,J),k.rect(t,y,G,1),k.fill(),k.fillStyle=n?R:_,k.beginPath(),k.rect(t,y+J-1,G,1),k.rect(t+G-1,y,1,J),k.fill()):(j=Q(D(j),Q(G/2,J/2)),K=k.createLinearGradient(t,y,t+j,y),K.addColorStop(0,n?_:R),K.addColorStop(1,r),k.fillStyle=K,k.beginPath(),k.moveTo(t,y),k.lineTo(t+j,y+j),k.lineTo(t+j,y+J-j),k.lineTo(t,y+J),k.lineTo(t,y),k.fill(),K=k.createLinearGradient(t,y,t,y+j),K.addColorStop(0,n?_:R),K.addColorStop(1,r),k.fillStyle=K,k.beginPath(),k.moveTo(t,y),k.lineTo(t+j,y+j),k.lineTo(t+G-j,y+j),k.lineTo(t+G,y),k.lineTo(t,y),k.fill(),K=k.createLinearGradient(t,y+J,t,y+J-j),K.addColorStop(0,n?R:_),K.addColorStop(1,r),k.fillStyle=K,k.beginPath(),k.moveTo(t,y+J),k.lineTo(t+j,y+J-j),k.lineTo(t+G-j,y+J-j),k.lineTo(t+G,y+J),k.lineTo(t,y+J),k.fill(),K=k.createLinearGradient(t+G,y,t+G-j,y),K.addColorStop(0,n?R:_),K.addColorStop(1,r),k.fillStyle=K,k.beginPath(),k.moveTo(t+G,y),k.lineTo(t+G-j,y+j),k.lineTo(t+G-j,y+J-j),k.lineTo(t+G,y+J),k.lineTo(t+G,y),k.fill())}},Cf=function(W,q,u,g,I,k,$){var s=W.createLinearGradient(g,I,k,$);return s.addColorStop(0,u),s.addColorStop(1,q),s},wj=function(E,H,m,K,W,S,v){var i=E.createLinearGradient(K,W,S,v);return i.addColorStop(0,H),i.addColorStop(.5,m),i.addColorStop(1,H),i},Le=function(U,F,e,b,N,s,u){var j=U.createLinearGradient(b,N,s,u);return j.addColorStop(0,F),j.addColorStop(1/3,e),j.addColorStop(2/3,F),j.addColorStop(1,e),j},yo=function(j,q,u,f,M,J,P,B,h){var e=j.createRadialGradient(f+J*B,M+P*h,Q(J,P)/24,f+J/2,M+P/2,r(J,P)/2);return e.addColorStop(0,u),e.addColorStop(1,q),e},Cb=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Mc={polygon:function(t,r,K,H,m,u){(u==o||3>u)&&(u=6);for(var x,_,z=Q(H,m)/2,W=r+H/2,Z=K+m/2,Y=0,i=2*s/u,d=0;u>d;d++)x=W+X(Y)*z,_=Z+V(Y)*z,0===d?t.moveTo(x,_):t.lineTo(x,_),Y+=i;
t.closePath()},arc:function(u,q,k,i,F,U,P,O,Y){U==o&&(U=s),P==o&&(P=j),O==o&&(O=!0);var Z=q+i/2,X=k+F/2;O&&u.moveTo(Z,X),Y?_p(u,Z,X,U,P,i/2,F/2):u.arc(Z,X,Q(i,F)/2,U,P),O&&u.closePath()},rect:function(K,U,s,Y,m){K.rect(U,s,Y,m)},circle:function(m,_,d,L,X){m.arc(_+L/2,d+X/2,Q(L,X)/2,0,j,!0)},oval:function(i,$,A,G,b){_p(i,$+G/2,A+b/2,0,j,G/2,b/2)},roundRect:function(s,z,t,p,h,J){J==o&&(J=Q(Q(p,h)/4,8)),mf(s,z,t,p,h,J)},star:function(e,U,B,J,R){var I=2*J,W=2*R,n=U+J/2,a=B+R/2;e.moveTo(n-I/4,a-W/12),e.lineTo(U+.306*J,B+.579*R),e.lineTo(n-I/6,a+W/4),e.lineTo(U+J/2,B+.733*R),e.lineTo(n+I/6,a+W/4),e.lineTo(U+.693*J,B+.579*R),e.lineTo(n+I/4,a-W/12),e.lineTo(U+.611*J,B+.332*R),e.lineTo(n+0,a-W/4),e.lineTo(U+.388*J,B+.332*R),e.closePath()},pentagram:function(B,q,T,L,w){var b=.5*w,P=q+.5*L,V=T+b,$=.5257311121191336*L;$>b&&($=b);var H=Cb,O=0;for(B.moveTo(P+$*H[O++],V+$*H[O++]);20>O;)B.lineTo(P+$*H[O++],V+$*H[O++]);B.closePath()},triangle:function(y,X,b,N,d){y.moveTo(X+N/2,b),y.lineTo(X+N,b+d),y.lineTo(X,b+d),y.closePath()},hexagon:function(Q,M,a,x,s){Q.moveTo(M,a+s/2),Q.lineTo(M+x/4,a+s),Q.lineTo(M+3*x/4,+a+s),Q.lineTo(M+x,a+s/2),Q.lineTo(M+3*x/4,a),Q.lineTo(M+x/4,a),Q.closePath()},pentagon:function(c,Z,k,C,h){var v=2*C,m=2*h,G=Z+C/2,K=k+h/2;c.moveTo(G-v/4,K-m/12),c.lineTo(G-v/6,K+m/4),c.lineTo(G+v/6,K+m/4),c.lineTo(G+v/4,K-m/12),c.lineTo(G+0,K-m/4),c.closePath()},diamond:function(u,G,R,E,Y){u.moveTo(G+E/2,R),u.lineTo(G,R+Y/2),u.lineTo(G+E/2,R+Y),u.lineTo(G+E,R+Y/2),u.closePath()},rightTriangle:function(o,$,g,B,i){o.moveTo($,g),o.lineTo($+B,g+i),o.lineTo($,g+i),o.closePath()},parallelogram:function(j,U,B,Z,k){var c=Z/4;j.moveTo(U+c,B),j.lineTo(U+Z,B),j.lineTo(U+Z-c,B+k),j.lineTo(U,B+k),j.closePath()},trapezoid:function(s,W,p,L,j){var u=L/4;s.moveTo(W+u,p),s.lineTo(W+L-u,p),s.lineTo(W+L,p+j),s.lineTo(W,p+j),s.closePath()},"linear.southwest":function(x,n,d,V,I,Y,e){return Cf(x,n,d,V,I+e,V+Y,I)},"linear.southeast":function(p,O,L,W,Y,o,$){return Cf(p,O,L,W+o,Y+$,W,Y)},"linear.northwest":function(Q,b,J,j,d,S,Z){return Cf(Q,b,J,j,d,j+S,d+Z)},"linear.northeast":function(L,J,T,w,C,B,U){return Cf(L,J,T,w+B,C,w,C+U)},"linear.north":function(D,r,H,N,A,Q,J){return Cf(D,r,H,N,A,N,A+J)},"linear.south":function(B,Y,L,U,y,K,H){return Cf(B,Y,L,U,y+H,U,y)},"linear.west":function(i,I,f,Y,d,n){return Cf(i,I,f,Y,d,Y+n,d)},"linear.east":function(z,S,s,X,j,l){return Cf(z,S,s,X+l,j,X,j)},"radial.center":function(M,B,n,t,P,T,u){return yo(M,B,n,t,P,T,u,.5,.5)},"radial.southwest":function(s,N,Y,j,a,M,t){return yo(s,N,Y,j,a,M,t,.25,.75)},"radial.southeast":function(h,K,x,v,m,e,O){return yo(h,K,x,v,m,e,O,.75,.75)},"radial.northwest":function(O,q,p,W,E,P,S){return yo(O,q,p,W,E,P,S,.25,.25)},"radial.northeast":function($,J,Z,u,M,C,Y){return yo($,J,Z,u,M,C,Y,.75,.25)},"radial.north":function(m,X,v,E,d,b,T){return yo(m,X,v,E,d,b,T,.5,.25)},"radial.south":function(y,V,C,e,n,G,g){return yo(y,V,C,e,n,G,g,.5,.75)},"radial.west":function(K,M,X,y,c,C,A){return yo(K,M,X,y,c,C,A,.25,.5)},"radial.east":function(H,D,v,u,j,A,J){return yo(H,D,v,u,j,A,J,.75,.5)},"spread.horizontal":function(w,j,k,a,N,J){return wj(w,j,k,a,N,a+J,N)},"spread.vertical":function(S,g,K,$,c,u,N){return wj(S,g,K,$,c,$,c+N)},"spread.diagonal":function(j,L,f,e,R,J,G){return wj(j,L,f,e+J,R,e,R+G)},"spread.antidiagonal":function(_,f,$,P,F,m,d){return wj(_,f,$,P,F,P+m,F+d)},"spread.north":function(z,n,j,V,u,l,A){return Le(z,n,j,V,u-A/4,V,u+A+A/4)},"spread.south":function(C,f,W,J,c,D,N){return Le(C,W,f,J,c-N/4,J,c+N+N/4)},"spread.west":function(x,V,u,e,F,C){return Le(x,V,u,e-C/4,F,e+C+C/4,F)},"spread.east":function(V,C,M,U,q,Y){return Le(V,M,C,U-Y/4,q,U+Y+Y/4,q)}},wf=function(o,l,R){return new bm(o).tf(l,R)},Lj=function(g){var W=g.touches[0],c=g.touches[1],S=W.clientX,Q=W.clientY,t=c.clientX,L=c.clientY;return T((S-t)*(S-t)+(Q-L)*(Q-L))},Aj=function(v){var D=v.touches[0],Z=v.touches[1],I=D.clientX,Y=D.clientY,U=Z.clientX,E=Z.clientY;return{x:(I+U)/2,y:(Y+E)/2}},of=(function(){for(var c=0,b=fi.split(""),i=0;i<b.length;i++)c=10*B(b[i])+c;return yp(d[sp.toString(8*i)+$h.substr(i)+3],d[sp.toString(8*i)+$h.substr(i)+4]),c}(),function(g,v,T){for(var G=0;G<T.size();G++){var p=T.get(G);g.co(p)&&v.add(p)}for(G=0;G<T.size();G++)p=T.get(G),of(g,v,p._children)}),Kj=function(Z,v,I){for(var u=0;u<I.size();u++){var i=I.get(I.size()-1-u);Z.co(i)&&v.add(i)}for(u=0;u<I.size();u++)i=I.get(u),Kj(Z,v,i._children)},Ck=function(P,F,o){for(var $=!1,I=0;I<o.size();I++){var S=o.get(I);P.co(S)?$&&F.add(S):$=1}for(I=0;I<o.size();I++)S=o.get(I),Ck(P,F,S._children)},bd=function(P,V,f){for(var r=!1,Z=0;Z<f.size();Z++){var E=f.get(f.size()-1-Z);P.co(E)?r&&V.add(E):r=!0}for(Z=0;Z<f.size();Z++)E=f.get(Z),bd(P,V,E._children)},Yh=N.moveDatas=function(V,H,$,l){var v=l==o;if(0!==H||0!==$||!v&&0!==l){var G=!0,E=[];if(V.forEach(function(q){G&&(q._69O||sj(q)||ff(q))&&(G=!1)}),G)E=V;else{var p={},O={};V.forEach(function(l){p[l._id]=!0});var a={},m=function(F){var K=F._id;return p[K]?(E.push(F),a[K]=!0):a[K]=!1},A=function(K){var F=K._id;if(O[F])return m(K);var x=a[F];if(x!==S)return x;var R=K._parent;if(R&&(ff(R)||sj(R))&&A(R))return a[F]=!0;var N=K._host;return N&&(O[F]=F,x=A(N),O[F]=S,x)?a[F]=!0:m(K)};V.forEach(function(v){A(v)})}E.forEach(function(t){if(Sl(t))v?t.translate(H,$):t.translate3d(H,$,l);else{var q=t.s(Mo);if(!q||q.isEmpty())return;var R=new Fj;q.each(function(U){U=rj(U),v?(U.x+=H,U.y+=$):(U.x+=H,U.y+=l,U.e==o?U.e=$:U.e+=$),R.add(U)}),t.s(Mo,R)}})}},wi=function(){function t(m,c){return c===m.substring(0,c.length)?!0:!1}function M(E){return parseFloat(E)||0}function $(Q,l){if(l==S&&(l=new Me),t(Q,"matrix3d")){var E=Q.substring(9,Q.length-1).split(",");E=E.map(M),l.fromArray(E)}else if(t(Q,"matrix")){var E=Q.substring(7,Q.length-1).split(",");E=E.map(M),l.el[0]=E[0],l.el[1]=E[1],l.el[2]=0,l.el[3]=0,l.el[4]=E[2],l.el[5]=E[3],l.el[6]=0,l.el[7]=0,l.el[8]=0,l.el[9]=0,l.el[10]=1,l.el[11]=0,l.el[12]=E[4],l.el[13]=E[5],l.el[14]=0,l.el[15]=1}return l}function p(X,d){d==S&&(d=new Of);var G=X.split(/\s+/);return G=G.map(M),d.set(G[0]||0,G[1]||0,G[2]||0),d}var P,o,L,E,W,h=function(J,T){P||(P=new Me,o=new Of,L=new Me,E=new Me,W=new Me),T==S&&(T=new Me);var u=getComputedStyle(J);u.transform&&"none"!==u.transform&&($(u.transform,P),p(u.transformOrigin,o),E.setPosition(o),o.negate(),W.setPosition(o),(dl||"preserve-3d"!==u.transformStyle)&&(P.el[8]=0,P.el[9]=0,P.el[10]=1,P.el[11]=0),T.multiplyMatrices(W,T),T.multiplyMatrices(P,T),T.multiplyMatrices(E,T)),!dl&&u.perspective&&"none"!==u.perspective&&(L.el[11]=-1/M(u.perspective),p(u.perspectiveOrigin,o),E.setPosition(o),o.negate(),W.setPosition(o),T.multiplyMatrices(W,T),T.multiplyMatrices(L,T),T.multiplyMatrices(E,T));for(var k=J.offsetParent,X=J.offsetLeft,A=J.offsetTop,Y=J.parentElement;Y&&Y!==k;){var G=getComputedStyle(Y);if("none"!==G.transform||"none"!==G.perspective)break;Y=Y.parentElement}return Y==S&&J!==J.ownerDocument.documentElement&&"fixed"!==u.position&&(Y=J.ownerDocument.documentElement),k!=S&&k!==Y&&(X-=Y.offsetLeft,A-=Y.offsetTop),o.set(X,A,0),E.setPosition(o),T.multiplyMatrices(E,T),Y&&h(Y,T),T};return function(p,c){var n=p.parentElement;if(n){var q=n.updateAppendMatrix;if(q){delete n.updateAppendMatrix;var _=new Me;h(n,_);var Q=new Me;Q.getInverse(_),n._matrixAppend=Q,n._maxrixPreAppend=_}return c?n._matrixAppend:n._maxrixPreAppend}}}(),tg=function(t,d){for(;t&&!t.hasOwnProperty(d);)t=l.getPrototypeOf(t);return t&&l.getOwnPropertyDescriptor(t,d)},Iq=l.getPrototypeOf?function($,b,v){var s=tg(b,v);s&&l.defineProperty($,v,s)}:function(N,M,W){N[W]=M[W]},hj={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},Hq=function(){var _={1:function(n,E){return{x:n.x-E.width/2,y:n.y-E.height/2}},2:function(u,C){return{x:u.x+C.width/2,y:u.y-C.height/2}},3:function(t,R){return{x:t.x+t.width/2,y:t.y-R.height/2}},4:function(x,p){return{x:x.x+x.width-p.width/2,y:x.y-p.height/2}},5:function(H,y){return{x:H.x+H.width+y.width/2,y:H.y-y.height/2}},6:function(K){return{x:K.x,y:K.y}},7:function(w){return{x:w.x+w.width/2,y:w.y}},8:function(G){return{x:G.x+G.width,y:G.y}},9:function(i,s){return{x:i.x-s.width/2,y:i.y+s.height/2}},10:function(l,h){return{x:l.x+h.width/2,y:l.y+h.height/2}},11:function(H,R){return{x:H.x+H.width/2,y:H.y+R.height/2}},12:function(M,G){return{x:M.x-G.width/2+M.width,y:M.y+G.height/2}},13:function(F,N){return{x:F.x+F.width+N.width/2,y:F.y+N.height/2}},14:function(k,U){return{x:k.x-U.width/2,y:k.y+k.height/2}},15:function(T){return{x:T.x,y:T.y+T.height/2}},16:function(s,L){return{x:s.x+L.width/2,y:s.y+s.height/2}},17:function(l){return{x:l.x+l.width/2,y:l.y+l.height/2}},18:function(V,s){return{x:V.x+V.width-s.width/2,y:V.y+V.height/2}},19:function(x){return{x:x.x+x.width,y:x.y+x.height/2}},20:function(T,D){return{x:T.x+T.width+D.width/2,y:T.y+T.height/2}},21:function(f,P){return{x:f.x-P.width/2,y:f.y+f.height-P.height/2}},22:function(H,k){return{x:H.x+k.width/2,y:H.y+H.height-k.height/2}},23:function(w,Y){return{x:w.x+w.width/2,y:w.y+w.height-Y.height/2}},24:function(s,K){return{x:s.x+s.width-K.width/2,y:s.y+s.height-K.height/2}},25:function(u,b){return{x:u.x+u.width+b.width/2,y:u.y+u.height-b.height/2}},26:function(v){return{x:v.x,y:v.y+v.height}},27:function(O){return{x:O.x+O.width/2,y:O.y+O.height}},28:function(f){return{x:f.x+f.width,y:f.y+f.height}},29:function(P,b){return{x:P.x-b.width/2,y:P.y+P.height+b.height/2}},30:function(Q,m){return{x:Q.x+m.width/2,y:Q.y+Q.height+m.height/2}},31:function(e,_){return{x:e.x+e.width/2,y:e.y+e.height+_.height/2}},32:function(M,Z){return{x:M.x+M.width-Z.width/2,y:M.y+M.height+Z.height/2}},33:function(L,e){return{x:L.x+L.width+e.width/2,y:L.y+L.height+e.height/2}},34:function(T,M){return{x:T.x,y:T.y-M.height/2}},35:function(O,B){return{x:O.x+O.width,y:O.y-B.height/2}},36:function(b,k){return{x:b.x,y:b.y+b.height+k.height/2}},37:function(w,h){return{x:w.x+w.width,y:w.y+w.height+h.height/2}},38:function(j,q){return{x:j.x+j.width/4,y:j.y-q.height/2}},39:function(E,b){return{x:E.x+3*E.width/4,y:E.y-b.height/2}},40:function(q){return{x:q.x+q.width/4,y:q.y}},41:function(h){return{x:h.x+3*h.width/4,y:h.y}},42:function(Q,I){return{x:Q.x+Q.width/4,y:Q.y+I.height/2}},43:function(N,m){return{x:N.x+3*N.width/4,y:N.y+m.height/2}},44:function(g,X){return{x:g.x+g.width/2,y:g.y+g.height/2-X.height/2}},45:function(a){return{x:a.x+a.width/4,y:a.y+a.height/2}},46:function(r,X){return{x:r.x+r.width/2-X.width/2,y:r.y+r.height/2}},47:function(q,A){return{x:q.x+q.width/2+A.width/2,y:q.y+q.height/2}},48:function(E){return{x:E.x+3*E.width/4,y:E.y+E.height/2}},49:function(P,b){return{x:P.x+P.width/2,y:P.y+P.height/2+b.height/2}},50:function(p,z){return{x:p.x+p.width/4,y:p.y+p.height-z.height/2}},51:function(h,Z){return{x:h.x+3*h.width/4,y:h.y+h.height-Z.height/2}},52:function(n){return{x:n.x+n.width/4,y:n.y+n.height}},53:function(x){return{x:x.x+3*x.width/4,y:x.y+x.height}},54:function(s,W){return{x:s.x+s.width/4,y:s.y+s.height+W.height/2}},55:function(v,l){return{x:v.x+3*v.width/4,y:v.y+v.height+l.height/2}}};return ho(d)?function(C,p,c){return _[C](p,c?c:qb)}:void 0}();vq(f,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var zf=f.reverse,Jd=f.transparent,Ji=f.rectSelectBackground,En=f.dash,Uf=f.titleBackground,yb=f.titleIconBackground,Dk=f.headerBackground,ve=f.headerIconBackground,Bd=f.headerSeparator,vm=f.headerLine,Rf=f.contentIconBackground,Ur=f.contentLine,Zg=(f.widgetIconHighlight,f.widgetIconBorder),dd=(f.widgetIconGradient,f.imageBackground),ah=f.imageGradient,wn=f.highlight,Kk=f.label,vg=f.labelSelect;if(b&&!d.shutAlert1){var Dp=new Date,Jh=b.split("-"),Up=new Date(Dp.getFullYear(),Dp.getMonth(),Dp.getDate()),b=new Date(B(Jh[0],10),B(Jh[1],10)-1,B(Jh[2],10)),ub=Up.getTime(),Wi=b.getTime(),mb=x+"_try",fb=d.alert;try{var Mn=d.localStorage;if(Mn&&fb)if(Wi>ub&&1728e6>Wi-ub){var bj=(Wi-ub)/864e5;Mn&&Mn[mb]!=bj&&(Mn[mb]=bj,d.htWillExpire?fb(d.htWillExpire.replace("{{day}}",bj)):fb("HT for Web free trial license will expire in "+bj+" days, please apply for a new license!"))}else ub>=Wi&&(d.htExpired?fb(d.htExpired):fb("Your free trial of HT for Web has expired!")),Mn&&delete Mn[mb]}catch(gd){}}Math.sign===S&&(Math.sign=function(o){return 0>o?-1:o>0?1:+o});var Km="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Gf={encode:function($,t){var P,g,C,H,v,V,M,Z="",p=0;for($=Gf._utf8_encode($);p<$.length;)P=$.charCodeAt(p++),g=$.charCodeAt(p++),C=$.charCodeAt(p++),H=P>>2,v=(3&P)<<4|g>>4,V=(15&g)<<2|C>>6,M=63&C,isNaN(g)?V=M=64:isNaN(C)&&(M=64),Z=Z+t.charAt(H)+t.charAt(v)+t.charAt(V)+t.charAt(M);return Z},decode:function($,u){var Q,o,X,Z,C,N,p,h="",r=0;for($=$.replace(/[^A-Za-z0-9\+\/\=]/g,"");r<$.length;)Z=u.indexOf($.charAt(r++)),C=u.indexOf($.charAt(r++)),N=u.indexOf($.charAt(r++)),p=u.indexOf($.charAt(r++)),Q=Z<<2|C>>4,o=(15&C)<<4|N>>2,X=(3&N)<<6|p,h+=String.fromCharCode(Q),64!=N&&(h+=String.fromCharCode(o)),64!=p&&(h+=String.fromCharCode(X));return h=Gf._utf8_decode(h)},_utf8_encode:function(v){v=v.replace(/\r\n/g,"\n");for(var o="",u=0;u<v.length;u++){var z=v.charCodeAt(u);128>z?o+=String.fromCharCode(z):z>127&&2048>z?(o+=String.fromCharCode(192|z>>6),o+=String.fromCharCode(128|63&z)):(o+=String.fromCharCode(224|z>>12),o+=String.fromCharCode(128|63&z>>6),o+=String.fromCharCode(128|63&z))}return o},_utf8_decode:function(A){for(var d="",T=0,c=0,I=0,z=0;T<A.length;)c=A.charCodeAt(T),128>c?(d+=String.fromCharCode(c),T++):c>191&&224>c?(I=A.charCodeAt(T+1),d+=String.fromCharCode((31&c)<<6|63&I),T+=2):(I=A.charCodeAt(T+1),z=A.charCodeAt(T+2),d+=String.fromCharCode((15&c)<<12|(63&I)<<6|63&z),T+=3);return d}},Er=E.Math={generateUUID:function(){for(var v=[],Q=0;256>Q;Q++)v[Q]=(16>Q?"0":"")+Q.toString(16).toUpperCase();return function(){var y=0|4294967295*Math.random(),j=0|4294967295*Math.random(),Y=0|4294967295*Math.random(),$=0|4294967295*Math.random();return v[255&y]+v[255&y>>8]+v[255&y>>16]+v[255&y>>24]+"-"+v[255&j]+v[255&j>>8]+"-"+v[64|15&j>>16]+v[255&j>>24]+"-"+v[128|63&Y]+v[255&Y>>8]+"-"+v[255&Y>>16]+v[255&Y>>24]+v[255&$]+v[255&$>>8]+v[255&$>>16]+v[255&$>>24]}}(),clamp:function(D,z,R){return Math.max(z,Math.min(R,D))},generateIncreasingID:function(){var H=0;return function(){return++H}}(),encodeBase64:function(C,D){return Gf.encode(C,D||Km)},decodeBase64:function(u,A){return Gf.decode(u,A||Km)},randomArray:function(y,c){c=c||y.length;for(var $=c-1;$>0;$--){var J=Math.floor(Math.random()*($+1)),f=y[$];y[$]=y[J],y[J]=f}return y},isPOT:function(m){return m>0&&0===(m-1&m)},nearestPOT:function(w){if(!w)return 1;var z=w;z--,z|=z>>1,z|=z>>2,z|=z>>4,z|=z>>8,z|=z>>16,z++;var c=z>>1;return w-c>z-w?z:c}},Pf=E.Matrix=E.Math.Matrix2d=function(W,Q,D,i,K){this.setFromTransform(W,Q,D,i,K)},bm=Pf;Pf.prototype={},Pf.prototype.constructor=Pf,Pf.prototype.set=function(d,X,z,Z,q,Q){return this.a=d,this.b=X,this.c=z,this.d=Z,this.tx=q,this.ty=Q,this},Pf.prototype.setFromTransform=function(Q,$,E,f,C){var u=this;if(Q===S)return u.a=1,u.b=0,u.c=0,u.d=1,u.tx=0,u.ty=0,void 0;Q=Q||0;var B=V(Q),T=X(Q);return f=f||1,C=C||1,u.a=T*f,u.b=B*f,u.c=-B*C,u.d=T*C,u.tx=$||0,u.ty=E||0,u},Pf.prototype.apply=function(L,Z){Z=Z||new Qp;var y=L.x,g=L.y;return Z.x=this.a*y+this.c*g+this.tx,Z.y=this.b*y+this.d*g+this.ty,Z},Pf.prototype.applyInverse=function(f,N){N=N||new Qp;var y=1/(this.a*this.d+this.c*-this.b),Z=f.x,W=f.y;return N.x=this.d*y*Z+-this.c*y*W+(this.ty*this.c-this.tx*this.d)*y,N.y=this.a*y*W+-this.b*y*Z+(-this.ty*this.a+this.tx*this.b)*y,N},Pf.prototype.translate=function(n,l){return this.tx+=n,this.ty+=l,this},Pf.prototype.scale=function(l,U){return this.a*=l,this.d*=U,this.c*=l,this.b*=U,this.tx*=l,this.ty*=U,this},Pf.prototype.rotate=function(h){var W=Math.cos(h),o=Math.sin(h),N=this.a,Q=this.c,$=this.tx;return this.a=N*W-this.b*o,this.b=N*o+this.b*W,this.c=Q*W-this.d*o,this.d=Q*o+this.d*W,this.tx=$*W-this.ty*o,this.ty=$*o+this.ty*W,this},Pf.prototype.appendTranslate=function(c,X){return this.tx+=this.a*c+this.c*X,this.ty+=this.b*c+this.d*X,this},Pf.prototype.appendScale=function(D,N){return this.a*=D,this.d*=N,this.c*=N,this.b*=D,this},Pf.prototype.appendRotate=function(p){if(!p)return this;var f=Math.cos(p),O=Math.sin(p),x=this.a,t=this.b;return this.a=x*f+this.c*O,this.b=t*f+this.d*O,this.c=-x*O+this.c*f,this.d=-t*O+this.d*f,this},Pf.prototype.append=function(s){var r=this.a,W=this.b,j=this.c,C=this.d;return this.a=s.a*r+s.b*j,this.b=s.a*W+s.b*C,this.c=s.c*r+s.d*j,this.d=s.c*W+s.d*C,this.tx=s.tx*r+s.ty*j+this.tx,this.ty=s.tx*W+s.ty*C+this.ty,this},Pf.prototype.setTransform=function(J,c,v,P,k,X,$,Q,e){var o,a,n,z,u,C,m,B,r,Y;return u=Math.sin($),C=Math.cos($),m=Math.cos(e),B=Math.sin(e),r=-Math.sin(Q),Y=Math.cos(Q),o=C*k,a=u*k,n=-u*X,z=C*X,this.a=m*o+B*n,this.b=m*a+B*z,this.c=r*o+Y*n,this.d=r*a+Y*z,this.tx=J+(v*o+P*n),this.ty=c+(v*a+P*z),this},Pf.prototype.prepend=function(B){var k=this.tx;if(1!==B.a||0!==B.b||0!==B.c||1!==B.d){var S=this.a,q=this.c;this.a=S*B.a+this.b*B.c,this.b=S*B.b+this.b*B.d,this.c=q*B.a+this.d*B.c,this.d=q*B.b+this.d*B.d}return this.tx=k*B.a+this.ty*B.c+B.tx,this.ty=k*B.b+this.ty*B.d+B.ty,this},Pf.prototype.transform=Pf.prototype.prepend,Pf.prototype.invert=function(){var H=this.a,x=this.b,B=this.c,n=this.d,r=this.tx,T=H*n-x*B;return this.a=n/T,this.b=-x/T,this.c=-B/T,this.d=H/T,this.tx=(B*this.ty-n*r)/T,this.ty=-(H*this.ty-x*r)/T,this},Pf.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Pf.prototype.clone=function(){var s=new Pf;return s.a=this.a,s.b=this.b,s.c=this.c,s.d=this.d,s.tx=this.tx,s.ty=this.ty,s},Pf.prototype.copy=function(P){return P.a=this.a,P.b=this.b,P.c=this.c,P.d=this.d,P.tx=this.tx,P.ty=this.ty,P},Pf.prototype.tf=function(u,d){1===arguments.length&&(d=u.y,u=u.x);var y=this;return{x:y.a*u+y.c*d+y.tx,y:y.b*u+y.d*d+y.ty}},Pf.prototype.tfi=function(L,h){1===arguments.length&&(h=L.y,L=L.x);var X=this,T=1/(X.a*X.d+X.c*-X.b);return{x:X.d*T*L+-X.c*T*h+(X.ty*X.c-X.tx*X.d)*T,y:X.a*T*h+-X.b*T*L+(-X.ty*X.a+X.tx*X.b)*T}},Pf.IDENTITY=new Pf,Pf.TEMP_MATRIX=new Pf;var Oh=E.Math.Quaternion=function(M,U,w,F){this.set(M,U,w,F)};l.assign(Oh.prototype,{set:function(M,H,u,h){var e=this;return e._x=M||0,e._y=H||0,e._z=u||0,e._w=h!==S?h:1,e},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(q){var F=this;return F._x=q._x,F._y=q._y,F._z=q._z,F._w=q._w,F},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(Q){return this._x*Q._x+this._y*Q._y+this._z*Q._z+this._w*Q._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var w=this.length();return 0===w?(this._x=0,this._y=0,this._z=0,this._w=1):(w=1/w,this._x=this._x*w,this._y=this._y*w,this._z=this._z*w,this._w=this._w*w),this},fromArray:function(o,V){V===S&&(V=0);var q=this;return q._x=o[V],q._y=o[V+1],q._z=o[V+2],q._w=o[V+3],this},slerp:function(T,o){if(0===o)return this;if(1===o)return this.copy(T);var W=this._x,w=this._y,E=this._z,J=this._w,q=J*T._w+W*T._x+w*T._y+E*T._z;if(0>q?(this._w=-T._w,this._x=-T._x,this._y=-T._y,this._z=-T._z,q=-q):this.copy(T),q>=1)return this._w=J,this._x=W,this._y=w,this._z=E,this;var L=Math.sqrt(1-q*q);if(Math.abs(L)<.001)return this._w=.5*(J+this._w),this._x=.5*(W+this._x),this._y=.5*(w+this._y),this._z=.5*(E+this._z),this;var G=Math.atan2(L,q),S=Math.sin((1-o)*G)/L,D=Math.sin(o*G)/L;return this._w=J*S+this._w*D,this._x=W*S+this._x*D,this._y=w*S+this._y*D,this._z=E*S+this._z*D,this},setFromAxisAngle:function(P,I){var a=I/2,S=Math.sin(a);return this._x=P.x*S,this._y=P.y*S,this._z=P.z*S,this._w=Math.cos(a),this},setFromEuler:function(s){var t=s._x,U=s._y,C=s._z,p=s._order,e=Math.cos,O=Math.sin,M=e(t/2),c=e(U/2),F=e(C/2),b=O(t/2),R=O(U/2),B=O(C/2);return"XYZ"===p?(this._x=b*c*F+M*R*B,this._y=M*R*F-b*c*B,this._z=M*c*B+b*R*F,this._w=M*c*F-b*R*B):"YXZ"===p?(this._x=b*c*F+M*R*B,this._y=M*R*F-b*c*B,this._z=M*c*B-b*R*F,this._w=M*c*F+b*R*B):"ZXY"===p?(this._x=b*c*F-M*R*B,this._y=M*R*F+b*c*B,this._z=M*c*B+b*R*F,this._w=M*c*F-b*R*B):"ZYX"===p?(this._x=b*c*F-M*R*B,this._y=M*R*F+b*c*B,this._z=M*c*B-b*R*F,this._w=M*c*F+b*R*B):"YZX"===p?(this._x=b*c*F+M*R*B,this._y=M*R*F+b*c*B,this._z=M*c*B-b*R*F,this._w=M*c*F-b*R*B):"XZY"===p&&(this._x=b*c*F-M*R*B,this._y=M*R*F-b*c*B,this._z=M*c*B+b*R*F,this._w=M*c*F+b*R*B),this},setFromRotationMatrix:function(w){var h,k=w.el,l=k[0],t=k[4],J=k[8],L=k[1],j=k[5],Q=k[9],q=k[2],I=k[6],e=k[10],o=l+j+e;return o>0?(h=.5/Math.sqrt(o+1),this._w=.25/h,this._x=(I-Q)*h,this._y=(J-q)*h,this._z=(L-t)*h):l>j&&l>e?(h=2*Math.sqrt(1+l-j-e),this._w=(I-Q)/h,this._x=.25*h,this._y=(t+L)/h,this._z=(J+q)/h):j>e?(h=2*Math.sqrt(1+j-l-e),this._w=(J-q)/h,this._x=(t+L)/h,this._y=.25*h,this._z=(Q+I)/h):(h=2*Math.sqrt(1+e-l-j),this._w=(L-t)/h,this._x=(J+q)/h,this._y=(Q+I)/h,this._z=.25*h),this},setFromToVectors:function(){var T,$;return function(N,y){return T===S&&(T=new Of),$=N.dot(y)+1,1e-7>$?($=0,Math.abs(N.x)>Math.abs(N.z)?T.set(-N.y,N.x,0):T.set(0,-N.z,N.y)):T.crossVectors(N,y),this._x=T.x,this._y=T.y,this._z=T.z,this._w=$,this.normalize()}}(),setFromUnitVectors:function(){var m,F,x=1e-6;return function(X,d){return m===S&&(m=new Of),F=X.dot(d)+1,x>F?(F=0,Math.abs(X.x)>Math.abs(X.z)?m.set(-X.y,X.x,0):m.set(0,-X.z,X.y)):m.crossVectors(X,d),this._x=m.x,this._y=m.y,this._z=m.z,this._w=F,this.normalize()}}(),multiply:function(C){return this.multiplyQuaternions(this,C)},premultiply:function(F){return this.multiplyQuaternions(F,this)},multiplyQuaternions:function(c,F){var i=c._x,m=c._y,d=c._z,Y=c._w,O=F._x,y=F._y,L=F._z,t=F._w;return this._x=i*t+Y*O+m*L-d*y,this._y=m*t+Y*y+d*O-i*L,this._z=d*t+Y*L+i*y-m*O,this._w=Y*t-i*O-m*y-d*L,this}});var nl=E.Math.Vector4=function(C,H,z,s){this.x=C||0,this.y=H||0,this.z=z||0,this.w=s!==S?s:1};l.assign(nl.prototype,{isVector4:!0,set:function(w,C,v,X){return this.x=w,this.y=C,this.z=v,this.w=X,this},setScalar:function(T){return this.x=T,this.y=T,this.z=T,this.w=T,this},setX:function(R){return this.x=R,this},setY:function(H){return this.y=H,this},setZ:function(O){return this.z=O,this},setW:function(Z){return this.w=Z,this},setComponent:function(V,K){switch(V){case 0:this.x=K;break;case 1:this.y=K;break;case 2:this.z=K;break;case 3:this.w=K;break;default:throw new Error("index is out of range: "+V)}return this},getComponent:function(_){switch(_){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+_)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(V){return this.x=V.x,this.y=V.y,this.z=V.z,this.w=V.w!==S?V.w:1,this},add:function(u,G){return G!==S?this.addVectors(u,G):(this.x+=u.x,this.y+=u.y,this.z+=u.z,this.w+=u.w,this)},addScalar:function(J){return this.x+=J,this.y+=J,this.z+=J,this.w+=J,this},addVectors:function(a,z){return this.x=a.x+z.x,this.y=a.y+z.y,this.z=a.z+z.z,this.w=a.w+z.w,this},addScaledVector:function(n,E){return this.x+=n.x*E,this.y+=n.y*E,this.z+=n.z*E,this.w+=n.w*E,this},sub:function($,b){return b!==S?this.subVectors($,b):(this.x-=$.x,this.y-=$.y,this.z-=$.z,this.w-=$.w,this)},subScalar:function(b){return this.x-=b,this.y-=b,this.z-=b,this.w-=b,this},subVectors:function(o,S){return this.x=o.x-S.x,this.y=o.y-S.y,this.z=o.z-S.z,this.w=o.w-S.w,this},multiplyScalar:function(A){return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},applyMatrix4:function(d){var t=this.x,Y=this.y,G=this.z,m=this.w,H=d.el;return this.x=H[0]*t+H[4]*Y+H[8]*G+H[12]*m,this.y=H[1]*t+H[5]*Y+H[9]*G+H[13]*m,this.z=H[2]*t+H[6]*Y+H[10]*G+H[14]*m,this.w=H[3]*t+H[7]*Y+H[11]*G+H[15]*m,this},divideScalar:function(_){return this.multiplyScalar(1/_)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var F=Math.sqrt(1-e.w*e.w);return 1e-4>F?(this.x=1,this.y=0,this.z=0):(this.x=e.x/F,this.y=e.y/F,this.z=e.z/F),this},setAxisAngleFromRotationMatrix:function(K){var u,V,$,B,Y=.01,U=.1,H=K.el,Q=H[0],z=H[4],E=H[8],J=H[1],d=H[5],j=H[9],a=H[2],e=H[6],w=H[10];if(Math.abs(z-J)<Y&&Math.abs(E-a)<Y&&Math.abs(j-e)<Y){if(Math.abs(z+J)<U&&Math.abs(E+a)<U&&Math.abs(j+e)<U&&Math.abs(Q+d+w-3)<U)return this.set(1,0,0,0),this;u=Math.PI;var T=(Q+1)/2,s=(d+1)/2,F=(w+1)/2,O=(z+J)/4,C=(E+a)/4,N=(j+e)/4;return T>s&&T>F?Y>T?(V=0,$=.707106781,B=.707106781):(V=Math.sqrt(T),$=O/V,B=C/V):s>F?Y>s?(V=.707106781,$=0,B=.707106781):($=Math.sqrt(s),V=O/$,B=N/$):Y>F?(V=.707106781,$=.707106781,B=0):(B=Math.sqrt(F),V=C/B,$=N/B),this.set(V,$,B,u),this}var f=Math.sqrt((e-j)*(e-j)+(E-a)*(E-a)+(J-z)*(J-z));return Math.abs(f)<.001&&(f=1),this.x=(e-j)/f,this.y=(E-a)/f,this.z=(J-z)/f,this.w=Math.acos((Q+d+w-1)/2),this},min:function(S){return this.x=Math.min(this.x,S.x),this.y=Math.min(this.y,S.y),this.z=Math.min(this.z,S.z),this.w=Math.min(this.w,S.w),this},max:function(I){return this.x=Math.max(this.x,I.x),this.y=Math.max(this.y,I.y),this.z=Math.max(this.z,I.z),this.w=Math.max(this.w,I.w),this},clamp:function(M,v){return this.x=Math.max(M.x,Math.min(v.x,this.x)),this.y=Math.max(M.y,Math.min(v.y,this.y)),this.z=Math.max(M.z,Math.min(v.z,this.z)),this.w=Math.max(M.w,Math.min(v.w,this.w)),this},clampScalar:function(){var D,R;return function(h,m){return D===S&&(D=new nl,R=new nl),D.set(h,h,h,h),R.set(m,m,m,m),this.clamp(D,R)}}(),clampLength:function(i,V){var l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(i,Math.min(V,l)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(Y){return this.normalize().multiplyScalar(Y)},lerp:function(e,Q){return this.x+=(e.x-this.x)*Q,this.y+=(e.y-this.y)*Q,this.z+=(e.z-this.z)*Q,this.w+=(e.w-this.w)*Q,this},lerpVectors:function(m,S,y){return this.subVectors(S,m).multiplyScalar(y).add(m)},equals:function(A){return A.x===this.x&&A.y===this.y&&A.z===this.z&&A.w===this.w},fromArray:function(o,O){return O===S&&(O=0),this.x=o[O],this.y=o[O+1],this.z=o[O+2],this.w=o[O+3],this},toArray:function(l,Q){return l===S&&(l=[]),Q===S&&(Q=0),l[Q]=this.x,l[Q+1]=this.y,l[Q+2]=this.z,l[Q+3]=this.w,l},fromBufferAttribute:function(v,W){return this.x=v.getX(W),this.y=v.getY(W),this.z=v.getZ(W),this.w=v.getW(W),this}});var Of=E.Math.Vector3=function(o,D,P){o===S?(this.x=0,this.y=0,this.z=0):"object"==typeof o?this.copy(o):this.set(o,D==S?o:D,P==S?o:P)};l.assign(Of.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function(X,s,P){return this.x=X,this.y=s,this.z=P,this},equals:function(H){return H&&this.x===H.x&&this.y===H.y&&this.z===H.z},setScalar:function(z){return this.x=z,this.y=z,this.z=z,this},setX:function(v){return this.x=v,this},setY:function(n){return this.y=n,this},setZ:function(N){return this.z=N,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(K){return K.x===S?(this.x=K[0],this.y=K[1],this.z=K[2]):(this.x=K.x,this.y=K.y,this.z=K.z||0),this},add:function(T){return this.x+=T.x,this.y+=T.y,this.z+=T.z,this},addScalar:function(v){return this.x+=v,this.y+=v,this.z+=v,this},addVectors:function(K,V){return this.x=K.x+V.x,this.y=K.y+V.y,this.z=K.z+V.z,this},addScaledVector:function(o,Y){return this.x+=o.x*Y,this.y+=o.y*Y,this.z+=o.z*Y,this},sub:function(W){return this.x-=W.x,this.y-=W.y,this.z-=W.z,this},subScalar:function(W){return this.x-=W,this.y-=W,this.z-=W,this},subVectors:function(O,G){return this.x=O.x-G.x,this.y=O.y-G.y,this.z=O.z-G.z,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},multiply:function(p){return this.x*=p.x,this.y*=p.y,this.z*=p.z,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},distanceTo:function(s){return Math.sqrt(this.distanceToSquared(s))},distanceToSquared:function(d){var W=this.x-d.x,A=this.y-d.y,z=this.z-d.z;return W*W+A*A+z*z},distanceToSquared2:function(v){var N=this.x-v[0],W=this.y-v[1],S=this.z-v[2];return N*N+W*W+S*S},divideVectors:function(D,J){return this.x=D.x/J.x,this.y=D.y/J.y,this.z=D.z/J.z,this},multiplyVectors:function(b,D){return this.x=b.x*D.x,this.y=b.y*D.y,this.z=b.z*D.z,this},transformDirection:function(J){var O=this.x,Y=this.y,e=this.z,s=J.el;return this.x=s[0]*O+s[4]*Y+s[8]*e,this.y=s[1]*O+s[5]*Y+s[9]*e,this.z=s[2]*O+s[6]*Y+s[10]*e,this.normalize()},applyAxisAngle:function(){var f=new Oh;return function(M,J){return this.applyQuaternion(f.setFromAxisAngle(M,J))}}(),applyEuler:function(){var L=new Oh;return function(o){return this.applyQuaternion(L.setFromEuler(o))}}(),applyQuaternion:function(L){var m=this.x,u=this.y,C=this.z,k=L._x,n=L._y,w=L._z,p=L._w,R=p*m+n*C-w*u,M=p*u+w*m-k*C,X=p*C+k*u-n*m,B=-k*m-n*u-w*C;return this.x=R*p+B*-k+M*-w-X*-n,this.y=M*p+B*-n+X*-k-R*-w,this.z=X*p+B*-w+R*-n-M*-k,this},applyMatrix4:function(W){var e=this.x,q=this.y,$=this.z,D=W.el,M=1/(D[3]*e+D[7]*q+D[11]*$+D[15]);return this.x=(D[0]*e+D[4]*q+D[8]*$+D[12])*M,this.y=(D[1]*e+D[5]*q+D[9]*$+D[13])*M,this.z=(D[2]*e+D[6]*q+D[10]*$+D[14])*M,this},applyMatrix3:function(W){var _=this.x,P=this.y,s=this.z,B=W.el;return this.x=B[0]*_+B[3]*P+B[6]*s,this.y=B[1]*_+B[4]*P+B[7]*s,this.z=B[2]*_+B[5]*P+B[8]*s,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var c=new Of;return function(Y){return this.sub(c.copy(Y).multiplyScalar(2*this.dot(Y)))}}(),dot:function(y){return this.x*y.x+this.y*y.y+this.z*y.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var i=this.length();return i?this.multiplyScalar(1/i):this},setLength:function(g){return this.normalize().multiplyScalar(g)},fromArray:function(C,J){return J===S&&(J=0),this.x=C[J],this.y=C[J+1],this.z=C[J+2],this
},toArray:function(P,$){return P===S&&(P=[0,0,0]),$===S&&($=0),P[$]=this.x,P[$+1]=this.y,P[$+2]=this.z,P},cross:function(Z){return this.crossVectors(this,Z)},angleTo:function(W){var N=this.dot(W)/Math.sqrt(this.lengthSq()*W.lengthSq());return N>1||-1>N?0:Math.acos(N)},lerp:function(J,T){return this.x+=(J.x-this.x)*T,this.y+=(J.y-this.y)*T,this.z+=(J.z-this.z)*T,this},lerpVectors:function(_,r,v){return this.subVectors(r,_).multiplyScalar(v).add(_)},crossVectors:function(H,n){var C=H.x,T=H.y,S=H.z,l=n.x,V=n.y,j=n.z;return this.x=T*j-S*V,this.y=S*l-C*j,this.z=C*V-T*l,this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(O){return this.x=Math.max(this.x,O.x),this.y=Math.max(this.y,O.y),this.z=Math.max(this.z,O.z),this},setFromMatrixPosition:function(m){return this.setFromMatrixColumn(m,3)},setFromMatrixScale:function(l){var x=this.setFromMatrixColumn(l,0).length(),n=this.setFromMatrixColumn(l,1).length(),q=this.setFromMatrixColumn(l,2).length();return this.x=x,this.y=n,this.z=q,this},setFromMatrixColumn:function(E,D){return this.fromArray(E.el,4*D)}});var Qp=E.Math.Vector2=function(x,V,G){"object"==typeof x&&(x.x!=S?(V=x.y,x=x.x,G=x.e):(G=x[2],V=x[1],x=x[0])),this.set(x||0,V||0,G)};Qp.prototype={},Qp.prototype.constructor=Qp,l.defineProperties(Qp.prototype,{width:{get:function(){return this.x},set:function(U){this.x=U}},height:{get:function(){return this.y},set:function(T){this.y=T}}}),Qp.prototype.clone=function(){return new Qp(this.x,this.y,this.e)},Qp.prototype.copy=function(I){return this.set(I.x,I.y,I.e),this},Qp.prototype.equals=function(s){return s.x===this.x&&s.y===this.y},Qp.prototype.set=function(j,V,y){return this.x=j||0,this.y=V||(0!==V?this.x:0),y!=S&&(this.e=y),this},Qp.prototype.setScalar=function(j){return this.x=j,this.y=j,this},Qp.prototype.setX=function(V){return this.x=V||0,this},Qp.prototype.setY=function(c){return this.y=c||0,this},Qp.prototype.add=function($){return this.x+=$.x,this.y+=$.y,this},Qp.prototype.addVectors=function(K,Q){return this.x=K.x+Q.x,this.y=K.y+Q.y,this},Qp.prototype.addScalar=function(S){return this.x+=S,this.y+=S,this},Qp.prototype.addScaledVector=function(n,V){return this.x+=n.x*V,this.y+=n.y*V,this},Qp.prototype.sub=function(q){return this.x-=q.x,this.y-=q.y,this},Qp.prototype.subScalar=function(I){return this.x-=I,this.y-=I,this},Qp.prototype.subVectors=function(C,Y){return this.x=C.x-Y.x,this.y=C.y-Y.y,this},Qp.prototype.multiply=function(K){return this.x*=K.x,this.y*=K.y,this},Qp.prototype.multiplyScalar=function(a){return this.x*=a,this.y*=a,this},Qp.prototype.divide=function(n){return this.x/=n.x,this.y/=n.y,this},Qp.prototype.divideScalar=function(m){return this.multiplyScalar(1/m)},Qp.prototype.min=function(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this},Qp.prototype.max=function(q){return this.x=Math.max(this.x,q.x),this.y=Math.max(this.y,q.y),this},Qp.prototype.fromArray=function(A,C){return C===S&&(C=0),this.x=A[C],this.y=A[C+1],this},Qp.prototype.clamp=function(K,E){return this.x=Math.max(K.x,Math.min(E.x,this.x)),this.y=Math.max(K.y,Math.min(E.y,this.y)),this},Qp.prototype.clampScalar=function(){var q,m;return function(x,W){return q===S&&(q=new Qp,m=new Qp),q.set(x,x),m.set(W,W),this.clamp(q,m)}}(),Qp.prototype.clampLength=function(Y,F){var Q=this.length();return this.multiplyScalar(Math.max(Y,Math.min(F,Q))/Q)},Qp.prototype.dot=function($){return this.x*$.x+this.y*$.y},Qp.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Qp.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Qp.prototype.normalize=function(){return this.divideScalar(this.length())},Qp.prototype.angle=function(){var q=Math.atan2(this.y,this.x);return 0>q&&(q+=2*Math.PI),q},Qp.prototype.distanceTo=function(y){return Math.sqrt(this.distanceToSquared(y))},Qp.prototype.distanceToSquared=function(a){var E=this.x-a.x,P=this.y-a.y;return E*E+P*P},Qp.prototype.isNearEnough=function(F){return this.distanceToSquared(F)<1e-8},Qp.prototype.setLength=function(g){var T=this.length();return T?this.multiplyScalar(g/T):this},Qp.prototype.lerp=function(Z,l){return this.x+=(Z.x-this.x)*l,this.y+=(Z.y-this.y)*l,this},Qp.prototype.lerpVectors=function(G,f,T){return this.subVectors(f,G).multiplyScalar(T).add(G)},Qp.prototype.rotateAround=function(k,$){var V=k?k.x:0,f=k?k.y:0,S=Math.cos($),b=Math.sin($),T=this.x-V,M=this.y-f;return this.x=T*S-M*b+V,this.y=T*b+M*S+f,this},l.assign(U.prototype,{isMatrix3:!0,set:function(m,f,K,i,q,c,O,H,J){var n=this.el;return n[0]=m,n[1]=i,n[2]=O,n[3]=f,n[4]=q,n[5]=H,n[6]=K,n[7]=c,n[8]=J,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(e){var n=this.el,k=e.el;return n[0]=k[0],n[1]=k[1],n[2]=k[2],n[3]=k[3],n[4]=k[4],n[5]=k[5],n[6]=k[6],n[7]=k[7],n[8]=k[8],this},setFromMatrix4:function(g){var S=g.el;return this.set(S[0],S[4],S[8],S[1],S[5],S[9],S[2],S[6],S[10]),this},applyToBufferAttribute:function(){var F=new Of;return function(o){for(var K=0,p=o.count;p>K;K++)F.x=o.getX(K),F.y=o.getY(K),F.z=o.getZ(K),F.applyMatrix3(this),o.setXYZ(K,F.x,F.y,F.z);return o}}(),multiply:function(o){return this.multiplyMatrices(this,o)},premultiply:function(P){return this.multiplyMatrices(P,this)},multiplyMatrices:function(T,j){var K=T.el,A=j.el,a=this.el,J=K[0],V=K[3],g=K[6],C=K[1],P=K[4],$=K[7],M=K[2],Z=K[5],W=K[8],_=A[0],t=A[3],R=A[6],Y=A[1],f=A[4],u=A[7],h=A[2],I=A[5],i=A[8];return a[0]=J*_+V*Y+g*h,a[3]=J*t+V*f+g*I,a[6]=J*R+V*u+g*i,a[1]=C*_+P*Y+$*h,a[4]=C*t+P*f+$*I,a[7]=C*R+P*u+$*i,a[2]=M*_+Z*Y+W*h,a[5]=M*t+Z*f+W*I,a[8]=M*R+Z*u+W*i,this},multiplyScalar:function(k){var U=this.el;return U[0]*=k,U[3]*=k,U[6]*=k,U[1]*=k,U[4]*=k,U[7]*=k,U[2]*=k,U[5]*=k,U[8]*=k,this},determinant:function(){var e=this.el,Y=e[0],n=e[1],b=e[2],s=e[3],a=e[4],K=e[5],t=e[6],k=e[7],C=e[8];return Y*a*C-Y*K*k-n*s*C+n*K*t+b*s*k-b*a*t},getInverse:function(x){var q=x.el,T=this.el,N=q[0],A=q[1],O=q[2],_=q[3],p=q[4],L=q[5],H=q[6],F=q[7],g=q[8],c=g*p-L*F,E=L*H-g*_,C=F*_-p*H,R=N*c+A*E+O*C;if(0===R)return this.identity();var r=1/R;return T[0]=c*r,T[1]=(O*F-g*A)*r,T[2]=(L*A-O*p)*r,T[3]=E*r,T[4]=(g*N-O*H)*r,T[5]=(O*_-L*N)*r,T[6]=C*r,T[7]=(A*H-F*N)*r,T[8]=(p*N-A*_)*r,this},transpose:function(){var t,C=this.el;return t=C[1],C[1]=C[3],C[3]=t,t=C[2],C[2]=C[6],C[6]=t,t=C[5],C[5]=C[7],C[7]=t,this},getNormalMatrix:function(X){return this.setFromMatrix4(X).getInverse(this).transpose()},transposeIntoArray:function(j){var U=this.el;return j[0]=U[0],j[1]=U[3],j[2]=U[6],j[3]=U[1],j[4]=U[4],j[5]=U[7],j[6]=U[2],j[7]=U[5],j[8]=U[8],this},setUvTransform:function(K,H,d,j,t,R,m){var s=Math.cos(t),x=Math.sin(t);this.set(d*s,d*x,-d*(s*R+x*m)+R+K,-j*x,j*s,-j*(-x*R+s*m)+m+H,0,0,1)},scale:function(F,V){var O=this.el;return O[0]*=F,O[3]*=F,O[6]*=F,O[1]*=V,O[4]*=V,O[7]*=V,this},rotate:function(x){var M=Math.cos(x),E=Math.sin(x),f=this.el,u=f[0],i=f[3],p=f[6],d=f[1],R=f[4],I=f[7];return f[0]=M*u+E*d,f[3]=M*i+E*R,f[6]=M*p+E*I,f[1]=-E*u+M*d,f[4]=-E*i+M*R,f[7]=-E*p+M*I,this},translate:function(Z,N){var g=this.el;return g[0]+=Z*g[2],g[3]+=Z*g[5],g[6]+=Z*g[8],g[1]+=N*g[2],g[4]+=N*g[5],g[7]+=N*g[8],this},equals:function(Q){for(var u=this.el,h=Q.el,k=0;9>k;k++)if(u[k]!==h[k])return!1;return!0},fromArray:function(m,A){A===S&&(A=0);for(var Z=0;9>Z;Z++)this.el[Z]=m[Z+A];return this},toArray:function(b,N){b===S&&(b=[]),N===S&&(N=0);var w=this.el;return b[N]=w[0],b[N+1]=w[1],b[N+2]=w[2],b[N+3]=w[3],b[N+4]=w[4],b[N+5]=w[5],b[N+6]=w[6],b[N+7]=w[7],b[N+8]=w[8],b}});var as=E.Math.Plane=function(b,$){this.normal=b!==S?b:new Of(1,0,0),this.constant=$!==S?$:0};l.assign(as.prototype,{set:function(R,X){return this.normal.copy(R),this.constant=X,this},setComponents:function(w,M,L,K){return this.normal.set(w,M,L),this.constant=K,this},setFromNormalAndCoplanarPoint:function(g,s){return this.normal.copy(g),this.constant=-s.dot(this.normal),this},setFromCoplanarPoints:function(){var T=new Of,u=new Of;return function(g,n,C){var r=T.subVectors(C,n).cross(u.subVectors(g,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,g),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(j){return this.normal.copy(j.normal),this.constant=j.constant,this},normalize:function(){var l=1/this.normal.length();return this.normal.multiplyScalar(l),this.constant*=l,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(m){return this.normal.dot(m)+this.constant},distanceToSphere:function(A){return this.distanceToPoint(A.center)-A.radius},projectPoint:function(Q,j){return j===S&&(j=new Of),j.copy(this.normal).multiplyScalar(-this.distanceToPoint(Q)).add(Q)},intersectLine:function(){var z=new Of;return function(w,F){F===S&&(F=new Of);var l=w.delta(z),r=this.normal.dot(l);if(0===r)return 0===this.distanceToPoint(w.start)?F.copy(w.start):S;var V=-(w.start.dot(this.normal)+this.constant)/r;return 0>V||V>1?S:F.copy(l).multiplyScalar(V).add(w.start)}}(),intersectsLine:function(O){var F=this.distanceToPoint(O.start),x=this.distanceToPoint(O.end);return 0>F&&x>0||0>x&&F>0},intersectsBox:function(D){return D.intersectsPlane(this)},intersectsSphere:function(c){return c.intersectsPlane(this)},coplanarPoint:function(l){return l===S&&(l=new Of),l.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var l=new Of,q=new U;return function(V,o){var x=o||q.getNormalMatrix(V),X=this.coplanarPoint(l).applyMatrix4(V),A=this.normal.applyMatrix3(x).normalize();return this.constant=-X.dot(A),this}}(),translate:function(G){return this.constant-=G.dot(this.normal),this},equals:function(K){return K.normal.equals(this.normal)&&K.constant===this.constant}});var vd=E.Math.Ray=function(n,x){this.origin=n!==S?n.clone():new Of,this.direction=x!==S?x.clone():new Of};l.assign(vd.prototype,{set:function(K,i){return this.origin.copy(K),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(x){return this.origin.copy(x.origin),this.direction.copy(x.direction),this.maxHitLen=x.maxHitLen,this},at:function(l,t){var S=t||new Of;return S.copy(this.direction).multiplyScalar(l).add(this.origin)},setMaxHitLength:function(U){this.maxHitLen=U},lookAt:function(h){return this.direction.copy(h).sub(this.origin).normalize(),this},applyMatrix4:function(S){var I=this.maxHitLen;if(I){var e=this.direction.clone().multiplyScalar(I).add(this.origin);e.applyMatrix4(S)}return this.origin.applyMatrix4(S),this.direction.transformDirection(S),I&&(this.maxHitLen=this.origin.distanceTo(e)),this},intersectSphere:function(){var K=new Of;return function(U,G){K.subVectors(U.center,this.origin);var $=K.dot(this.direction),M=K.dot(K)-$*$,v=U.radius*U.radius;if(M>v)return null;var V=Math.sqrt(v-M),J=$-V,X=$+V;return 0>J&&0>X?null:0>J?this.at(X,G):this.at(J,G)}}(),intersectEllipsoid:function(){var Y=new Of,l=new Of;return function(d,Z){Y.subVectors(d.center,this.origin),Y.divide(d.radius),l.divideVectors(this.direction,d.radius);var E=l.lengthSq(),w=Y.dot(l),z=Y.dot(Y)*E-w*w;if(z>E)return null;var S=Math.sqrt(E-z),K=(w-S)/E,R=(w+S)/E;return 0>K&&0>R?null:0>K?this.at(R,Z):this.at(K,Z)}}(),intersectBox:function(C,p){var I,Y,J,H,V,y,W=1/this.direction.x,R=1/this.direction.y,n=1/this.direction.z,S=this.origin;if(W>=0?(I=(C.min.x-S.x)*W,Y=(C.max.x-S.x)*W):(I=(C.max.x-S.x)*W,Y=(C.min.x-S.x)*W),R>=0?(J=(C.min.y-S.y)*R,H=(C.max.y-S.y)*R):(J=(C.max.y-S.y)*R,H=(C.min.y-S.y)*R),I>H||J>Y)return null;if((J>I||I!==I)&&(I=J),(Y>H||Y!==Y)&&(Y=H),n>=0?(V=(C.min.z-S.z)*n,y=(C.max.z-S.z)*n):(V=(C.max.z-S.z)*n,y=(C.min.z-S.z)*n),I>y||V>Y)return null;if((V>I||I!==I)&&(I=V),(Y>y||Y!==Y)&&(Y=y),0>Y)return null;var z=I>=0?I:Y,Q=this.maxHitLen;return Q&&z>Q?null:this.at(z,p)},intersectTriangle:function(){var E=new Of,Q=new Of,z=new Of,q=new Of;return function(W,$,P,o,d){Q.subVectors($,W),z.subVectors(P,W),q.crossVectors(Q,z);var _,O=this.direction.dot(q);if(O>0){if(o)return null;_=1}else{if(!(0>O))return null;_=-1,O=-O}E.subVectors(this.origin,W);var x=_*this.direction.dot(z.crossVectors(E,z));if(0>x)return null;var j=_*this.direction.dot(Q.cross(E));if(0>j||x+j>O)return null;var u=-_*E.dot(q);if(0>u)return null;var h=u/O,H=this.maxHitLen;return H&&h>H?null:this.at(h,d)}}()});var nb=E.Math.Box3=function(Y,B){this.min=Y!==S?Y:new Of(1/0,1/0,1/0),this.max=B!==S?B:new Of(-1/0,-1/0,-1/0)};l.assign(nb.prototype,{set:function(g,X){return this.min.copy(g),this.max.copy(X),this},setFromArray:function(w){for(var M=1/0,A=1/0,F=1/0,y=-1/0,X=-1/0,b=-1/0,s=0,P=w.length;P>s;s+=3){var v=w[s],U=w[s+1],Z=w[s+2];M>v&&(M=v),A>U&&(A=U),F>Z&&(F=Z),v>y&&(y=v),U>X&&(X=U),Z>b&&(b=Z)}return this.min.set(M,A,F),this.max.set(y,X,b),this},setFromPoints:function(d){this.makeEmpty();for(var x=0,t=d.length;t>x;x++)this.expandByPoint(d[x]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(L){return L.max.x<this.min.x||L.min.x>this.max.x||L.max.y<this.min.y||L.min.y>this.max.y||L.max.z<this.min.z||L.min.z>this.max.z?!1:!0},copy:function(O){return this.min.copy(O.min),this.max.copy(O.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(F){return this.min.min(F),this.max.max(F),this},expandByBox:function(D){return this.min.min(D.min),this.max.max(D.max),this},applyMatrix4:function(){var P=[new Of,new Of,new Of,new Of,new Of,new Of,new Of,new Of];return function(c){return this.isEmpty()?this:(P[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(c),P[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(c),P[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(c),P[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(c),P[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(c),P[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(c),P[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(c),P[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(c),this.setFromPoints(P),this)}}()});var gh=E.Math.Sphere=function(j,l){this.center=j!==S?j:new Of,this.radius=l!==S?l:0};l.assign(gh.prototype,{set:function(Z,H){return this.center.copy(Z),this.radius=H,this},setFromPoints:function(){var C=new nb;return function(x,f){var _=this.center;f!==S?_.copy(f):C.setFromPoints(x).getCenter(_);for(var T=0,b=0,c=x.length;c>b;b++)T=Math.max(T,_.distanceToSquared(x[b]));return this.radius=Math.sqrt(T),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(r){return this.center.copy(r.center),this.radius=r.radius,this},empty:function(){return this.radius<=0},containsPoint:function(l){return l.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(N){return N.distanceTo(this.center)-this.radius},intersectsSphere:function(_){var c=this.radius+_.radius;return _.center.distanceToSquared(this.center)<=c*c},intersectsBox:function(j){return j.intersectsSphere(this)},intersectsPlane:function(O){return Math.abs(O.distanceToPoint(this.center))<=this.radius},clampPoint:function(y,z){var J=this.center.distanceToSquared(y);return z===S&&(z=new Of),z.copy(y),J>this.radius*this.radius&&(z.sub(this.center).normalize(),z.multiplyScalar(this.radius).add(this.center)),z},getBoundingBox:function(q){return q===S&&(q=new nb),q.set(this.center,this.center),q.expandByScalar(this.radius),q},applyMatrix4:function(N){return this.center.applyMatrix4(N),this.radius=this.radius*N.getMaxScaleOnAxis(),this},translate:function(H){return this.center.add(H),this},equals:function(W){return W.center.equals(this.center)&&W.radius===this.radius}});var Em=E.Math.Frustum=function(B,j,I,y,q,X){this.planes=[B!==S?B:new as,j!==S?j:new as,I!==S?I:new as,y!==S?y:new as,q!==S?q:new as,X!==S?X:new as]};l.assign(Em.prototype,{set:function(l,t,i,Q,N,q){var _=this.planes;return _[0].copy(l),_[1].copy(t),_[2].copy(i),_[3].copy(Q),_[4].copy(N),_[5].copy(q),this},clone:function(){return(new this.constructor).copy(this)},copy:function(l){for(var N=this.planes,p=0;6>p;p++)N[p].copy(l.planes[p]);return this},setFromMatrix:function(S){var R=this.planes,K=S.el,Z=K[0],C=K[1],l=K[2],c=K[3],Q=K[4],V=K[5],i=K[6],I=K[7],O=K[8],g=K[9],o=K[10],J=K[11],N=K[12],t=K[13],B=K[14],j=K[15];return R[0].setComponents(c-Z,I-Q,J-O,j-N).normalize(),R[1].setComponents(c+Z,I+Q,J+O,j+N).normalize(),R[2].setComponents(c+C,I+V,J+g,j+t).normalize(),R[3].setComponents(c-C,I-V,J-g,j-t).normalize(),R[4].setComponents(c-l,I-i,J-o,j-B).normalize(),R[5].setComponents(c+l,I+i,J+o,j+B).normalize(),this},intersectsObject:function(){var s=new gh;return function(h){var K=h.geometry;return null===K.boundingSphere&&K.computeBoundingSphere(),s.copy(K.boundingSphere).applyMatrix4(h.matrixWorld),this.intersectsSphere(s)}}(),intersectsSprite:function(){var s=new gh;return function(S){return s.center.set(0,0,0),s.radius=.7071067811865476,s.applyMatrix4(S.matrixWorld),this.intersectsSphere(s)}}(),intersectsSphere:function(y){for(var E=this.planes,D=y.center,_=-y.radius,n=0;6>n;n++){var A=E[n].distanceToPoint(D);if(_>A)return!1}return!0},intersectsBox:function(){var S=new Of;return function(y){for(var G=this.planes,O=0;6>O;O++){var n=G[O];if(S.x=n.normal.x>0?y.max.x:y.min.x,S.y=n.normal.y>0?y.max.y:y.min.y,S.z=n.normal.z>0?y.max.z:y.min.z,n.distanceToPoint(S)<0)return!1}return!0}}(),containsPoint:function(S){for(var v=this.planes,C=0;6>C;C++)if(v[C].distanceToPoint(S)<0)return!1;return!0}});var Me=E.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};l.assign(Me.prototype,{set:function(r,l,x,d,o,k,b,A,m,h,R,v,$,z,D,X){var J=this.el;return J[0]=r,J[4]=l,J[8]=x,J[12]=d,J[1]=o,J[5]=k,J[9]=b,J[13]=A,J[2]=m,J[6]=h,J[10]=R,J[14]=v,J[3]=$,J[7]=z,J[11]=D,J[15]=X,this},clone:function(){return(new Me).fromArray(this.el)},fromArray:function($,Y){Y===S&&(Y=0);for(var e=this.el,l=0;16>l;l++)e[l]=$[l+Y];return this},scale:function(V){var X=this.el,v=V.x,Z=V.y,T=V.z;return X[0]*=v,X[4]*=Z,X[8]*=T,X[1]*=v,X[5]*=Z,X[9]*=T,X[2]*=v,X[6]*=Z,X[10]*=T,X[3]*=v,X[7]*=Z,X[11]*=T,this},makeRotationFromEuler:function(N){var P=this.el,G=N._x,I=N._y,w=N._z,k=N._order,$=Math.cos(G),i=Math.sin(G),a=Math.cos(I),h=Math.sin(I),L=Math.cos(w),n=Math.sin(w);if("XYZ"===k){var B=$*L,M=$*n,o=i*L,Z=i*n;P[0]=a*L,P[4]=-a*n,P[8]=h,P[1]=M+o*h,P[5]=B-Z*h,P[9]=-i*a,P[2]=Z-B*h,P[6]=o+M*h,P[10]=$*a}else if("YXZ"===k){var V=a*L,q=a*n,C=h*L,A=h*n;P[0]=V+A*i,P[4]=C*i-q,P[8]=$*h,P[1]=$*n,P[5]=$*L,P[9]=-i,P[2]=q*i-C,P[6]=A+V*i,P[10]=$*a}else if("ZXY"===k){var V=a*L,q=a*n,C=h*L,A=h*n;P[0]=V-A*i,P[4]=-$*n,P[8]=C+q*i,P[1]=q+C*i,P[5]=$*L,P[9]=A-V*i,P[2]=-$*h,P[6]=i,P[10]=$*a}else if("ZYX"===k){var B=$*L,M=$*n,o=i*L,Z=i*n;P[0]=a*L,P[4]=o*h-M,P[8]=B*h+Z,P[1]=a*n,P[5]=Z*h+B,P[9]=M*h-o,P[2]=-h,P[6]=i*a,P[10]=$*a}else if("YZX"===k){var r=$*a,O=$*h,W=i*a,D=i*h;P[0]=a*L,P[4]=D-r*n,P[8]=W*n+O,P[1]=n,P[5]=$*L,P[9]=-i*L,P[2]=-h*L,P[6]=O*n+W,P[10]=r-D*n}else if("XZY"===k){var r=$*a,O=$*h,W=i*a,D=i*h;P[0]=a*L,P[4]=-n,P[8]=h*L,P[1]=r*n+D,P[5]=$*L,P[9]=O*n-W,P[2]=W*n-O,P[6]=i*L,P[10]=D*n+r}return P[3]=0,P[7]=0,P[11]=0,P[12]=0,P[13]=0,P[14]=0,P[15]=1,this},makeRotationFromQuaternion:function(i){var B=this.el,b=i._x,j=i._y,P=i._z,D=i._w,t=b+b,g=j+j,p=P+P,Y=b*t,F=b*g,l=b*p,A=j*g,W=j*p,_=P*p,T=D*t,I=D*g,K=D*p;return B[0]=1-(A+_),B[4]=F-K,B[8]=l+I,B[1]=F+K,B[5]=1-(Y+_),B[9]=W-T,B[2]=l-I,B[6]=W+T,B[10]=1-(Y+A),B[3]=0,B[7]=0,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(T){var S=this.el,G=T.el,v=G[0],D=G[1],Y=G[2],P=G[3],i=G[4],J=G[5],c=G[6],s=G[7],M=G[8],g=G[9],O=G[10],z=G[11],w=G[12],C=G[13],E=G[14],h=G[15],u=g*E*s-C*O*s+C*c*z-J*E*z-g*c*h+J*O*h,q=w*O*s-M*E*s-w*c*z+i*E*z+M*c*h-i*O*h,W=M*C*s-w*g*s+w*J*z-i*C*z-M*J*h+i*g*h,k=w*g*c-M*C*c-w*J*O+i*C*O+M*J*E-i*g*E,I=v*u+D*q+Y*W+P*k;if(0===I)return this.identity();var B=1/I;return S[0]=u*B,S[1]=(C*O*P-g*E*P-C*Y*z+D*E*z+g*Y*h-D*O*h)*B,S[2]=(J*E*P-C*c*P+C*Y*s-D*E*s-J*Y*h+D*c*h)*B,S[3]=(g*c*P-J*O*P-g*Y*s+D*O*s+J*Y*z-D*c*z)*B,S[4]=q*B,S[5]=(M*E*P-w*O*P+w*Y*z-v*E*z-M*Y*h+v*O*h)*B,S[6]=(w*c*P-i*E*P-w*Y*s+v*E*s+i*Y*h-v*c*h)*B,S[7]=(i*O*P-M*c*P+M*Y*s-v*O*s-i*Y*z+v*c*z)*B,S[8]=W*B,S[9]=(w*g*P-M*C*P-w*D*z+v*C*z+M*D*h-v*g*h)*B,S[10]=(i*C*P-w*J*P+w*D*s-v*C*s-i*D*h+v*J*h)*B,S[11]=(M*J*P-i*g*P-M*D*s+v*g*s+i*D*z-v*J*z)*B,S[12]=k*B,S[13]=(M*C*Y-w*g*Y+w*D*O-v*C*O-M*D*E+v*g*E)*B,S[14]=(w*J*Y-i*C*Y-w*D*c+v*C*c+i*D*E-v*J*E)*B,S[15]=(i*g*Y-M*J*Y+M*D*c-v*g*c-i*D*O+v*J*O)*B,this},makeRotationAxis:function(K,T){var v=Math.cos(T),x=Math.sin(T),n=1-v,Q=K.x,t=K.y,A=K.z,o=n*Q,M=n*t;return this.set(o*Q+v,o*t-x*A,o*A+x*t,0,o*t+x*A,M*t+v,M*A-x*Q,0,o*A-x*t,M*A+x*Q,n*A*A+v,0,0,0,0,1),this},multiply:function(S){return this.multiplyMatrices(this,S)},premultiply:function(K){return this.multiplyMatrices(K,this)},multiplyMatrices:function(Y,L){var W=Y.el,T=L.el,d=this.el,s=W[0],K=W[4],o=W[8],Q=W[12],f=W[1],P=W[5],D=W[9],O=W[13],N=W[2],I=W[6],t=W[10],J=W[14],v=W[3],q=W[7],R=W[11],Z=W[15],x=T[0],V=T[4],h=T[8],b=T[12],y=T[1],A=T[5],E=T[9],C=T[13],g=T[2],l=T[6],M=T[10],k=T[14],j=T[3],c=T[7],X=T[11],i=T[15];return d[0]=s*x+K*y+o*g+Q*j,d[4]=s*V+K*A+o*l+Q*c,d[8]=s*h+K*E+o*M+Q*X,d[12]=s*b+K*C+o*k+Q*i,d[1]=f*x+P*y+D*g+O*j,d[5]=f*V+P*A+D*l+O*c,d[9]=f*h+P*E+D*M+O*X,d[13]=f*b+P*C+D*k+O*i,d[2]=N*x+I*y+t*g+J*j,d[6]=N*V+I*A+t*l+J*c,d[10]=N*h+I*E+t*M+J*X,d[14]=N*b+I*C+t*k+J*i,d[3]=v*x+q*y+R*g+Z*j,d[7]=v*V+q*A+R*l+Z*c,d[11]=v*h+q*E+R*M+Z*X,d[15]=v*b+q*C+R*k+Z*i,this},lookAt:function(){var H=new Of,S=new Of,i=new Of;return function(u,n,P){var g=this.el;return i.subVectors(u,n),0===i.lengthSq()&&(i.z=1),i.normalize(),H.crossVectors(P,i),0===H.lengthSq()&&(1===Math.abs(P.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),H.crossVectors(P,i)),H.normalize(),S.crossVectors(i,H),g[0]=H.x,g[4]=S.x,g[8]=i.x,g[1]=H.y,g[5]=S.y,g[9]=i.y,g[2]=H.z,g[6]=S.z,g[10]=i.z,this}}(),extractScale:function(){var L;return function(Z){L===S&&(L=new Of),Z===S&&(Z=new Of);var X=L.setFromMatrixColumn(this,0).length(),b=L.setFromMatrixColumn(this,1).length(),m=L.setFromMatrixColumn(this,2).length();return Z.set(X,b,m),Z}}(),extractRotation:function(){var v;return function(Y){v===S&&(v=new Of),Y===S&&(Y=new Me);var k=this.el,l=Y.el,t=1/v.setFromMatrixColumn(Y,0).length(),s=1/v.setFromMatrixColumn(Y,1).length(),y=1/v.setFromMatrixColumn(Y,2).length();return k[0]=l[0]*t,k[1]=l[1]*t,k[2]=l[2]*t,k[4]=l[4]*s,k[5]=l[5]*s,k[6]=l[6]*s,k[8]=l[8]*y,k[9]=l[9]*y,k[10]=l[10]*y,this}}(),multiplyScalar:function(b){var x=this.el;return x[0]*=b,x[4]*=b,x[8]*=b,x[12]*=b,x[1]*=b,x[5]*=b,x[9]*=b,x[13]*=b,x[2]*=b,x[6]*=b,x[10]*=b,x[14]*=b,x[3]*=b,x[7]*=b,x[11]*=b,x[15]*=b,this},getPosition:function(m){return m===S&&(m=new Of),m.setFromMatrixColumn(this,3)},setPosition:function(d){var p=this.el;return p[12]=d.x,p[13]=d.y,p[14]=d.z,this},toArray:function(e,l){e===S&&(e=[]),l===S&&(l=0);var z=this.el;return e[l]=z[0],e[l+1]=z[1],e[l+2]=z[2],e[l+3]=z[3],e[l+4]=z[4],e[l+5]=z[5],e[l+6]=z[6],e[l+7]=z[7],e[l+8]=z[8],e[l+9]=z[9],e[l+10]=z[10],e[l+11]=z[11],e[l+12]=z[12],e[l+13]=z[13],e[l+14]=z[14],e[l+15]=z[15],e},determinant:function(){var N=this.el,z=N[0],o=N[4],F=N[8],E=N[12],D=N[1],m=N[5],K=N[9],$=N[13],w=N[2],B=N[6],W=N[10],M=N[14],A=N[3],q=N[7],r=N[11],J=N[15];return A*(+E*K*B-F*$*B-E*m*W+o*$*W+F*m*M-o*K*M)+q*(+z*K*M-z*$*W+E*D*W-F*D*M+F*$*w-E*K*w)+r*(+z*$*B-z*m*M-E*D*B+o*D*M+E*m*w-o*$*w)+J*(-F*m*w-z*K*B+z*m*W+F*D*B-o*D*W+o*K*w)},copy:function(A){var r=this.el,L=A.el;return r[0]=L[0],r[1]=L[1],r[2]=L[2],r[3]=L[3],r[4]=L[4],r[5]=L[5],r[6]=L[6],r[7]=L[7],r[8]=L[8],r[9]=L[9],r[10]=L[10],r[11]=L[11],r[12]=L[12],r[13]=L[13],r[14]=L[14],r[15]=L[15],this},compose:function(J,E,s){var k=this.el,S=E._x,Q=E._y,w=E._z,i=E._w,q=S+S,A=Q+Q,p=w+w,Y=S*q,T=S*A,z=S*p,y=Q*A,l=Q*p,v=w*p,u=i*q,n=i*A,$=i*p,N=s.x,I=s.y,B=s.z;return k[0]=(1-(y+v))*N,k[1]=(T+$)*N,k[2]=(z-n)*N,k[3]=0,k[4]=(T-$)*I,k[5]=(1-(Y+v))*I,k[6]=(l+u)*I,k[7]=0,k[8]=(z+n)*B,k[9]=(l-u)*B,k[10]=(1-(Y+y))*B,k[11]=0,k[12]=J.x,k[13]=J.y,k[14]=J.z,k[15]=1,this},decompose:function(){var R=new Of,l=new Me;return function(o,v,K){var $=this.el,q=R.set($[0],$[1],$[2]).length(),d=R.set($[4],$[5],$[6]).length(),Y=R.set($[8],$[9],$[10]).length(),m=this.determinant();0>m&&(q=-q),o.x=$[12],o.y=$[13],o.z=$[14],l.copy(this);var z=1/q,N=1/d,u=1/Y;return l.el[0]*=z,l.el[1]*=z,l.el[2]*=z,l.el[4]*=N,l.el[5]*=N,l.el[6]*=N,l.el[8]*=u,l.el[9]*=u,l.el[10]*=u,v.setFromRotationMatrix(l),K.x=q,K.y=d,K.z=Y,this}}()});var Xi=E.Math.Triangle=function(i,c,R){this.a=i!==S?i:new Of,this.b=c!==S?c:new Of,this.c=R!==S?R:new Of};l.assign(Xi,{barycoordFromPoint:function(){var K=new Of,I=new Of,j=new Of;return function(U,D,u,P,v){K.subVectors(P,D),I.subVectors(u,D),j.subVectors(U,D);var M=K.dot(K),t=K.dot(I),g=K.dot(j),b=I.dot(I),z=I.dot(j),s=M*b-t*t,q=v||new Of;if(0===s)return q.set(-2,-1,-1);var m=1/s,F=(b*g-t*z)*m,E=(M*z-t*g)*m;return q.set(1-F-E,E,F)}}()});var Dd=E.Math.Euler=function(J,r,H,g,W){this.set(J,r,H,g,W)};Dd.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Dd.DefaultOrder="XYZ",Dd.ReverseOrder=function(w){return w=w[2]+w[1]+w[0],w.toUpperCase()},l.defineProperties(Dd.prototype,{x:{get:function(){return this._x},set:function(K){this._x=K,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(i){this._y=i,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(T){this._z=T,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(s){this._order=s,this.onChangeCallback()}}}),l.assign(Dd.prototype,{set:function(F,K,f,l,j){return Si(F)&&(j=f,l=K,f=F[2],K=F[1],F=F[0]),l?j&&(l=Dd.ReverseOrder(l)):l="ZYX",this._x=F||0,this._y=K||0,this._z=f||0,this._order=l||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(h,Q,I){var O=E.Math.clamp,U=h.el||h,t=U[0],u=U[4],l=U[8],o=U[1],K=U[5],a=U[9],Z=U[2],J=U[6],s=U[10];return Q=Q||this._order,"XYZ"===Q?(this._y=Math.asin(O(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-a,s),this._z=Math.atan2(-u,t)):(this._x=Math.atan2(J,K),this._z=0)):"YXZ"===Q?(this._x=Math.asin(-O(a,-1,1)),Math.abs(a)<.99999?(this._y=Math.atan2(l,s),this._z=Math.atan2(o,K)):(this._y=Math.atan2(-Z,t),this._z=0)):"ZXY"===Q?(this._x=Math.asin(O(J,-1,1)),Math.abs(J)<.99999?(this._y=Math.atan2(-Z,s),this._z=Math.atan2(-u,K)):(this._y=0,this._z=Math.atan2(o,t))):"ZYX"===Q?(this._y=Math.asin(-O(Z,-1,1)),Math.abs(Z)<.99999?(this._x=Math.atan2(J,s),this._z=Math.atan2(o,t)):(this._x=0,this._z=Math.atan2(-u,K))):"YZX"===Q?(this._z=Math.asin(O(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-a,K),this._y=Math.atan2(-Z,t)):(this._x=0,this._y=Math.atan2(l,s))):"XZY"===Q?(this._z=Math.asin(-O(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(J,K),this._y=Math.atan2(l,t)):(this._x=Math.atan2(-a,s),this._y=0)):console.warn("unsupported order: "+Q),this._order=Q,I!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var G=new Me;return function(g,R,D){return G.makeRotationFromQuaternion(g),this.setFromRotationMatrix(G,R,D)}}(),setFromVector3:function(z,v){return this.set(z.x,z.y,z.z,v||this._order)},reorder:function(){var G=new Oh;return function(t){return G.setFromEuler(this),this.setFromQuaternion(G,t)}}(),equals:function(Z){return Z._x===this._x&&Z._y===this._y&&Z._z===this._z&&Z._order===this._order},fromArray:function(O){return this._x=O[0],this._y=O[1],this._z=O[2],O[3]!==S&&(this._order=O[3]),this.onChangeCallback(),this},toArray:function(J,l){return J===S&&(J=[]),l===S&&(l=0),J[l]=this._x,J[l+1]=this._y,J[l+2]=this._z,J[l+3]=this._order,J},toVector3:function(q){return q?q.set(this._x,this._y,this._z):new Of(this._x,this._y,this._z)},onChange:function(p){return this.onChangeCallback=p,this},onChangeCallback:function(){}});var _l={ms_ac:function(j,e){for(var D=e.ms_ac,_=0;_<D.length;_++)ti(j,D[_])},ms_listener:function(Z){Z.addListeners=function(){for(var l=this,S=0;S<zj.length;S++){var N=zj[S];"wheel"===N&&!l.handle_wheel&&l.handle_mousewheel&&(l.handle_wheel=function(A){Uh(l,A)}),l["handle_"+N]&&Vk(N,l.getView(),l)}},Z.removeListeners=function(){for(var a=this,m=0;m<zj.length;m++)a["handle_"+zj[m]]&&rl(zj[m],a.getView(),a)}},ms_fire:function(N){N.mp=function(K,u,H){this.addPropertyChangeListener(K,u,H)},N.ump=function(p,P){this.removePropertyChangeListener(p,P)},N.fp=function(Y,f,H,T,z){return this.firePropertyChange(Y,f,H,T,z)},N.addPropertyChangeListener=function(I,L,e){var A=this;A._62I||(A._62I=new cd),A._62I.add(I,L,e)},N.removePropertyChangeListener=function(j,E){this._62I&&this._62I.remove(j,E)},N.firePropertyChange=function(d,w,P,C,V){if(C){if(C(w,P))return!1}else if(w===P)return!1;var t=this,H=V||{};return H.property=d,H.oldValue=w,H.newValue=P,H.source=t,H.data=t,t._62I&&t._62I.fire(H),t.onPropertyChanged&&t.onPropertyChanged(H),!0}},ms_attr:function(N){N.a=function(m,q){var M=this;if(2===arguments.length)M.setAttr(m,q);else{if(!uq(m))return M.getAttr(m);for(var C in m)M.setAttr(C,m[C])}return M},N.getAttr=function(Y,G){if(G===S&&(G=1),this._attrObject&&Y in this._attrObject)return this._attrObject[Y];if(this.getImage){var Q=this.getImage();if(rb(Q)&&(Q=lb[Q]),uq(Q)&&"dataBindings"in Q)for(var e=Q.dataBindings,A=e.length-1;A>=0;A--){var h=e[A];if(h.attr===Y){if("defaultValue"in h)return h.defaultValue;break}}}return G?k[Y]:S},N.setAttr=function(E,M){var A=this;A._attrObject||(A._attrObject={});var j=A._attrObject[E];M===S?delete A._attrObject[E]:A._attrObject[E]=M,A.fp&&A.fp("a:"+E,j,M)&&A.onAttrChanged&&A.onAttrChanged(E,j,M)},N.getSerializableAttrs=function(){var Z,J={};for(Z in this._attrObject)J[Z]=1;return J}},ms_bnb:function(t){t.getBodyColor=function(w){return w.s("body.color")},t.getBorderColor=function(z){return z.s("border.color")}},_51o:function(y){y.mi=function(Y,T,L){this.addInteractorListener(Y,T,L)},y.umi=function(K,J){this.removeInteractorListener(K,J)},y.fi=function(G){this.fireInteractorEvent(G)},y.addInteractorListener=function(N,V,g){var S=this;S._63I||(S._63I=new cd),S._63I.add(N,V,g)},y.removeInteractorListener=function(z,X){this._63I&&this._63I.remove(z,X)},y.fireInteractorEvent=function(m){this._63I&&this._63I.fire(m)},y.setInteractors=function(e){var I=this,T=I._interactors;T&&T.each(function(b){b.tearDown()}),Si(e)&&(e=new Fj(e)),I._interactors=e,e&&e.each(function(o){o.setUp()}),I.fp("interactors",T,e),I.invalidateSelection()},y.getInteractors=function(){return this._interactors}},_49o:function(j){j._44O=o,j._45O=o,j.getTopPainters=function(){return this._44O},j.getBottomPainters=function(){return this._45O},j.addTopPainter=function(I){var y=this;y._44O||(y._44O=new Fj),y._44O.contains(I)||(y._44O.add(I),y.redraw&&y.redraw())},j.removeTopPainter=function(A){var S=this;S._44O&&(S._44O.remove(A),S.redraw&&S.redraw())},j.addBottomPainter=function(U){var w=this;w._45O||(w._45O=new Fj),w._45O.contains(U)||(w._45O.add(U),w.redraw&&w.redraw())},j.removeBottomPainter=function(Y){var Z=this;Z._45O&&(Z._45O.remove(Y),Z.redraw&&Z.redraw())},j._93db=function(B,G){var q=this;q._45O&&q._45O.each(function(g){g.draw?g.draw(B,G):g.call(q,B,G)})},j._92db=function(p,l){var T=this;T._44O&&T._44O.each(function(G){G.draw?G.draw(p,l):G.call(T,p,l)})}},ms_sm:function(T){T.sm=function(){return this.getSelectionModel()},T.setSelectableFunc=function(F){this.sm().setFilterFunc(F)},T.getSelectableFunc=function(){return this.sm().getFilterFunc()},T.getSelectionModel=function(){var A=this;return A._selectionModel?A._selectionModel:A.dm().sm()},T.isSelectionModelShared=function(){return!this._selectionModel},T.setSelectionModelShared=function(M){var K=this,H=!K._selectionModel,Y=K.handleSelectionChange,B=K.dm();H!==M&&(K.invalidateSelection&&K.invalidateSelection(),M?(B.sm().ms(Y,K),K._selectionModel.ums(Y,K),K._selectionModel.dispose(),K._selectionModel=o):(B.sm().ums(Y,K),K._selectionModel=new Lb(B),K._selectionModel.ms(Y,K)),K.onSelectionModelSharedChanged(),K.fp("selectionModelShared",H,M))
},T.onSelectionModelSharedChanged=function(){var o=this;o.redraw(),o.invalidateSelection&&o.invalidateSelection()},T.removeSelection=function(){var J=this.dm();J.beginTransaction(),this.sm().toSelection().each(J.remove,J),J.endTransaction()},T.selectAll=function(){var v=this;v.sm().ss(v.dm().toDatas(function(_){return v.isVisible(_)&&v.isSelectable(_)}))},T.isSelected=function(U){return this.sm().co(U)},T.isSelectedById=function(l){var F=this.dm().getDataById(l);return F?this.isSelected(F):!1},T.isSelectable=function(L){return this.sm().isSelectable(L)}},ms_tx:function(z){z._64I=0,z._65O=0,z.isScrollable=function(){return this.getWidth()<this._64I},z._40o=function(){return this.isScrollable()},z.getLogicalPoint=function($){return Zl($,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},z.tx=function(A){return A===S?this.getTranslateX():(this.setTranslateX(A),void 0)},z.getTranslateX=function(){return this._65O},z.setTranslateX=function(z){var r=this,U=r.getWidth()-r._64I;U>z&&(z=U),z>0&&(z=0),z=h(z);var l=r._65O;r._65O=z,r.fp(og,l,z)}},ms_ty:function(J){J._23Q=0,J._66O=0,J._41o=function(){return this.getHeight()<this._23Q},J.getLogicalPoint=function(W){return Zl(W,this._canvas||this._view,this.tx?this.tx():0,this.ty())},J.ty=function(K){return K===S?this.getTranslateY():(this.setTranslateY(K),void 0)},J.getTranslateY=function(){return this._66O},J.setTranslateY=function(s){var H=this,k=H.getHeight()-H._23Q;k>s&&(s=k),s>0&&(s=0),s=h(s);var R=H._66O;H._66O=s,H.fp(zb,R,s)}},ms_txy:function(J){J._65O=0,J._66O=0,J.tx=function(q){return q===S?this.getTranslateX():(this.setTranslateX(q),void 0)},J.ty=function(A){return A===S?this.getTranslateY():(this.setTranslateY(A),void 0)},J.onTranslateEnded=function(){},J.setTranslate=function(f,v,P){var V=this;if(P=zg(P)){V._65I&&V._65I.stop(!0);var i=V.tx(),C=V.ty();P.action=function($){V.setTranslate(i+(f-i)*$,C+(v-C)*$)},P._37o=function(){delete V._66I,delete V._65I,V.onTranslateEnded()},V._66I=1,V._65I=Jc(P)}else V.tx(f),V.ty(v)},J.getTranslateX=function(){return this._65O},J.setTranslateX=function(F){var k=this;F=k.adjustTranslateX(F);var M=k._65O;k._65O=F,k.fp(og,M,F)},J.getTranslateY=function(){return this._66O},J.setTranslateY=function(Z){var R=this;Z=R.adjustTranslateY(Z);var b=R._66O;R._66O=Z,R.fp(zb,b,Z)},J.adjustTranslateX=function(u){return h(u)},J.adjustTranslateY=function(B){return h(B)},J.translate=function(v,o,m){this.setTranslate(this.tx()+v,this.ty()+o,m)},J.getLogicalPoint=function(Y){var V=this;return Zl(Y,this._canvas||V._view,V.tx(),V.ty())}},ms_dm:function(j){j.dm=function(P){return P?(this.setDataModel(P),void 0):this.getDataModel()},j.getDataModel=function(){return this._dataModel}},ms_lp:function(u){u.lp=function(t){return this.getLogicalPoint(t)}},ms_v:function(p){p._disabled=!1,p.setDisabled=function(U,J){var d=this,L=d._disabled;L!==U&&(L&&(tc(d._63O),delete d._63O),U&&(xh(d._view,d._63O=uj(J)),d.iv()),d._disabled=U,d.fp("disabled",L,U))},p.isDisabled=function(){return this._disabled},p.getDisabledDiv=function(){return this._63O},p.getView=function(){return this._view},p.addToDOM=function(n){var a=this,E=a.getView(),p=E.style;n=n||L.body,n.appendChild(E),p.left="0",p.right="0",p.top="0",p.bottom="0",A(d,"resize",function(){a.iv()}),a.iv()},p.getWidth=function(){return this._view.clientWidth},p.getHeight=function(){return this._view.clientHeight},p.setWidth=function(I){var P=this;P._view.style.width=I+Yg,P.iv(),P.fp&&P.fp(Ij,o,I)},p.setHeight=function(N){var P=this;P._view.style.height=N+Yg,P.iv(),P.fp&&P.fp(hk,o,N)},p.setFocus=function(I){var C=this,X=C._currentEditor;return I&&X&&(X.getView&&(X=X.getView()),X.contains(I.target))?!1:(qf(C._view),C.endEditing&&C.endEditing(),C.fireViewEvent("focus"),!0)},p.iv=function(O){this.invalidate(O)},p.invalidate=function(D){var X=this;X._68I||(X._68I=1,Rg(X.validate,X,o,D),X.onInvalidated&&X.onInvalidated(),X.fireViewEvent("invalidate"))},p.validate=function(){var z=this,O=z._view;if(z._68I&&(delete z._68I,O.parentNode))if(0===O.offsetWidth&&0===O.offsetHeight&&z._67I!==o)z._67I===S&&(z._67I=N.reinvalidateCount),z._67I>0?z._67I--:z._67I=o,z.iv();else{z.fireViewEvent("beginValidate"),z.validateImpl(),z.onValidated&&z.onValidated(),z.fireViewEvent("validate");var i=z._63O;i&&(O.lastChild!==i&&(tc(i),xh(O,i)),_o(i,0,0,z.getWidth(),z.getHeight())),ul(z),Be(z),aq(z)}},p.layout=function(B,f,A,U){1===arguments.length?_o(this,B):_o(this,B,f,A,U)},p.addViewListener=function(w,X,E){var c=this;c._67O||(c._67O=new cd),c._67O.add(w,X,E)},p.removeViewListener=function(p,o){this._67O.remove(p,o)},p.fireViewEvent=function(z){var L=this;L._67O&&(rb(z)&&(z={kind:z}),L._67O.fire(z)),N.viewListener&&N.viewListener(L,z)}},ms_tip:function(t){t.setToolTipEnabled=function(M){var G=this;M?Tk||G._13o||(G.enableToolTip(),G.fp("toolTipEnabled",!1,!0)):G._13o&&(G.disableToolTip(),G.fp("toolTipEnabled",!0,!1))},t.isToolTipEnabled=function(){return!!this._13o},t.enableToolTip=function(){var D=this;if(!Tk&&!D._13o){D._13o=function(S){var r=D.getToolTip(S);r!=o?N.toolTipContinual&&N.isToolTipShowing()?zd(S,r):(mh(),mn={timeout:W(sg,zk),e:S,info:r}):mh()};var J=D.getView();A(J,Ti,D._13o),A(J,"mouseleave",N.hideToolTip)}},t.disableToolTip=function(){var w=this;if(w._13o){var z=w.getView();u(z,Ti,w._13o),u(z,"mouseleave",N.hideToolTip),delete w._13o}},t.getToolTip=function(n){var J=this;if(J.getDataAt){var B=J.getDataAt(n);return B?B.getToolTip():o}return J.getValue?J.getValue():void 0}},_52o:function(F){F._zoom=1,F._29I=qb,F.zoomIn=function(t,T){this.setZoom(this._zoom*Fn,t,T)},F.zoomOut=function(f,W){this.setZoom(this._zoom/Fn,f,W)},F.zoomReset=function(N,U){this.setZoom(1,N,U)},F.scrollZoomIn=function(u){this.setZoom(this._zoom*Fo,o,u)},F.scrollZoomOut=function(W){this.setZoom(this._zoom/Fo,o,W)},F.pinchZoomIn=function(f){this.setZoom(this._zoom*Vj,o,f)},F.pinchZoomOut=function(z){this.setZoom(this._zoom/Vj,o,z)},F.adjustZoom=function(r){return Lr>r?Lr:r>Vl?Vl:r},F.getZoom=function(){return this._zoom},F.setZoom=function(f,g,C){var B=this;if(g=zg(g)){B._14o&&B._14o.stop(!0);var d=B._zoom;g.action=function(O){B._96O(d+(f-d)*O,C)},g._37o=function(){delete B._zooming,delete B._14o,B.onZoomEnded()},B._zooming=1,B._14o=Jc(g)}else B._96O(f,C)},F._96O=function(p,Y){var K=this;if(p=K.adjustZoom(p),p!==K._zoom){K.validate();var g=K._29I,A=K._zoom;0!==g.width&&0!==g.height&&(Y=Y?Y:{x:g.x+g.width/2,y:g.y+g.height/2},K.tx((Y.x-g.x)*A-Y.x*p),K.ty((Y.y-g.y)*A-Y.y*p)),K._zoom=p,K.fp("zoom",A,p)}}},ms_edge:function(g){g._2I=function(l){var G=this;G._44I||(G._44I=new Fj),G._42I||(G._42I=new Fj),G._44I.add(l),G._42I.add(l),G._20I()},g._4I=function(K){var k=this;k._44I||(k._44I=new Fj),k._43I||(k._43I=new Fj),k._44I.add(K),k._43I.add(K),k._20I()},g._16I=function(R){var q=this;q._44I.remove(R),q._42I.remove(R),q._44I.isEmpty()&&delete q._44I,q._42I.isEmpty()&&delete q._42I,q._20I()},g._18I=function(N){var C=this;C._44I.remove(N),C._43I.remove(N),C._44I.isEmpty()&&delete C._44I,C._43I.isEmpty()&&delete C._43I,C._20I()},g._20I=function(){var J=this;if(delete J._45I,!J._44I||J._44I.isEmpty())return delete J._70O,void 0;var c;J._44I.each(function(x){x.isLooped()&&(c||(c={}),c[x._id]||(J._45I||(J._45I=new Fj),J._45I.add(x),c[x._id]=x))}),c?(J._70O=new Fj,J._44I.each(function(O){c[O._id]?"A"===c[O._id]||(c[O._id]="A",J._70O.add(O)):J._70O.add(O)})):J._70O=J._44I},g.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},g.getSourceAgentEdges=function(){return this._46I},g.getTargetAgentEdges=function(){return this._47I},g._1I=function(N){var K=this;K._46I||(K._46I=new Fj),K._48I||(K._48I=new Fj),K._46I.add(N),K._48I.add(N),K._19I()},g._3I=function(F){var O=this;O._47I||(O._47I=new Fj),O._48I||(O._48I=new Fj),O._47I.add(F),O._48I.add(F),O._19I()},g._15I=function(Z){var m=this;m._46I.remove(Z),m._48I.remove(Z),m._46I.isEmpty()&&delete m._46I,m._48I.isEmpty()&&delete m._48I,m._19I()},g._17I=function(E){var H=this;H._47I.remove(E),H._48I.remove(E),H._47I.isEmpty()&&delete H._47I,H._48I.isEmpty()&&delete H._48I,H._19I()},g._19I=function(){var R=this;delete R._49I;var t=R._48I;if(t&&!t.isEmpty()){var h={};t.each(function(d){h[d._id]?R._49I||(R._49I=new Fj):h[d._id]=d}),R._49I?t.each(function(o){h[o._id]&&(R._49I.add(o),delete h[o._id])}):R._49I=t}},g.getLoopedEdges=function(){return this._45I},g.getEdges=function(){return this._70O},g.getAgentEdges=function(){return this._49I},g.getSourceEdges=function(){return this._42I},g.getTargetEdges=function(){return this._43I},g._8I=function(){this._70O&&this._70O.each(function(p){p._7I()})}}};vq(N,{numberDigits:5,crossOrigin:"",baseZIndex:S,isTouchable:Tk,devicePixelRatio:d.devicePixelRatio?d.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:f.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Wc},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],encodeStringKey:null,doubleClickRange:Tk?20:1,animDuration:200,animEasing:function(Q){return Q*Q},labelColor:Kk,labelSelectColor:vg,labelFont:(Tk?"15":"12")+"px arial, sans-serif",widgetIndent:Tk?30:20,widgetRowHeight:Tk?30:20,widgetHeaderHeight:Tk?32:22,widgetTitleHeight:Tk?34:24,scrollBarColor:Jd,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:Tk?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:ce,intersectionLineLine:Cq,isEnter:lo,isEsc:Lq,isDelete:Lc,isSpace:Pe,isLeft:Di,isUp:mr,isRight:vc,isDown:jn,getTarget:qs,isString:rb,isNumber:Ie,isBoolean:Vd,isArray:Si,isSelectAll:qo,isFunction:fd,isObject:uq,getPropertyValue:jl,setPropertyValue:dq,addMethod:vq,getVersion:function(){return"7.0.7"},isMobile:function(){var U;return function(){return U!==S?U:(U=!1,function(C){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(C)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(C.substr(0,4)))&&(U=!0)}(navigator.userAgent||navigator.vendor||d.opera),U)}}(),createGradient:function(p,k,H,E,Q,N,A,D){var F=Mc[k];return F(p,H,E,Q,N,A,D)},appendToScreen:function(r){r=r.getView?r.getView():r,(L.fullscreenElement||L.mozFullScreenElement||L.webkitFullscreenElement||L.msFullscreenElement||L.body).appendChild(r)},encodeString:function(m){return E.Math.encodeBase64(m,N.encodeStringKey)},decodeString:function(i){return E.Math.decodeBase64(i,N.encodeStringKey)},findView:function(X){var G=function(c,Y){var P=Y._ht;P&&c.push(P);var r=Y.children,m=r.length;if(m)for(var S=0;m>S;S++)G(c,r[S])},J=[];G(J,L.body);var D=function(E,i){for(var u="2d"===i?Mb.GraphView:gl.Graph3dView,B=0,$=E.length;$>B;B++)if(E[B]instanceof u)return J[B];return null};return"all"===X?J:"2d"===X?D(J,"2d"):"3d"===X?D(J,"3d"):D(J,"3d")||D(J,"2d")},toggleFullscreen:function(k){var J=k.getView();if(L.fullscreenElement||L.mozFullScreenElement||L.webkitFullscreenElement||L.msFullscreenElement)L.exitFullscreen?L.exitFullscreen():L.msExitFullscreen?L.msExitFullscreen():L.mozCancelFullScreen?L.mozCancelFullScreen():L.webkitExitFullscreen&&L.webkitExitFullscreen();else{var y=!0;if(k.isSelfViewEvent){var C=k.getX(),O=k.getY(),f=k.getWidth(),i=k.getHeight(),z=J.style.background,Y=J.style.backgroundColor;z||Y||(J.style.backgroundColor="white"),J.requestFullscreen?J.requestFullscreen():J.msRequestFullscreen?J.msRequestFullscreen():J.mozRequestFullScreen?J.mozRequestFullScreen():J.webkitRequestFullscreen&&J.webkitRequestFullscreen();var e=setInterval(function(){if(J!==(L.fullscreenElement||L.mozFullScreenElement||L.webkitFullscreenElement||L.msFullscreenElement))clearInterval(e),k.setX(C),k.setY(O),k.setWidth(f),k.setHeight(i),k._fullscreen=!1,J.style.oldBackgroundColor=Y,k.iv();else{var s=E.Default.getWindowInfo();(y||s.width!==k.getWidth()||s.height!==k.getHeight())&&(k.setX(s.left),k.setY(s.top),k.setWidth(s.width),k.setHeight(s.height),k._fullscreen=!0,k.iv(),y=!1)}},500)}else{var m=J.style.left,W=J.style.top,f=J.style.width,i=J.style.height,z=J.style.background,Y=J.style.backgroundColor;z||Y||(J.style.backgroundColor="white"),J.requestFullscreen?J.requestFullscreen():J.msRequestFullscreen?J.msRequestFullscreen():J.mozRequestFullScreen?J.mozRequestFullScreen():J.webkitRequestFullscreen&&J.webkitRequestFullscreen();var e=setInterval(function(){if(J!==(L.fullscreenElement||L.mozFullScreenElement||L.webkitFullscreenElement||L.msFullscreenElement))clearInterval(e),J.style.left=m,J.style.top=W,J.style.width=f,J.style.height=i,J.style.oldBackgroundColor=Y,k.iv();else{var a=E.Default.getWindowInfo();(y||a.width!==k.getWidth()||a.height!==k.getHeight())&&(_o(k),y=!1)}},500)}}},appendTimeStamp:function(B){return B},setCompType:function(x,t){fd(t)||uq(t)?Zc[x]=t:Db(x)},getCompType:function($){var B=Zc[$];return B===S&&vf.test($)&&Db($),B},getCompTypeMap:function(){return Zc},drawCompType:function(N,T,h,m,R,v){N(T,h,m,R,v)},numberListener:function(){var K={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(r){var f=r.keyCode;K[f]||65===f&&N.isCtrlDown(r)||86===f&&N.isCtrlDown(r)||67===f&&N.isCtrlDown(r)||88===f&&N.isCtrlDown(r)||f>=35&&40>=f||(r.shiftKey||48>f||f>57)&&(96>f||f>105)&&r.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(j){var Q=j.target.tagName;("DIV"===Q||"CANVAS"===Q)&&!(N.ignoreKeyCodes.indexOf(j.keyCode)>=0)&&("keydown"!==j.type||Di(j)||vc(j)||mr(j)||jn(j)||Lc(j)||65===j.keyCode&&(j.metaKey||j.ctrlKey))&&(j.preventDefault(),j.preventManipulation&&j.preventManipulation())},getWindowInfo:function(){var M=L.documentElement,N=M&&(M.scrollLeft||M.scrollTop)?M:L.body;return{target:N,left:N.scrollLeft,top:N.scrollTop,width:d.innerWidth||N.clientWidth,height:d.innerHeight||N.clientHeight}},isDragging:function(){return!!Wc},isLeftButton:function(c){return Tk?!0:0===c.button},isMiddleButton:function(s){return Tk?!1:s&&(1===s.button||4&(s.buttons||0))},isRightButton:function(O){return Tk?!1:O&&(2===O.button||2&(O.buttons||0))},isInput:function(a){if(!a)return!1;var M=a.tagName;return"INPUT"===M||"TEXTAREA"===M||"SELECT"===M},getTouchCount:function(S){return Tk?S.touches.length:1},isDoubleClick:function(){function U($){$.details=0,$.timeout=null,$.lastPoint=null}var J={};return Yq=new m,lh=Yq.getTime(),function(Z){if(Z.touches&&Z.touches.length>1)return!1;var H=Z.button==o?"":Z.button,V=Z.type+H,f=V+"_isDoubleClick",D=J[V];if(D||(D=J[V]={details:0,timeout:null,lastPoint:null}),Z[f]===S){Z[f]=!0;var R=uk(Z);D.timeout&&(w(D.timeout),D.timeout=null),D.lastPoint&&Qm(D.lastPoint,R)>N.doubleClickRange&&U(D),D.lastPoint=R,D.details++,D.timeout=W(function(){U(this)}.bind(D),500)}return 2===D.details}}(),isShiftDown:function($){return $?$.shiftKey:qj["16"]},isCtrlDown:function(a){return a?Kb?a.metaKey:a.ctrlKey:Kb?qj["91"]:qj["17"]},getClientPoint:function(o){return Tk&&(o=Ln(o)),{x:o.clientX,y:o.clientY}},isMouseEvent:function(u){return u instanceof MouseEvent||0===u.type.indexOf("mouse")},getTargetElement:function(G){if(N.isMouseEvent(G)||!L.elementFromPoint)return G.target;var P=fh(G);return L.elementFromPoint(P.x,P.y)},getPagePoint:function(M){return Tk&&(M=Ln(M)),{x:M.pageX,y:M.pageY}},createObject:function(u,K){var Q=new u;for(var V in K){var S=K[V];if(fd(S))Q[V]=S;else if(0===V.indexOf("s:"))Q.s(V.substr(2),K[V]);else if(0===V.indexOf("a:"))Q.a(V.substr(2),K[V]);else{var O=In(V),S=K[V];Q[O]?(Q[O](S),"setToolTip"===O&&Q.enableToolTip&&Q.enableToolTip()):Q[V]=S}}return Q},setImage:function(g,c,V,S){var s=arguments.length;4===s?Nd(g,S,c,V):2===s?rb(c)?Nd(g,c):Gq(g,c):1===s&&Nd(g,g)},getImage:function(A,M,l){var U;if(A==o)return o;if(uq(A)?U=A:(U=lb[A],A&&U===S&&(rs&&rs[A]||Nd(A,A))),M&&U&&U.tagName){var _;_="override"===l?"colors_override":"override_rgb"===l?"colors_override_rgb":"override_a"===l?"colors_override_a":"colors",U[_]||(U[_]={__count__:0});var q=U[_][M];return q||(U[_].__count__>N.imageCacheThreshold&&(U[_]={__count__:0}),q=Ug(U,zh(M),U.width,U.height,l),U[_][M]=q,U[_].__count__++),q}return U},isImageComplete:function(o,D,t){var A=ng(o);if(!A)return!1;if(A.tagName)return A.complete;for(var b,o,v,J=A.comps,z=!0,a=0,M=J.length;M>a;a++)if(b=J[a],v=b.type,"image"===b.type){o=b.name,o&&o.func&&(o=hd(o,D));var _=Qh(o,D,t);if(!_){z=!1;break}}else if(vf.test(v)&&N.getCompType(v)===S){z=!1,Db(v);break}return z},getId:function(){var T=1;return function(){return++T}}(),callLater:function(G,w,V,r){var H=function(){G.apply(w,V)};return r?W(H,r):d.requestAnimationFrame(H)},cancelLater:function(Z,f){f?w(Z):d.cancelAnimationFrame(Z)},clone:function(L){if(null==L||"object"!=typeof L)return L;if(L instanceof Date){var b=new Date;return b.setTime(L.getTime()),b}if(L instanceof Array){for(var b=[],B=0,t=L.length;t>B;B++)b[B]=rj(L[B]);return b}if(L instanceof Fj){for(var b=new Fj,B=0,t=L.length;t>B;B++)b.set(B,rj(L.get(B)));return b}if(L instanceof Xd)return L;if(L instanceof l){var b={};for(var J in L)L.hasOwnProperty(J)&&(b[J]=rj(L[J]));return b}return L},callWhenLoaded:function(C,V){V=V||100;var O=$j(C,V);To||(To={}),To[O]={tick:O,cb:C,delay:V}},beforeLoadURL:function(Y){if(To){var A={};for(var x in To){var y=To[x];w(y.tick);var D=$j(y.cb,y.delay);A[D]={tick:D,delay:y.delay,cb:y.cb}}To=A}return N.convertURL?N.convertURL(Y):Y},convertURL:function(q){return q},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return N.getImage("default_blank")},resizeImagePOT:function(L,c){if(!L||!L.tagName)return L;var l=L.width,n=L.height;if(!l||!n)return L;if(Er.isPOT(l)&&Er.isPOT(n)&&(!c||l===n))return L;var T,s;c?s=T=Er.nearestPOT(Math.min(l,n)):(T=Er.nearestPOT(l),s=Er.nearestPOT(n));var X=ib(),z=X.getContext("2d");return km(X,T,s,1),z.drawImage(L,0,0,l,n,0,0,T,s),X},sortFunc:function(i,r){if(i===r)return 0;if(i==o&&r!=o)return 1;if(i!=o&&r==o)return-1;if(i==o&&r==o)return 0;var c,f=typeof i,V=typeof r;return f===Tg&&V===Tg?c=i.localeCompare(r):f===sk&&V===sk&&(c=i-r),c===S&&(c=(""+i).localeCompare(""+r)),c>0?1:0>c?-1:0},getClassMap:function(){return Dh},getClass:function(u){if(rb(u)){var C,V=Dh[u];if(!V){C=u.split("."),V=d;for(var Y=0;Y<C.length;Y++)V=V[C[Y]];Dh[u]=V}return V}return u},def:function(c,X,M){var A,u,n,r=function(){};if(r.prototype=X.prototype,A=new r,rb(c)){if(Dh[c])throw"'"+c+"' already defined";n=kn(c),A.getClassName=function(){return c}}else n=c;if(A.constructor=n,A.getClass=function(){return n},A.getSuperClass=function(){return X},M)for(u in M)_l[u]&&_l.hasOwnProperty(u)?_l[u](A,M):Iq(A,M,u);n.prototype=A,n.superClass=X.prototype},startAnim:function(){var d=function(y){y.duration&&(y.startTime=Hg()),y.timeId=Rg(y.tick,o,o,y.interval)};return function(m){return m=rj(m),m.easing=m.easing||N.animEasing,m.duration||m.frames||(m.duration=N.animDuration),m.t=0,m.duration?m.interval=0:(m.frame=0,m.interval=m.interval||10),m.tick=function(){if(m.duration){var Q=(Hg()-m.startTime)/m.duration;if(Q>1&&(Q=1),m.t=Q,m.action(m.easing(Q),Q),!m.isRunning())return;1===Q?m.stop():m._isPaused||(m.timeId=Rg(m.tick))}else{if(m.frame++,Q=m.t=m.frame/m.frames,m.action(m.easing(Q),Q),!m.isRunning())return;m.frame<m.frames?m._isPaused||(m.timeId=Rg(m.tick,o,o,m.interval)):m.stop()}},m.resume=function(){m._isPaused&&(delete m._isPaused,m.duration?m.t<1&&(m.startTime=Hg()-m.duration*m.t,m.timeId=Rg(m.tick)):m.frame<m.frames&&(m.timeId=Rg(m.tick,o,o,m.interval)))},m.pause=function(){bb(m.timeId,!m.duration),m._isPaused=!0},m.isPaused=function(){return this._isPaused},m.stop=function(G){m.isRunning()&&(bb(m.timeId,!m.duration),delete m.timeId,m.duration?m.t<1&&G&&(m.t=1,m.action(m.easing(1),1)):m.frame<m.frames&&G&&(m.frame=m.frames,m.action(m.easing(1),1)),m._37o&&m._37o(),m.finishFunc&&m.finishFunc())},m.isRunning=function(){return m.timeId!=o},m.delay?Rg(d,o,[m],m.delay):d(m),m}}(),getTextSize:function(){var f={},Z=L?ib().getContext("2d"):o;return function(d,M){Z.font=d?d:ej;var U=f[Z.font];return U||(U=2*Z.measureText("e").width+4,f[Z.font]=U),{width:Z.measureText(M).width+4,height:U}}}(),drawText:function(S,x,I,e,i,j,b,w,M,U){if(x!=o){var p=np(I,x),R={};R.y=U&&U!==fr?U===md?j+p.height/2:j+w-p.height/2:j+w/2,R.x=M&&M!==Ec?M===zn?i+b-p.width/2:i+b/2:i+p.width/2,Om(S,x,R,I,e)}},getDistance:function(t,F){var X=t.length;return F?3===X?T(J(t[0]-F[0])+J(t[1]-F[1])+J(t[2]-F[2])):2===X?T(J(t[0]-F[0])+J(t[1]-F[1])):t.z===S?T(J(F.x-t.x)+J(F.y-t.y)):T(J(F.x-t.x)+J(F.y-t.y)+J(F.z-t.z)):3===X?T(J(t[0])+J(t[1])+J(t[2])):2===X?T(J(t[0])+J(t[1])):void 0},brighter:function(y,x){return 0>x&&(x=-x),kl(y,x?x:40)},darker:function(Z,j){return j>0&&(j=-j),kl(Z,j?j:-40)},unionPoint:function(w,Z){if(!w)return o;if(2===arguments.length)return w&&Z?{x:Q(w.x,Z.x),y:Q(w.y,Z.y),width:D(w.x-Z.x),height:D(w.y-Z.y)}:o;var m=w;if(m._as&&(m=m._as),m.length===S)return o;var t=m.length;if(0>=t)return o;for(var b=1,R=m[0],I={x:R.x,y:R.y,width:0,height:0};t>b;b++){R=m[b];var P=Q(I.x,R.x),G=r(I.x+I.width,R.x),d=Q(I.y,R.y),J=r(I.y+I.height,R.y);I.x=P,I.y=d,I.width=G-P,I.height=J-d}return I},unionRect:function(y,w){if(y&&!w)return rj(y);if(!y&&w)return rj(w);if(y&&w){var J={x:Q(y.x,w.x),y:Q(y.y,w.y)};return J.width=r(y.x+y.width,w.x+w.width)-J.x,J.height=r(y.y+y.height,w.y+w.height)-J.y,J}return o},containsPoint:function(O,R,_,L){if(L!=o&&1!==L){var q=O.x+O.width/2,A=O.y+O.height/2;O={x:q-O.width/2*L,y:A-O.height/2*L,width:O.width*L,height:O.height*L}}if(_){var Q=O.width/2,$=O.height/2,B=V(-_),M=X(-_),m=R.x-O.x-Q,W=R.y-O.y-$;return R={x:M*m-B*W,y:B*m+M*W},Ib({x:-Q,y:-$,width:O.width,height:O.height},R)}return!(!O||R.x<O.x||R.y<O.y||R.x>O.x+O.width||R.y>O.y+O.height)},containsRect:function(g,f){if(!g||!f)return!1;var K=f.x,M=f.y,k=f.width,A=f.height,n=g.width,C=g.height;if(0>(n|C|k|A))return!1;var t=g.x,H=g.y;if(t>K||H>M)return!1;if(n+=t,k+=K,K>=k){if(n>=t||k>n)return!1}else if(n>=t&&k>n)return!1;if(C+=H,A+=M,M>=A){if(C>=H||A>C)return!1}else if(C>=H&&A>C)return!1;return!0},intersectsRect:function(u,V){if(!u||!V)return!1;var G=V.width,r=V.height,L=u.width,_=u.height;if(0>=L||0>=_||0>=G||0>=r)return!1;var U=V.x,y=V.y,T=u.x,K=u.y;return L+=T,_+=K,G+=U,r+=y,L>U&&_>y&&G>T&&r>K},intersection:function(F,Y){if(!F||!Y)return o;var c=Y.x,d=Y.y,J=F.x,N=F.y,$=c,L=d,E=J,f=N;return $+=Y.width,L+=Y.height,E+=F.width,f+=F.height,J>c&&(c=J),N>d&&(d=N),$>E&&($=E),L>f&&(L=f),$-=c,L-=d,0>=$||0>=L?o:{x:c,y:d,width:$,height:L}},grow:function(C,Y,u){u===S&&(u=Y),C.x-=Y,C.y-=u,C.width=C.width+2*Y,C.height=C.height+2*u},getScreenPoint:function(a,m,u,q,W,Q,g){var l=u.getBoundingClientRect(),d=a*(Q||1)-u.scrollLeft+(q||0),D=m*(g||1)-u.scrollTop+(W||0),s=wi(u,!1);if(s){var b=new Of(d,D,0);return b.applyMatrix4(s),console.log(b),{x:b.x,y:b.y}}return{x:d+l.left,y:D+l.top}},getLogicalPoint:function(v,u,w,k,f,q){var Q,H,b=u.getBoundingClientRect();v.target?(Xl(v)?Kb?qj["91"]=!0:qj["17"]=!0:Kb?qj["91"]=!1:qj["17"]=!1,qj["16"]=$q(v)?!0:!1,v=Tk?Ln(v):v,Q=v.clientX,H=v.clientY):(Q=v.x,H=v.y);var m=wi(u,!0);if(m){var V=new Of(Q,H,0);V.applyMatrix4(m);do{if(Math.abs(V.z)<=1e-6)break;var X=new Of(Q,H,1);if(X.applyMatrix4(matrix),Math.abs(X.z)<=1e-6){V=X;break}if(X.sub(V),Math.abs(X.z)<=1e-6)break;V.addScaledVector(X,-V.z/X.z)}while(!1);return{x:(V.x+u.scrollLeft-(w||0))/(f||1),y:(V.y+u.scrollTop-(k||0))/(q||1)}}return{x:(Q-b.left+u.scrollLeft-(w||0))/(f||1),y:(H-b.top+u.scrollTop-(k||0))/(q||1)}},removeHTML:function(){var J;return function(q){return q&&q.getView&&(q=q.getView()),q&&q.parentNode?J===q?!0:(J=q,q.parentNode.removeChild(q),J=o,!0):!1}}(),getToolTipDiv:function(){if(!rm){rm=Pd(),um=Pd();var c=rm.style;N.baseZIndex!=o&&(c.zIndex=B(N.baseZIndex)+3+""),c.whiteSpace="nowrap",c.color=N.toolTipLabelColor,c.background=N.toolTipBackground,c.font=N.toolTipLabelFont,c.padding="5px",c.boxShadow="0px 0px 3px "+N.toolTipShadowColor}return rm},isToolTipShowing:function(){return rm&&rm.parentNode?!0:um&&um.parentNode?!0:!1},hideToolTip:function(){tc(rm),tc(um),Mi()},showToolTip:function(K,r){if(!K||r==o)return mh(),void 0;N.getToolTipDiv();var R,i;if(r.html?(r=r.html,R=um,tc(rm)):(R=rm,tc(um)),i=R.style,R.innerHTML=r,R.parentNode||E.Default.appendToScreen(R),K.target){K=fh(K);var D=ri(),n=K.x,Q=K.y,d=Tk?60:12;if(Tk){var h=R.getBoundingClientRect();i.left=n-h.width/2+Yg,i.top=Q-h.height-d<D.top?Q+d+Yg:Q-h.height-d+Yg}else{i.left=n+d+Yg,i.top=Q+d+Yg;var h=R.getBoundingClientRect();h.left+h.width>D.width&&(i.left=n-d-h.width+Yg),h.top+h.height>D.height&&(i.top=Q-d-h.height+Yg),h.left<0&&(i.left=n+d+Yg),h.top<0&&(i.top=Q+d+Yg)}}else i.left=K.x+Yg,i.top=K.y+Yg;Mi()},startDragging:function(J,e,T){T==S&&(T=!0),J!==Wc&&(Wc?T&&(Tk?Wc.handleWindowTouchEnd(e):Wc.handleWindowMouseUp(e)):Tk?(A(d,ar,Do),A(d,Po,hm)):(A(d,Ti,gk),A(d,Xk,Qo)),Wc=J)},getImageMap:function(){return lb},toBoundaries:function(p,b,Z,S){var t=[];return Qc(p,b,Z,S).forEach(function(V){var x=[];V.forEach(function(S){x.push(S.x,S.y)}),t.push(x)}),t},getCurrentKeyCodeMap:function(){return qj},drawCenterImage:function(z,y,d,S,R,v,b,C){!R&&v&&v.isSelfViewEvent&&(R=v);var a=rr(y,R,v),e=cc(y,R,v);sq(z,y,h(d-a/2),h(S-e/2),a,e,R,v,b,C)},drawStretchImage:function(D,l,Z,R,i,V,A,P,_,u,K,L){!P&&_&&_.isSelfViewEvent&&(P=_);var J,b=rr(l,P,_,V),g=cc(l,P,_,A);"uniform"===Z?(J=Q(V/b,A/g),b*=J,g*=J,R+=h((V-b)/2),i+=h((A-g)/2),V=b,A=g):"centerUniform"===Z&&((b>V||g>A)&&(J=Q(V/b,A/g),b*=J,g*=J),R+=h((V-b)/2),i+=h((A-g)/2),V=b,A=g);var O=D.interactiveInfo;if(O){var c;if(c="center"===Z?{x:R+V/2-b/2,y:i+A/2-g/2,width:b,height:g}:{x:R,y:i,width:V,height:A},O.rect){var o=O.compInfos,M=o.length;M&&(o[M-1].rect.image=l)}else O.rect=c}if("center"===Z){var W=K!==!1&&(b>V||g>A);W&&(D.save(),D.beginPath(),D.rect(R,i,V,A),D.clip()),sq(D,l,R+V/2-b/2,i+A/2-g/2,b,g,P,_,u,L),W&&D.restore()}else sq(D,l,R,i,V,A,P,_,u,L)},toCanvas:function(Z,X,j,M,s,N,A,R,q){Z=ng(Z,A),X=X||rr(Z,s),j=j||cc(Z,s);var P=ib(),p=Vn(P);return R?(km(P,X,j,R),p.scale(R,R)):km(P,X,j,1),li(p,Z,M,0,0,X,j,s,N,A,q),Z&&Z.clampToEdge&&(P.clampToEdge=Z.clampToEdge),p.restore(),P},toGrayColor:function(W){if(!W)return W;var X=$i(W),u=h(.299*X[0]+.587*X[1]+.114*X[2]);return"rgba("+u+","+u+","+u+","+X[3]/255+")"},createGradientImage:function(m,v,K,R){for(var I=["L",0,0,m,0,1,0,0,1,0,0],H=0,e=Math.min(v.length,K.length);e>H;H++)I.push(K[H],v[H]);var o=E.Default.toCanvas({width:m,height:m,clampToEdge:!0,comps:[{type:"shape",rotation:R||0,points:[0,0,m,0,m,m,0,m],background:"#ffffff",gradientPack:I}]});return o},createElement:function(x,F,j,J){var _=L.createElement(x);return Zh(_,F||f.widgetBorder,2),_.style.font=j?j:ej,J!=o&&(_.value=J),N.onElementCreated&&N.onElementCreated(_),_},containedInView:function(O,x){var Z=mm(x).getBoundingClientRect();return Ib({x:Z.left,y:Z.top,width:Z.width,height:Z.height},uk(O))},isIsolating:function(){return cn>0},setIsolating:function(j){j?cn++:cn--},getMSMap:function(){return _l},stringify:function(q,k,s){var $=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var x=JSON.stringify(q,function(r,H){return"function"==typeof H?"__ht__"+(H.__ht__||H.toString()):Ie(H)?Wr(H):H instanceof E.List?"__ht__list"+(H.__ht__list||N.stringify(H._as)):H},k==o?2:k);return Date.prototype.toJSON=$,s&&(x="__ht__encode"+N.encodeString(x)),x},parse:function(g){return rb(g)?"__ht__encode"!=g.substr(0,12)||(g=N.decodeString(g.substr(12)),rb(g))?JSON.parse(g,function(R,H){if(rb(H))if("__ht__function"==H.substr(0,14)){var L=H.indexOf("{")+1,h=H.lastIndexOf("}"),C=H.indexOf("(")+1,d=H.indexOf(")");if(L&&h&&C&&d){var l=new Function(H.substring(C,d),H.substring(L,h));return l.__ht__=H.substr(6),l}}else{if("__ht__date"==H.substr(0,10))return new Date(B(H.substr(10)));if("__ht__list"===H.substr(0,10))return new Fj(N.parse(H.substr(10)))}return H}):g:g},loadJS:function(H,c){c&&H.push(c);var o=H.shift();if(Si(o))H=o.contact(H),N.loadJS(H);else if(fd(o))o(),N.loadJS(H);else if(rb(o)){var K=L.createElement("script");K.onload=function(){N.loadJS(H)},K.setAttribute("src",o),L.getElementsByTagName("head")[0].appendChild(K)}else H.length&&N.loadJS(H)},toRoundedCorner:function(){function l(P,Z,s){P.x=Z.x,P.y=Z.e||s,P.z=Z.y}var h=new Of,z=new Of,D=new Of,o=new Of;return function(F,w){var L,p=0;F.getPoints&&(p=F.getElevation(),F=F.getPoints()),L=F instanceof Fj?F:new Fj(F);var N=L.size();if(0>=w)return{points:L};var s=new Fj,v=new Fj,V=L.get(0);l(h,V,p),s.add(V),v.add(1);for(var K=1;N>K;K++)if(N>K+1){var T=L.get(K),g=L.get(K+1);l(z,T,p),l(D,g,p),o.subVectors(h,z).setLength(Math.min(.99*o.length(),w)).add(z),T.e!==S||V.e!==S?s.add({x:o.x,y:o.z,e:o.y}):s.add({x:o.x,y:o.z}),s.add(T),o.subVectors(D,z).setLength(Math.min(.99*o.length(),w)).add(z),T.e!==S||g.e!==S?s.add(V={x:o.x,y:o.z,e:o.y}):s.add(V={x:o.x,y:o.z}),h.copy(o),v.addAll([2,3])}else s.add(L.get(K)),v.add(2);return{points:s,segments:v}}}(),toColorData:$i,setCanvas:km,createDiv:Pd,createDisabledDiv:uj,createView:kb,createCanvas:ib,appendChild:xh,initContext:Vn,checkLoadingImage:ul,translateAndScale:yr,layout:_o,getPosition:Hq,drawPoints:Dc,drawRoundRect:mf,drawBorder:Ml,setFocus:qf,getter:Vr,setter:In,isEmptyObject:de,cameraPriority:function(){var $={skybox:0,main:1e4,top:1e7};return l.seal(l.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return $.skybox},set:function(D){if(D>=$.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");$.skybox=Number(D)}},main:{configurable:!1,enumerable:!1,get:function(){return $.main},set:function(e){if(e<=$.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(e>=$.top)throw new RangeError("Main camera must have lower priority than the top camera.");$.main=Number(e)}},top:{configurable:!1,enumerable:!1,get:function(){return $.top},set:function(N){if(N<=$.main)throw new RangeError("Top camera must have higher priority than the main camera.");$.top=Number(N)}}}))}()},!0),vq(a,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Lh=N.disabledOpacity,zk=N.toolTipDelay,bq=N.devicePixelRatio,Ip=N.autoMakeVisible,$d=N.autoHideScrollBar,Qi=N.imageGradient,zd=N.showToolTip,mh=N.hideToolTip,wr=N.dashPattern,zo=N.lineCap,Yd=N.lineJoin,Se=N.labelColor,Pm=N.labelSelectColor,ej=N.labelFont,Zb=N.widgetIndent,Yb=N.widgetRowHeight,Ng=N.widgetHeaderHeight,kp=N.widgetTitleHeight,cl=N.scrollBarColor,xl=N.scrollBarSize,Ef=N.scrollBarTimeout,qr=N.scrollBarMinLength,$p=N.scrollBarInteractiveSize,Fn=N.zoomIncrement,Fo=N.scrollZoomIncrement,Vj=N.pinchZoomIncrement,Vl=N.zoomMax,Lr=N.zoomMin,ur=N.createObject,Ge=N.preventDefault,Dq=N.setImage,ng=N.getImage,Qh=N.isImageComplete,Te=N.drawCenterImage,li=N.drawStretchImage,Gk=N.getId,Rg=N.callLater,bb=N.cancelLater,Zj=N.sortFunc,rj=N.clone,kn=N.getClass,Jc=N.startAnim,Sm=N.brighter,br=N.darker,qh=N.drawText,np=N.getTextSize,lg=N.isLeftButton,dk=N.isMiddleButton,gs=N.isRightButton,_f=N.getTouchCount,Yj=N.isDoubleClick,$q=N.isShiftDown,Xl=N.isCtrlDown,uk=N.getClientPoint,fh=N.getPagePoint,Qm=N.getDistance,uh=N.unionPoint,ym=N.unionRect,Ib=N.containsPoint,Yk=N.containsRect,xk=N.intersectsRect,Ak=N.intersection,ri=N.getWindowInfo,me=N.grow,Zl=N.getLogicalPoint,Im=N.getScreenPoint,Ho=N.startDragging,tc=N.removeHTML,Tc=N.createElement,zc=N.segmentResolution,Rm=N.shapeResolution,dj=N.shapeSide,pk=N.def,Eb=function(A,n,s){pk(x+"."+A,n,s)
},Fh=function(Q,J){Q.childNodes.forEach(function(D){J(D),Fh(D,J)})};vq(N,{toolTipLabelColor:Se,toolTipLabelFont:ej,toolTipBackground:f.toolTipBackground,toolTipShadowColor:Jd,drawBreakableText:xq,setDevicePixelRatio:function(I){bq=N.devicePixelRatio="number"==typeof I?I:d.devicePixelRatio,Fh(L.body,function(h){var v=h._ht;v&&v._canvas&&(km(v._canvas,v.getWidth(),v.getHeight()),v.redraw?v.redraw():v.iv())})}},!0);var So=1e-6,gn="undefined"!=typeof Uint16Array?Uint16Array:Array,$g="undefined"!=typeof Float32Array?Float32Array:Array,Ni=function(S,X,F){var t=[S[0]-X[0],S[1]-X[1],S[2]-X[2]];if(F){var $=Qm(t);$>0&&(t[0]/=$,t[1]/=$,t[2]/=$)}return t},Yc=function(){var Z="charCodeAt",b=2*(2*El.length+1);for(var W in d)if(W===x+Ec[0]+(Yg.length+2)){var n=d[W];if(!n)break;for(var F=n.length,A=0;F>A;A++)if(n[A][Z](0)===b&&n[A+1]!=o&&n[A+1]===Yg[0]&&n[A+2]!=o&&n[A+2][Z](0)===b){for(var i=A+3;F>i;i++)if(n[i][Z](0)===b){if(0==n[i+1])for(var $,T=i+2;F>T;T++){if(n[T][Z](0)===b){0==n[T-1]&&$&&(sc=$.substr(0,$.length-1));break}$==o?$=n[T]:$+=n[T]}break}break}break}return function(J){return[-J[0],-J[1],-J[2]]}}(),Mq=function(S,I){return 3===S.length?S[0]*I[0]+S[1]*I[1]+S[2]*I[2]:S[0]*I[0]+S[1]*I[1]},wo=function(){var e=new $g(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Bj=wo(),Fq=function(O){var t=new $g(16);return t[0]=O[0],t[1]=O[1],t[2]=O[2],t[3]=O[3],t[4]=O[4],t[5]=O[5],t[6]=O[6],t[7]=O[7],t[8]=O[8],t[9]=O[9],t[10]=O[10],t[11]=O[11],t[12]=O[12],t[13]=O[13],t[14]=O[14],t[15]=O[15],t},Df=function(_,t){return _[0]=t[0],_[1]=t[1],_[2]=t[2],_[3]=t[3],_[4]=t[4],_[5]=t[5],_[6]=t[6],_[7]=t[7],_[8]=t[8],_[9]=t[9],_[10]=t[10],_[11]=t[11],_[12]=t[12],_[13]=t[13],_[14]=t[14],_[15]=t[15],_},Sd=function(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L},Mr=function(x,h){var t=x[0],g=x[1],O=x[2];return x[0]=h[0]*t+h[4]*g+h[8]*O+h[12],x[1]=h[1]*t+h[5]*g+h[9]*O+h[13],x[2]=h[2]*t+h[6]*g+h[10]*O+h[14],x},hl=function(R,y){var Z=R[0],O=R[1],A=R[2],e=R[3];return R[0]=y[0]*Z+y[4]*O+y[8]*A+y[12]*e,R[1]=y[1]*Z+y[5]*O+y[9]*A+y[13]*e,R[2]=y[2]*Z+y[6]*O+y[10]*A+y[14]*e,R[3]=y[3]*Z+y[7]*O+y[11]*A+y[15]*e,R},$e=function(){var f,Q,y,s,S=rg(gf[1]+gf[7]),W=rg(gf[0]+gf[3]-gf[10]),E=rg(gf[8]+2),B=function(){return Q=y.charAt(f),f+=1,Q},L=function(){var S="";if(Q===E)for(;B();){if(Q===E)return B(),S;S+=Q}else B()},n=function(){for(;Q&&" ">=Q;)B()},J=function(){var a,p={};if(Q===S){if(B(),n(),Q===W)return B(),p;for(;Q;){if(a=L(),n(),B(),p[a]=s(),n(),Q===W)return B(),p;B(),n()}}};return s=function(){switch(n(),Q){case S:return J();default:return L()}},function(N){if(O={},N){var E;if(y=N,f=0,Q=" ",E=s(),n(),!Q)return E}}}(),Fe=function(q,r){if(r){var Q=V(r),R=X(r),g=q[4],H=q[5],$=q[6],u=q[7],L=q[8],v=q[9],S=q[10],_=q[11];q[4]=g*R+L*Q,q[5]=H*R+v*Q,q[6]=$*R+S*Q,q[7]=u*R+_*Q,q[8]=L*R-g*Q,q[9]=v*R-H*Q,q[10]=S*R-$*Q,q[11]=_*R-u*Q}},Gb=function(I,W){if(W){var o=V(W),U=X(W),T=I[0],B=I[1],C=I[2],M=I[3],y=I[8],A=I[9],K=I[10],Z=I[11];I[0]=T*U-y*o,I[1]=B*U-A*o,I[2]=C*U-K*o,I[3]=M*U-Z*o,I[8]=T*o+y*U,I[9]=B*o+A*U,I[10]=C*o+K*U,I[11]=M*o+Z*U}},Tf=function(A,r){if(r){var w=V(r),b=X(r),Z=A[0],M=A[1],k=A[2],h=A[3],t=A[4],d=A[5],f=A[6],K=A[7];A[0]=Z*b+t*w,A[1]=M*b+d*w,A[2]=k*b+f*w,A[3]=h*b+K*w,A[4]=t*b-Z*w,A[5]=d*b-M*w,A[6]=f*b-k*w,A[7]=K*b-h*w}},Hi=function(u,f,X){return si(o,X===!1?o:u.getFinalScale3d(),u.getFinalRotation3d(),u.getRotationMode(),u.p3(),o,f)},si=function(V,D,k,B,c,y,p){return y||(y=wo()),c&&ol(y,c),Gh(y,k,B),p&&$l(y,y,p),D&&lm(y,D),V&&$l(y,y,V),y},al=function(o,E,L){E=B(E),L=B(L);var l=this;l.g=o,l._84O=E,l._85O=L,l._70I=!0,l.F=0,l._83O=E+L,l.pen={x:0,y:0}},vb="lineDashOffset",Bp="setLineDash",we=function(v){for(var w in v)1===w.length&&(vb=v[w]);return w?1:0},Pi=function(h,g,l){return Ad(g)?h:h[Bp]?(h[Bp](g),l&&(h.lineDashOffset=l),h):new al(h,g[0],g.length>1?g[1]:g[0])},Ch=function(O,a){!Ad(a)&&O[Bp]&&(O[Bp](Bi),O.lineDashOffset=0)};if(pk(al,l,{_69I:6,moveTo:function(b,x){var k=this,d=k.pen;d.x=b,d.y=x,k.g.moveTo(b,x),k.start||(k.start={x:b,y:x})},lineTo:function(m,Q){var $=this,_=$.pen,z=m-_.x,U=Q-_.y,t=g(U,z),u=X(t),c=V(t),H=$._23O(_.x,_.y,m,Q),D=$._85O,W=$._84O,N=$._83O;if($.F){if($.F>H)return $._70I?$._72I(m,Q):$.moveTo(m,Q),$.F-=H,void 0;if($._70I?$._72I(_.x+u*$.F,_.y+c*$.F):$.moveTo(_.x+u*$.F,_.y+c*$.F),H-=$.F,$.F=0,$._70I=!$._70I,!H)return}var x=P(H/N);if(x){for(var T=u*W,F=c*W,e=u*D,R=c*D,d=0;x>d;d++)$._70I?($._72I(_.x+T,_.y+F),$.moveTo(_.x+e,_.y+R)):($.moveTo(_.x+e,_.y+R),$._72I(_.x+T,_.y+F));H-=N*x}$._70I?H>W?($._72I(_.x+u*W,_.y+c*W),$.moveTo(m,Q),$.F=D-(H-W),$._70I=!1):($._72I(m,Q),H===W?($.F=0,$._70I=!$._70I):($.F=W-H,$.moveTo(m,Q))):H>D?($.moveTo(_.x+u*D,_.y+c*D),$._72I(m,Q),$.F=W-(H-D),$._70I=!0):($.moveTo(m,Q),H===D?($.F=0,$._70I=!$._70I):$.F=D-H)},quadraticCurveTo:function(I,Q,K,$){var B,n=this,x=n.pen,r=x.x,F=x.y,m=n._22O(r,F,I,Q,K,$),G=0,t=0,A=n._85O,X=n._84O;if(n.F){if(n.F>m)return n._70I?n._71I(I,Q,K,$):n.moveTo(K,$),n.F-=m,void 0;if(G=n.F/m,B=n._20O(r,F,I,Q,K,$,G),n._70I?n._71I(B[2],B[3],B[4],B[5]):n.moveTo(B[4],B[5]),n.F=0,n._70I=!n._70I,!m)return}var S=m-m*G,w=P(S/n._83O),k=X/m,C=A/m;if(w)for(var h=0;w>h;h++)n._70I?(t=G+k,B=n._21O(r,F,I,Q,K,$,G,t),n._71I(B[2],B[3],B[4],B[5]),G=t,t=G+C,B=n._21O(r,F,I,Q,K,$,G,t),n.moveTo(B[4],B[5])):(t=G+C,B=n._21O(r,F,I,Q,K,$,G,t),n.moveTo(B[4],B[5]),G=t,t=G+k,B=n._21O(r,F,I,Q,K,$,G,t),n._71I(B[2],B[3],B[4],B[5])),G=t;S=m-m*G,n._70I?S>X?(t=G+k,B=n._21O(r,F,I,Q,K,$,G,t),n._71I(B[2],B[3],B[4],B[5]),n.moveTo(K,$),n.F=A-(S-X),n._70I=!1):(B=n._19O(r,F,I,Q,K,$,G),n._71I(B[2],B[3],B[4],B[5]),m===X?(n.F=0,n._70I=!n._70I):(n.F=X-S,n.moveTo(K,$))):S>A?(t=G+C,B=n._21O(r,F,I,Q,K,$,G,t),n.moveTo(B[4],B[5]),B=n._19O(r,F,I,Q,K,$,t),n._71I(B[2],B[3],B[4],B[5]),n.F=X-(S-A),n._70I=!0):(n.moveTo(K,$),S===A?(n.F=0,n._70I=!n._70I):n.F=A-S)},bezierCurveTo:function(){var N=arguments;this.pen={x:N[4],y:N[5]},this.g.bezierCurveTo(N[0],N[1],N[2],N[3],N[4],N[5])},arc:function(S,i,H,K,p,_){_||(K=-K,p=-p),rq(this,S,i,K,p-K,H,H,!1)},rect:function(c,n,q,O){var t=this;t.pen={x:c,y:n},t.moveTo(c,n),t.lineTo(c,n+O),t.lineTo(c+q,n+O),t.lineTo(c+q,n),t.lineTo(c,n)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(m,G,N,p){var J=N-m,I=p-G;return T(J*J+I*I)},_22O:function(K,m,z,T,N,d,b){for(var i,p,_,A,R,Q,S,j=0,P=K,D=m,W=b>0?b:this._69I,q=1;W>=q;q++)_=q/W,A=1-_,R=A*A,Q=2*_*A,S=_*_,i=R*K+Q*z+S*N,p=R*m+Q*T+S*d,j+=this._23O(P,D,i,p),P=i,D=p;return j},_21O:function(j,S,X,s,i,Z,d,N){var J=this;if(0===d)return J._20O(j,S,X,s,i,Z,N);if(1===N)return J._19O(j,S,X,s,i,Z,d);var m=J._20O(j,S,X,s,i,Z,N);return m.push(d/N),J._19O.apply(J,m)},_20O:function(c,A,G,p,E,B,r){if(1!==r){var X=G+(E-G)*r,l=p+(B-p)*r;G=c+(G-c)*r,p=A+(p-A)*r,E=G+(X-G)*r,B=p+(l-p)*r}return[c,A,G,p,E,B]},_19O:function(A,p,O,T,B,G,H){if(1!==H){var Z=A+(O-A)*H,Q=p+(T-p)*H;O+=(B-O)*H,T+=(G-T)*H,A=Z+(O-Z)*H,p=Q+(T-Q)*H}return[A,p,O,T,B,G]},_72I:function(J,M){var I=this.pen;(J!==I.x||M!==I.y)&&(I.x=J,I.y=M,this.g.lineTo(J,M))},_71I:function(A,i,f,w){var W=this.pen;(A!==f||i!==w||f!==W.x||w!==W.y)&&(W.x=f,W.y=w,this.g.quadraticCurveTo(A,i,f,w))}}),y&&_){var cq=_.toString();e=cq.indexOf(rc.substr(0,2))>0&&cq.indexOf(md+md.substr(1,1))>1||cq.indexOf(ln.substr(0,2)+rc.substr(2,2)+Ec[0]+rc[4])>1?!0:!1}var vo=o,wk=o,Be=N.checkLoadingCompType=function(_){vo&&!_._72O&&(wk||(wk={}),wk[_._72O=Gk()]=_)},Db=function(G,k){if(k||(k=G),k&&(vo||(vo={}),!vo[G])){var e=new nk;if(vo[k]={request:e,url:k},k=N.beforeLoadURL(k),k.data){var q=N.parse(k.data);$b(G,q),N.handleCompTypeLoaded(G,q)}else{e.onload=function(){if(200===this.status||0===this.status){var w=N.parse(e.getResponseText());$b(G,w),N.handleCompTypeLoaded(G,w)}else $b(G,o)},e.onerror=function(){$b(G,o)};var v={};v.url=encodeURI(k),v.sync=!1,e.send(v)}}},$b=function(w,u){if(Zc[w]=u,delete vo[w],de(vo)&&(vo=o,wk)){for(var c in wk){var B=wk[c];B.invalidateAll&&B.invalidateAll(S,"compTypeLoaded",w),B.redraw&&B.redraw(),B.iv(),delete B._72O}wk=o}if(u&&wk)for(var c in wk){var B=wk[c];B.invalidateAll&&B.invalidateAll(S,"compTypeLoading",w),B.redraw&&B.redraw(),B.iv()}},Yo=f.chart,Fm="",gc=!0,cb=N.compStack=[],lj=/^style@/,mk=/^attr@/,No=/^field@/,Lg={x:.5,y:.5},sh=function(){gc=!0},em=function(){return gc},rr=function(m,z,U,d){if(!m)return 0;if(hd(m.fitSize,z,U)&&d)return d;var A=hd(m.width,z,U);return null==A?20:A},cc=function(A,q,F,p){if(!A)return 0;if(hd(A.fitSize,q,F)&&p)return p;var E=hd(A.height,q,F);return null==E?20:E},hd=function(t,W,g){if(!t||!t.func)return t;var I,r=t.func,k=t.value;return I=fd(r)?g&&g.vectorDataBindingDisabled&&!t.isSafeFunc?k:r(W,g):W instanceof Xd||(E.ui?W instanceof E.ui.View:0)?mk.test(r)?W.a(Fm+r.slice(5)):lj.test(r)?W.s(Fm+r.slice(6)):No.test(r)?W[r.slice(6)]:W[r]?W[r](g):k:k,k!==S&&I==o?k:I},sq=N.drawImage=function(){var M,A,D,$,E,z,R=function(z,d){z.getValue&&z.getValue.compType===d||(z.getValue=function(T){var O=H(z,T);if(O===S&&d.properties){var E=d.properties[T];E&&(O=E.defaultValue)}return O},z.getColor=function(o){return m(z.getValue(o))},z.getValue.compType=d)},H=function($,d,s){var b,C=!1;if($.prefix&&A instanceof Xd){var t=A.a(Fm+d);t!==S&&(C=!0,b=t)}return b===S&&(b=$[d]),b&&b.func&&(C=!0,b=hd(b,A,D)),s&&(b=s(b),C||($[d]=b)),b},m=function(X,Z){var J;if(J=Z?H(X,Z):X,M&&M.compGray&&J)return N.toGrayColor(J);if(E&&J){if("override"===z)return E;if("override_rgb"===z){var D=zh(E);return J=$i(J),"rgba("+h(255*D[0])+","+h(255*D[1])+","+h(255*D[2])+","+J[3]/255+")"}if("override_a"===z){var D=zh(E);return J=$i(J),"rgba("+J[0]+","+J[1]+","+J[2]+","+D[3]+")"}var D=zh(E);return J=$i(J),"rgba("+h(J[0]*D[0])+","+h(J[1]*D[1])+","+h(J[2]*D[2])+","+J[3]/255*D[3]+")"}return J},C=function($){if(Si($)){for(var S=new Fj,t=$.length,B=0;t>B;B+=2)S.add({x:$[B],y:$[B+1]});$=S}return $},K=function(i){var t=H(i,"anchorX"),s=H(i,"anchorY");if(t!==S||s!==S)return{x:t===S?Lg.x:t,y:s===S?Lg.y:s};var A=H(i,"type"),W=H(i,"name");if("image"!==A||!W)return Lg;var U=ng(W);return U&&U.anchorX!==S&&U.anchorY!==S?{x:U.anchorX,y:U.anchorY}:Lg},t=function(X,Z){var p=H(X,ir),W=K(X);if(Si(p)){var v=p.length,J=H(X,"relative"),A=Z.width,y=Z.height;if(4===v)p={x:p[0],y:p[1],width:p[2],height:p[3]},J&&(p.x*=A,p.y*=y,p.width*=A,p.height*=y);else if(3===v){var U=p[0];p={width:p[1],height:p[2]},J&&(p.width*=A,p.height*=y),"object"==typeof U?U.length&&(U={x:U[0],y:U[1]}):U=Hq(U,Z,p),p.x=U.x-p.width*W.x,p.y=U.y-p.height*W.y}p.x+=H(X,"offsetX")||0,p.y+=H(X,"offsetY")||0,!J&&Z.fitSize&&(p=F(X,p,Z))}return p},F=function(J,g,c){if(g){var I,x,B,n={x:g.x,y:g.y,width:g.width,height:g.height},h=K(J),y=H(J,"layoutH"),s=H(J,"layoutV"),m=1,L=1,b=0,w=0,e=1,p=1;switch(y){case"left":break;case"right":n.x+=c.width-c.rw;break;case"center":n.x+=.5*(c.width-c.rw);break;case"scale":case"leftright":default:I=H(J,Bb)||0,I&&(b=Math.abs(w=Math.sin(I)),e=Math.abs(p=Math.cos(I))),"leftright"!==y?(m+=e*(c.widthScale-1),L+=b*(c.widthScale-1)):(m+=n.width?e*(c.width-c.rw)/n.width:0,L+=n.height?b*(c.width-c.rw)/n.height:0,x=-Math.min(-h.x*p+h.y*w,-h.x*p-(1-h.y)*w,(1-h.x)*p+h.y*w,(1-h.x)*p-(1-h.y)*w))}switch(s){case"top":break;case"bottom":n.y+=c.height-c.rh;break;case"center":n.y+=.5*(c.height-c.rh);break;case"scale":case"topbottom":default:I==o&&(I=H(J,Bb),I&&(b=Math.abs(w=Math.sin(I)),e=Math.abs(p=Math.cos(I)))),"topbottom"!==s?(m+=b*(c.heightScale-1),L+=e*(c.heightScale-1)):(m+=n.width?b*(c.height-c.rh)/n.width:0,L+=n.height?e*(c.height-c.rh)/n.height:0,B=-Math.min(-h.x*w-h.y*p,-h.x*w+(1-h.y)*p,(1-h.x)*w-h.y*p,(1-h.x)*w+(1-h.y)*p))}return(1!==m||1!==L)&&("scale"!==y&&y?"leftright"===y&&(n.x+=n.width*(1-m)*h.x+x*(c.width-c.rw)):n.x+=n.x*(c.widthScale-1)+h.x*n.width*(c.widthScale-m),"scale"!==s&&s?"topbottom"===s&&(n.y+=n.height*(1-L)*h.y+B*(c.height-c.rh)):n.y+=n.y*(c.heightScale-1)+h.y*n.height*(c.heightScale-L),n.width*=m,n.height*=L),n.width<0&&(n.width=0),n.height<0&&(n.height=0),n}},g=function(m){return Si(m)?new Fj(m):m},I=function(L,p,j,P,u,d,n){var O=M.interactiveInfo,G=L.transform;if(G)return M.save(),M.setTransform(G.a,G.b,G.c,G.d,G.tx,G.ty),O&&O.compInfos.push({comp:L,rect:p,matrix:G.clone(),prefix:Fm}),!0;u===S&&(u=1),d===S&&(d=1);var E=H(L,"clipPercentage"),l=Tl(j,p);if(l&&!P&&1===u&&1===d&&!(1>E))return O&&O.compInfos.push({comp:L,rect:p,matrix:O.matrix.clone(),prefix:Fm}),!1;n=n||Lg;var g=p.x+p.width*n.x,v=p.y+p.height*n.y,J=j.x+j.width*n.x,Y=j.y+j.height*n.y,w=j.width?u*(p.width/j.width):1,k=j.height?d*(p.height/j.height):1;if(M.save(),O&&(O.matrix.appendTranslate(g,v).appendRotate(P).appendScale(w,k).appendTranslate(-J,-Y),O.compInfos.push({comp:L,rect:p,matrix:O.matrix.clone()})),te(M,g,v),Rh(M,P||0),tl(M,w,k),te(M,-J,-Y),1>E){0>E&&(E=0);var U=vs(j,H(L,"clipDirection"),E);M.beginPath(),M.rect(U.x,U.y,U.width,U.height),M.clip()}return!0},u=function(){M.restore()},P=function(r,Y,f){var y=H(r,"path"),k=H(r,Bb),L=H(r,"scaleX"),A=H(r,"scaleY"),i=K(r),Q=o,n=ue(null,y);if(f||(f=r.unionRect,f||(f=uh(n),r.path.func||(r.unionRect=f)),Q=f),f){Q||(Q=r.unionRect,Q||(Q=uh(n),r.path.func||(r.unionRect=Q)));var X=I(r,f,Q,k,L,A,i),b=H(r,"borderPattern"),F=Pi(M,b),l=m(r,"background"),z=m(r,"borderColor"),W=H(r,"borderWidth"),N=H(r,"gradient"),c=m(r,"gradientColor"),q=H(r,"border3d"),D=m(r,"border3dColor"),T=H(r,"border3dAccuracy"),C=M.lineJoin,_=M.lineCap;M.lineJoin=H(r,"borderJoin")||Yd,M.lineCap=H(r,"borderCap")||zo,l?(Ub(M,l,N,c,Q),ue(M,y),M.fill(),F!==M&&ue(M,y)):ue(M,y);var p=H(r,"borderWidthAbsolute");if(p&&(M.save(),M.setTransform(1,0,0,1,0,0)),W&&z&&(M.lineWidth=W,M.strokeStyle=z,M.stroke(),q&&ij(M,z,D,W,$,T)),Ch(M,b),H(r,"dash")){var P=H(r,"dashWidth")||W;if(P>0){b=H(r,"dashPattern")||wr;var F=Pi(M,b,H(r,"dashOffset")),t=m(r,"dashColor")||m(En);F!==M&&ue(M,y),M.strokeStyle=t,M.lineWidth=P,M.stroke(),H(r,"dash3d")&&ij(M,t,m(r,"dash3dColor"),P,$,H(r,"dash3dAccuracy")),Ch(M,b)}}p&&M.restore(),Y===ir&&Xh(M,l,H(r,"depth"),Q),M.lineJoin=C,M.lineCap=_,X&&u()}},s=function(P,Y,R,N){var s=H(P,Zq,C),y=H(P,Bb),d=K(P);if(s&&N.fitSize){var p=new Fj,j=uh(s),k=F(P,j,N),w=j.x+d.x*j.width,_=j.y+d.y*j.height,x=k.x+d.x*k.width,q=k.y+d.y*k.height,b=j.width?k.width/j.width:1,U=j.height?k.height/j.height:1;s.each(function(h){p.add({x:x+(h.x-w)*b,y:q+(h.y-_)*U})}),s=p,P.unionRect=null}var h=H(P,"scaleX"),V=H(P,"scaleY"),i=Y===Fl,S=o;if(!R&&i&&(R=P.unionRect,R||(R=uh(s),P.points.func||(P.unionRect=R)),S=R),R){i?S||(S=P.unionRect,S||(S=uh(s),P.points.func||(P.unionRect=S))):S=R;var W,T,O,X,B=I(P,R,S,y,h,V,d),Z=H(P,"borderPattern"),a=Pi(M,Z),f=m(P,"background"),n=ng(H(P,"repeatImage"),E,z),r=H(P,"gradientPack"),v=m(P,"borderColor"),c=H(P,"borderWidth"),G=H(P,"segments",g),e=H(P,"gradient"),Q=m(P,"gradientColor"),t=H(P,"border3d"),L=m(P,"border3dColor"),l=H(P,"border3dAccuracy"),J=H(P,"closePath"),ks=H(P,"fillRule")||"nonzero",Dq=M.lineJoin,ae=M.lineCap;if(M.lineJoin=H(P,"borderJoin")||Yd,M.lineCap=H(P,"borderCap")||zo,i)if(f||n||r){var ro=H(P,"fillClipPercentage");if(1>ro){0>ro&&(ro=0);var yk=vs(S,H(P,"fillClipDirection"),ro);M.save(),M.beginPath(),M.rect(yk.x,yk.y,yk.width,yk.height),M.clip()}Dc(M,s,G,J),r?On(M,r):n?Li(M,n,E,z,A,D):Ub(M,f,e,Q,S),M.fill(ks),1>ro&&M.restore(),r&&M.restore(),a!==M&&Dc(a,s,G,J)}else Dc(a,s,G,J);else if("roundRect"===Y?W=H(P,"cornerRadius"):"polygon"===Y?W=H(P,"polygonSide"):"arc"===Y&&(W=H(P,"arcFrom"),T=H(P,"arcTo"),O=H(P,"arcClose"),X=H(P,"arcOval")),f||n||r){var ro=H(P,"fillClipPercentage");if(1>ro){0>ro&&(ro=0);var yk=vs(S,H(P,"fillClipDirection"),ro);M.save(),M.beginPath(),M.rect(yk.x,yk.y,yk.width,yk.height),M.clip()}_c(M,Y,S,W,T,O,X),r?On(M,r):n?Li(M,n,E,z,A,D):Ub(M,f,e,Q,S),M.fill(ks),1>ro&&M.restore(),r&&M.restore(),M!==a&&_c(a,Y,S,W,T,O,X)}else _c(a,Y,S,W,T,O,X);var _l=H(P,"borderWidthAbsolute");if(_l&&(M.save(),M.setTransform(1,0,0,1,0,0)),c&&v&&(M.lineWidth=c,M.strokeStyle=v,M.stroke(),t&&ij(M,v,L,c,$,l)),Ch(M,Z),H(P,"dash")){var Mm=H(P,"dashWidth")||c;if(Mm>0){Z=H(P,"dashPattern")||wr;var a=Pi(M,Z,H(P,"dashOffset")),xc=m(P,"dashColor")||m(En);a!==M&&(i?Dc(a,s,G,J):_c(a,Y,S,W,T,O,X)),M.strokeStyle=xc,M.lineWidth=Mm,M.stroke(),H(P,"dash3d")&&ij(M,xc,m(P,"dash3dColor"),Mm,$,H(P,"dash3dAccuracy")),Ch(M,Z)}}_l&&M.restore(),Y===ir&&Xh(M,f,H(P,"depth"),S),M.lineJoin=Dq,M.lineCap=ae,B&&u()}},J=function(i,j){var N=E||H(i,lq),Q=z||H(i,"blendMode"),y=H(i,"name"),l=ng(y,N,Q);l?li(M,l,H(i,"stretch"),j.x,j.y,j.width,j.height,A,D,N,null,Q):gc=!1},e=function(k,K){var w=H(k,"text");w!=o&&qh(M,w,H(k,"font"),m(k,lq),K.x,K.y,K.width,K.height,H(k,"align"),H(k,"vAlign"))},Y=function(Q,X){Ml(M,m(Q,lq),X.x,X.y,X.width,X.height,H(Q,"width"))},q=function(G,c){var Y=H(G,hc),x=0;if(Y&&(Y.forEach(function(v){x+=v}),x>0)){for(var r=H(G,"colors")||Yo,p=H(G,"startAngle")||0,N=H(G,"hollow"),D=H(G,$h),R=H(G,Qj),d=H(G,ql),Z=D?new Fj:o,a=c.x,v=c.y,w=c.width,l=c.height,P=a+w/2,s=v+l/2,C=Q(w,l)/2,e=0,n=0;n<Y.length;n++){var F=Y[n],J=j*F/x,W=p+J;if(M.fillStyle=r[e++],e===r.length&&(e=0),M.beginPath(),N){var y=P+X(p)*C/2,z=s+V(p)*C/2,L=P+X(W)*C,_=s+V(W)*C;M.moveTo(y,z),M.arc(P,s,C/2,p,W,!1),M.lineTo(L,_),M.arc(P,s,C,W,p,!0)}else M.moveTo(P,s),M.arc(P,s,C,W,p,!0);Z&&(J=(p+W)/2,Z.add({text:fd(D)?D(F,n,x,A):F,x:P+.75*X(J)*C,y:s+.75*V(J)*C})),M.closePath(),M.fill(),p=W}Z&&Z.each(function(I){qh(M,I.text,R,d,I.x,I.y,0,0,Oj)})}},L=function(t,S){var Z=H(t,Qk);if(Z&&Z.length>0){var D=Z.length,u=H(t,$h),j=H(t,Qj),C=H(t,ql),N=u?new Fj:o,R=H(t,"minValue")||0,F=H(t,"maxValue");if(F==o&&(F=0,Z.forEach(function(m){H(m,hc).forEach(function(E){F=r(F,E)})})),R===F)return;for(var k=S.height/(F-R),f=S.y+F*k,Q=H(Z[0],hc).length,T=S.width/(3*Q+1),O=2*T/D,c=0,a=0;D>a;a++)for(var K=Z[a],h=H(K,lq),x=H(K,"colors"),$=H(K,hc),X=0;Q>X;X++){x?M.fillStyle=x[X]:h?M.fillStyle=h:(M.fillStyle=Yo[c++],c===Yo.length&&(c=0));var i=$[X],v=i*k,_=S.x+(1+3*X)*T+a*O;if(xe(M,_,f-v,O,v),N){var m=fd(u)?u(i,X,K,A):i,Y=np(j,m).height;N.add({x:_,y:f-v-Y,width:O,height:Y,text:m})}}N&&N.each(function(R){qh(M,R.text,j,C,R.x,R.y,R.width,R.height,Oj)})}},Z=function(G,S){var m=H(G,Qk);if(m&&m.length>0){var Z=m.length,h=H(m[0],hc).length,Y=S.width/(3*h+1),u=0,I=H(G,"maxValue"),g=H(G,$h),R=H(G,Qj),d=H(G,ql),s=g?new Fj:o;if(I==o){I=0;for(var N=0;h>N;N++){for(var O=0,b=0;Z>b;b++)O+=H(m[b],hc)[N];I=r(I,O)}}if(I>0){for(var N=0;h>N;N++)for(var W=S.y+S.height,b=0;Z>b;b++){var v=m[b],e=H(v,lq),p=H(v,hc)[N],T=p/I*S.height;e?M.fillStyle=e:(M.fillStyle=Yo[u++],u===Yo.length&&(u=0)),W-=T;var K={x:S.x+(1+3*N)*Y,y:W,width:2*Y,height:T};xe(M,K.x,K.y,K.width,K.height),s&&(K.text=fd(g)?g(p,N,v,A):p,s.add(K))}s&&s.each(function(x){qh(M,x.text,R,d,x.x,x.y,x.width,x.height,Oj)})}}},a=function(s,X){var u=H(s,Qk);if(u&&u.length>0){for(var q=u.length,L=H(u[0],hc).length,F=X.width/(3*L+1),T=0,x=H(s,$h),b=H(s,Qj),t=H(s,ql),O=x?new Fj:o,Q=0;L>Q;Q++){for(var i=0,V=0;q>V;V++)i+=H(u[V],hc)[Q];if(i>0){var y=X.y+X.height;for(V=0;q>V;V++){var k=u[V],d=H(k,lq),g=H(k,hc)[Q],J=g/i*X.height;d?M.fillStyle=d:(M.fillStyle=Yo[T++],T===Yo.length&&(T=0)),y-=J;var w={x:X.x+(1+3*Q)*F,y:y,width:2*F,height:J};xe(M,w.x,w.y,w.width,w.height),O&&(w.text=fd(x)?x(g,Q,k,A):g,O.add(w))}}}O&&O.each(function(P){qh(M,P.text,b,t,P.x,P.y,P.width,P.height,Oj)})}},i=function(G,U){var f=H(G,Qk);if(f&&f.length>0){var s=f.length,u=H(G,"minValue")||0,D=H(G,"maxValue");if(D==o&&(D=0,f.forEach(function(j){H(j,hc).forEach(function(n){D=r(D,n)})})),u===D)return;for(var e=U.height/(D-u),Y=U.y+D*e,q=H(f[0],hc).length,k=U.width/(3*q+1),K=0,w=H(G,"lineWidth")||2,T=H(G,"line3d"),P=H(G,"linePoint"),m=H(G,$h),C=H(G,Qj),S=H(G,ql),R=0;s>R;R++){var N=f[R],d=H(N,lq),V=H(N,hc);d?M.strokeStyle=d:(d=M.strokeStyle=Yo[K++],K===Yo.length&&(K=0)),M.beginPath();for(var a=0;q>a;a++){var L=U.x+(2+3*a)*k,l=Y-V[a]*e;0===a?M.moveTo(L,l):M.lineTo(L,l)}if(M.lineWidth=w,M.stroke(),T&&ij(M,d,o,w,$),P||m){var p,Z=w/2+2;for(a=0;q>a;a++){var F=V[a];if(L=U.x+(2+3*a)*k,l=Y-F*e,fd(P)?P(M,L,l,d,a,N,A):P&&(M.fillStyle=d,M.beginPath(),M.arc(L,l,Z,0,j,!0),M.fill()),fd(m)?p=m(F,a,N,A):m&&(p=F),p){var O=np(C,p).height,J=M.shadowBlur;if(J){var g=M.shadowOffsetX,x=M.shadowOffsetY,n=M.shadowColor;M.shadowOffsetX=0,M.shadowOffsetY=0,M.shadowBlur=0,M.shadowColor=o}qh(M,p,C,S,L,l-O-Z+2,0,O,Oj),J&&(M.shadowOffsetX=g,M.shadowOffsetY=x,M.shadowBlur=J,M.shadowColor=n)}}}}}},l=function(J){M=J[0],A=J[1],D=J[2],$=J[3],E=J[4],z=J[5]},k=function(){return[M,A,D,$,E,z]},O=function(i,M){var T;D&&D.getState?T=D.getState(A):(T=A instanceof Xd?A.s(Cc):null,(T===S||null===T)&&(T=H(i,Cc)));var C=H(M,Cc);return C!==S&&null!==C&&C!==T?!1:H(M,Tr)},w={border:Y,image:J,text:e,pieChart:q,columnChart:L,stackedColumnChart:Z,percentageColumnChart:a,lineChart:i};return function(c,W,p,x,y,U,f,v,q,Q){if(W&&y&&U){var X=k();M=c,A=f,D=v,!A&&D&&D.isSelfViewEvent&&(A=D),$=D?D._zoom?D._zoom:1:1,E=q,z=Q;var T=y,B=U;if(Gi()){var L,j,G;0===M[Oo]?Gi[0]&&(L=!0):L=!0,M.texureImage2D?Gi[1]&&(j=!0):j=!0,M.texureImage3D?Gi[2]&&(G=!0):G=!0,L&&j&&G&&(T=p,B=x)}if(W.tagName)return rb(sc)&&!d[sc]||M.drawImage(W,T,B,y,U),l(X),void 0;if(H(W,"visible")===!1)return l(X),void 0;E||(E=hd(W.color,A,D)),Q||(z=hd(W.blendMode,A,D)),rb(sc)&&!d[sc]&&(y=T,U=B);var h=rr(W,A,D,y),n=cc(W,A,D,U),J={x:0,y:0,width:h,height:n,fitSize:H(W,"fitSize")},r=H(W,"clip"),e=H(W,"opacity");if(J.fitSize){var F=J.rw=hd(W.width,A,D)||20;J.widthScale=h/F;var b=J.rh=hd(W.height,A,D)||20;J.heightScale=n/b}if(M.save(),M.interactiveInfo){var V=M.interactiveInfo.matrix,Z=V.clone();V.appendTranslate(T,B).appendScale(y/h,U/n)}te(M,T,B),(h!==y||n!==U)&&M.scale(y/h,U/n),r&&(fd(r)?r(M,h,n,A,D,W):(M.beginPath(),M.rect(0,0,h,n),M.clip())),e!=o&&(M.globalAlpha*=e),H(W,"comps").forEach(function(v){if(v.prefix){var U=Fm,Q=hd(v.prefix,A,D);Q&&(Fm=Fm+Q+".")}if(O(W,v)===!1)return v.prefix&&(Fm=U),void 0;if(cb.splice(0,0,v),M.interactiveInfo)var j=M.interactiveInfo.matrix.clone();var V=H(v,"opacity"),i=H(v,"shadow"),e=H(v,"type"),n=t(v,J);if(V!=o){var Z=M.globalAlpha;M.globalAlpha*=V}if(i){var k=M.shadowOffsetX,y=M.shadowOffsetY,f=M.shadowBlur,l=M.shadowColor,r=H(v,"shadowOffsetX"),c=H(v,"shadowOffsetY"),q=H(v,"shadowBlur"),L=m(v,"shadowColor");M.shadowOffsetX=(r==o?3:r)*$,M.shadowOffsetY=(c==o?3:c)*$,M.shadowBlur=(q==o?6:q)*$,M.shadowColor=L||m(wn)}if("save"===e)M.save();else if("endClip"===e||"restore"===e)M.restore();else if("clip"===e)M.save(),Dc(M,H(v,"points",C),H(v,"segments",g),!0),M.clip();else if(Mc[e])n=n||{x:0,y:0,width:J.width,height:J.height},s(v,e,n,J);else if(e===Fl)s(v,e,n,J);else if("SVGPath"===e)P(v,e,n);else{n=n||{x:0,y:0,width:J.width,height:J.height};var h=H(v,Bb),d=H(v,"scaleX"),X=H(v,"scaleY"),Y=K(v),T=I(v,n,n,h,d,X,Y);if(fd(e))R(v,e),N.drawCompType(e,M,n,v,A,D);else if(N.getCompType(e)){var _=N.getCompType(e),b=_.func||_;R(v,_),N.drawCompType(b,M,n,v,A,D)}else w[e]?w[e](v,n):N.getCompType(e)===S&&vf.test(e)&&Db(e);T&&u()}i&&(M.shadowOffsetX=k,M.shadowOffsetY=y,M.shadowBlur=f,M.shadowColor=l),V!=o&&(M.globalAlpha=Z),M.interactiveInfo&&(M.interactiveInfo.matrix=j),v.prefix&&(Fm=U),cb.splice(0,1)}),M.interactiveInfo&&(M.interactiveInfo.matrix=Z),M.restore(),l(X)}}}();N.getCurrentComp=function(){return cb[0]},N.getParentComp=function(){return cb[1]},N.getInternal=function(){return{isEnter:lo,isEsc:Lq,isSpace:Pe,isLeft:Di,isUp:mr,isRight:vc,isDown:jn,addMethod:vq,superCall:ii,toPointsArray:Qc,translateAndScale:yr,appendArray:ad,createWorldMatrix:si,vec3TransformMat4:Mr,setCanvas:km,createDiv:Pd,createView:kb,createCanvas:ib,createImage:zl,initContext:Vn,layout:_o,fillRect:xe,Mat:bm,drawBorder:Ml,isString:rb,setBorder:Zh,getPropertyValue:jl,setPropertyValue:dq,drawVerticalLine:Kn,draw3DRect:Xh,getPinchDist:Lj,isSameRect:Tl,getPosition:Hq,intersectionLineRect:ce,getNodeRect:ks,getEdgeAgentPosition:Kq,getEdgeHostPosition:nr,getImageWidth:rr,getImageHeight:cc,initItemElement:Fb,drawPoints:Dc,createG2:Pi,closePopup:Ed,isH:Xr,createAnim:zg,createNormalMatrix:_n,createNormals:jq,toFloatArray:Um,glMV:is,batchShape:ag,createNodeMatrix:Hi,getFaceInfo:Qn,transformAppend:re,drawFaceInfo:Qb,to3dPointsArray:nq,setGLDebugMode:function(F){Xo=F},cube:function(){return{vs:Ye,is:Uq,uv:je}},ui:function(){return{DataUI:Rb,NodeUI:Bk,EdgeUI:Ul,GroupUI:Rk,ShapeUI:uc,GridUI:Jf,Data3dUI:Wb,Node3dUI:eb,Shape3dUI:vr}},getInternalVersion:function(){return"U2FsdGVkX19zh56xkDSa7M523NY0ilNrn5WvPOgZv2o="},getDragger:function(){return Wc},addMSMap:function(W){vq(_l,W)},k:p,addEventListener:A,removeEventListener:u}},function(D){function k(C,y){C!=o&&(y==o&&Tg!=typeof C?this._54O(C,256):this._54O(C,y))}function W(){return new k(o)}function h(c,X,k,g,w,s){for(;--s>=0;){var W=X*this[c++]+k[g]+w;w=P(W/67108864),k[g++]=67108863&W}return w}function c(o,L,E,u,k,c){for(var y=32767&L,v=L>>15;--c>=0;){var w=32767&this[o],x=this[o++]>>15,W=v*w+x*y;w=y*w+((32767&W)<<15)+E[u]+(1073741823&k),k=(w>>>30)+(W>>>15)+v*x+(k>>>30),E[u++]=1073741823&w}return k}function Y(p,i,c,u,H,o){for(var v=16383&i,R=i>>14;--o>=0;){var x=16383&this[p],V=this[p++]>>14,h=R*x+V*v;x=v*x+((16383&h)<<14)+c[u]+H,H=(x>>28)+(h>>14)+R*V,c[u++]=268435455&x}return H}function u(u){return Fi.charAt(u)}function U(v,D){var G=al[v.charCodeAt(D)];return G==o?-1:G}function g(m){for(var X=this.t-1;X>=0;--X)m[X]=this[X];m.t=this.t,m.s=this.s}function e(v){this.t=1,this.s=0>v?-1:0,v>0?this[0]=v:-1>v?this[0]=v+this.DV:this.t=0}function N(D){var e=W();return e._58O(D),e}function m(l,Z){var s,A=this;if(16==Z)s=4;else if(8==Z)s=3;else if(256==Z)s=8;else if(2==Z)s=1;else if(32==Z)s=5;else{if(4!=Z)return A.fromRadix(l,Z),void 0;s=2}A.t=0,A.s=0;for(var n=l.length,z=!1,R=0;--n>=0;){var G=8==s?255&l[n]:U(l,n);0>G?"-"==l.charAt(n)&&(z=!0):(z=!1,0==R?A[A.t++]=G:R+s>A.DB?(A[A.t-1]|=(G&(1<<A.DB-R)-1)<<R,A[A.t++]=G>>A.DB-R):A[A.t-1]|=G<<R,R+=s,R>=A.DB&&(R-=A.DB))}8==s&&0!=(128&l[0])&&(A.s=-1,R>0&&(A[A.t-1]|=(1<<A.DB-R)-1<<R)),A._57O(),z&&k.ZERO._78O(A,A)}function A(){for(var V=this,w=V.s&V.DM;V.t>0&&V[V.t-1]==w;)--V.t}function s(W){var F=this;if(F.s<0)return"-"+F._85O()[sb](W);var y;if(16==W)y=4;else if(8==W)y=3;else if(2==W)y=1;else if(32==W)y=5;else{if(4!=W)return F.toRadix(W);y=2}var Z,M=(1<<y)-1,H=!1,A="",q=F.t,i=F.DB-q*F.DB%y;if(q-->0)for(i<F.DB&&(Z=F[q]>>i)>0&&(H=!0,A=u(Z));q>=0;)y>i?(Z=(F[q]&(1<<i)-1)<<y-i,Z|=F[--q]>>(i+=F.DB-y)):(Z=F[q]>>(i-=y)&M,0>=i&&(i+=F.DB,--q)),Z>0&&(H=!0),H&&(A+=u(Z));return H?A:"0"}function b(){var S=W();return k.ZERO._78O(this,S),S}function t(){return this.s<0?this._85O():this}function _(b){var L=this,f=L.s-b.s;if(0!=f)return f;var l=L.t;if(f=l-b.t,0!=f)return L.s<0?-f:f;for(;--l>=0;)if(0!=(f=L[l]-b[l]))return f;return 0}function J(V){var I,W=1;return 0!=(I=V>>>16)&&(V=I,W+=16),0!=(I=V>>8)&&(V=I,W+=8),0!=(I=V>>4)&&(V=I,W+=4),0!=(I=V>>2)&&(V=I,W+=2),0!=(I=V>>1)&&(V=I,W+=1),W}function F(){var x=this;return x.t<=0?0:x.DB*(x.t-1)+J(x[x.t-1]^x.s&x.DM)}function l(r,z){var a;for(a=this.t-1;a>=0;--a)z[a+r]=this[a];for(a=r-1;a>=0;--a)z[a]=0;z.t=this.t+r,z.s=this.s}function K(h,n){for(var C=h;C<this.t;++C)n[C-h]=this[C];n.t=r(this.t-h,0),n.s=this.s}function n(W,L){var w,d=this,B=W%d.DB,e=d.DB-B,Y=(1<<e)-1,I=P(W/d.DB),b=d.s<<B&d.DM;for(w=d.t-1;w>=0;--w)L[w+I+1]=d[w]>>e|b,b=(d[w]&Y)<<B;for(w=I-1;w>=0;--w)L[w]=0;L[I]=b,L.t=d.t+I+1,L.s=d.s,L._57O()}function G(a,$){var i=this;$.s=i.s;var A=P(a/i.DB);if(A>=i.t)return $.t=0,void 0;var z=a%i.DB,u=i.DB-z,k=(1<<z)-1;$[0]=i[A]>>z;for(var E=A+1;E<i.t;++E)$[E-A-1]|=(i[E]&k)<<u,$[E-A]=i[E]>>z;z>0&&($[i.t-A-1]|=(i.s&k)<<u),$.t=i.t-A,$._57O()}function S(I,i){for(var x=this,E=0,W=0,b=Q(I.t,x.t);b>E;)W+=x[E]-I[E],i[E++]=W&x.DM,W>>=x.DB;if(I.t<x.t){for(W-=I.s;E<x.t;)W+=x[E],i[E++]=W&x.DM,W>>=x.DB;W+=x.s}else{for(W+=x.s;E<I.t;)W-=I[E],i[E++]=W&x.DM,W>>=x.DB;W-=I.s}i.s=0>W?-1:0,-1>W?i[E++]=x.DV+W:W>0&&(i[E++]=W),i.t=E,i._57O()}function I(x,T){var Q=this.abs(),u=x.abs(),Y=Q.t;for(T.t=Y+u.t;--Y>=0;)T[Y]=0;for(Y=0;Y<u.t;++Y)T[Y+Q.t]=Q.am(0,u[Y],T,Y,0,Q.t);T.s=0,T._57O(),this.s!=x.s&&k.ZERO._78O(T,T)}function w(L){for(var R=this.abs(),x=L.t=2*R.t;--x>=0;)L[x]=0;for(x=0;x<R.t-1;++x){var w=R.am(x,R[x],L,2*x,0,1);(L[x+R.t]+=R.am(x+1,2*R[x],L,2*x+1,w,R.t-x-1))>=R.DV&&(L[x+R.t]-=R.DV,L[x+R.t+1]=1)}L.t>0&&(L[L.t-1]+=R.am(x,R[x],L,2*x,0,1)),L.s=0,L._57O()}function i(w,Z,D){var R=w.abs(),v=this;if(!(R.t<=0)){var t=v.abs();if(t.t<R.t)return Z!=o&&Z._58O(0),D!=o&&v._77O(D),void 0;D==o&&(D=W());var _=W(),M=v.s,G=w.s,j=v.DB-J(R[R.t-1]);j>0?(R._44O(j,_),t._44O(j,D)):(R._77O(_),t._77O(D));var i=_.t,K=_[i-1];if(0!=K){var u=K*(1<<v.F1)+(i>1?_[i-2]>>v.F2:0),f=v.FV/u,l=(1<<v.F1)/u,c=1<<v.F2,s=D.t,I=s-i,V=Z==o?W():Z;for(_._59O(I,V),D._52O(V)>=0&&(D[D.t++]=1,D._78O(V,D)),k.ONE._59O(i,V),V._78O(_,_);_.t<i;)_[_.t++]=0;for(;--I>=0;){var Y=D[--s]==K?v.DM:P(D[s]*f+(D[s-1]+c)*l);if((D[s]+=_.am(0,Y,D,I,0,i))<Y)for(_._59O(I,V),D._78O(V,D);D[s]<--Y;)D._78O(V,D)}Z!=o&&(D._45O(i,Z),M!=G&&k.ZERO._78O(Z,Z)),D.t=i,D._57O(),j>0&&D._46O(j,D),0>M&&k.ZERO._78O(D,D)}}}function O(g){var c=W();return this.abs()._49O(g,o,c),this.s<0&&c._52O(k.ZERO)>0&&g._78O(c,c),c}function a(M){this.m=M}function f(b){return b.s<0||b._52O(this.m)>=0?b.mod(this.m):b}function z(u){return u}function H(C){C._49O(this.m,o,C)}function R(H,e,Y){H._47O(e,Y),this._74O(Y)}function E(M,f){M._48O(f),this._74O(f)}function d(){if(this.t<1)return 0;var g=this[0];if(0==(1&g))return 0;var G=3&g;return G=15&G*(2-(15&g)*G),G=255&G*(2-(255&g)*G),G=65535&G*(2-(65535&(65535&g)*G)),G=G*(2-g*G%this.DV)%this.DV,G>0?this.DV-G:-G}function v(N){var F=this;F.m=N,F.mp=N._50O(),F.mpl=32767&F.mp,F.mph=F.mp>>15,F.um=(1<<N.DB-15)-1,F.mt2=2*N.t}function $(q){var B=W();return q.abs()._59O(this.m.t,B),B._49O(this.m,o,B),q.s<0&&B._52O(k.ZERO)>0&&this.m._78O(B,B),B}function L(N){var T=W();return N._77O(T),this._74O(T),T}function y(h){for(var o=this;h.t<=o.mt2;)h[h.t++]=0;for(var J=0;J<o.m.t;++J){var s=32767&h[J],F=s*o.mpl+((s*o.mph+(h[J]>>15)*o.mpl&o.um)<<15)&h.DM;for(s=J+o.m.t,h[s]+=o.m.am(0,F,h,J,0,o.m.t);h[s]>=h.DV;)h[s]-=h.DV,h[++s]++}h._57O(),h._45O(o.m.t,h),h._52O(o.m)>=0&&h._78O(o.m,h)}function kj(w,e){w._48O(e),this._74O(e)}function _q(R,v,K){R._47O(v,K),this._74O(K)}function dl(){return 0==(this.t>0?1&this[0]:this.s)}function rp(V,T){if(V>4294967295||1>V)return k.ONE;var r=W(),z=W(),u=T._73O(this),D=J(V)-1;for(u._77O(r);--D>=0;)if(T._76O(r,z),(V&1<<D)>0)T._75O(z,u,r);else{var G=r;r=z,z=G}return T.revert(r)}function hs(M,l){var E;return E=256>M||l._51O()?new a(l):new v(l),this.exp(M,E)}function yr(){var P=this;if(P.s<0){if(1==P.t)return P[0]-P.DV;if(0==P.t)return-1}else{if(1==P.t)return P[0];if(0==P.t)return 0}return(P[1]&(1<<32-P.DB)-1)<<P.DB|P[0]}function wn(j,E){return new k(j,E)}function _g(){var d=this;d.n=o,d.e=0,d.d=o,d.p=o,d.q=o,d.dmp1=o,d.dmq1=o,d._10A=o}function Mm(I){return I._53O(this.e,this.n)}function dc(B){var P,c,w,j="",z=0;for(P=0;P<B.length&&B.charAt(P)!=Tj;++P)w=mr.indexOf(B.charAt(P)),0>w||(0==z?(j+=u(w>>2),c=3&w,z=1):1==z?(j+=u(c<<2|w>>4),c=15&w,z=2):2==z?(j+=u(c),j+=u(w>>2),c=3&w,z=3):(j+=u(c<<2|w>>4),j+=u(15&w),z=0));return 1==z&&(j+=u(c<<2)),j}function gb(I){var J=I.split(""),f=dc(I);return J.forEach(function(D){var s=D.length;s>0&&f&&(Yl+=B(D))}),f}function ge(r,C){var $=ih._4O.Util._56O(r,"ss"),g={},t=0;return g.v=$==C,g.t=1,g.s=0>t?-1:0,le=g.v,t>0?g[0]=t:-1>t?g[0]=t+g.DV:g.t=0,[$,g]}function uj(V){var X=38,u=V.substring(0,X);if(u&&30==u.indexOf("05000420")){var p=["ss",V.substring(X)];return p}return[]}function ei(Y,w){w=w.replace(bc,""),w=w.replace(/[ \n]+/g,"");var t=wn(w,16);if(t._55O()>this.n._55O())return 0;var s=this._37O(t),Q=s[sb](16).replace(/^1f+00/,""),m=uj(Q);if(0==m.length)return!1;for(var O,C,B,e=.5,L=dj,a=[0,.5,.75,.875,.9375],Z=[],d=[],J=[],U=j/L,F=m[1],H=ge(Y,F)[0],P=0,i=0;P<a.length;P++){var q=0===P%2?0:.5;for(O=0;L>=O;O++)C=(O+q)*U,B=1-a[P],Z.push(X(C)*e*B,-e+2*a[P]*e,-V(C)*e*B),d.push((O+q)/L,B)}for(P=0;P<a.length-1;P++){var k=P*(L+1),r=(P+1)*(L+1);for(O=0;L>O;O++)J.push(k+O,r+O+1,r+O,k+O,k+O+1,r+O+1)}return J.forEach(function(p){i+=p}),F==H&&i>10}var ee,cs=0xdeadbeefcafe,Kg=15715070==(16777215&cs),sb="toString",os="",Ij="nat",cc=function(){};C=D["D"+11182[sb](q(2,5))];var Jb=k.prototype;Kh+=ns.substr(0,1);var Sq=D.navigator?D.navigator.appName:"";Kg&&"Microsoft Internet Explorer"==Sq?(Jb.am=c,ee=30):Kg&&"Netscape"!=Sq?(Jb.am=h,ee=26):(Jb.am=Y,ee=28),Jb.DB=ee,Jb.DM=(1<<ee)-1,Jb.DV=1<<ee;
var mk=52;Jb.FV=q(2,mk),Jb.F1=mk-ee,Jb.F2=2*ee-mk;var wl,Hj,Fi="0123456789abcdefghijklmnopqrstuvwxyz",al=[],Yj=function(M){return String.fromCharCode(M)};for(wl="0".charCodeAt(0),Hj=0;9>=Hj;++Hj)al[wl++]=Hj;for(wl="a".charCodeAt(0),Hj=10;36>Hj;++Hj)al[wl++]=Hj;for(wl="A".charCodeAt(0),Hj=10;36>Hj;++Hj)al[wl++]=Hj;var er=a.prototype;er._73O=f,er.revert=z,er._74O=H,er._75O=R,er._76O=E;var Zg=v.prototype;Zg._73O=$,Zg.revert=L,Zg._74O=y,Zg._75O=_q,Zg._76O=kj,Jb._77O=g,Jb._58O=e,Jb._54O=m,Jb._57O=A,Jb._59O=l,Jb._45O=K,Jb._44O=n,Jb._46O=G,Jb._78O=S,Jb._47O=I,Jb._48O=w,Jb._49O=i,Jb._50O=d,Jb._51O=dl,Jb.exp=rp,Jb.toString=s,Jb._85O=b,Jb.abs=t,Jb._52O=_,Jb._55O=F,Jb.mod=O,Jb._53O=hs,k.ZERO=N(0),k.ONE=N(1),Jb._86O=yr;var Xe=function(k,e){var f=this;f.isPublic=!0,typeof k!==Tg?(f.n=k,f.e=e):k!=o&&e!=o&&k.length>0&&e.length>0&&(f.n=wn(k,16),f.e=B(e,16))};Op=function(){var T,j,J=gb(We),g=J.substr(0,4),M=J.substr(4,2),i=J.substr(6,2),Y=1,S=!Y,n=p,m=[],s=Mh.charAt(7);if(C&&(C[sb]().indexOf(Ij)<0||C[Kh][sb]().indexOf(Ij)<0||!J?T=o:(J=new C(g-0,M-Y,i-0),j=J.setHours(9),C[Kh]()>j?T=Hf[s]:S=!0)),J&&T&&T[0]&&T[Z(.5)]&&n){var B=$e(T[0]),z=$e(T[1]);for(var W in z)m.push(W);var R,u=0,L=B[m[u]],d=z[m[u++]],h=z[m[u++]],a=z[m[u++]],D=z[m[u++]],I=z[m[u++]],F=z[m[u++]],k=B[m[u]],O=z[m[u++]],A=rd._27O(n);if(L===d&&A&&O){R=d+h+a+D+I+F;var v=!F||F===ne;if(!v&&F)for(var x,X=0,t=F.length;t>X;X++)F[X]===ll[u]?x===ne?v=!0:x[0]===Nn[5]&&ne&&ne.indexOf(x.substr(1))>=0?v=!0:x=o:(x==o?x=F[X]:x+=F[X],X===t-1&&(x===ne?v=!0:x[0]===Nn[5]&&ne&&ne.indexOf(x.substr(1))>=0&&(v=!0)));R&&A._31O(R,O)&&A._31O(L,k)&&v&&(!I||C[Kh]()<I)&&(S=!0)}}return S||(_c=Ad),s};var kl=_g.prototype;kl._37O=Mm,kl._38O=Xe;var mr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tj="=",_n=25,uf=10,We="ICAHFQ==",ad=ad||function(b,G){var l={},h=l._7A={},y=h._6A=function(){function L(){}return{_80O:function(w){L.prototype=this;var i=new L;return w&&i._5A(w),i.hasOwnProperty("_82O")||(i._82O=function(){i.$super._82O.apply(this,arguments)}),i._82O.prototype=i,i.$super=this,i},_3A:function(){var t=this._80O();return t._82O.apply(t,arguments),t},_82O:function(){},_5A:function(I){for(var Q in I)I.hasOwnProperty(Q)&&(this[Q]=I[Q]);I.hasOwnProperty(sb)&&(this.toString=I.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),s=h._39O=y._80O({_82O:function(y,m){y=this._84O=y||[],this._65O=m!=G?m:4*y.length},toString:function(n){return(n||d).stringify(this)},_89O:function(L){var n=this._84O,g=L._84O,M=this._65O,j=L._65O;if(this._57O(),M%4)for(var d=0;j>d;d++){var t=255&g[d>>>2]>>>24-8*(d%4);n[M+d>>>2]|=t<<24-8*((M+d)%4)}else if(g.length>65535)for(var d=0;j>d;d+=4)n[M+d>>>2]=g[d>>>2];else n.push.apply(n,g);return this._65O+=j,this},_57O:function(){var T=this._84O,f=this._65O;T[f>>>2]&=4294967295<<32-8*(f%4),T.length=Z(f/4)},_88O:function(){var w=y._88O.call(this);return w._84O=this._84O.slice(0),w},_87O:function(S){for(var m=[],q=0;S>q;q+=4)m.push(0|4294967296*M);return new s._82O(m,S)}}),m=l._2A={},d=m._69O={stringify:function(X){var F,p=X._84O,l=X._65O,P=[];for(F=0;l>F;F++){var t=255&p[F>>>2]>>>24-8*(F%4);P.push((t>>>4).toString(16)),P.push((15&t).toString(16))}return P.join("")},_68O:function(w){for(var j=w.length,E=[],l=0;j>l;l+=2)E[l>>>3]|=B(w.substr(l,2),16)<<24-4*(l%8);return new s._82O(E,j/2)}},I=m._8A={stringify:function(h){var g,E=h._84O,i=h._65O,v=[];for(g=0;i>g;g++){var c=255&E[g>>>2]>>>24-8*(g%4);v.push(Yj(c))}return v.join("")},_68O:function(d){var $,F=d.length,h=[];for($=0;F>$;$++)h[$>>>2]|=(255&d.charCodeAt($))<<24-8*($%4);return new s._82O(h,F)}},P=m._9A={stringify:function(p){try{return decodeURIComponent(escape(I.stringify(p)))}catch(K){throw new Error("")}},_68O:function($){return I._68O(unescape(encodeURIComponent($)))}},a=h._32O=y._80O({_1A:function(){this._83O=new s._82O,this._23O=0},_33O:function(l){typeof l==Tg&&(l=P._68O(l)),this._83O._89O(l),this._23O+=l._65O},_25O:function(N){var M=this._83O,L=M._84O,n=M._65O,I=this._79O,v=4*I,w=n/v;w=N?Z(w):r((0|w)-this._22O,0);var l=w*I,a=Q(4*l,n);if(l){for(var k=0;l>k;k+=I)this._20O(L,k);var F=L.splice(0,l);M._65O-=a}return new s._82O(F,a)},_88O:function(){var V=y._88O.call(this);return V._83O=this._83O._88O(),V},_22O:0});h._66O=a._80O({cfg:y._80O(),_82O:function(F){this.cfg=this.cfg._80O(F),this._1A()},_1A:function(){a._1A.call(this),this._34O()},_81O:function(g){return this._33O(g),this._25O(),this},_72O:function(P){P&&this._33O(P);var t=this._21O();return t},_79O:16,_26O:function(L){return function(x,$){return new L._82O($)._72O(x)}},_19O:function(r){return function($,J){return new T._71O._82O(r,J)._72O($)}}});var T=l._67O={};return l}();!function(){var Z=ad,A=Z._7A,W=A._39O,a=A._66O,J=Z._67O,I=[],K=[];!function(){function J(y){for(var I=T(y),b=2;I>=b;b++)if(!(y%b))return!1;return!0}function w(b){return 0|4294967296*(b-(0|b))}for(var P=2,l=0;64>l;)J(P)&&(8>l&&(I[l]=w(q(P,.5))),K[l]=w(q(P,1/3)),l++),P++}();var O=[],j=J._41O=a._80O({_34O:function(){this._64O=new W._82O(I.slice(0))},_20O:function(g,t){for(var b=this._64O._84O,v=b[0],Y=b[1],N=b[2],P=b[3],M=b[4],j=b[5],W=b[6],x=b[7],$=0;64>$;$++){if(16>$)O[$]=0|g[t+$];else{var q=O[$-15],p=(q<<25|q>>>7)^(q<<14|q>>>18)^q>>>3,a=O[$-2],C=(a<<15|a>>>17)^(a<<13|a>>>19)^a>>>10;O[$]=p+O[$-7]+C+O[$-16]}var G=M&j^~M&W,T=v&Y^v&N^Y&N,n=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),e=(M<<26|M>>>6)^(M<<21|M>>>11)^(M<<7|M>>>25),B=x+e+G+K[$]+O[$],A=n+T;x=W,W=j,j=M,M=0|P+B,P=N,N=Y,Y=v,v=0|B+A}b[0]=0|b[0]+v,b[1]=0|b[1]+Y,b[2]=0|b[2]+N,b[3]=0|b[3]+P,b[4]=0|b[4]+M,b[5]=0|b[5]+j,b[6]=0|b[6]+W,b[7]=0|b[7]+x},_21O:function(){var G=this._83O,w=G._84O,E=8*this._23O,u=8*G._65O;return w[u>>>5]|=128<<24-u%32,w[(u+64>>>9<<4)+14]=P(E/4294967296),w[(u+64>>>9<<4)+15]=E,G._65O=4*w.length,this._25O(),this._64O},_88O:function(){var D=a._88O.call(this);return D._64O=this._64O._88O(),D}});Z._41O=a._26O(j),Z._42O=a._19O(j)}();var bc=new RegExp("");bc.compile("[^0-9a-f]","gi"),_g._28O=-1,_g._29O=-2,kl._31O=ei,kl._63O=ei,_g._43O=-2;var Kb=new function(){var H=this;H._5O=function(M,L){if("8"!=M.substring(L+2,L+3))return 1;var J=B(M.substring(L+3,L+4));return 0==J?-1:J>0&&10>J?J+1:-2},H._13O=function(N,B){var h=H._5O(N,B);return 1>h?"":N.substring(B+2,B+2+2*h)},H._12O=function(c,Q){var W=H._13O(c,Q);if(""==W)return-1;var Y;return Y=B(W.substring(0,1))<8?new k(W,16):new k(W.substring(2),16),Y._86O()},H._6O=function(w,P){var V=H._5O(w,P);return 0>V?V:P+2*(V+1)},H._11O=function(U,F){var M=H._6O(U,F),J=H._12O(U,F);return U.substring(M,M+2*J)},H._10O=function(g,Q){var G=H._6O(g,Q),N=H._12O(g,Q);return G+2*N},H._7O=function(s,F){var f=[],Y=H._6O(s,F);f.push(Y);for(var K=H._12O(s,F),P=Y,N=0;;){var t=H._10O(s,P);if(t==o||t-Y>=2*K)break;if(N>=200)break;f.push(t),P=t,N++}return f}};if(Kb._90O=Yj(uf+24),Kb._91O=x+Yj(uf*uf+8),ih==o||!ih)var ih={};ih._4O!=o&&ih._4O||(ih._4O={});var Id=ih._4O;ih._4O.Util=new function(){var e=this;e._56O=function(C){var c=new ih._4O._3O;return c._30O(C)},e._4A=function(l){var N=new ih._4O._3O;return N._36O(l)},e._11A=function(u){var O=new Id._3O;return O._30O(u)}},ih._4O._3O=function(){var Y=this;Y._8O=function(C,U){if("ss"==C&&"cj"==U){try{Y.md=ad._67O._41O._3A()}catch(E){cc(os)}Y._24O=function(w){Y.md._81O(w)},Y._35O=function(l){var A=ad._2A._69O._68O(l);Y.md._81O(A)},Y._60O=function(){var R=Y.md._72O();return R[sb](ad._2A._69O)},Y._30O=function(s){return Y._24O(s),Y._60O()},Y._36O=function(b){return Y._35O(b),Y._60O()}}},Y._24O=function(){cc(os)},Y._35O=function(){cc(os)},Y._60O=function(){cc(os)},Y._30O=function(){cc(os)},Y._36O=function(){cc(os)},Y._8O("ss","cj")},Vb=function(Q){var a=Cr[jh[7]],p=1,o=!1;if(Ei.a!=Cr[sk])return Ei.a;if(Ei.forEach(function(S){p*=S}),Q>p){if(a&&a[1]&&a[0]){var h=a[0],u=a[1];u=u.split(Kb._90O),h=h.split(Kb._90O);var n=u[3],L=h[3],Z=u[7],U=u[11],i=u[15],S=u[19],k=u[23],W=u[27],A=h[7],T=n+Z+U+i+S+k,c=k?!1:!0,X=L===n;if(k){var G=k&&k.split(In("firefox")[3]);if(G)for(var $=0;$<G.length;$++){var M=G[$];if(M[0]===jo[8]&&(M=M.substring(1)),ki.indexOf(M)>=0){c=!0;break}}}o=X&&Rl()(L,A)&&Rl()(T,W)&&c&&(!S||S>Q)}o||(Rb.prototype._42=sg)}else o=!0;return Ei.a=o,o},_n=String.fromCharCode(_n+20);var lf=function(e){return e=e.replace(bc,os),e=e.replace(/[ \n]+/g,os)},Mb="30",el="06",pk="02",we="03",xs=wn,Pd=/^1f+00/,rd=function(){var d;return d={_18O:function(l){var o=l,m=o.replace(/\s+/g,""),V=dc(m);return V},_14O:function(n){var A=this._18O(n),U=this._15O(A);return U},_15O:function(P){var s=this._17O(P);if("2a864886f70d010101"==s._61O){var $=this._16O(s.key),D=new _g;return D._38O($.n,$.e),D}cc(os)},_16O:function(h){var D={};h.substr(0,2)!=Mb&&cc(os);var L=Kb._7O(h,0);return 2!=L.length&&cc(os),h.substr(L[0],2)!=pk&&cc(os),D.n=Kb._11O(h,L[0]),h.substr(L[1],2)!=pk&&cc(os),D.e=Kb._11O(h,L[1]),D},_17O:function(B){var d={};d._40O=o;var f=Kb._7O(B,0);2!=f.length&&cc(os);var t=f[0];B.substr(t,2)!=Mb&&cc(os);var b=Kb._7O(B,t);return 2!=b.length&&cc(os),B.substr(b[0],2)!=el&&cc(os),d._61O=Kb._11O(B,b[0]),B.substr(b[1],2)==el?d._40O=Kb._11O(B,b[1]):B.substr(b[1],2)==Mb&&(d._40O={},d._40O.p=Kb._70O(B,b[1],[0],pk),d._40O.q=Kb._70O(B,b[1],[1],pk),d._40O.g=Kb._70O(B,b[1],[2],pk)),B.substr(f[1],2)!=we&&cc(os),d.key=Kb._11O(B,f[1]).substr(2),d}},d._17O?d:o}(),Wr=rd._27O=function(Z){return rd._14O(Z)};Rl=function(){return function(E,Y){if(E&&Y){Y=lf(Y);var N=xs(Y,q(2,4)),O=this;if(!O||!O.n||N._55O()>O.n._55O())return 0;var c=O._37O(N),i=c[sb](q(2,4)).replace(Pd,""),p=uj(i);if(0==p.length)return!1;var M=p[0],U=p[1],P=function(b){return ih._4O.Util._56O(b,M)},F=P(E);return U==F}}.bind(Wr(p))};var Pj,Fm;return function(){var G=Td.length-Hb.length;if(G>0)for(var h=0;G>h;h++)Pj=Id.Util,Fm=lf}(),nd=function(c,k){k=Fm(k);var N=Wr(vb),r=Yg.length,j=2*r,l=xs(k,q(r,j)),b=N,S=!0;if(b){var Q=b[hg[0]];Q&&l._55O()<=Q._55O()&&(S=!1)}if(S)return 0;var d=b._37O(l),x=d[sb](q(r,j)).replace(Pd,""),h=uj(x);if(0==h.length)return!1;var v=h[0],Y=h[1],t=Pj._11A(c,v);return Y==t},rd}(d,l),vq(N,{load:function(){var x={},s=function(o){return o?"c_"+(o.sync?"1":"0")+"_"+(o.post?"1":"0")+"_"+(o.responseType||"H")+"_"+(o.mimeType||"H")+"_"+(o.data?JSON.stringify(o.data):"H"):""};return function(B,c,G){var y,T=x[B],U=s(G);return T&&(y=T[U])?(y.push(c),void 0):(x[B]||(T=x[B]={count:0}),y=T[U]=[c],T.count++,N.xhrLoad(B,function(d){delete T[U],T.count--,T.count||delete x[B],y.forEach(function(Z){Z(d)})},G),void 0)}}(),asyncEach:function(X,x,F){"function"!=typeof F&&(F=Function.prototype);var m=new Array(X.length),N=0,y=!1;X.forEach(function(z,j){x(z,function(p,w){return y?void 0:p?(y=!0,F(null)):(m[j]=w,N++,N===X.length?F(m):void 0)})})},xhrLoad:function(j,P,v){var A=!1;Si(j)||(A=!0,j=[j]),v=v||{};var O=v.sync,$=null,K=v.method||"GET";return v.post&&(K="POST"),v.method=K,N.asyncEach(j,function(A,x){var P=new nk;A=N.beforeLoadURL(A),A.data?x(null,A.data):(v.url=encodeURI(A),v.responseType?P.setResponseType(v.responseType):P.setOverrideMimeType(v.mimeType||"text/plain"),P.onload=function(){200===this.status||0===this.status?x(null,P.getResponseText()):x(!0)},P.onerror=function(){x(!0)},P.send(v))},function(v){var r="function"==typeof P;(r||O)&&($=A&&v?v[0]:v,r&&P($))}),O?$:void 0}});var Fj=E.List=function(){this._as=[];var s,m,j=arguments.length;if(1===j){var Y=arguments[0];if(oc(Y)&&(Y=Y._as),Si(Y))for(m=Y.length,s=0;m>s;s++)this._as.push(Y[s]);else Y!=o&&this._as.push(Y)}else if(j>1)for(s=0;j>s;s++)this._as.push(arguments[s])};Eb("List",l,{forEach:function(u,c){this.each(u,c)},push:function(){for(var Y=0;Y<arguments.length;Y++)this.add(arguments[Y])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(Q,L){return L===S?this._as.push(Q):this._as.splice(L,0,Q)},addAll:function(u){oc(u)&&(u=u._as),Si(u)?ad(this._as,u):this._as.push(u)},get:function(e){return this._as[e]},slice:function(F,H){return new Fj(this._as.slice(F,H))},remove:function($){var n=this._as.indexOf($);return n>=0&&n<this._as.length&&this.removeAt(n),n},removeAt:function(C){return this._as.splice(C,1)[0]},set:function(p,y){return this._as[p]=y},clear:function(){return this._as.splice(0,this._as.length)},contains:function(D){return this._as.indexOf(D)>=0},indexOf:function(Z){return this._as.indexOf(Z)},each:function(s,w){for(var i=0,h=this._as.length;h>i;i++){var v=this._as[i];w?s.call(w,v,i,this):s(v,i,this)}},reverseEach:function(U,L){for(var j=this._as.length-1;j>=0;j--){var G=this._as[j];L?U.call(L,G):U(G)}},getArray:function(){return this._as},toArray:function(U,X){if(U){for(var d,K=[],A=0,x=this._as.length;x>A;A++)d=this._as[A],X?U.call(X,d)&&K.push(d):U(d)&&K.push(d);return K}return this._as.concat()},toList:function(M,o){if(M){for(var r,s=new Fj,D=0,I=this._as.length;I>D;D++)r=this._as[D],o?M.call(o,r)&&s.add(r):M(r)&&s.add(r);return s}return new Fj(this)},reverse:function(){this._as.reverse()},sort:function(P){return this._as.sort(P?P:Zj),this},toString:function(){return this._as.toString()}}),l.defineProperties(Fj.prototype,{length:{get:function(){return this._as.length},set:function(i){this._as.length=i}}});var Ep=new Fj;vq(Ep,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:Hj,each:Hj,reverseEach:Hj,toArray:function(){return[]},toList:function(){return new Fj},add:eh,addAll:eh,set:eh,remove:eh,removeAt:eh,clear:eh});var cd=E.Notifier=function(){this._f=0};Eb("Notifier",l,{contains:function(O,M){if(this._ls)for(var K,U=0,S=this._ls.size();S>U;U++)if(K=this._ls.get(U),O===K.l&&M===K.s)return!0;return!1},add:function(d,s,Z){var N=this,c={l:d,s:s,a:Z};N._ls||(N._ls=new Fj),N._f?(N._as||(N._as=new Fj),N._as.add(c)):c.a?N._ls.add(c,0):N._ls.add(c)},remove:function(L,G){var g=this;g._ls&&(g._f?(g._rs||(g._rs=new Fj),g._rs.add({l:L,s:G})):g._remove(L,G))},_remove:function(b,E){for(var u,Q=this._ls,s=0,Y=Q.size();Y>s;s++)if(u=Q.get(s),u.l===b&&u.s===E)return Q.removeAt(s),void 0},fire:function(F){var x=this,s=x._ls;if(x._b=1e4,s){++x._f;try{for(var t,g=0,E=s.size();E>g;g++)t=s.get(g),t.s?t.l.call(t.s,F):t.l(F)}catch(F){W(function(){throw F})}finally{if(--x._f)return;if(x._rs){for(E=x._rs.size(),g=0;E>g;g++)t=x._rs.get(g),x._remove(t.l,t.s);delete x._rs}if(x._as){for(E=x._as.size(),g=0;E>g;g++)t=x._as.get(g),t.a?s.add(t,0):s.add(t);delete x._as}}}}});var Xd=E.Data=function(){this._id=Gk()};Eb("Data",l,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:o,_parent:o,_children:Ep,_childMap:o,_styleMap:o,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return o},_22Q:function(){return o},s:function(H,m){var A=this;if(2===arguments.length)A.setStyle(H,m);else{if(!uq(H))return A.getStyle(H);for(var $ in H)A.setStyle($,H[$])}return A},fp:function(a,A,E,p,$){return this.firePropertyChange(a,A,E,p,$)},firePropertyChange:function(Z,k,M,S,D){if(S){if(S(k,M))return!1}else if(k===M)return!1;var u=this,m=D||{};return m.property=Z,m.oldValue=k,m.newValue=M,m.data=u,u._dataModel&&u._dataModel.handleDataPropertyChange(m),u.onPropertyChanged(m),!0},onPropertyChanged:function(A){var f=this,h=f._parent,e=A.property;if(sj(h)){var L=f.s(ei),w="s:ingroup"===e;(L&&Yr[e]||e===w)&&h._81I(),(L||w)&&h.fp("childChange",!0,!1)}ff(h)&&Yr[e]&&h.updateFromChildren()},_21I:function(D){var b=this;if(D&&b._dataModel)throw"Remove data from dataModel before adding";b._dataModel=D},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var I=0,r=this._children.toArray(),B=r.length;B>I;I++)r[I].removeFromDataModel()},getId:function(){return this._id},setId:function(x){this._id=x},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(Z,$){return this._children.toList(Z,$)},eachChild:function(C,$){this._children.each(C,$)},addChild:function(T,i){var Y=this;T!==Y&&(Y._children===Ep&&(Y._children=new Fj,Y._childMap={}),i>=0||(i=Y._children.size()),Y._childMap[T._id]||Y.isDescendantOf(T)||(T._parent&&T._parent.removeChild(T),(0>i||i>Y._children.size())&&(i=Y._children.size()),Y._children.add(T,i),Y._childMap[T._id]=T,T.setParent(Y),Y.onChildAdded(T,i),Y.fp(lf,o,T)))},onChildAdded:function(){},removeChild:function(K){var t=this;if(t._childMap&&t._childMap[K._id]){var x=t._children.remove(K);delete t._childMap[K._id],t.fp(lf,K,o),K.setParent(o,x),t.onChildRemoved(K,x)}},onChildRemoved:function(){},getChildAt:function(o){return this._children.get(o)},clearChildren:function(){var i=this;if(!i._children.isEmpty())for(var M=0,N=i._children.toArray(),b=N.length;b>M;M++)i.removeChild(N[M])},getParent:function(){return this._parent},setParent:function(Q,_){var M=this;if(!(M._73I||M._parent===Q||M===Q||Q&&Q.isDescendantOf(M))){var $,E=M._parent;M._parent=Q,M._73I=1,E?(_==o&&(_=E.getChildren().indexOf(M)),E.removeChild(M)):M._dataModel&&_==o&&(_=M._dataModel.getRoots().indexOf(M)),Q&&(Q.addChild(M),$=Q.getChildren().indexOf(M)),delete M._73I,M.fp("parent",E,Q,S,{oldIndex:_,newIndex:$}),M.onParentChanged(E,Q)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(G){return G?this.isDescendantOf(G)||G.isDescendantOf(this):!1},isParentOf:function(N){return N&&this._childMap?!!this._childMap[N._id]:!1},isDescendantOf:function(y){if(!y||y.isEmpty())return!1;for(var x=this._parent;x;){if(y===x)return!0;x=x._parent}return!1},getStyle:function(Y,u){u===S&&(u=1);var d=this._styleMap?this._styleMap[Y]:S;return d===S&&u?t[Y]:d},setStyle:function(m,P){var w=this;w._styleMap||(w._styleMap={});var N=w._styleMap[m];P===S?delete w._styleMap[m]:w._styleMap[m]=P,w.fp("s:"+m,N,P)&&w.onStyleChanged(m,N,P)},onStyleChanged:function(){},iv:function(m){this.invalidate(m)},invalidate:function($){this.fp($||"*",!1,!0)},toString:function(){var c=this;return c._displayName||c._name||c._tag||c._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(C,O){var q=this,X=q.s(ss);X||q.s(ss,X={}),O?X[C]=O:delete X[C],q.fp(ss,o,X)},removeStyleIcon:function($){var F=this.s(ss);if(F){var d=F[$];delete F[$],this.fp(ss,o,F)}return d},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var G,Q={};for(G in this._styleMap)Q[G]=1;return Q},getCurrentPrefix:function(){return this._interactPrefix||Fm},ca:function(g,m){var z=this.getCurrentPrefix();return g=z+g,2===arguments.length?this.a(g,m):this.a(g)}});var gm=E.DataModel=function(){var k=this;k._datas=new Fj,k._dataMap={},k._roots=new Fj,k._rootMap={},k._fsDataMap={},k._78O={},k._reflectorMap={},k._36I=new cd,k._35I=new cd,k._serializeNotifier=new cd,k._selectionModel=new Lb(k);var u=k._29Q=[],e=k._scheduleCallback=function(){for(var i=Date.now(),L=0;L<u.length;L++){var q=u[L];q.enabled&&i-q.lastTime>q.interval&&(q.beforeAction&&q.beforeAction(),q.action&&k.each(function(e){q.action(e)}),q.afterAction&&q.afterAction(),q.lastTime=i)}u.length&&(k._30Q=d.requestAnimationFrame(e))}};Eb("DataModel",l,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:S,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:S,_init:S,_envmap:S,_postProcessingData:S,sm:function(){return this.getSelectionModel()},mm:function(m,E,h){this.addDataModelChangeListener(m,E,h)},umm:function(S,z){this.removeDataModelChangeListener(S,z)},md:function(X,f,I){this.addDataPropertyChangeListener(X,f,I)},umd:function(z,N){this.removeDataPropertyChangeListener(z,N)},mh:function(p,K,y){this.addHierarchyChangeListener(p,K,y)},umh:function(F,i){this.removeHierarchyChangeListener(F,i)},getAttrObject:function(){return this._attrObject},setAttrObject:function(Y){return this._attrObject=Y},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(b){return this._dataMap[b]},removeDataById:function(k){this.remove(this.getDataById(k))},toDatas:function(t,s){return this._datas.toList(t,s)},each:function(O,i){this._datas.each(O,i)},getDataByTag:function(m){return this._78O[m]},getTagMap:function(){return this._78O},removeDataByTag:function(L){this.remove(this.getDataByTag(L))},add:function(b,d,W){var p=this,X=b._id,v=b._tag,F=p._roots;if(p._dataMap[X])throw"'"+X+"' already exists";v!=o&&(p._78O[v]=b),p._dataMap[X]=b,W>=0?p._datas.add(b,W):p._datas.add(b),b._parent||(p._rootMap[X]=b,d>=0?F.add(b,d):F.add(b)),b.s("fullscreen")!==S&&(p._fsDataMap[X]=b),b.s("shape3d.reflector")&&(p._reflectorMap[X]=b),b._21I(p),p.onAdded(b),p._36I.fire({kind:"add",data:b,rootsIndex:d,datasIndex:W})},onAdded:function(){},remove:function(F,h){if(F){var f=this,p=F._id,Q=h&&h.keepStructure,L=h&&h.keepChildren,y=F.getTag();if(F._dataModel===f){this.beginTransaction(),Q?f._removingData||(f._removingData=F):f.prepareRemove(F),L||F.toChildren().each(function(K){f.remove(K,h)},f),Q?f._removingData===F&&(F._parent&&F._parent.removeChild(F),delete f._removingData):F._parent&&F._parent.removeChild(F);var Y=f._datas.remove(F);delete f._dataMap[p],y!=o&&delete f._78O[y];var d;f._rootMap[p]&&(delete f._rootMap[p],d=f._roots.remove(F)),f._fsDataMap[p]&&delete f._fsDataMap[p],f._reflectorMap[p]&&delete f._reflectorMap[p],F._21I(o),f.onRemoved(F),f._36I.fire({kind:cf,data:F,rootsIndex:d,datasIndex:Y}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var V=this;if(V._datas.size()){var J=V._historyManager?this.toJSON():S;V._datas.toArray().forEach(function(J){J._21I(o)}),V._datas.clear(),V._dataMap={},V._roots.clear(),V._rootMap={},V._fsDataMap={},V._reflectorMap={},V._78O={},V._36I.fire({kind:ms,json:J})}},contains:function(p){return p&&p._dataModel===this},handleDataPropertyChange:function(K){var I=this,F=K.data,y=K.property;if("parent"===y){var D=F._id,c=I._rootMap,Q=I._roots;F._parent?c[D]&&(delete c[D],Q.remove(F)):c[D]||(c[D]=F,Q.add(F))}else if("tag"===y){var a=K.oldValue,C=K.newValue,O=I._78O;a!=o&&delete O[a],C!=o&&(O[C]=F)}else if("s:fullscreen"===y){var D=F._id,M=I._fsDataMap;K.oldValue!=o&&delete M[D],K.newValue!=o&&(M[D]=F)}else if("s:shape3d.reflector"===y){var D=F._id,U=I._reflectorMap;K.oldValue&&delete U[D],K.newValue&&(U[D]=F)}this.onDataPropertyChanged(F,K),this._35I.fire(K)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(s,l,f){this._36I.add(s,l,f)},removeDataModelChangeListener:function(W,V){this._36I.remove(W,V)},addSerializeListener:function(I,s,e){this._serializeNotifier.add(I,s,e)},removeSerializeListener:function(I,h){this._serializeNotifier.remove(I,h)},fireSerializeEvent:function(x){this._serializeNotifier.fire(x)},addDataPropertyChangeListener:function(r,u,Q){this._35I.add(r,u,Q)},removeDataPropertyChangeListener:function(O,K){this._35I.remove(O,K)},_38I:function(A,T,D){this._37I&&this._37I.fire({data:A,oldIndex:T,newIndex:D})},addHierarchyChangeListener:function(v,g,r){this._37I||(this._37I=new cd),this._37I.add(v,g,r)},removeHierarchyChangeListener:function(t,u){this._37I.remove(t,u)},getSiblings:function(H){var M=H._parent;return M?M._children:this._roots},eachByHierarchical:function(i,_,o){if(_)return this._eachByHierarchical(i,_,o);for(var z=0,x=this._roots,q=x.size();q>z;z++)if(this._eachByHierarchical(i,x.get(z),o)===!1)return!1;return!0},_eachByHierarchical:function(q,D,L){if(L){if(q.call(L,D)===!1)return!1}else if(q(D)===!1)return!1;for(var N=D.size(),M=0;N>M;M++)if(this._eachByHierarchical(q,D.getChildAt(M),L)===!1)return!1;return!0},reverseEachByHierarchical:function(s,w,D){if(w)return this._reverseEachByHierarchical(s,w,D);for(var M=this._roots,K=M.size(),H=K-1;H>=0;H--)if(this._reverseEachByHierarchical(s,M.get(H),D)===!1)return!1;return!0},_reverseEachByHierarchical:function(f,R,l){for(var P=R.size(),o=P-1;o>=0;o--)if(this._reverseEachByHierarchical(f,R.getChildAt(o),l)===!1)return!1;if(l){if(f.call(l,R)===!1)return!1}else if(f(R)===!1)return!1;return!0},eachByDepthFirst:function(L,H,G){if(H)return this._11I(L,H,G);for(var k=0,V=this._roots,j=V.size();j>k;k++)if(this._11I(L,V.get(k),G)===!1)return!1;return!0},_11I:function(V,l,N){for(var $=l.size(),u=0;$>u;u++)if(this._11I(V,l.getChildAt(u),N)===!1)return!1;if(N){if(V.call(N,l)===!1)return!1}else if(V(l)===!1)return!1;return!0},eachByBreadthFirst:function(n,V,L){var f=new Fj;for(V?f.add(V):this._roots.each(f.add,f);f.size()>0;)if(V=f.removeAt(0),V.eachChild(f.add,f),L){if(n.call(L,V)===!1)return!1}else if(n(V)===!1)return!1;return!0},moveTo:function(T,m){var v=this.getSiblings(T),P=v.indexOf(T);P===m||0>P||m>=0&&m<=v.size()&&(v.remove(T),m>v.size()&&m--,v.add(T,m),this._38I(T,P,m))},moveUp:function(C){this.moveTo(C,this.getSiblings(C).indexOf(C)-1)},moveDown:function(f){this.moveTo(f,this.getSiblings(f).indexOf(f)+1)},moveToTop:function(E){this.moveTo(E,0)},moveToBottom:function(Q){this.moveTo(Q,this.getSiblings(Q).size())},moveSelectionUp:function(A){this.beginTransaction(),A||(A=this.sm());var L=new Fj;Ck(A,L,this._roots),L.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(r){this.beginTransaction(),r||(r=this.sm());var X=new Fj;bd(r,X,this._roots),X.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(P){this.beginTransaction(),P||(P=this.sm());var B=new Fj;Kj(P,B,this._roots),B.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(H){this.beginTransaction(),H||(H=this.sm());var O=new Fj;of(H,O,this._roots),O.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(D,C,e){var y=this.getDatas();null==e&&(e=y.indexOf(D)),e===C||0>e||C>=0&&C<=y.size()&&(y.remove(D),C>y.size()&&C--,y.add(D,C),this._76I(D,e,C))},bringForward:function(t){this.moveToIndex(t,this.getDatas().indexOf(t)+1)},bringToFront:function(x){this.moveToIndex(x,this.size())},sendBackward:function(B){this.moveToIndex(B,this.getDatas().indexOf(B)-1)},sendToBack:function(D){this.moveToIndex(D,0)},bringSelectionForward:function(t){this.beginTransaction(),t||(t=this.sm());for(var U=new Fj,b=this.getDatas(),u=!1,Q=0;Q<b.size();Q++){var f=b.get(b.size()-1-Q);t.contains(f)?u&&U.add(f):u=!0}U.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(M){this.beginTransaction(),M||(M=this.sm());for(var e=new Fj,Q=this.getDatas(),p=0;p<Q.size();p++){var x=Q.get(p);M.contains(x)&&e.add(x)}e.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(m){this.beginTransaction(),m||(m=this.sm());for(var e=new Fj,O=this.getDatas(),w=!1,W=0;W<O.size();W++){var E=O.get(W);m.contains(E)?w&&e.add(E):w=!0}e.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(m){this.beginTransaction(),m||(m=this.sm());for(var E=new Fj,l=this.getDatas(),L=0;L<l.size();L++){var h=l.get(l.size()-1-L);m.contains(h)&&E.add(h)}E.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(i){var q=this;q.removeScheduleTask(i),i.enabled==o&&(i.enabled=!0),i.interval==o&&(i.interval=10),i.lastTime=Date.now(),q._29Q.push(i),q._30Q==o&&(q._30Q=d.requestAnimationFrame(q._scheduleCallback))},removeScheduleTask:function(I){var B=this,q=B._29Q,Y=q.indexOf(I);Y>=0&&q.splice(Y,1),q.length||B._30Q==o||(d.cancelAnimationFrame(B._30Q),delete B._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(f){this._historyManager||new E.HistoryManager(this),null!=f&&this._historyManager.setMaxHistoryCount(f),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(S){this._historyManager&&this._historyManager.undo(S)},redo:function(Z){this._historyManager&&this._historyManager.redo(Z)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(Q){this._historyManager&&this._historyManager.addHistory(Q)},onHistoryManagerChanged:function(){}});var Lb=E.SelectionModel=function(L){var f=this;f._68O=ys,f._map={},f._73O=new Fj,f._74I=new cd,f._21I(L)};Eb("SelectionModel",l,{ms_fire:1,ms_dm:1,ms:function(c,N,m){this.addSelectionChangeListener(c,N,m)},ums:function(l,J){this.removeSelectionChangeListener(l,J)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===Wf},co:function(W){return this._map[W._id]!=o},ss:function(S){this.setSelection(S)},as:function(Q){this.appendSelection(Q)},rs:function(w){this.removeSelection(w)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(Y){var b=this;if(b._68O!==Y&&(Y===hg||Y===Wf||Y===ys)){b.cs();var r=b._68O;b._68O=Y,b.fp("selectionMode",r,Y)}},_21I:function(v){var K=this,p=K._dataModel;p!==v&&(p&&(K.cs(),p.umm(K.handleDataModelChange,K)),K._dataModel=v,v.mm(K.handleDataModelChange,K,!0),K.fp(Nh,p,v))},dispose:function(){var G=this;G.cs(),G._dataModel.umm(G.handleDataModelChange,G)},handleDataModelChange:function(c){var W=this;if(c.kind===cf){var N=c.data;W.co(N)&&(W._73O.remove(N),delete W._map[N._id],W._75I(cf,new Fj(N)))}else c.kind===ms&&W.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(n){var t=this;if(t._filterFunc!==n){t.cs();var f=t._filterFunc;t._filterFunc=n,t.fp("filterFunc",f,t._filterFunc)}},_75I:function(L,A,k,C){k&&(this._73O.each(function(R){C[R._id]?k.remove(R):k.add(R)}),A=k.toList()),this._74I.fire({kind:L,datas:new Fj(A)})},addSelectionChangeListener:function(f,w,I){this._74I.add(f,w,I)},removeSelectionChangeListener:function(i,e){this._74I.remove(i,e)},_97O:function(p,g){for(var r,E=this,X=0,Q=new Fj(p);X<Q.size();X++)r=Q.get(X),(E._filterFunc&&!E._filterFunc(r)||g&&E.co(r)||!g&&!E.co(r)||!E._dataModel.contains(r))&&(Q.removeAt(X),X--);return Q},appendSelection:function(s){var B=this;if(B._68O!==hg){var p,X,U=B._73O,P=B._97O(s,!0);P.isEmpty()||(B.sg()&&(p=new Fj(U),X=B._map,U.clear(),B._map={},P=new Fj(P.get(P.size()-1))),P.each(function(C){U.add(C),B._map[C._id]=C}),B._75I("append",P,p,X))}},removeSelection:function(h){var r=this,g=r._97O(h),a=0,j=g.size();if(0!==j){for(;j>a;a++){var L=g.get(a);r._73O.remove(L),delete r._map[L._id]}r._75I(cf,g)}},toSelection:function(u,l){return this._73O.toList(u,l)},getSelection:function(){return this._73O},each:function(m,F){this._73O.each(m,F)},setSelection:function(O){var P=this,Y=P._73O;if(P._68O!==hg&&!(Y.isEmpty()&&!O||1===Y.size()&&P.ld()===O)){var B=new Fj(Y),l=P._map;Y.clear(),P._map={};var h=P._97O(O,!0);P.sg()&&h.size()>1&&(h=new Fj(h.get(h.size()-1))),h.each(function(s){Y.add(s),P._map[s._id]=s}),P._75I("set",o,B,l)}},clearSelection:function(){var M=this,V=M._73O;if(V.size()>0){var Q=V.toList();V.clear(),M._map={},M._75I(ms,Q)}},selectAll:function(){var X=this;if(X._68O!==hg){var W,N,Q=X._dataModel.toDatas();if(X._filterFunc)for(W=0;W<Q.size();W++)N=Q.get(W),X._filterFunc(N)||(Q.removeAt(W),W--);var p=X._73O,z=new Fj(p),Z=X._map;p.clear(),X._map={},X.sg()&&Q.size()>1&&(Q=new Fj(Q.get(Q.size()-1)));var $=Q.size();for(W=0;$>W;W++)N=Q.get(W),p.add(N),X._map[N._id]=N;X._75I("all",o,z,Z)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(j){return this._map[j._id]!=o},getLastData:function(){var G=this._73O;return G.size()>0?G.get(G.size()-1):o},getFirstData:function(){var G=this._73O;return G.size()>0?G.get(0):o
},isSelectable:function(H){var i=this;return H&&i._68O!==hg?i._filterFunc?i._filterFunc(H):!0:!1},getTopSelection:function(){var I=this,d=new Fj;return I._73O.each(function(q){for(var h=q.getParent();h;){if(I.contains(h)){q=o;break}h=h.parent}q&&d.add(q)}),d}});var ks=function(){return hs(0),function(Z,t){var v;if(qq(t)){var R=Z.getDataUI(t);R&&R._88I&&(v=R._88I.rect)}return v?v:t.getRect()}}();vq(N,{edgeGroupAgentFunc:o,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:f.rectSelectBorder,graphViewRectSelectBackground:Ji,graphViewEditPointSize:Tk?17:7,graphViewEditPointBorderColor:f.editPointBorder,graphViewEditPointBackground:f.editPointBackground,setEdgeType:function(h,Y,R){Nj[h]=Y,dp[h]=R},getEdgeType:function(m){return Nj[m]},getEdgeTypeMap:function(){return Nj},getNodeRect:ks},!0),vq(t,{"layout.h":S,"layout.v":S,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":S,interactive:!1,preventDefaultWhenInteractive:!0,"image.stretch":"fill",icons:S,ingroup:!0,"body.color":S,"2d.gray":!1,fullscreen:S,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:S,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":wn,"select.width":1,"select.padding":2,"select.type":ir,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":S,"border.width":2,"border.padding":2,"border.type":ir,label:S,"label.font":S,"label.color":Se,"label.background":S,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":S,"label.max":S,"label.opacity":S,"label.scale":1,"label.align":S,"label.selectable":!0,label2:S,"label2.font":S,"label2.color":Se,"label2.background":S,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":S,"label2.max":S,"label2.opacity":S,"label2.scale":1,"label2.align":S,"label2.selectable":!0,note:S,"note.expanded":!0,"note.font":S,"note.color":Pm,"note.background":wn,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":S,"note.toggleable":!0,"note.border.width":1,"note.border.color":S,"note.opacity":S,"note.scale":1,"note.align":S,note2:S,"note2.expanded":!0,"note2.font":S,"note2.color":Pm,"note2.background":wn,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":S,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":S,"note2.opacity":S,"note2.scale":1,"note2.align":S,"group.type":S,"group.image":S,"group.image.stretch":"fill","group.repeat.image":S,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":S,"group.title.color":Pm,"group.title.background":f.groupTitleBackground,"group.title.align":Ec,"group.title.orientation":md,"group.background":f.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":S,"group.border.color":dd,"group.border.radius":0,"group.border.cap":zo,"group.border.join":Yd,"group.splitLine":!1,"group.gradient":o,"group.gradient.color":"#FFF",shape:S,"shape.background":dd,"shape.repeat.image":S,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":dd,"shape.border.3d":!1,"shape.border.3d.color":S,"shape.border.3d.accuracy":S,"shape.border.cap":zo,"shape.border.join":Yd,"shape.border.pattern":S,"shape.gradient":o,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":wr,"shape.dash.offset":0,"shape.dash.color":En,"shape.dash.width":S,"shape.dash.3d":!1,"shape.dash.3d.color":S,"shape.dash.3d.accuracy":S,"shape.polygon.side":6,"shape.arc.from":s,"shape.arc.to":j,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":S,"shape.gradient.pack":S,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":S,"shape.foreground.gradient":o,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":S,"autolayout.hgap":S,"autolayout.vgap":S,"edge.type":S,"edge.points":S,"edge.segments":S,"edge.color":dd,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":S,"edge.3d.accuracy":S,"edge.cap":zo,"edge.join":Yd,"edge.source.position":17,"edge.source.anchor.x":S,"edge.source.anchor.y":S,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":S,"edge.target.anchor.y":S,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":S,"edge.dash":!1,"edge.dash.pattern":wr,"edge.dash.offset":0,"edge.dash.color":En,"edge.dash.width":S,"edge.dash.3d":!1,"edge.dash.3d.color":S,"edge.dash.3d.accuracy":S,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":S,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":S,"grid.column.percents":S,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":f.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":f.gridCellBorderColor,"grid.block":S,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":f.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":Se,"text.font":ej,"text.shadow":!1,"text.shadow.color":wn,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,_62O:S},!0),vq(gm,{_76I:function(b,J,x){this._39I&&this._39I.fire({data:b,oldIndex:J,newIndex:x})},addIndexChangeListener:function(q,b,A){var L=this;L._39I||(L._39I=new cd),L._39I.add(q,b,A)},removeIndexChangeListener:function(H,X){this._39I.remove(H,X)},prepareRemove:function(Y){Ej(Y)&&(Y.setSource(o),Y.setTarget(o)),Y._70O&&Y._70O.toList().each(this.remove,this),Y._69O&&Y._69O.toList().each(function(w){w.setHost(o)}),Y._host&&Y.setHost(o)},onAdded:function(m){this.isAutoAdjustIndex()&&this.adjustIndex(m)},onDataPropertyChanged:function(i,F){ao[F.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(i)},isAdjustable:function(Z){return Sl(Z)||Ej(Z)},isAdjustedToBottom:function(Z){return sj(Z)?Z.isExpanded()&&Yf(Z):!1},adjustIndex:function(X){var Q=this;this.isHierarchicalRendering()||(Q.isAdjustedToBottom(X)?(Q.sendToBottom(X),X.eachChild(Q.adjustIndex,Q)):Q.sendToTop(X))},sendToTop:function(U){var t=this;if(t.contains(U)&&t.isAdjustable(U)){var v=t._datas;if(U!==v.get(t.size()-1)){var u=v.indexOf(U);v.removeAt(u),v.add(U),t._76I(U,u,t.size()-1)}if(Ej(U)){var I=U._40I;I&&!t.isAdjustedToBottom(I)&&t.sendToTop(I),I=U._41I,I&&!t.isAdjustedToBottom(I)&&t.sendToTop(I)}U._69O&&U._69O.each(function(p){p.isRelatedTo(U)||Sl(U)&&p.isLoopedHostOn(U)||t.sendToTop(p)}),U.ISubGraph||(!sj(U)||U.isExpanded())&&U._adjustChildrenToTop&&U.eachChild(function(F){Ej(F)||t.sendToTop(F)})}},sendToBottom:function(v,U){var D=this;if(v!==U&&D.contains(v)&&D.isAdjustable(v)&&(!U||D.contains(U))){var d=D._datas,y=d.remove(v),$=U?D._datas.indexOf(U):0;if(d.add(v,$),y!==$){D._76I(v,y,$);var J=v._parent;!J||J.ISubGraph||Ej(J)||D.sendToBottom(v._parent,v)}}}}),vq(_l,{ms_edit:function(e){e._46O=function(K){var T=this,Q=T.gv.dm(),Z=T._index,C=T._89I,D=T._node,J=T._shape,c=T._edge,k=T._77I;D&&C?(this.fi({kind:"endEditRect",event:K,data:D,direction:C}),Q.endTransaction()):J&&Z>=0?(T.fi({kind:"endEditPoint",event:K,data:J,index:Z}),Q.endTransaction()):c&&Z>=0?(T.fi({kind:"endEditPoint",event:K,data:c,index:Z}),Q.endTransaction()):k&&(T.fi({kind:"endEditRotation",event:K,data:k}),Q.endTransaction())},e._78I=function(p){var _=this;_.autoScroll(p);var M=_.gv.lp(p),F=_._index,z=_._89I,R=_._node,d=_._shape,I=_._edge,V=_._77I;if(R&&z)_._80O(M),_.fi({kind:"betweenEditRect",event:p,data:R,direction:z});else if(d&&F>=0)M.e=d.getPoints().get(F).e,d.setPoint(F,M),_.fi({kind:"betweenEditPoint",event:p,data:d,index:F});else if(I&&F>=0){var c=I.s(Mo);M.e=c.get(F).e,c.set(F,M),I.fp(Mo,o,c),_.fi({kind:"betweenEditPoint",event:p,data:I,index:F})}else if(V){var t=V.p(),H=V.getScale(),m=v+g(M.y-t.y,M.x-t.x);H.y<0&&(m+=s),D(m)<.04&&(m=0),V.setRotation(m),_.fi({kind:"betweenEditRotation",event:p,data:V})}},e._80O=function(B){var W=this,s=W._node,E=W._rect,Q=E.x,Y=E.y,l=E.width,Z=E.height,k=W._89I,o=W._anchor,z=W._matrix,B=z.tfi(B);"northwest"===k?E=uh(B,{x:Q+l,y:Y+Z}):k===Ee?E=uh({x:Q,y:B.y},{x:Q+l,y:Y+Z}):"northeast"===k?E=uh({x:Q,y:B.y},{x:B.x,y:Y+Z}):k===ns?E=uh({x:B.x,y:Y},{x:Q+l,y:Y+Z}):k===Sb?E=uh({x:Q,y:Y},{x:B.x,y:Y+Z}):"southwest"===k?E=uh({x:B.x,y:Y},{x:Q+l,y:B.y}):"south"===k?E=uh({x:Q,y:Y},{x:Q+l,y:B.y}):"southeast"===k&&(E=uh({x:Q,y:Y},B)),s.setPosition(z.tf(E.x+E.width*o.x,E.y+E.height*o.y)),s.setWidth(E.width),s.setHeight(E.height)},e._80I=function(h,F,o,g){var w=this,G=w.gv._zoom,Z=(w.gv.getEditPointSize()+2)/G;return Ib({x:F-Z/2,y:o-Z/2,width:Z,height:Z},h)?(w._89I!==g&&(w._89I=g),!0):!1},e._79I=function(q,s,F){var a=this,r=a.gv,e=s?r.getDataUI(s):o,Q=e?e._55O:o;if(Q){var E,U,M,G,z=r._zoom,m=(r.getEditPointSize()+2)/z,w=r.lp(q);if(Sl(s)){if(Q._56O&&Sl(s)&&(U=Q._98o,Ib({x:U.x-m/2,y:U.y-m/2,width:m,height:m},w)))return a._77I=s,F&&a.fi({kind:"beginEditRotation",event:q,data:s}),a.setCursor("crosshair"),!0;if(Q._43O&&s instanceof rd)for(M=s.getPoints(),E=M.size()-1;E>=0;E--)if(U=M.get(E),Ib({x:U.x-m/2,y:U.y-m/2,width:m,height:m},w))return a._index=E,a._shape=s,F&&a.fi({kind:"beginEditPoint",event:q,data:s,index:E}),a.setCursor("crosshair"),!0;if(Q._42O)for(var v=s.getEditControlPoints(),l=["northwest",-1,-1,ns,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Sb,1,0,"northeast",1,-1,Ee,0,-1],E=0,G=v.length;G>E;E++){var W=l[3*E],h=v[E];if(a._80I(w,h.x,h.y,W)){a._node=s;var Y=s.getWidth(),R=s.getHeight(),O=s.getAnchor();a._rect={x:-Y*O.x,y:-R*O.y,width:Y,height:R},a._anchor=O,a._matrix=s.getMatrix();var D=s.getRotation(),A=X(D),y=V(D),j=l[3*E+1]*Co(s.getScale().x),i=l[3*E+2]*Co(s.getScale().y),J=Math.atan2(-y*j-A*i,A*j-y*i),k=(Math.round(J/(Math.PI/4))+8)%8,T=[Ac,"nesw-resize",Mh,"nwse-resize",Ac,"nesw-resize",Mh,"nwse-resize"][k];return a.setCursor(T),F&&a.fi({kind:"beginEditRect",event:q,data:s,direction:a._89I}),!0}}}if(Q._43O&&Ej(s)&&s.s(os)===Zq&&(M=s.s(Mo)))for(E=M.size()-1;E>=0;E--)if(U=M.get(E),Ib({x:U.x-m/2,y:U.y-m/2,width:m,height:m},w))return a._index=E,a._edge=s,F&&a.fi({kind:"beginEditPoint",event:q,data:s,index:E}),a.setCursor("crosshair"),!0}return!1}},ms_gv:function($){$._currentSubGraph=o,$._fpsInfo={time:0,fps:0,frames:0},$.upSubGraph=function(){this.setCurrentSubGraph(Yi(this._currentSubGraph))},$.isVisible=function(K){var l=this;if(Yi(K)!==l._currentSubGraph)return!1;if(Ej(K)){var p=K._40I,P=K._41I;if(!p||!P)return!1;if(!(K.s("edge.independent")||l.isVisible(p)&&l.isVisible(P)))return!1;if(K.isEdgeGroupHidden())return!1}else for(var o=K._parent;o&&!o.ISubGraph;){if(sj(o)&&(!o.isExpanded()||!l.isVisible(o)))return!1;o=o._parent}if(K._parent instanceof zm&&!l.isVisible(K._parent))return!1;if(K._refGraph instanceof Sf&&!l.isVisible(K._refGraph))return!1;if(l instanceof Ym){if(!K.s("3d.visible"))return!1}else{var t=l.getLayersInfo();if(t){var C=t[K._layer];if(C&&C.visible===!1)return!1}if(!K.s("2d.visible"))return!1}return l._visibleFunc?l._visibleFunc(K):!0},$.handleSelectionChange=function(T){var M=this;T.datas.each(function(Y){M.invalidateData(Y);var Z=Y._parent;sj(Z)&&Sl(Y)&&Y.s(ei)&&(M.invalidateData(Z),Z._49I&&Z._49I.each(function(w){M.invalidateData(w)}))}),M.onSelectionChanged(T)},$.onSelectionChanged=function(n){var W=this,V=W.sm();if(1===V.size()&&("set"===n.kind||"append"===n.kind)){var L=V.ld();W.isAutoMakeVisible()&&W.makeVisible(L),W.adjustIndex&&W._dataModel.isAutoAdjustIndex()&&W.adjustIndex(L)}},$.makeVisible=function(q){if(q){var P=this,a=P.getDataUI?P.getDataUI(q):P.getData3dUI(q);if(a){var t=q,s=Yi(q);for(s!==P._currentSubGraph&&P.setCurrentSubGraph(s);(t=t._parent)&&t!==s;)sj(t)&&t.setExpanded(!0);P._23I=q,P.iv()}}},$.getLabel=function(A){var Q=A.getStyle($h);return Q===S?A.getName():Q},$.getLabelBackground=function(y){return y.getStyle("label.background")},$.getLabelColor=function(J){return J.getStyle("label.color")},$.getLabel2=function(R){return R.getStyle("label2")},$.getLabel2Background=function(t){return t.getStyle("label2.background")},$.getLabel2Color=function(e){return e.getStyle("label2.color")},$.getNote=function(Z){return Z.getStyle(Fc)},$.getNoteBackground=function(c){return c.getStyle("note.background")},$.getNote2=function(g){return g.getStyle(Hn)},$.getNote2Background=function(n){return n.getStyle("note2.background")},$.handleClick=function(I,C,Z){var g=this;C?(g.fi({kind:"clickData",event:I,data:C,part:Z}),g.onDataClicked(C,I)):(g.fi({kind:"clickBackground",event:I}),g.onBackgroundClicked(I))},$.handleDoubleClick=function(S,N,v){var R=this;lg(S)&&(N?(R.fi({kind:"doubleClickData",event:S,data:N,part:v}),R.onDataDoubleClicked(N,S,v),R.checkDoubleClickOnNote(S,N,v)||R.checkDoubleClickOnRotation&&R.checkDoubleClickOnRotation(S,N,v)||(Ej(N)?R.onEdgeDoubleClicked(N,S,v):N.ISubGraph?R.onSubGraphDoubleClicked(N,S,v):sj(N)?R.onGroupDoubleClicked(N,S,v):N.IDoorWindow?R.onDoorWindowDoubleClicked(N,S,v):N.ICSGBox&&R.onCSGBoxDoubleClicked(N,S,v))):(R.fi({kind:"doubleClickBackground",event:S}),R.onBackgroundDoubleClicked(S)))},$.onSubGraphDoubleClicked=function(n){this.setCurrentSubGraph(n)},$.onEdgeDoubleClicked=function(M,t){M.ISubGraph&&!Xl(t)?this.setCurrentSubGraph(M):M.s("edge.toggleable")&&M.toggle()},$._39Q=function(o){return this.isInteractive(o)?this.preventDefaultWhenInteractive(o):!1},$.preventDefaultWhenInteractive=function(E){return E.s("preventDefaultWhenInteractive")},$.onGroupDoubleClicked=function(T){T.s("group.toggleable")&&T.toggle()},$.onDoorWindowDoubleClicked=function(t){t.s("dw.toggleable")&&t.toggle(!0)},$.onCSGBoxDoubleClicked=function(f,S){var c=this;if(c instanceof Ym){var E=c.getHitFaceInfo(S);E&&E.face&&f.s(E.face+".toggleable")&&f.toggleFace(E.face,!0)}},$.onBackgroundClicked=function(){},$.onBackgroundDoubleClicked=function(){this.upSubGraph()},$.onDataClicked=function(){},$.onDataDoubleClicked=function(){},$.onAutoLayoutEnded=function(){},$.onMoveEnded=function(){},$.onPanEnded=function(){},$.onPinchEnded=function(){},$.onRectSelectEnded=function(){},$.onZoomEnded=function(){},$.serialize=function(d){return this.dm().serialize(d)},$.toJSON=function(){return this.dm().toJSON()},$.deserialize=function(J,b){var A=this;b=b instanceof Xd?{rootParent:b}:Vd(b)?{setId:b}:fd(b)?{finishFunc:b}:b||{},b.view=A;var r=A.dm(),O=b.finishFunc;return b.finishFunc=function(){O&&O.apply(b,arguments),Vd(r.a("zoomable"))&&A.setZoomable&&A.setZoomable(r.a("zoomable")),Vd(r.a("pannable"))&&A.setPannable&&A.setPannable(r.a("pannable")),Vd(r.a("rectSelectable"))&&A.setRectSelectable&&A.setRectSelectable(r.a("rectSelectable")),r.a("fitContent")===!0&&A.fitContent&&A.fitContent(!0,0)},r.deserialize(J,b.rootParent,b)},$.showDebugTip=function(){var B=this,N=B._debugDiv;if(!N){N=B._debugDiv=L.createElement("div"),N.style.position="absolute",N.style.overflow="hidden",N.style.backgroundColor="white",N.style.color="black";var R=B.getView();B._79O?R.insertBefore(N,B._79O):R.appendChild(N);var d=function(){B.redraw();var h=B._canvas,H="FPS : "+B._fpsInfo.fps+"<br/>"+"Datas : "+B.dm().getDatas().length+(h?"<br/>Size : "+h.width+" * "+h.height:""),M=B.getDebugTip();M&&(H+="<br/>------<br/>"+M),N.innerHTML=H,B._isDebugging&&requestAnimationFrame(d)};requestAnimationFrame(d),B._isDebugging=!0}},$.hideDebugTip=function(){var K=this,N=K._debugDiv;N&&(delete K._debugDiv,K.getView().removeChild(N),K._isDebugging=!1)},$.updateDOMAppendMatrix=function(){var M=this.getView();M&&(M.updateAppendMatrix=!0)},$.countFrame=function(){if(this._isDebugging){var Q=Date.now(),E=this._fpsInfo;Q-E.time>1e3?(E.fps=Math.round(1e5*(E.frames+1)/(Q-E.time))/100,E.time=Q,E.frames=0):E.frames++}}},ms_icons:function(p){p.getRotation=function(y){return y==o?0:y},p._15O=function(){var f=this,h=f.s(ss);if(h){var F=f,b=f.data||f._data,d=f._38o={icons:h,rects:{}};for(var U in h){var e=h[U],W=hd(e.shape3d,b,F);if(!(hd(e.visible,b,F)===!1||hd(e.for3d,b,F)&&!f.I3d||W&&!f.I3d)){var G=W?[W]:hd(e.names,b,F),C=G?G.length:0,v=hd(e.position,b,F)||3,T=hd(e.offsetX,b,F)||0,i=hd(e.offsetY,b,F)||0,A=hd(e.direction,b,F)||Sb,P=hd(e.gap,b,F),q=P!=o?P:1,s=hd(e.rotation,b,F),S=hd(e.keepOrien,b,F),B=hd(e.rotationFixed,b,F)?s:f.getRotation(s,S,v),N=o,X=d.rects[U]=new Array(C);X.rotation=B;for(var _=0;C>_;_++){var V,a,Q,O,g=G[_];if(W)Q=0,O=0;else{var m=ng(g);Q=hd(e.width,b,F),O=hd(e.height,b,F),Q==o&&(Q=rr(m,b)),O==o&&(O=cc(m,b))}if(N?A===Sb?T+=Q/2:A===ns?T-=Q/2:A===Ee?i-=O/2:i+=O/2:N={width:Q,height:O},f.I3d){var r=-Q/2,p=-O/2;a={width:Q,height:O,mat:f._16O(hd(e.autorotate,b,F),v,N,hd(e.face,b,F)||ph,hd(e.t3,b,F),hd(e.r3,b,F),hd(e.rotationMode,b,F),T,i),vs:new $g([r,-p,0,r,-p-O,0,r+Q,-p-O,0,r+Q,-p,0])}}else V=f.getPosition(v,T,i,N,hd(e.positionFixed,b,F)),a={x:V.x-Q/2,y:V.y-O/2,width:Q,height:O},f._68o(a,B);X[_]=a,A===Sb?T+=Q/2+q:A===ns?T-=Q/2+q:A===Ee?i-=O/2+q:i+=O/2+q}}}}}}});var Ao={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Bh={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Je={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},ao={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Yr={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},fn={"edge.type":1,"edge.group":1},Vg={rotation:1,rotationX:1,rotationZ:1},wb={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Kl={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},oj={shape:1,thickness:1,position:1,anchor:1,scale:1},Yi=function(j){if(!j)return o;if(Ej(j)){var G=j._40I,S=j._41I;if(!G||!S)return o;var u=Yi(G),b=Yi(S);return u===b?u:o}for(var w=j._parent;Ej(w)&&!w.ISubGraph;)w=w._parent;return w?w.ISubGraph?w:Yi(w):o},ko=function(H,$,P,E){var J=$.getStyle(P)*E;J&&me(H,J),J=$.getStyle(P+".left")*E,J&&(H.x-=J,H.width+=J),J=$.getStyle(P+".right")*E,J&&(H.width+=J),J=$.getStyle(P+".top")*E,J&&(H.y-=J,H.height+=J),J=$.getStyle(P+".bottom")*E,J&&(H.height+=J),H.width<0&&(H.width=-H.width,H.x-=H.width),H.height<0&&(H.height=-H.height,H.y-=H.height)},Yf=function(V){for(var g,b=0,t=V.size();t>b;b++)if(g=V.getChildAt(b),Sl(g)&&Yf(g))return!0;return V.hasAgentEdges()},js=function(p){if(!p)return o;for(var U=p._parent;sj(U);){if(!sj(U._parent))return U.isExpanded()?p:U;U.isExpanded()||(p=U),U=U._parent}return p},Dr=function(D,B){if(!D||!B)return o;var b,w,S,T=Yi(D),t=Yi(B);if(T!==t){for(;t&&T!==t;)t=Yi(t);if(T===t)return D;b=new Fj,b.add(D,0);for(var Q=D._parent;Sl(Q)&&!B.isDescendantOf(Q);)b.add(Q,0),Q=Q._parent;for(S=b.size(),w=0;S>w;w++){var i=b.get(w);if(sj(i)&&!i.isExpanded())return i;if(i.ISubGraph)return i}return D}return D},ok=function(f){if(f.isLooped())return f._source;var A=js(f._source),_=js(f._target);return A===_?f._source:Dr(A,_)},fp=function(d){if(d.isLooped())return d._target;var e=js(d._source),W=js(d._target);return e===W?d._target:Dr(W,e)},nr=function(P,c,g){"target"!==g&&(g="source");var t="target"===g?c.getTargetAgent():c.getSourceAgent(),s="edge."+g+".";if(Ej(t)){var v=P.getDataUI(t);v._79o();var m=c.s(s+"index");if(m!==S){var N=nj(v);return N[Math.max(0,Math.min(m,N.length-1))]}var d=c.s(s+"percent")||0;d=Math.max(0,Math.min(d,1));var J=vh(v);return Tm(J,100*d)}return Kq(P,t,c.s(s+"position"),c.s(s+"offset.x"),c.s(s+"offset.y"),c.s(s+"anchor.x"),c.s(s+"anchor.y"))},Kq=function(P,D,a,c,F,t,G){if(!D)return o;var W,k=D.getRotation?D.getRotation():0;if(t!==S||G!==S){t=t===S?.5:t,G=G===S?.5:G;var H=D.getScale();if(k&&!qq(D,P)||H.x<0||H.y<0){var I=D.getPosition(),p=D.getWidth(),K=D.getHeight(),Y=D.getAnchor(),Q=new bm(k,I.x,I.y,H.x,H.y);a=Q.tf((t-Y.x)*p,(G-Y.y)*K)}else W=ks(P,D),a={x:W.x+t*W.width,y:W.y+G*W.height}}else a=Hq(a,ks(P,D));if(k){var E=X(k),i=V(k),n=c*E-F*i;F=c*i+F*E,c=n}return a.x+=c,a.y+=F,a},ee=function(r,k){if(!r||!k)return o;var B,b,f,N,n,t;if(r===k){if(N=r.getLoopedEdges(),!N)return o;N=new Fj(N)}else{if(n=r.getAgentEdges(),t=k.getAgentEdges(),!n||!t)return o;for(b=n.size(),B=0;b>B;B++)f=n.get(B),t.contains(f)&&(N||(N=new Fj),N.add(f))}if(N)for(B=0;B<N.size();B++)f=N.get(B),f.getStyle(os)===Zq&&(f._22I(o),N.removeAt(B),B--);return N},xd=function(V,i){var Q=ee(V,i);if(Q&&!Q.isEmpty()){if(1===Q.size())return Q.get(0)._22I(o),void 0;var f=new Fj,y=new Fj;Q.each(function(K){var z=K.s("edge.group");f.contains(z)||f.add(z)}),f.sort(),f.each(function($){y.add(new E.EdgeGroup(Q.toList(function(J){return $===J.s("edge.group")}),y))}),y.each(function(v){v.each(function(K){K._22I(v)})})}},nh=function(n,z,R){var q=n._canvas;n._zoom;var b=Zl(z,q),f=Zl(R,q);return{x:b.x-f.x,y:b.y-f.y}},Wl=function(K,H){if(H){var Z=H.rect,y=H.color,k=H.rotation,M=H.labelWidth,f=H.background,B=H.opacity,L=H.scale,X=L!=o&&1!==L;if(B!=o){var x=K.globalAlpha;K.globalAlpha*=B}if(k||X){K.save();var z=Z.x+Z.width/2,w=Z.y+Z.height/2;te(K,z,w),k&&Rh(K,k),X&&K.scale(L,L),te(K,-z,-w)}if(f&&xe(K,Z.x,Z.y,Z.width,Z.height,f),M){var n=Z.width,$=K.createLinearGradient(Z.x,Z.y,Z.x+n,Z.y);$.addColorStop(0,y),$.addColorStop(.9,y),$.addColorStop(1,Pp),y=$,Z.width=M}xq(K,H.ss,Z,H.font,y,H.align),M&&(Z.width=n),(k||X)&&K.restore(),B!=o&&(K.globalAlpha=x)}},Cm=function(A,c){if(c){var r=c.rect,C=r.x,h=r.y,y=r.width,k=r.height,K=c.background,x=c.backgroundImage,w=c.borderWidth,t=c.borderColor,a=c.labelWidth,p=c.opacity,U=c.scale,W=U!=o&&1!==U;if(p!=o){var Y=A.globalAlpha;A.globalAlpha*=p}if(W){A.save();var u=r.x+r.width/2,n=r.y+r.height/2;te(A,u,n),A.scale(U,U),te(A,-u,-n)}if(c.expanded){var R=Q(8,y/4),G=h+k-8;if(A.fillStyle=K,A.beginPath(),A.moveTo(C,h),A.lineTo(C,G),A.lineTo(C+y/2,G),A.lineTo(C+y/2,h+k),A.lineTo(C+y/2+R,G),A.lineTo(C+y,G),A.lineTo(C+y,h),A.closePath(),A.fill(),w&&(A.lineWidth=w,A.lineJoin="round",A.lineCap="round",t?(A.strokeStyle=t,A.stroke()):(A.strokeStyle=br(K),A.beginPath(),A.moveTo(C+y,h),A.lineTo(C+y,G),A.lineTo(C+y/2+R,G),A.lineTo(C+y/2,h+k),A.stroke(),A.strokeStyle=Sm(K),A.beginPath(),A.moveTo(C+y,h),A.lineTo(C,h),A.lineTo(C,G),A.lineTo(C+y/2,G),A.lineTo(C+y/2,h+k),A.stroke())),x)li(A,ng(x),Ki,r.x,r.y,r.width,r.height-8,c.data,c.view);else{if(r.height-=8,K=c.color,a){var J=y,F=A.createLinearGradient(C,h,C+J,h);F.addColorStop(0,K),F.addColorStop(.9,K),F.addColorStop(1,Pp),K=F,r.width=a}xq(A,c.ss,r,c.font,K,c.align),a&&(r.width=J),r.height+=8}}else if(c.icon)sq(A,ng(c.icon),C,h,y,k,c.data,c.view);else{var e=y/2;w&&(A.lineWidth=w,A.lineJoin="round",A.lineCap="round",A.strokeStyle=t?t:br(K),A.beginPath(),A.arc(C+e,h+e,e,v,1.6*s,!0),A.moveTo(C+e,h+k),A.lineTo(C+y-e/5,h+e),A.stroke(),A.strokeStyle=t?t:Sm(K),A.beginPath(),A.arc(C+e,h+e,e,1.6*s,v,!0),A.moveTo(C+e,h+k),A.lineTo(C+e/5,h+e),A.stroke()),A.fillStyle=K,A.beginPath(),A.arc(C+e,h+e,e,0,j,!0),A.moveTo(C+e,h+k),A.lineTo(C+y-e/5,h+e),A.lineTo(C+e/5,h+e),A.closePath(),A.fill(),A.fillStyle=c.color,A.beginPath(),A.arc(C+e,h+e,e/3,0,j,!0),A.fill()}W&&A.restore(),p!=o&&(A.globalAlpha=Y)}},Hm=function(M,j){return j>2*M?M:j/2},uf=function(v,C,X,l){if(!v||!C)return 0;var U=g(C.y-v.y,C.x-v.x);return X||(U=C.x<v.x?U+s:U),U+l},jd=function(n,P,p,Y,i,B,b){b&&(n.x>P.x||n.x===P.x&&n.y>P.y)&&(p=hj[p],i=-i);var W=Hq(p,{x:0,y:0,width:Qm(n,P),height:0},B);return W.x+=Y,W.y+=i,W=new bm(g(P.y-n.y,P.x-n.x)).tf(W),W.x+=n.x,W.y+=n.y,W},ap=function(_,Z,n,K,G){if(_._19Q=!0,!n.getEdgeGroup())return K?n.s("edge.gap"):0;if(Ej(n.getSourceAgent())||Ej(n.getTargetAgent()))return 0;var x,d=0,s=0,o=0;if(n.getEdgeGroup().getSiblings().each(function(z){z.each(function(f){if(Z.isVisible(f)&&f.s(os)==G){var B=f.s("edge.gap");x?(s+=o/2+B/2,o=B):(x=f,o=B),f===n&&(d=s)}})}),K)return s-d+o;var C=d-s/2;return x&&n._40I!==x._40I&&(_._19Q=!1),C},Eh=function(){var R=function(y){var Z=[];return y.forEach(function(y){Z.push({x:y.x,y:y.y}),Z.push({x:y.x+y.width,y:y.y+y.height}),Z.push({x:y.x+y.width,y:y.y}),Z.push({x:y.x,y:y.y+y.height})}),Z};return function(I,V,s){if("oval"===I){var _=0,x=s.height/s.width,k=x*x,J=s.x+s.width/2,L=s.y+s.height/2,E=R(V);E.forEach(function(P){var r=P.x-J,v=P.y-L,n=r*r+v*v/k;n>_&&(_=n)}),_=T(_);var o=x*_;return{x:J-_,y:L-o,width:2*_,height:2*o}}if("circle"===I){var F=0,J=s.x+s.width/2,L=s.y+s.height/2,E=R(V);return E.forEach(function(Q){var e=Q.x-J,O=Q.y-L,U=e*e+O*O;U>F&&(F=U)}),F=T(F),{x:J-F,y:L-F,width:2*F,height:2*F}}return"roundRect"===I?(me(s,Q(s.width,s.height)/16),s):s}}(),Mb=E.graph={},Tq=function(n,a,U){pk(x+".graph."+n,a,U)};E.layout={};var ts={},ef=function(y,G,h,Y,p,c,T,L){var a=[G.uuid,Math.round(Y),Math.round(p),h].join("_");G.cacheRule&&(a+=hd(G.cacheRule,c,T));var o=T._zoom;o!==T._cacheZoom&&(T._cacheZoom=o,T._cacheImage={}),o*=bq;var r=T._cacheImage[a];return r||(sh(),r=E.Default.toCanvas(G,Math.ceil(Y*o),Math.ceil(p*o),h,c,T,L),em()&&(T._cacheImage[a]=r)),r};vq(N,{setImageCacheRule:function(X,F){var k;k=F||"object"!=typeof X?{_image:F}:X;for(var U in k){var m=k[U];rb(U)?(pk=ng(U),pk?pk.cacheRule=m:ts[U]=m):U.cacheRule=m}}});var Sk={comps:[{type:Fl,points:[85,50,70,115,100,71,86,107,88,49,56,88,78,56,49,84,55,51,71,110,87,103,120,120,43,49,118,107,87,55,85,83,100,116,67,107,71,100,108,117,79,109,65,61],borderWidth:1,borderColor:o}]};if(Sk[Ij]=Sk[hk]=160,d.Image){var Ol=new d.Image;Ol.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Dq("default_blank",Ol)}Dq("node_image",zl(30,30,[{type:ir,rect:[4,5,22,16],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[2,3,26,20],borderWidth:1,borderColor:dd},{type:ir,rect:[11,23,8,4],background:dd},{type:ir,rect:[6,27,18,2],background:dd}])),Dq("node_icon",zl(16,16,[{type:ir,rect:[2,2,12,10],gradient:Qi,gradientColor:ah,background:dd},{type:Wo,rect:[2,2,12,10],width:1,color:dd},{type:ir,rect:[6,12,4,2],background:dd},{type:ir,rect:[4,14,8,1],background:dd}])),Dq("block_icon",zl(16,16,[{type:Wo,rect:[1,1,14,14],width:1,color:dd}])),Dq("group_image",zl(66,39,[{type:ir,rect:[44.3,18,18.1,12.8],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[3.3,17.8,18.1,12.8],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:dd,gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[26.2,29.4,12.8,4.2],background:dd},{type:ir,rect:[21.3,33.5,22.5,2.3],background:dd},{type:ir,rect:[5.3,32.7,14.1,2.1],background:dd},{type:ir,rect:[9,30.4,6.7,2.4],background:dd},{type:ir,rect:[50,30.7,6.7,2.4],background:dd},{type:ir,rect:[46.3,33,14.1,2.1],background:dd}])),Dq("group_icon",zl(16,16,[{type:ir,rect:[4,12,4,2],background:dd},{type:ir,rect:[2,13,8,1],background:dd},{type:ir,rect:[12,12,2,1],background:dd},{type:ir,rect:[11,13,4,1],background:dd},{type:ir,rect:[10,7,6,5],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[1,2,10,10],gradient:Qi,gradientColor:ah,background:dd},{type:Wo,rect:[1,2,10,10],width:1,color:dd}])),Dq("refGraph_icon",zl(16,16,[{type:"shape",borderWidth:1,borderColor:dd,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:dd,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Dq("edge_icon",zl(16,16,[{type:ir,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[10.8,1,4,4],background:dd},{type:ir,rect:[1,11,4,4],background:dd}])),Dq("subGraph_image",zl(72,45,[{type:Fl,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[29.6,30.7,3.6,1.8],background:dd},{type:ir,rect:[28.4,32.3,6,1.2],background:dd},{type:ir,rect:[37.3,32,10.8,1.8],background:dd},{type:ir,rect:[39.1,29.9,7.2,2.3],background:dd},{type:ir,rect:[26.6,23.7,9.6,7.2],gradient:Qi,gradientColor:ah,background:dd},{type:ir,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:dd,gradient:Qi,gradientColor:ah,background:dd}])),Dq("subGraph_icon",zl(17,17,[{type:Fl,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:Qi,gradientColor:ah,background:dd}])),Dq("shape_icon",zl(16,16,[{type:Fl,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:dd}])),Dq("polyline_icon",zl(16,16,[{type:Fl,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:dd},Mg(7.5,.4),Mg(7.5,6.3),Mg(13.6,6.3),Mg(13.6,14),Mg(.7,13.9),Mg(.7,.3)])),Dq("grid_icon",zl(16,16,[{type:ir,rect:[1,1,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[6,1,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[11,1,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[11,6,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[6,6,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[1,6,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[11,11,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[6,11,4,4],background:dd,gradient:Qi,gradientColor:ah},{type:ir,rect:[1,11,4,4],background:dd,gradient:Qi,gradientColor:ah}])),Dq("light_icon",zl(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:dd},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:dd,gradient:Qi,gradientColor:ah,background:{func:function(O){var H=O?O.s(Pg):o;return Si(H)?"rgb("+B(255*H[0])+","+B(255*H[1])+","+B(255*H[2])+")":H||dd}}}])),Dq("text_icon",zl(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:dd}])),Dq("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Dq("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Dq("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Dq("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});
var rf=function(F,u,O,J,R,k){var W,x,r,Y,M,g,d,D,G,p,o,h=[];if(Math.abs(J)>2*Math.PI&&(J=2*Math.PI),M=Math.ceil(Math.abs(J)/(Math.PI/4)),W=J/M,x=-W,r=-O,M>0){g=F+Math.cos(O)*R,d=u+Math.sin(-O)*k,h.push({x:g,y:d});for(var t=0;M>t;t++)r+=x,Y=r-x/2,D=F+Math.cos(r)*R,G=u+Math.sin(r)*k,p=F+Math.cos(Y)*(R/Math.cos(x/2)),o=u+Math.sin(Y)*(k/Math.cos(x/2)),h.push({x:p,y:o}),h.push({x:D,y:G})}return h},Nb=function(b){if(b){var w=b._data;if(w instanceof E.Shape)return{points:w.getPoints(),segments:w.getSegments()};var a;if(w instanceof E.Edge&&(a=b._78o)){var U,r,$=a.type,M=a.points,X=a.segments,d=a.edgeTypeInfo;if(!$||M){var c=a.sourcePoint,p=c.x,J=c.y,Y=a.targetPoint,Z=Y.x,I=Y.y;if($)X?(U=new Fj({x:p,y:J}),U.addAll(M),U.add({x:Z,y:I}),r=new Fj(X._as)):(U=new Fj({x:p,y:J}),M.each(function(A){U.add(A)}),U.add({x:Z,y:I}));else if(a.looped){U=new Fj(rf(p,J,0,2*Math.PI,a.radius,a.radius)),r=new Fj([1]);for(var o=0;o<(U.size()-1)/2;o++)r.add(3)}else U=new Fj,a.center?(U.add({x:a.c1.x,y:a.c1.y}),U.add({x:p,y:J}),U.add({x:Z,y:I}),U.add({x:a.c2.x,y:a.c2.y})):(U.add({x:p,y:J}),U.add({x:Z,y:I}))}else d&&(U=new Fj(d.points._as),d.segments&&(r=new Fj(d.segments._as)));return{points:U,segments:r}}}},vh=function(p,u,K){if(null==u){var z=Nb(p);if(!z)return;u=z.points,K=z.segments}if(u){if(Array.isArray(u)&&(u=new Fj(u)),"number"==typeof u.get(0)){for(var Q=new E.List,y=0;y<u.size();y+=2)Q.add({x:u.get(y),y:u.get(y+1)});u=Q}if(!K){K=[1];for(var C=u.length-1;C>0;C--)K.push(2)}Array.isArray(K)&&(K=new Fj(K));for(var i=Qc(u._as,K._as,50),O=i.length,$=[],y=0;O>y;y++){var d=i[y];d.length>1&&$.push(d)}return $}},ck=function(T){for(var V=0,C=T.length-1,a=0;C>a;a++){var Y=T[a],Z=T[a+1],r=Z.x-Y.x,H=Z.y-Y.y;V+=Math.sqrt(r*r+H*H)}return V},kf=function(C,o){for(var Y=0,v=o.length,F=0;v>F;F++){var h=o[F];if(Y+=h,Y>C)return F}return Math.min(F,v-1)},Rc=function(t,s){for(var W=0,D=0,j=0,g=t.length-1,F=0;g>F;F++){var a=t[F],i=t[F+1],f=i.x-a.x,V=i.y-a.y;if(j=Math.sqrt(f*f+V*V),W+=j,W>s){W-=j,D=F;break}}var C=t[D],k=t[D+1],R=Math.atan2(k.y-C.y,k.x-C.x),c=s-W,V=Math.sin(R)*c,f=Math.cos(R)*c;return{x:C.x+f,y:C.y+V}},Tm=function(j,R){if(j){var L;if(0===R)L=j[0][0];else if(100===R)j=j[j.length-1],L=j[j.length-1];else{for(var A=0,Z=[],u=j.length,E=0;u>E;E++){var i=j[E],w=ck(i);A+=w,Z.push(w)}for(var M=A*R/100,Q=kf(M,Z),P=0,o=0;Q>o;o++)P+=Z[o];M-=P,L=Rc(j[Q],M)}return L}},nj=function(d){var c,m,a,R,p=Nb(d),V=[],i=p.points,r=p.segments,H=-1;for(m=0,a=r?r.length:i.length;a>m;m++){if(c=r?r.get(m):1,3===c)R=2;else if(4===c)R=3;else{if(5===c)continue;R=1}H+=R,V.push(i.get(H))}return V},_k=function(F,i,L,g){function X(R){if(R>=0&&1>=R){c=i(R);var W=(F.x-c.x)*(F.x-c.x)+(F.y-c.y)*(F.y-c.y);return T>W?(T=W,H=R,!0):!1}}L=L||100,g=g||1e-5;for(var T=1/0,H=0,c=new Qp,A=0;L>A;++A)X(A/L);for(var d=1/(2*L);d>g;)X(H-d)||X(H+d)||(d/=2);return H};vq(N,{_edgeProtectMethod:{getStraightLinePoints:vh,calculateLineLength:ck,calcSegmentIndexByDistance:kf,calculatePointAlongLine:Rc,getPercentPosition:Tm,getRealPointsFromDataUI:nj}});var yf=function(F,P){for(var k=F.vertices,E=0;E<k.length;E++){var R=k[E],V=R.y;R.y=R.z,R.z=-V,P&&(R.y+=P)}},ze=function(C){for(var t,o,I,V,S,c,H=[],Y=[],b=[],g=C.faces,R=0,m=0,y=0,W=g.length;W>R;R++,m+=6,y+=9){var J=g[R];1===J.i?(t||(t=[],o=[],I=[]),Ri(J,R,m,y,C,t,I,o)):2===J.i?(V||(V=[],S=[],c=[]),Ri(J,R,m,y,C,V,c,S)):Ri(J,R,m,y,C,H,b,Y)}return{vs:H,uv:Y,ns:b,top_vs:t,top_uv:o,top_ns:I,bottom_vs:V,bottom_uv:S,bottom_ns:c}},Ri=function(t,Z,q,e,D,E,C,m){var a=D.vertices,I=D.faceVertexUvs,z=a[t.a],g=a[t.b],R=a[t.c];E[e]=z.x,E[e+1]=z.y,E[e+2]=z.z,E[e+3]=g.x,E[e+4]=g.y,E[e+5]=g.z,E[e+6]=R.x,E[e+7]=R.y,E[e+8]=R.z;var y=t.vertexNormals;if(3===y.length){var v=y[0],l=y[1],N=y[2];C[e]=v.x,C[e+1]=v.y,C[e+2]=v.z,C[e+3]=l.x,C[e+4]=l.y,C[e+5]=l.z,C[e+6]=N.x,C[e+7]=N.y,C[e+8]=N.z}else{var M=t.normal;C[e]=M.x,C[e+1]=M.y,C[e+2]=M.z,C[e+3]=M.x,C[e+4]=M.y,C[e+5]=M.z,C[e+6]=M.x,C[e+7]=M.y,C[e+8]=M.z}var h=I[0][Z][0],r=I[0][Z][1],K=I[0][Z][2];m[q]=h.x,m[q+1]=h.y,m[q+2]=r.x,m[q+3]=r.y,m[q+4]=K.x,m[q+5]=K.y},Qe=function(){function F(l,x){return l.dot(x)>0}function A(l,R,P,U,w,q,A){for(var E,J,$=[R,P,U],t=[w,q,A],L=[],y=$.length,T=!0;y--&&T;){for(var g=$[y],S=t.length,b=!1;S--;)if(g.equals(t[S])){t.splice(S,1),L.push(g),b=!0;break}if(!b){if(E){T=!1;break}E=g}}return T&&2===L.length&&(J=t[0],e.subVectors(E,L[0]),C.subVectors(J,L[0]),H.subVectors(E,L[1]),e.x*H.y*C.z+H.x*C.y*e.z+C.x*e.y*H.z-C.x*H.y*e.z-C.y*H.z*e.x-C.z*H.x*e.y<1e-6&&(n.subVectors(J,L[1]),z.subVectors(L[1],L[0]),F(z,e)&&F(z,C)&&(z.negate(),F(z,H)&&F(z,n))))?(l.push(L[1].x,L[1].y,L[1].z),l.push(E.x,E.y,E.z),l.push(E.x,E.y,E.z),l.push(L[0].x,L[0].y,L[0].z),l.push(L[0].x,L[0].y,L[0].z),l.push(J.x,J.y,J.z),l.push(J.x,J.y,J.z),l.push(L[1].x,L[1].y,L[1].z),2):(l.push(R.x,R.y,R.z),l.push(P.x,P.y,P.z),l.push(P.x,P.y,P.z),l.push(U.x,U.y,U.z),l.push(U.x,U.y,U.z),l.push(R.x,R.y,R.z),1)}function N(){this._vertexMap={},this._lineMap={},this._lineList=[]}function q(P,U,L,m,o,Q,r){var K=[L,o];P[0]===m&&K.reverse();var w=[K[0]._key,K[1]._key].join("|"),Z=P._triangles[w];Z||(P._triangles[w]=Z={});var T=[Q._key,r._key].join("|");Z[T]||(Z[T]=[Q,r])}function O(N,W,d){var K=N._planes[d._key];if(!K)for(var O in N._planes){var j=N._planes[O];if(j._normal.angleTo(d)<.001){K=j;break}}return K?(K._vertices.indexOf(W)<0&&K._vertices.push(W),void 0):(N._planes[d.key]={_normal:d,_vertices:[W]},void 0)}function r(X){var N=X._ctlineModel;if(N||(X._ctlineModel=N=[]),N[0])return N[0];var t;t=Si(X)?X:[X];var W,r,Z,c,M,F,C,d,f,o,a,e,h,P,m,p,Y,$,x,n=["","top_","bottom_"];for(N=[],W=0,r=t.length;r>W;W++)if(o=t[W])for(Af(o),Z=0,c=n.length;c>Z;Z++)if(f=o[n[Z]+"lvs"])for(Y=N.length,$=f.length,N.length=Y+$,x=0;$>x;++x,++Y)N[Y]=f[x];else if(C=o[n[Z]+"vs"]){d=o[n[Z]+"is"],F=d?d.length:C.length/3;for(var M=0;F-1>M;)d?(a=d[M],e=d[M+1],h=d[M+2],P=d[M+3],m=d[M+4],p=d[M+5]):(a=M,e=M+1,h=M+2,P=M+3,m=M+4,p=M+5),T.fromArray(C,3*a),b.fromArray(C,3*e),R.fromArray(C,3*h),V.fromArray(C,3*P),y.fromArray(C,3*m),E.fromArray(C,3*p),M+=3*A(N,T,b,R,V,y,E);F>M&&(d?(a=d[M],e=d[M+1],h=d[M+2]):(a=M,e=M+1,h=M+2),T.fromArray(C,3*a),b.fromArray(C,3*e),R.fromArray(C,3*h),N.push(T.x,T.y,T.z),N.push(b.x,b.y,b.z),N.push(b.x,b.y,b.z),N.push(R.x,R.y,R.z),N.push(R.x,R.y,R.z),N.push(T.x,T.y,T.z))}return X._ctlineModel[0]=N,N}function x(C){var h=C._ctlineModel;if(h||(C._ctlineModel=h=[]),h[1])return h[1];var E;E=Si(C)?C:[C];var L,A,x,r,w,Q,q,V,G,m,$,T,B=["","top_","bottom_"],f=new N;for(h=[],L=0,A=E.length;A>L;L++)if(G=E[L])for(Af(G),x=0,r=B.length;r>x;x++)if(q=G[B[x]+"vs"]){V=G[B[x]+"is"],Q=V?V.length:q.length/3;for(var w=0,w=0;Q>w;w+=3)V?(m=V[w],$=V[w+1],T=V[w+2]):(m=w,$=w+1,T=w+2),f._addTriangle(q,S,m,$,T)}return f._toLineVS(h),C._ctlineModel[1]=h,h}function i(c){var x=c._ctlineModel;if(x||(c._ctlineModel=x=[]),x[2])return x[2];var b;b=Si(c)?c:[c];var p,m,P,v,R,l,s,Y,e,E,K,$,i,H=["","top_","bottom_"],o=new N;for(x=[],p=0,m=b.length;m>p;p++)if(E=b[p])for(Af(E),P=0,v=H.length;v>P;P++)if(s=E[H[P]+"vs"]){Y=E[H[P]+"is"],e=E[H[P]+"ns"],l=Y?Y.length:s.length/3;for(var R=0,R=0;l>R;R+=3)Y?(K=Y[R],$=Y[R+1],i=Y[R+2]):(K=R,$=R+1,i=R+2),o._addTriangle(s,e,K,$,i)}return o._toLineVS(x),c._ctlineModel[2]=x,x}var T=new Of,b=new Of,R=new Of,V=new Of,y=new Of,E=new Of,e=new Of,H=new Of,C=new Of,n=new Of,z=new Of,s=new Of;N.prototype._findVertex=function(o,t){s.fromArray(o,3*t);var Z=[s.x,s.y,s.z].join(","),V=this._vertexMap[Z];if(!V){var C=s.clone();C._key=Z,this._vertexMap[Z]=V=C}return V},N.prototype._findLine=function(j,J){var e=[j,J];j._key>J._key&&e.reverse(),e._key=[e[0]._key,e[1]._key].join("|");var E=this._lineMap[e._key];return E||(this._lineMap[e._key]=E=e,e._triangles={},e._planes={},this._lineList.push(e)),E};var D=new Of,m=new Of;return N.prototype._addTriangle=function(g,W,N,n,M){var Q,v,x,X=this._findVertex(g,N),Y=this._findVertex(g,n),A=this._findVertex(g,M),o=this._findLine(X,Y),d=this._findLine(Y,A),$=this._findLine(A,X);W?(Q=(new Of).fromArray(W,3*N),Q._key=[Q.x,Q.y,Q.z].join("|"),v=(new Of).fromArray(W,3*n),v._key=[v.x,v.y,v.z].join("|"),x=(new Of).fromArray(W,3*M),x._key=[x.x,x.y,x.z].join("|"),q(o,X,Q,Y,v,A,x),q(d,Y,v,A,x,X,Q),q($,A,x,X,Q,Y,v)):(m.subVectors(A,Y),D.subVectors(Y,X),Q=(new Of).crossVectors(D,m),Q._key=[Q.x,Q.y,Q.z].join("|"),O(o,A,Q),O(d,X,Q),O($,Y,Q))},N.prototype._toLineVS=function(w){for(var T=this._lineList,a=0,h=T.length;h>a;++a){var O=T[a],o=!1;for(var e in O._triangles)if(1==l.keys(O._triangles[e]).length){w.push(O[0].x,O[0].y,O[0].z,O[1].x,O[1].y,O[1].z),o=!0;break}if(!o)for(var S in O._planes)if(1==O._planes[S]._vertices.length){w.push(O[0].x,O[0].y,O[0].z,O[1].x,O[1].y,O[1].z),o=!0;break}}},[r,x,i]}(),Lm=function(N){var p=N._lineModel;if(p)return p;var H;H=Si(N)?N:[N];var g,w,X,G,x,F,D,A,L,P,E,Z,U=["","top_","bottom_"];for(p=[],g=0,w=H.length;w>g;g++)if(L=H[g])for(X=0,G=U.length;G>X;X++)if(D=L[U[X]+"vs"]){A=L[U[X]+"is"],F=A?A.length:D.length/3;for(var x=0;F>x;x+=3)A?(P=A[x],E=A[x+1],Z=A[x+2]):(P=x,E=x+1,Z=x+2),P*=3,E*=3,Z*=3,p.push(D[P],D[P+1],D[P+2],D[E],D[E+1],D[E+2],D[E],D[E+1],D[E+2],D[Z],D[Z+1],D[Z+2],D[Z],D[Z+1],D[Z+2],D[P],D[P+1],D[P+2])}return N._lineModel=p,p},so=function(k,G,a,e,F,L,h,H,M){a==o&&(a=!0),e==o&&(e=!0),h==o&&(h=1),H==o&&(H=0);var P=new db;return Dc(P,k,G,M),P=P.toShapes(),ze(new oh(P,{top:a,bottom:e,curveSegments:F,amount:h,repeatUVLength:L},-h/2+H))},Md=function(x,g){this.x=x||0,this.y=g||0};Md.prototype={constructor:Md,add:function(q){return this.x+=q.x,this.y+=q.y,this},sub:function(Q){return this.x-=Q.x,this.y-=Q.y,this},equals:function(F){return F.x===this.x&&F.y===this.y},multiplyScalar:function(F){return this.x*=F,this.y*=F,this},distanceTo:function(g){return T(this.distanceToSquared(g))},distanceToSquared:function(Q){var O=this.x-Q.x,p=this.y-Q.y;return O*O+p*p},clone:function(){return new Md(this.x,this.y)}};var Lk=function(n,k,z){this.x=n||0,this.y=k||0,this.z=z||0};Lk.prototype={constructor:Lk,set:function(X,K,U){return this.x=X,this.y=K,this.z=U,this},setY:function(x){return this.y=x,this},copy:function(X){return this.x=X.x,this.y=X.y,this.z=X.z,this},add:function(H){return this.x+=H.x,this.y+=H.y,this.z+=H.z,this},addVectors:function(K,X){return this.x=K.x+X.x,this.y=K.y+X.y,this.z=K.z+X.z,this},sub:function(H){return this.x-=H.x,this.y-=H.y,this.z-=H.z,this},subVectors:function(U,F){return this.x=U.x-F.x,this.y=U.y-F.y,this.z=U.z-F.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},applyMatrix4:function(m){var G=this.x,g=this.y,f=this.z,A=m.elements;return this.x=A[0]*G+A[4]*g+A[8]*f+A[12],this.y=A[1]*G+A[5]*g+A[9]*f+A[13],this.z=A[2]*G+A[6]*g+A[10]*f+A[14],this},divideScalar:function(D){if(0!==D){var T=1/D;this.x*=T,this.y*=T,this.z*=T}else this.x=0,this.y=0,this.z=0;return this},dot:function(O){return this.x*O.x+this.y*O.y+this.z*O.z},length:function(){return T(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(w){var s=this.x,P=this.y,H=this.z;return this.x=P*w.z-H*w.y,this.y=H*w.x-s*w.z,this.z=s*w.y-P*w.x,this},crossVectors:function(J,n){var d=J.x,a=J.y,e=J.z,y=n.x,z=n.y,$=n.z;return this.x=a*$-e*z,this.y=e*y-d*$,this.z=d*z-a*y,this},distanceTo:function(W){return T(this.distanceToSquared(W))},distanceToSquared:function(x){var $=this.x-x.x,U=this.y-x.y,O=this.z-x.z;return $*$+U*U+O*O},clone:function(){return new Lk(this.x,this.y,this.z)}};var wl=function(){this.elements=new Float32Array(16)};wl.prototype={constructor:wl,set:function(D,w,K,i,W,n,o,$,Y,F,g,H,u,r,R,x){var d=this.elements;return d[0]=D,d[4]=w,d[8]=K,d[12]=i,d[1]=W,d[5]=n,d[9]=o,d[13]=$,d[2]=Y,d[6]=F,d[10]=g,d[14]=H,d[3]=u,d[7]=r,d[11]=R,d[15]=x,this},makeRotationAxis:function(O,y){var l=X(y),Q=V(y),T=1-l,c=O.x,J=O.y,D=O.z,S=T*c,Y=T*J;return this.set(S*c+l,S*J-Q*D,S*D+Q*J,0,S*J+Q*D,Y*J+l,Y*D-Q*c,0,S*D-Q*J,Y*D+Q*c,T*D*D+l,0,0,0,0,1),this}};var Jm=function(p){this.repeatUVLength=p};Jm.prototype={generateTopUV:function(J,q,O,K,c,H,C){var p,t,d,e,R=J.vertices,m=R[K].x,D=R[K].y,P=R[c].x,k=R[c].y,o=R[H].x,E=R[H].y,S=this.repeatUVLength;if(S)p=0,t=0,d=S,e=S;else{this._bb||(this._bb=q.getBoundingBox());var j=this._bb;p=j.minX,t=j.minY,d=j.maxX-p,e=j.maxY-t}return C?[new Md((m-p)/d,(D-t)/e),new Md((P-p)/d,(k-t)/e),new Md((o-p)/d,(E-t)/e)]:[new Md((m-p)/d,1-(D-t)/e),new Md((P-p)/d,1-(k-t)/e),new Md((o-p)/d,1-(E-t)/e)]},generateBottomUV:function(L,C,J,e,R,h){return this.generateTopUV(L,C,J,e,R,h,!0)},generateSideWallUV:function(D,x,H,v,C,t,O,b,Y,i,W,P){if(!this._cl){for(var S,Z,V=[],f=0,F=H.length,z=0;F>z;z++){S=H[z],Z=H[(z+1)%F];var N=S.x-Z.x,d=S.y-Z.y,K=T(N*N+d*d);V.push(f),f+=K}for(var z=0;F>z;z++)V[z]/=f;this._cl=V}var V=this._cl,k=1-Y/i,E=1-(Y+1)/i,X=V[W],R=V[P];return R>X&&(X+=1),[new Md(X,k),new Md(R,k),new Md(R,E),new Md(X,E)]}};var Oe=function(b,B,F,R,Z,C){this.a=b,this.b=B,this.c=F,this.i=C,this.normal=R instanceof Lk?R:new Lk,this.vertexNormals=R instanceof Array?R:[]};Oe.prototype={constructor:Oe};var Mm=[-8,13,2,10,2,11,-2,4,-1],Gi=function(){if(Gi[Ob]!=o)return Gi[Ob];for(var t=_r[Ob],m=Mm,J=Xd.prototype.getClassName(),P='"',n=0,Q="",N=!1,B=+new(d[J.substr(3,3)+Ac[n]]),y=n;y<m.length;y++){var E=m.length-y;Q+=y%2===n?m[y]+E+"":m[y]-E+""}for(var y=n;4>y;y++)Q+=n;if(Q=Q*Q.length/Q.length,B>Q){if(t&&t[n]&&t[4/ir.length]){for(var $,S,Y,v,k,x,b,G,R=t[0],X=t[1],q="",D=0,y=0;y<X.length;y++)X[y]===P?G?(G=!1,0!==D%2&&($==o?$=q:S==o?S=q:Y==o?Y=q:v==o?v=q:k==o?k=q:x==o?x=q:b==o&&(b=q)),D++,q=""):G=!0:G&&(q+=X[y]);for(var l,K,L,U="",s=0,y=0;y<R.length;y++)R[y]===P?l?(l=!1,0!==s%2&&(K==o?K=U:L==o&&(L=U)),s++,U=""):l=!0:l&&(U+=R[y]);var H=$+S+Y+v+k+x,h=!x||x===ne;if(!h&&x)for(var O,y=0,_=x.length;_>y;y++)x[y]===Rn[4]?O===ne?h=tj:O[0]===Oc[7]&&ne&&ne.indexOf(O.substr(1))>=0?h=Hc:O=o:(O==o?O=x[y]:O+=x[y],y===_-1&&(O===ne?h=tj:O[0]===Oc[7]&&ne&&ne.indexOf(O.substr(1))>=0&&(h=Hc)));(N=nd(H,b)&&nd(K,L)&&K===$&&h&&(!k||k>B))&&Y.indexOf($n[0])>=0&&(Gi[$n[0]]=1),N&&Y.indexOf(1)>=0&&(Gi[1]=1),N&&Y.indexOf(2)>=0&&(Gi[2]=1)}}else N=!0,Gi[$n[0]]=Gi[1]=Gi[2]=1;return Gi[Ob]=N,N},Ig=function(){},ak=Ig.prototype;ak.getPointAt=function(h){var r=this.getUtoTmapping(h);return this.getPoint(r)},ak.getPoints=function(l){l||(l=5);var k,z=[];for(k=0;l>=k;k++)z.push(this.getPoint(k/l));return z},ak.getSpacedPoints=function(i){i||(i=5);var V,y=[];for(V=0;i>=V;V++)y.push(this.getPointAt(V/i));return y},ak.getLength=function(){var h=this.getLengths();return h[h.length-1]},ak.getLengths=function(J){if(J||(J=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==J+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var j,L,I=[],M=this.getPoint(0),T=0;for(I.push(0),L=1;J>=L;L++)j=this.getPoint(L/J),T+=j.distanceTo(M),I.push(T),M=j;return this.cacheArcLengths=I,I},ak.getUtoTmapping=function(Z,q){var d,l=this.getLengths(),J=0,r=l.length;d=q?q:Z*l[r-1];for(var G,p=0,j=r-1;j>=p;)if(J=P(p+(j-p)/2),G=l[J]-d,0>G)p=J+1;else{if(!(G>0)){j=J;break}j=J-1}if(J=j,l[J]==d){var A=J/(r-1);return A}var N=l[J],u=l[J+1],o=u-N,g=(d-N)/o,A=(J+g)/(r-1);return A},ak.getTangent=function(u){var t=1e-4,o=u-t,q=u+t;0>o&&(o=0),q>1&&(q=1);var c=this.getPoint(o),U=this.getPoint(q),f=U.clone().sub(c);return f.normalize()},ak.getTangentAt=function(w){var k=this.getUtoTmapping(w);return this.getTangent(k)},Ig.create=function(Z,P){return Z.prototype=qd(Ig.prototype),Z.prototype.getPoint=P,Z};var xr=function(){this.curves=[],this.autoClose=!1},tn=xr.prototype=qd(ak);tn.add=function(K){this.curves.push(K)},tn.closePath=function(){var j=this.curves[0].getPoint(0),y=this.curves[this.curves.length-1].getPoint(1);j.equals(y)||this.curves.push(new Xm(y,j))},tn.getPoint=function(E){for(var Z,z,D=E*this.getLength(),Y=this.getCurveLengths(),x=0;x<Y.length;){if(Y[x]>=D){Z=Y[x]-D,z=this.curves[x];var B=1-Z/z.getLength();return z.getPointAt(B)}x++}return null},tn.getLength=function(){var z=this.getCurveLengths();return z[z.length-1]},tn.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var P,G=[],R=0,q=this.curves.length;for(P=0;q>P;P++)R+=this.curves[P].getLength(),G.push(R);return this.cacheLengths=G,G},tn.getTransformedPoints=function(n){return this.getPoints(n)},tn.getBoundingBox=function(){var s,$,h,L,R,C,H=this.getPoints();s=$=Number.NEGATIVE_INFINITY,L=R=Number.POSITIVE_INFINITY;var a,m,F,A,k=H[0]instanceof Lk;for(A=k?new Lk:new Md,m=0,F=H.length;F>m;m++)a=H[m],a.x>s&&(s=a.x),a.x<L&&(L=a.x),a.y>$&&($=a.y),a.y<R&&(R=a.y),k&&(a.z>h&&(h=a.z),a.z<C&&(C=a.z)),A.add(a);var D={minX:L,minY:R,maxX:s,maxY:$};return k&&(D.maxZ=h,D.minZ=C),D};var fm=function(L){xr.call(this),this.actions=[],L&&this.fromPoints(L)},_g=fm.prototype=qd(xr.prototype),Wh="moveTo",op="lineTo",Kp="quadraticCurveTo",Zk="bezierCurveTo",sn="arc",vi="ellipse";_g.fromPoints=function(j){this.moveTo(j[0].x,j[0].y);for(var R=1,E=j.length;E>R;R++)this.lineTo(j[R].x,j[R].y)},_g.moveTo=function(){var n=Array.prototype.slice.call(arguments);this.actions.push({action:Wh,args:n})},_g.lineTo=function(Y,e){var O=Array.prototype.slice.call(arguments),x=this.actions[this.actions.length-1].args,l=x[x.length-2],A=x[x.length-1],u=new Xm(new Md(l,A),new Md(Y,e));this.curves.push(u),this.actions.push({action:op,args:O})},_g.quadraticCurveTo=function(u,a,C,H){var d=Array.prototype.slice.call(arguments),y=this.actions[this.actions.length-1].args,r=y[y.length-2],N=y[y.length-1],v=new Pc(new Md(r,N),new Md(u,a),new Md(C,H));this.curves.push(v),this.actions.push({action:Kp,args:d})},_g.bezierCurveTo=function(Y,i,L,w,t,g){var B=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,F=r[r.length-2],n=r[r.length-1],K=new Pn(new Md(F,n),new Md(Y,i),new Md(L,w),new Md(t,g));this.curves.push(K),this.actions.push({action:Zk,args:B})},_g.arc=function(C,c,y,S,g,w){var N=this.actions[this.actions.length-1].args,d=N[N.length-2],Y=N[N.length-1];this.absarc(C+d,c+Y,y,S,g,w)},_g.absarc=function($,K,U,b,y,D){this.absellipse($,K,U,U,b,y,D)},_g.ellipse=function(u,O,M,A,$,E,r){var X=this.actions[this.actions.length-1].args,I=X[X.length-2],D=X[X.length-1];this.absellipse(u+I,O+D,M,A,$,E,r)},_g.absellipse=function(U,s,Y,D,_,b,t){var p=Array.prototype.slice.call(arguments),m=new sr(U,s,Y,D,_,b,t);this.curves.push(m);var Q=m.getPoint(1);p.push(Q.x),p.push(Q.y),this.actions.push({action:vi,args:p})},_g.getSpacedPoints=function(S){S||(S=40);for(var i=[],W=0;S>W;W++)i.push(this.getPoint(W/S));return i},_g.getPoints=function(T,c){T=T||12;var $,W,w,Q,d,n,e,v,N,g,A,R,u,l,i,h,q,Y,o=[];for($=0,W=this.actions.length;W>$;$++)switch(w=this.actions[$],Q=w.action,d=w.args,Q){case Wh:o.push(new Md(d[0],d[1]));break;case op:o.push(new Md(d[0],d[1]));break;case Kp:for(n=d[2],e=d[3],g=d[0],A=d[1],o.length>0?(l=o[o.length-1],R=l.x,u=l.y):(l=this.actions[$-1].args,R=l[l.length-2],u=l[l.length-1]),i=1;T>=i;i++)h=i/T,q=Tn.b2(h,R,g,n),Y=Tn.b2(h,u,A,e),o.push(new Md(q,Y));break;case Zk:for(n=d[4],e=d[5],g=d[0],A=d[1],v=d[2],N=d[3],o.length>0?(l=o[o.length-1],R=l.x,u=l.y):(l=this.actions[$-1].args,R=l[l.length-2],u=l[l.length-1]),i=1;T>=i;i++)h=i/T,q=Tn.b3(h,R,g,v,n),Y=Tn.b3(h,u,A,N,e),o.push(new Md(q,Y));break;case sn:var U,j=d[0],Z=d[1],s=d[2],z=d[3],b=d[4],H=!!d[5],f=b-z,p=2*T;for(i=1;p>=i;i++)h=i/p,H||(h=1-h),U=z+h*f,q=j+s*X(U),Y=Z+s*V(U),o.push(new Md(q,Y));break;case vi:var U,j=d[0],Z=d[1],S=d[2],M=d[3],z=d[4],b=d[5],H=!!d[6],f=b-z,p=2*T;for(i=1;p>=i;i++)h=i/p,H||(h=1-h),U=z+h*f,q=j+S*X(U),Y=Z+M*V(U),o.push(new Md(q,Y))}var y,F,k=t["shape3d.point.epsilon"],G=!1;for(W=o.length,$=0,W=o.length;W>$;$++)y=o[$],F=$===W-1?o[0]:o[$+1],y&&F&&D(y.x-F.x)<k&&D(y.y-F.y)<k&&(G=!0,o[$]=null);if(G){var J=[];for($=0;W>$;$++)o[$]&&J.push(o[$]);o=J}return c&&o.push(o[0]),o},_g.toShapes=function(e,t){function r(o){var $,c,O,Q,D,Z=[],p=new fm;for($=0,c=o.length;c>$;$++)O=o[$],D=O.args,Q=O.action,Q==Wh&&0!=p.actions.length&&(Z.push(p),p=new fm),p[Q].apply(p,D);return 0!=p.actions.length&&Z.push(p),Z}function g(l){for(var P=[],s=0,q=l.length;q>s;s++){var F=l[s],$=new db;$.actions=F.actions,$.curves=F.curves,P.push($)}return P}function Y(n,L){for(var A=1e-10,m=L.length,j=!1,O=m-1,Q=0;m>Q;O=Q++){var T=L[O],H=L[Q],V=H.x-T.x,u=H.y-T.y;if(D(u)>A){if(0>u&&(T=L[Q],V=-V,H=L[O],u=-u),n.y<T.y||n.y>H.y)continue;if(n.y==T.y){if(n.x==T.x)return!0}else{var N=u*(n.x-T.x)-V*(n.y-T.y);if(0==N)return!0;if(0>N)continue;j=!j}}else{if(n.y!=T.y)continue;if(H.x<=n.x&&n.x<=T.x||T.x<=n.x&&n.x<=H.x)return!0}}return j}var L=r(this.actions);if(0==L.length)return[];if(t===!0)return g(L);var c,G,_,q=[];if(1==L.length)return G=L[0],_=new db,_.actions=G.actions,_.curves=G.curves,q.push(_),q;var z=!Tn.isClockWise(L[0].getPoints());z=e?!z:z;var N,I=[],J=[],R=[],p=0;J[p]=S,R[p]=[];var l,E;for(l=0,E=L.length;E>l;l++)G=L[l],N=G.getPoints(),c=Tn.isClockWise(N),c=e?!c:c,c?(!z&&J[p]&&p++,J[p]={s:new db,p:N},J[p].s.actions=G.actions,J[p].s.curves=G.curves,z&&p++,R[p]=[]):R[p].push({h:G,p:N[0]});if(!J[0])return g(L);if(J.length>1){for(var v=!1,x=[],u=0,A=J.length;A>u;u++)I[u]=[];for(var u=0,A=J.length;A>u;u++){J[u];for(var d=R[u],a=0;a<d.length;a++){for(var P=d[a],h=!0,w=0;w<J.length;w++)Y(P.p,J[w].p)&&(u!=w&&x.push({froms:u,tos:w,hole:a}),h?(h=!1,I[w].push(P)):v=!0);h&&I[u].push(P)}}x.length>0&&(v||(R=I))}var Q,O,o;for(l=0,E=J.length;E>l;l++)for(_=J[l].s,q.push(_),Q=R[l],O=0,o=Q.length;o>O;O++)_.holes.push(Q[O].h);return q};var db=function(){fm.apply(this,arguments),this.holes=[]},Rr=db.prototype=qd(_g);Rr.getPointsHoles=function(c){var g,h=this.holes.length,_=[];for(g=0;h>g;g++)_[g]=this.holes[g].getTransformedPoints(c);return _},Rr.extractAllPoints=function(Q){return{shape:this.getTransformedPoints(Q),holes:this.getPointsHoles(Q)}},Rr.extractPoints=function(C){return this.extractAllPoints(C)};var Tn={triangulateShape:function(A,x){function _(o,e,q){return o.x!=e.x?o.x<e.x?o.x<=q.x&&q.x<=e.x:e.x<=q.x&&q.x<=o.x:o.y<e.y?o.y<=q.y&&q.y<=e.y:e.y<=q.y&&q.y<=o.y}function s(t,U,$,f,G){var q=1e-10,R=U.x-t.x,V=U.y-t.y,j=f.x-$.x,l=f.y-$.y,N=t.x-$.x,r=t.y-$.y,m=V*j-R*l,F=V*N-R*r;if(D(m)>q){var S;if(m>0){if(0>F||F>m)return[];if(S=l*N-j*r,0>S||S>m)return[]}else{if(F>0||m>F)return[];if(S=l*N-j*r,S>0||m>S)return[]}if(0==S)return!G||0!=F&&F!=m?[t]:[];if(S==m)return!G||0!=F&&F!=m?[U]:[];if(0==F)return[$];if(F==m)return[f];var p=S/m;return[{x:t.x+p*R,y:t.y+p*V}]}if(0!=F||l*N!=j*r)return[];var E=0==R&&0==V,T=0==j&&0==l;if(E&&T)return t.x!=$.x||t.y!=$.y?[]:[t];if(E)return _($,f,t)?[t]:[];if(T)return _(t,U,$)?[$]:[];var A,w,n,i,a,B,h,e;return 0!=R?(t.x<U.x?(A=t,n=t.x,w=U,i=U.x):(A=U,n=U.x,w=t,i=t.x),$.x<f.x?(a=$,h=$.x,B=f,e=f.x):(a=f,h=f.x,B=$,e=$.x)):(t.y<U.y?(A=t,n=t.y,w=U,i=U.y):(A=U,n=U.y,w=t,i=t.y),$.y<f.y?(a=$,h=$.y,B=f,e=f.y):(a=f,h=f.y,B=$,e=$.y)),h>=n?h>i?[]:i==h?G?[]:[a]:e>=i?[a,w]:[a,B]:n>e?[]:n==e?G?[]:[A]:e>=i?[A,w]:[A,B]}function V(X,p,H,P){var G=1e-10,m=p.x-X.x,b=p.y-X.y,n=H.x-X.x,k=H.y-X.y,F=P.x-X.x,Q=P.y-X.y,u=m*k-b*n,t=m*Q-b*F;if(D(u)>G){var E=F*k-Q*n;return u>0?t>=0&&E>=0:t>=0||E>=0}return t>0}function F(K,T){function p(C,P){var z=u.length-1,b=C-1;0>b&&(b=z);var Y=C+1;Y>z&&(Y=0);var v=V(u[C],u[b],u[Y],c[P]);if(!v)return!1;var f=c.length-1,m=P-1;0>m&&(m=f);var B=P+1;return B>f&&(B=0),v=V(c[P],c[m],c[B],u[C]),v?!0:!1}function j(v,H){var h,Y,B;for(h=0;h<u.length;h++)if(Y=h+1,Y%=u.length,B=s(v,H,u[h],u[Y],!0),B.length>0)return!0;return!1}function Y(v,D){var J,B,b,L,o;for(J=0;J<R.length;J++)for(B=T[R[J]],b=0;b<B.length;b++)if(L=b+1,L%=B.length,o=s(v,D,B[b],B[L],!0),o.length>0)return!0;return!1}for(var c,F,n,y,z,E,P,$,q,a,X,u=K.concat(),R=[],k=[],N=0,A=T.length;A>N;N++)R.push(N);for(var D=0,I=2*R.length;R.length>0&&(I--,!(0>I));)for(n=D;n<u.length;n++){y=u[n],F=-1;for(var N=0;N<R.length;N++)if(E=R[N],P=y.x+":"+y.y+":"+E,k[P]===S){c=T[E];for(var f=0;f<c.length;f++)if(z=c[f],p(n,f)&&!j(y,z)&&!Y(y,z)){F=f,R.splice(N,1),$=u.slice(0,n+1),q=u.slice(n),a=c.slice(F),X=c.slice(0,F+1),u=$.concat(a).concat(X).concat(q),D=n;break}if(F>=0)break;k[P]=!0}if(F>=0)break}return u}for(var v,u,n,w,p,c,l={},N=A.concat(),r=0,R=x.length;R>r;r++)Array.prototype.push.apply(N,x[r]);for(v=0,u=N.length;u>v;v++)p=N[v].x+":"+N[v].y,l[p]!==S,l[p]=v;var m=F(A,x),o=kc.Triangulate(m,!1);for(v=0,u=o.length;u>v;v++)for(w=o[v],n=0;3>n;n++)p=w[n].x+":"+w[n].y,c=l[p],c!==S&&(w[n]=c);return o.concat()},isClockWise:function(L){return kc.Triangulate.area(L)<0},b2p0:function(g,v){var j=1-g;return j*j*v},b2p1:function(i,L){return 2*(1-i)*i*L},b2p2:function(F,V){return F*F*V},b2:function(t,I,L,V){return this.b2p0(t,I)+this.b2p1(t,L)+this.b2p2(t,V)},b3p0:function(B,_){var n=1-B;return n*n*n*_},b3p1:function(A,w){var P=1-A;return 3*P*P*A*w},b3p2:function(h,H){var Z=1-h;return 3*Z*h*h*H},b3p3:function(M,n){return M*M*M*n},b3:function(o,U,T,s,w){return this.b3p0(o,U)+this.b3p1(o,T)+this.b3p2(o,s)+this.b3p3(o,w)}},kc={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var x=l.keys(this.faces);return x.length?x[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(N){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(d){var T=d.familyName.toLowerCase(),$=this;return $.faces[T]=$.faces[T]||{},$.faces[T][d.cssFontWeight]=$.faces[T][d.cssFontWeight]||{},$.faces[T][d.cssFontWeight][d.cssFontStyle]=d,d},drawText:function(i){var V,f=this.getFace(),U=this.size/f.resolution,k=0,p=String(i).split(""),j=p.length,$=[];for(V=0;j>V;V++){var h=new fm,r=this.extractGlyphPoints(p[V],f,U,k,h);r&&(k+=r.offset*this.spacing,$.push(r.path))}var u=k/2;return{paths:$,offset:u}},extractGlyphPoints:function(u,d,M,Q,x){var k,U,v,w,p,B,g,y,Y,b,n,O,H,h,C,c,t,f,W,z=[],q=d.glyphs[u]||d.glyphs["?"];if(q){if(q.o)for(w=q._cachedOutline||(q._cachedOutline=q.o.split(" ")),B=w.length,g=M,y=M,k=0;B>k;)switch(p=w[k++]){case"m":Y=w[k++]*g+Q,b=w[k++]*y,x.moveTo(Y,b);break;case"l":Y=w[k++]*g+Q,b=w[k++]*y,x.lineTo(Y,b);break;case"q":if(n=w[k++]*g+Q,O=w[k++]*y,C=w[k++]*g+Q,c=w[k++]*y,x.quadraticCurveTo(C,c,n,O),W=z[z.length-1])for(H=W.x,h=W.y,U=1,v=this.divisions;v>=U;U++){var E=U/v;Tn.b2(E,H,C,n),Tn.b2(E,h,c,O)}break;case"b":if(n=w[k++]*g+Q,O=w[k++]*y,C=w[k++]*g+Q,c=w[k++]*y,t=w[k++]*g+Q,f=w[k++]*y,x.bezierCurveTo(C,c,t,f,n,O),W=z[z.length-1])for(H=W.x,h=W.y,U=1,v=this.divisions;v>=U;U++){var E=U/v;Tn.b3(E,H,C,t,n),Tn.b3(E,h,c,f,O)}}return{offset:q.ha*M,path:x}}}};kc.generateShapes=function(h,i){i=i||{};var R=i.font;if(R===S&&(R=kc.getDefaultFont(),!R))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var P=i.size!==S?i.size:1,T=i.curveSegments!==S?i.curveSegments:4,l=i.spacing!==S?i.spacing:1,y=i.weight!==S?i.weight:"normal",J=i.style!==S?i.style:"normal";kc.size=P,kc.divisions=T,kc.face=R,kc.weight=y,kc.style=J,kc.spacing=l;for(var W=kc.drawText(h),X=W.paths,_=[],V=0,u=X.length;u>V;V++)Array.prototype.push.apply(_,X[V].toShapes());return _},function(p){var O=1e-10,R=function(f,Z){var O=f.length;if(3>O)return null;var x,w,d,E=[],r=[],Y=[];if(H(f)>0)for(w=0;O>w;w++)r[w]=w;else for(w=0;O>w;w++)r[w]=O-1-w;var b=O,k=2*b;for(w=b-1;b>2;){if(k--<=0)return Z?Y:E;if(x=w,x>=b&&(x=0),w=x+1,w>=b&&(w=0),d=w+1,d>=b&&(d=0),J(f,x,w,d,b,r)){var y,_,e,K,q;for(y=r[x],_=r[w],e=r[d],E.push([f[y],f[_],f[e]]),Y.push([r[x],r[w],r[d]]),K=w,q=w+1;b>q;K++,q++)r[K]=r[q];b--,k=2*b}}return Z?Y:E},H=function(R){for(var y=R.length,A=0,K=y-1,S=0;y>S;K=S++)A+=R[K].x*R[S].y-R[S].x*R[K].y;return.5*A},J=function(f,x,e,p,D,u){var E,M,X,P,r,k,w,o,i;if(M=f[u[x]].x,X=f[u[x]].y,P=f[u[e]].x,r=f[u[e]].y,k=f[u[p]].x,w=f[u[p]].y,O>(P-M)*(w-X)-(r-X)*(k-M))return!1;var Z,d,j,C,l,t,z,L,W,c,S,K,y,F,I;for(Z=k-P,d=w-r,j=M-k,C=X-w,l=P-M,t=r-X,E=0;D>E;E++)if(o=f[u[E]].x,i=f[u[E]].y,!(o===M&&i===X||o===P&&i===r||o===k&&i===w)&&(z=o-M,L=i-X,W=o-P,c=i-r,S=o-k,K=i-w,I=Z*c-d*W,y=l*L-t*z,F=j*K-C*S,I>=-O&&F>=-O&&y>=-O))return!1;return!0};return p.Triangulate=R,p.Triangulate.area=H,p}(kc),d._typeface_js={faces:kc.faces,loadFace:kc.loadFace};var ld=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Vo=ld.prototype={constructor:ld,computeFaceNormals:function(){for(var P=new Lk,u=new Lk,X=0,C=this.faces.length;C>X;X++){var l=this.faces[X],W=this.vertices[l.a],A=this.vertices[l.b],Z=this.vertices[l.c];P.subVectors(Z,A),u.subVectors(W,A),P.cross(u),P.normalize(),l.normal.copy(P)}},computeVertexNormals:function(D){var f,L,P,J,M,j;for(j=new Array(this.vertices.length),f=0,L=this.vertices.length;L>f;f++)j[f]=new Lk;if(D){var N,O,a,k=new Lk,U=new Lk;for(P=0,J=this.faces.length;J>P;P++)M=this.faces[P],N=this.vertices[M.a],O=this.vertices[M.b],a=this.vertices[M.c],k.subVectors(a,O),U.subVectors(N,O),k.cross(U),j[M.a].add(k),j[M.b].add(k),j[M.c].add(k)}else for(P=0,J=this.faces.length;J>P;P++)M=this.faces[P],j[M.a].add(M.normal),j[M.b].add(M.normal),j[M.c].add(M.normal);for(f=0,L=this.vertices.length;L>f;f++)j[f].normalize();for(P=0,J=this.faces.length;J>P;P++)M=this.faces[P],M.vertexNormals[0]=j[M.a].clone(),M.vertexNormals[1]=j[M.b].clone(),M.vertexNormals[2]=j[M.c].clone()},mergeVertices:function(){var u,y,p,G,L,c,T,A,i={},F=[],n=[],l=4,M=q(10,l);for(p=0,G=this.vertices.length;G>p;p++)u=this.vertices[p],y=h(u.x*M)+"_"+h(u.y*M)+"_"+h(u.z*M),i[y]===S?(i[y]=p,F.push(this.vertices[p]),n[p]=F.length-1):n[p]=n[i[y]];var m=[];for(p=0,G=this.faces.length;G>p;p++){L=this.faces[p],L.a=n[L.a],L.b=n[L.b],L.c=n[L.c],c=[L.a,L.b,L.c];for(var t=0;3>t;t++)if(c[t]==c[(t+1)%3]){m.push(p);break}}for(p=m.length-1;p>=0;p--){var f=m[p];for(this.faces.splice(f,1),T=0,A=this.faceVertexUvs.length;A>T;T++)this.faceVertexUvs[T].splice(f,1)}var X=this.vertices.length-F.length;return this.vertices=F,X}},sr=function(p,i,x,d,k,_,T){this.aX=p,this.aY=i,this.xRadius=x,this.yRadius=d,this.aStartAngle=k,this.aEndAngle=_,this.aClockwise=T};sr.prototype=qd(ak),sr.prototype.getPoint=function(u){var M,q=this.aEndAngle-this.aStartAngle;0>q&&(q+=j),q>j&&(q-=j),M=this.aClockwise===!0?this.aEndAngle+(1-u)*(j-q):this.aStartAngle+u*q;var b=this.aX+this.xRadius*X(M),G=this.aY+this.yRadius*V(M);return new Md(b,G)};var Xm=function(V,B){this.v1=V,this.v2=B},Lp=Xm.prototype=qd(ak);Lp.getPoint=function(z){var T=this.v2.clone().sub(this.v1);return T.multiplyScalar(z).add(this.v1),T},Lp.getPointAt=function(r){return this.getPoint(r)},Lp.getTangent=function(){var j=this.v2.clone().sub(this.v1);return j.normalize()};var Pc=function(w,Q,S){this.v0=w,this.v1=Q,this.v2=S};Pc.prototype=qd(ak),Pc.prototype.getPoint=function(X){var P,R;return P=Tn.b2(X,this.v0.x,this.v1.x,this.v2.x),R=Tn.b2(X,this.v0.y,this.v1.y,this.v2.y),new Md(P,R)};var Pn=function(k,b,c,h){this.v0=k,this.v1=b,this.v2=c,this.v3=h};Pn.prototype=qd(ak),Pn.prototype.getPoint=function(V){var I,g;return I=Tn.b3(V,this.v0.x,this.v1.x,this.v2.x,this.v3.x),g=Tn.b3(V,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Md(I,g)},Ig.create(function(Y,m){this.v1=Y,this.v2=m},function(R){var K=new Lk;return K.subVectors(this.v2,this.v1),K.multiplyScalar(R),K.add(this.v1),K});var Hh=Ig.create(function(I,$,h){this.v0=I,this.v1=$,this.v2=h},function(T){var L,Y,O;return L=Tn.b2(T,this.v0.x,this.v1.x,this.v2.x),Y=Tn.b2(T,this.v0.y,this.v1.y,this.v2.y),O=Tn.b2(T,this.v0.z,this.v1.z,this.v2.z),new Lk(L,Y,O)}),Sc=Ig.create(function(N,o,S,f){this.v0=N,this.v1=o,this.v2=S,this.v3=f},function(p){var w,T,l;return w=Tn.b3(p,this.v0.x,this.v1.x,this.v2.x,this.v3.x),T=Tn.b3(p,this.v0.y,this.v1.y,this.v2.y,this.v3.y),l=Tn.b3(p,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Lk(w,T,l)}),gg=function(A,g,h,$,u,s,m,c){ld.call(this),$=$!==S?$:.5,u=u!==S?u:.5,c=c!==S?c:1,A=A||8,s=s||0,m=m||j;var F,e,Z=1,J=c/2,L=[],G=[],b=this.vertices,q=this.faces,R=this.faceVertexUvs;for(e=0;Z>=e;e++){var P=[],y=[],U=e/Z,C=U*(u-$)+$;for(F=0;A>=F;F++){var I=F/A,x=new Lk,z=-(I*m+s);x.z=C*V(z),x.y=-U*c+J,x.x=C*X(z),b.push(x),P.push(b.length-1),y.push(new Md(I,U))}L.push(P),G.push(y)}var d,K,N=(u-$)/c;for(F=0;A>F;F++)for(0!==$?(d=b[L[0][F]].clone(),K=b[L[0][F+1]].clone()):(d=b[L[1][F]].clone(),K=b[L[1][F+1]].clone()),d.setY(T(d.x*d.x+d.z*d.z)*N).normalize(),K.setY(T(K.x*K.x+K.z*K.z)*N).normalize(),e=0;Z>e;e++){var O=L[e][F],l=L[e+1][F],Q=L[e+1][F+1],i=L[e][F+1],D=d.clone(),t=d.clone(),r=K.clone(),H=K.clone(),M=G[e][F].clone(),f=G[e+1][F].clone(),E=G[e+1][F+1].clone(),v=G[e][F+1].clone();
q.push(new Oe(O,l,i,[D,t,H])),R[0].push([M,f,v]),q.push(new Oe(l,Q,i,[t.clone(),r,H.clone()])),R[0].push([f.clone(),E,v.clone()])}if(g&&$>0)for(this.vertices.push(new Lk(0,J,0)),F=0;A>F;F++){var O=L[0][F],l=L[0][F+1],Q=this.vertices.length-1,D=new Lk(0,1,0),t=new Lk(0,1,0),r=new Lk(0,1,0),M=G[0][F].clone(),f=G[0][F+1].clone(),E=new Md(f.x,0);q.push(new Oe(O,l,Q,[D,t,r],null,1));var p=F/A*j,w=X(p),o=V(p),k=(F+1)/A*j,a=X(k),n=V(k);R[0].push([new Md(.5+.5*w,.5+.5*o),new Md(.5+.5*a,.5+.5*n),new Md(.5,.5)])}if(h&&u>0)for(this.vertices.push(new Lk(0,-J,0)),F=0;A>F;F++){var O=L[e][F+1],l=L[e][F],Q=b.length-1,D=new Lk(0,-1,0),t=new Lk(0,-1,0),r=new Lk(0,-1,0),M=G[e][F+1].clone(),f=G[e][F].clone();q.push(new Oe(O,l,Q,[D,t,r],null,2));var p=F/A*j,w=X(p),o=V(p),k=(F+1)/A*j,a=X(k),n=V(k);R[0].push([new Md(.5+.5*a,.5-.5*n),new Md(.5+.5*w,.5-.5*o),new Md(.5,.5)])}};gg.prototype=qd(Vo);var Wk=function(B,l,r,c,K,Y,P){ld.call(this),P=P||.5,B=B||16,l=l||16,r=(r!==S?r:0)-s,c=c!==S?c:j,K=K!==S?K:0,Y=Y!==S?Y:s;var d,w,o=[],g=[],T=this.vertices,u=this.faces,e=this.faceVertexUvs;for(w=0;l>=w;w++){var A=[],b=[];for(d=0;B>=d;d++){var R=d/B,Q=w/l,O=new Lk;O.x=-P*X(r+R*c)*V(K+Q*Y),O.y=P*X(K+Q*Y),O.z=P*V(r+R*c)*V(K+Q*Y),T.push(O),A.push(T.length-1),b.push(new Md(R,Q))}o.push(A),g.push(b)}for(w=0;l>w;w++)for(d=0;B>d;d++){var y=o[w][d+1],I=o[w][d],a=o[w+1][d],$=o[w+1][d+1],h=T[y].clone().normalize(),m=T[I].clone().normalize(),E=T[a].clone().normalize(),t=T[$].clone().normalize(),U=g[w][d+1].clone(),H=g[w][d].clone(),Z=g[w+1][d].clone(),_=g[w+1][d+1].clone();D(T[y].y)===P?(U.x=(U.x+H.x)/2,u.push(new Oe(y,a,$,[h,E,t])),e[0].push([U,Z,_])):D(T[a].y)===P?(Z.x=(Z.x+_.x)/2,u.push(new Oe(y,I,a,[h,m,E])),e[0].push([U,H,Z])):(u.push(new Oe(y,I,$,[h,m,t])),e[0].push([U,H,_]),u.push(new Oe(I,a,$,[m.clone(),E,t.clone()])),e[0].push([H.clone(),Z,_.clone()]))}};Wk.prototype=qd(Vo);var Xn=function(k,$,S,K,E,Y){ld.call(this),k=k||.33,$=$||.17,K=K||8,S=S||6,E=E||0,Y=Y||j;for(var o=new Lk,c=[],z=[],_=0;K>=_;_++)for(var M=_/K*j+s,n=0;S>=n;n++){var R=n/S*Y+E;o.x=k*X(R),o.z=-k*V(R);var e=new Lk,t=k+$*X(M);e.x=t*X(R),e.z=-t*V(R),e.y=$*V(M),this.vertices.push(e),c.push(new Md(n/S,1-_/K)),z.push(e.clone().sub(o).normalize())}for(var _=1;K>=_;_++)for(var n=1;S>=n;n++){var N=(S+1)*_+n-1,H=(S+1)*(_-1)+n-1,m=(S+1)*(_-1)+n,b=(S+1)*_+n,G=new Oe(N,H,b,[z[N].clone(),z[H].clone(),z[b].clone()]);this.faces.push(G),this.faceVertexUvs[0].push([c[N].clone(),c[H].clone(),c[b].clone()]),G=new Oe(H,m,b,[z[H].clone(),z[m].clone(),z[b].clone()]),this.faces.push(G),this.faceVertexUvs[0].push([c[H].clone(),c[m].clone(),c[b].clone()])}this.computeFaceNormals()};Xn.prototype=qd(Vo);var oh=function(Z,f,m){return Z?(ld.call(this),Z=Z instanceof Array?Z:[Z],this.addShapeList(Z,f),f.convertYZ!==!1&&yf(this,m),this.computeFaceNormals(),void 0):(Z=[],void 0)},Wj=oh.prototype=qd(ld.prototype);Wj.addShapeList=function(a,Z){for(var u=a.length,w=0;u>w;w++){var h=a[w];this.addShape(h,Z)}},Wj.addShape=function(z,e){function j(){if(e.bottom)for(var w=0;d>w;w++)q=l[w],I(q[2],q[1],q[0],!0);if(e.top)for(w=0;d>w;w++)q=l[w],I(q[0]+V*b,q[1]+V*b,q[2]+V*b,!1)}function N(){var V=0;for(m(G,V),V+=G.length,L=0,h=M.length;h>L;L++)c=M[L],m(c,V),V+=c.length}function m(D,Y){for(var R,I,t=D.length;--t>=0;){R=t,I=t-1,0>I&&(I=D.length-1);var c=0,$=b;for(c=0;$>c;c++){var F=V*c,z=V*(c+1),C=Y+R+F,j=Y+I+F,k=Y+I+z,L=Y+R+z;n(C,j,k,L,D,c,$,R,I)}}}function C(T,O,x){W.vertices.push(new Lk(T,O,x))}function I(M,T,r,H){M+=Y,T+=Y,r+=Y,W.faces.push(new Oe(M,T,r,null,null,H?2:1));var _=H?O.generateBottomUV(W,z,e,M,T,r):O.generateTopUV(W,z,e,M,T,r);W.faceVertexUvs[0].push(_)}function n(p,m,$,f,D,x,I,g,q){p+=Y,m+=Y,$+=Y,f+=Y,W.faces.push(new Oe(p,m,f)),W.faces.push(new Oe(m,$,f));var n=O.generateSideWallUV(W,z,D,e,p,m,$,f,x,I,g,q);W.faceVertexUvs[0].push([n[0],n[1],n[3]]),W.faceVertexUvs[0].push([n[1],n[2],n[3]])}var X,U,$,p,i,A=e.amount,_=e.curveSegments||Rm,b=e.steps||1,t=e.extrudePath,F=!1,O=new Jm(e.repeatUVLength);t&&(X=t.getSpacedPoints(b),F=!0,U=e.frames!==S?e.frames:new fg.FrenetFrames(t,b,!1),$=new Lk,p=new Lk,i=new Lk);var c,L,h,W=this,Y=this.vertices.length,g=z.extractPoints(_),s=g.shape,M=g.holes,J=!Tn.isClockWise(s);if(J){for(s=s.reverse(),L=0,h=M.length;h>L;L++)c=M[L],Tn.isClockWise(c)&&(M[L]=c.reverse());J=!1}var l=Tn.triangulateShape(s,M),G=s;for(L=0,h=M.length;h>L;L++)c=M[L],s=s.concat(c);for(var H,q,V=s.length,d=l.length,k=0;V>k;k++)H=s[k],F?(p.copy(U.normals[0]).multiplyScalar(H.x),$.copy(U.binormals[0]).multiplyScalar(H.y),i.copy(X[0]).add(p).add($),C(i.x,i.y,i.z)):C(H.x,H.y,0);var w;for(w=1;b>=w;w++)for(k=0;V>k;k++)H=s[k],F?(p.copy(U.normals[w]).multiplyScalar(H.x),$.copy(U.binormals[w]).multiplyScalar(H.y),i.copy(X[w]).add(p).add($),C(i.x,i.y,i.z)):C(H.x,H.y,A/b*w);j(),N()};var fg=function(G,x,H,M,b){function W(Q,T,F){return O.vertices.push(new Lk(Q,T,F))-1}ld.call(this),x=x||64,H=H||1,M=M||8,b=b||!1;var $,D,Y,u,U,n,w,c,e,R,J,k,Q,Z,A,L,g,C,E,h,z=[],O=this,r=x+1,y=new Lk,B=new fg.FrenetFrames(G,x,b),d=B.tangents,q=B.normals,o=B.binormals;for(this.tangents=d,this.normals=q,this.binormals=o,e=0;r>e;e++)for(z[e]=[],u=e/(r-1),c=G.getPointAt(u),$=d[e],D=q[e],Y=o[e],R=0;M>R;R++)U=R/M*j,n=-H*X(U),w=H*V(U),y.copy(c),y.x+=n*D.x+w*Y.x,y.y+=n*D.y+w*Y.y,y.z+=n*D.z+w*Y.z,z[e][R]=W(y.x,y.y,y.z);for(e=0;x>e;e++)for(R=0;M>R;R++)J=b?(e+1)%x:e+1,k=(R+1)%M,Q=z[e][R],Z=z[J][R],A=z[J][k],L=z[e][k],g=new Md(e/x,R/M),C=new Md((e+1)/x,R/M),E=new Md((e+1)/x,(R+1)/M),h=new Md(e/x,(R+1)/M),this.faces.push(new Oe(Q,Z,L)),this.faceVertexUvs[0].push([g,C,h]),this.faces.push(new Oe(Z,A,L)),this.faceVertexUvs[0].push([C.clone(),E,h.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};fg.prototype=qd(Vo),fg.FrenetFrames=function(O,E,t){function f(){v[0]=new Lk,Y[0]=new Lk,U=Number.MAX_VALUE,I=D(_[0].x),y=D(_[0].y),n=D(_[0].z),U>=I&&(U=I,l.set(1,0,0)),U>=y&&(U=y,l.set(0,1,0)),U>=n&&l.set(0,0,1),W.crossVectors(_[0],l).normalize(),v[0].crossVectors(_[0],W),Y[0].crossVectors(_[0],v[0])}var M,U,I,y,n,b,S,l=new Lk,_=[],v=[],Y=[],W=new Lk,g=new wl,A=E+1,$=1e-4;for(this.tangents=_,this.normals=v,this.binormals=Y,b=0;A>b;b++)S=b/(A-1),_[b]=O.getTangentAt(S),_[b].normalize();for(f(),b=1;A>b;b++)v[b]=v[b-1].clone(),Y[b]=Y[b-1].clone(),W.crossVectors(_[b-1],_[b]),W.length()>$&&(W.normalize(),M=G(Ud(_[b-1].dot(_[b]),-1,1)),v[b].applyMatrix4(g.makeRotationAxis(W,M))),Y[b].crossVectors(_[b],v[b]);if(t)for(M=G(Ud(v[0].dot(v[A-1]),-1,1)),M/=A-1,_[0].dot(W.crossVectors(v[0],v[A-1]))>0&&(M=-M),b=1;A>b;b++)v[b].applyMatrix4(g.makeRotationAxis(_[b],M*b)),Y[b].crossVectors(_[b],v[b])};var lc=function(N,u,f,e){ld.call(this),u=u||18,f=f||0,e=e==o?j:e;for(var W=1/(N.length-1),c=1/u,x=0,D=u;D>=x;x++)for(var w=f+x*c*e,b=X(w),r=V(w),M=0,Z=N.length;Z>M;M++){var d=N[M],F=new Lk;F.x=b*d.x-r*d.y,F.y=r*d.x+b*d.y,F.z=d.z,this.vertices.push(F)}for(var g=N.length,x=0,D=u;D>x;x++)for(var M=0,Z=N.length-1;Z>M;M++){var i=M+g*x,q=i,G=i+g,b=i+1+g,l=i+1,O=x*c,s=M*W,h=O+c,y=s+W;this.faces.push(new Oe(q,l,G)),this.faceVertexUvs[0].push([new Md(O,s),new Md(O,y),new Md(h,s)]),this.faces.push(new Oe(G,l,b)),this.faceVertexUvs[0].push([new Md(h,s),new Md(O,y),new Md(h,y)])}this.mergeVertices(),yf(this),this.computeFaceNormals(),this.computeVertexNormals()};lc.prototype=qd(Vo);var mj=function(Q,O){O=O||{};var r=kc.generateShapes(Q,O);O.amount=O.amount!==S?O.amount:.5,O.convertYZ=!1,O.fill!==!1&&(O.bottom=!0,O.top=!0),oh.call(this,r,O)};mj.prototype=qd(Wj);var Rd=E.Node=function(){ii(Rd,this)},Wp={X:Fe,Y:Gb,Z:Tf},od={X:0,Y:1,Z:2},id={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},jg="xzy",Gh=function(D,o,S){if(o){var Z=o[0],E=o[1],N=o[2];"xzy"===S?(Gb(D,E),Tf(D,N),Fe(D,Z)):"xyz"===S?(Tf(D,N),Gb(D,E),Fe(D,Z)):"yxz"===S?(Tf(D,N),Fe(D,Z),Gb(D,E)):"yzx"===S?(Fe(D,Z),Tf(D,N),Gb(D,E)):"zxy"===S?(Gb(D,E),Fe(D,Z),Tf(D,N)):"zyx"===S?(Fe(D,Z),Gb(D,E),Tf(D,N)):(Gb(D,E),Tf(D,N),Fe(D,Z))}};Eb("Node",Xd,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:jg,_64O:0,_rotationX:0,_53O:0,_host:o,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Bk},_22Q:function(){return eb},getX:function(){return this.p().x},setX:function(E){this.p(E,this.p().y)},getY:function(){return this.p().y},setY:function(Q){this.p(this.p().x,Q)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(m){this.setAnchor(m,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(t){this.setAnchor(this.getAnchor().x,t)},getScaleX:function(){return this.getScale().x},setScaleX:function(T){this.setScale(T,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(Q){this.setScale(this.getScale().x,Q)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(B,N){Mr(B,si(o,o,this.r3(),this.getRotationMode())),this.translate3d(B[0]*N,B[1]*N,B[2]*N)},translateFront:function(M){this.translate3dBy([0,0,1],M)},translateBack:function(g){this.translate3dBy([0,0,-1],g)},translateLeft:function(v){this.translate3dBy([-1,0,0],v)},translateRight:function(X){this.translate3dBy([1,0,0],X)},translateTop:function(n){this.translate3dBy([0,1,0],n)},translateBottom:function(i){this.translate3dBy([0,-1,0],i)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(J,I,h){1===arguments.length&&(I=J[1],h=J[2],J=J[0]),this.p(J,h),this.setElevation(I)},translate3d:function(J,m,t){1===arguments.length&&(m=J[1],t=J[2],J=J[0]),this.translate(J,t),this.setElevation(this._54O+m)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(U,J,t){1===arguments.length&&(J=U[1],t=U[2],U=U[0]),this.setSize(U,t),this.setTall(J)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(r,l,o){1===arguments.length&&(l=r[1],o=r[2],r=r[0]),this.setRotationX(r),this.setRotation(-l),this.setRotationZ(o)},setRotationY:function(m){this.setRotation(-m)},getRotationY:function(){return-this._64O},lookAtDirection:function(C,j){j=j||ph;var b=this,Y=Qm(C);j===ph?(b.r3([-R(C[1]/Y),-g(C[2],C[0])+v,0]),b.setRotationMode("xzy")):j===zn?(b.r3(0,-g(C[2],C[0]),R(C[1]/Y)),b.setRotationMode("zyx")):j===Ec?(b.r3(0,-g(C[2],C[0])+s,-R(C[1]/Y)),b.setRotationMode("zyx")):j===md?(b.r3([-R(C[1]/Y)+v,-g(C[2],C[0])+v,0]),b.setRotationMode("xzy")):j===Il&&(b.r3([-R(C[1]/Y)-v,-g(C[2],C[0])+v,0]),b.setRotationMode("xzy")),j===Ic&&(b.r3([-R(C[1]/Y)+s,-g(C[2],C[0])+v,s]),b.setRotationMode("zxy"))},lookAt:function(p,c){return this.lookAtDirection(Ni(p,this.p3()),c)},lookAtX:function(){var R=new Of,I=new Of,L=new Of,s=new Me,m=new Me,c=new Dd;return function(X,Q){var M=Hi(this);if(s.fromArray(M),L.copy(this.p3()),R.copy(X).sub(L),!(R.lengthSq()<1e-6)){R.normalize(),Q===ph?I.set(0,0,1):Q===Ic?I.set(0,0,-1):Q===Ec?I.set(-1,0,0):Q===zn?I.set(1,0,0):Q===md?I.set(0,1,0):Q===Il&&I.set(0,-1,0),I.applyMatrix4(s).sub(L).normalize();var i=Math.acos(R.dot(I));if(i){var z=R.clone().cross(I);z.lengthSq()<1e-6&&(Q===md||Q===Il?z.set(0,0,1).applyMatrix4(s).sub(L):z.set(0,1,0).applyMatrix4(s).sub(L)),z.normalize(),c.set(this.r3(),this.getRotationMode(),!0),s.makeRotationFromEuler(c),m.makeRotationAxis(z,-i),c.setFromRotationMatrix(m.multiply(s)),this.r3([c.x,c.y,c.z])}}}}(),getHost:function(){return this._host},setHost:function(N){var H=this;if(H!==N&&H._host!==N){var o=H._host;o&&o._removeAttach(H),H._host=N,H._host&&H._host._addAttach(H),H.fp("host",o,N),H.onHostChanged(o,N)}},getAttaches:function(){return this._69O},_addAttach:function(L){var B=this;B._69O||(B._69O=new Fj),B._69O.add(L),B.fp("attaches",o,L)},_removeAttach:function(h){var D=this;D._69O.remove(h),D._69O.isEmpty()&&delete D._69O,D.fp("attaches",h,o)},getImage:function(){if(this._pendingCheckImageJSON){var z=N.getImage(this._image);z&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof Sf&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(p){var a=this,O=a._image,i=a.getWidth(),h=a.getHeight();a._image=p,a.fp("image",O,p)&&(null!=p&&(uq(p)||rb(p)&&/\.json$/i.test(p))&&(this._pendingCheckImageJSON=!0),a.fp(Ij,i,a.getWidth()),a.fp(hk,h,a.getHeight()))},getElevation:function(){return this._54O},setElevation:function(_){var C=this;if(!C._50O){C._50O=1;var l=C._54O;C._54O=_,C.fp(Kc,l,_),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(c){var r=this;if(!r._49O){r._49O=1;var $=r._64O;r._64O=c,r.fp(Bb,$,c),delete r._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(U){var j=this;if(!j._51O){j._51O=1;var C=j._rotationX;j._rotationX=U,j.fp("rotationX",C,U),delete j._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(a){var Y=this;if(!Y._52O){Y._52O=1;var q=Y._53O;Y._53O=a,Y.fp("rotationZ",q,a),delete Y._52O}},getPosition:function(){return this._position},setPosition:function(M,O){var o=this;if(!o._50I){o._50I=1;var m;if(m=2===arguments.length?{x:M,y:O}:M,m.x!==o._position.x||m.y!==o._position.y){var S=o._position;o._position=m,o.fp(ie,S,m)}delete o._50I}},translate:function(e,U){var z=this._position;this.p(z.x+e,z.y+U)},getWidth:function(){var o=this;if(o._width>=0)return o._width;var h=o.getStyle("shape3d");if(h){var J=Sn(h);if(J&&J.rawS3)return J.rawS3[0];if("billboard"===h||"plane"===h){var u=ng(o.getStyle("shape3d.image"));return u?rr(u,o):20}}var u=ng(o._image);return u?rr(u,o):20},setWidth:function(s){var K=this,_=K._width;K._width=s,K.fp(Ij,_,s)},getHeight:function(){var r=this;if(r._height>=0)return r._height;var B=r.getStyle("shape3d");if(B){var D=Sn(B);if(D&&D.rawS3)return D.rawS3[2];if("plane"===B){var E=ng(r.getStyle("shape3d.image"));return E?cc(E,r):20}if("billboard"===B)return 2}var E=ng(r._image);return E?cc(E,r):20},setHeight:function(M){var t=this,R=t._height;t._height=M,t.fp(hk,R,M)},getTall:function(){var q=this;if(q._tall>=0)return q._tall;var z=q.getStyle("shape3d");if(z){var U=Sn(z);if(U&&U.rawS3)return U.rawS3[1];if("billboard"===z){var s=ng(q.getStyle("shape3d.image"));return s?cc(s,q):20}if("plane"===z)return 2}return 20},setTall:function(G){var m=this,t=m._tall;m._tall=G,m.fp("tall",t,G)},setSize:function(T,Z){var o=this;2===arguments.length?(o.setWidth(T),o.setHeight(Z)):(o.setWidth(T.width),o.setHeight(T.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(s,d,Y,m,o){var p=this,K=p.getAnchor(),y=p.getScale();arguments.length<=2&&(o=d,d=s.y,Y=s.width,m=s.height,s=s.x);var w=o&&y.x<0?1-K.x:K.x,J=o&&y.y<0?1-K.y:K.y;p.p(s+Y*w,d+m*J),o&&(Y/=Math.abs(y.x),m/=Math.abs(y.y)),p.setWidth(Y),p.setHeight(m)},getMatrix:function(){var l=this,k=l._64O,s=l._position,I=l.getScale();return new bm(k,s.x,s.y,I.x,I.y)},getAnchorRect:function(){var o=this,c=o.getWidth(),X=o.getHeight(),L=o.getAnchor();return{x:-c*L.x,y:-X*L.y,width:c,height:X}},toLocal:function(M){return this.getMatrix().tfi(M)},toGlobal:function(R){return this.getMatrix().tf(R)},getAttachPosition:function(){var Y=new bm;return function(F,X,K,H){K=K||0,H=H||0;var m=this,Z=m.getAnchor(),V=m._64O,c=m._position,D=m.getScale();return Y.setFromTransform(V,c.x,c.y).tf({x:K+D.x*m.getWidth()*(F-Z.x),y:H+D.y*m.getHeight()*(X-Z.y)})}}(),isInRect:function(h){h=this.toLocal(h);var F=this.getWidth(),n=this.getHeight();return h.x+=F*this.getAnchorX(),h.y+=n*this.getAnchorY(),!(h.x<0||h.y<0||h.x>F||h.y>n)},getRect:function(){var O=this,Z=O.getWidth(),m=O.getHeight(),i=O.getAnchor(),V={x:-Z*i.x,y:-m*i.y,width:Z,height:m},H=O.getMatrix();return V=uh([H.tf(V.x,V.y),H.tf(V.x+V.width,V.y),H.tf(V.x+V.width,V.y+V.height),H.tf(V.x,V.y+V.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var x=this,T=x.getAnchor(),q=x._anchorElevation;return{x:T.x,y:q,z:T.y}},setAnchorElevation:function(r){var L=this,m=L._anchorElevation;return m!==r?(L._anchorElevation=r,L.fp("anchorElevation",m,r),!0):!1},setAnchor3d:function(L,Z,O,k){var R,g=this;"number"==typeof L?R={x:L,y:Z,z:O}:(R=L.length?{x:L[0],y:L[1],z:L[2]}:L,k=Z);var N=g.getDataModel();N&&N.beginTransaction();var D=g.getAnchor3d(),$=g.setAnchor(R.x,R.z);if(g.setAnchorElevation(R.y)&&($=!0),$&&k&&!cn){g.getAnchor3d();var U=Hi(g),d=Mr([R.x-D.x,R.y-D.y,R.z-D.z],U);g.p3(d)}return N&&N.endTransaction(),$},getAnchor:function(){var B=this;if(B.hasOwnProperty("_anchor"))return B._anchor;var M=ng(B._image);return M&&M.anchorX!==S?{x:M.anchorX,y:M.anchorY}:B._anchor},setAnchor:function(t,B,s){var x,l=this;"number"==typeof t?x={x:t,y:B}:(x=t.length?{x:t[0],y:t[1]}:t,s=B);var T=l.getAnchor();if(T.x!==x.x||T.y!==x.y){var d=l.getDataModel();if(d&&d.beginTransaction(),l._anchor=x,l.fp("anchor",T,x),s&&!cn){var i=l.getPosition(),e=l.getSize(),F=l.getRotation(),G=l.getScale(),P=-e.width*(T.x-x.x)*G.x,K=-e.height*(T.y-x.y)*G.y,k=V(F),S=X(F);l.setPosition(i.x+S*P-k*K,i.y+k*P+S*K)}return d&&d.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(e,u){var q,f=this;q=2===arguments.length?{x:e,y:u}:e;var d=f.getScale();(d.x!==q.x||d.y!==q.y)&&(f._scale=q,f.fp("scale",d,q))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var P=this,G=P._scaleTall,S=P.getScale();return[S.x,G,S.y]},getFinalScale3d:function(){var c=this,g=c.s3(),D=c._dynamicScale3d,y=c.getScale3d();return g&&(y[0]*=g[0],y[1]*=g[1],y[2]*=g[2]),D&&(y[0]*=D[0],y[1]*=D[1],y[2]*=D[2]),y},getFinalRotation3d:function(){var i=this;return i._dynamicRotation||i.r3()},setScaleTall:function(h){var A=this,F=A._scaleTall;F!==h&&(A._scaleTall=h,A.fp("scaleTall",F,h))},setScale3d:function(k,j,s){var H,$=this;H="number"==typeof k?{x:k,y:j,z:s}:k.length?{x:k[0],y:k[1],z:k[2]}:k,$.setScaleTall(H.y),$.setScale(H.x,H.z)},getCorners:function(m,D){m==o&&(m=0),D==o&&(D=m);var $=this,B=$.getAnchor(),v=$.getWidth(),i=$.getHeight(),E=-v*B.x-m,R=-i*B.y-D,S=v+2*m,J=i+2*D,I=$.getMatrix();return[I.tf(E,R),I.tf(E,R+J),I.tf(E+S,R+J),I.tf(E+S,R)]},getEditControlPoints:function(c,m,S){m==o&&(m=0),S==o&&(S=m);var H=this,F=H.getAnchor(),J=H.getWidth(),U=H.getHeight(),C=-J*F.x-m,t=-U*F.y-S,D=J+2*m,p=U+2*S;if(c)return[{x:C,y:t},{x:C,y:0},{x:C,y:t+p},{x:0,y:t+p},{x:C+D,y:t+p},{x:C+D,y:0},{x:C+D,y:t},{x:0,y:t}];var M=H.getMatrix();return[M.tf(C,t),M.tf(C,0),M.tf(C,t+p),M.tf(0,t+p),M.tf(C+D,t+p),M.tf(C+D,0),M.tf(C+D,t),M.tf(0,t)]},rotateAt:function(k,S,F){var M=this,q=M._position,s=M._64O,m=new bm(s,q.x,q.y).tf(k,S),i=T(k*k+S*S),H=g(q.y-m.y,q.x-m.x)+F;M.setRotation(s+F),M.p(m.x+i*X(H),m.y+i*V(H))},onParentChanged:function(){Rd.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var q={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(T){q[T]=!0}),function(e){var m=this;Rd.superClass.onPropertyChanged.call(m,e),q[e.property]&&!m._layoutUpdating&&m.updateLayoutParameters(null,e.property),m._69O&&m._69O.each(function(O){O.handleHostPropertyChange(e)}),m._49I&&m._49I.each(function(k){k.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(S){this.updateAttach(S)},onStyleChanged:function(r){Rd.superClass.onStyleChanged.apply(this,arguments),Kl[r]&&this.updateAttach()},updateAttach:function(Q){var v=this;return cn?(v.updateLayoutParameters(),void 0):(v._51I||(v._51I=1,v._71O(Q),delete v._51I),void 0)},_71O:function(r){var U,z,I,C,T,M,h=this,H=h._host,V=r?r.property:o,q=r?r.oldValue:o,w=r?r.newValue:o;if(H instanceof E.Grid){if(V===Kc)h.setElevation(h._54O+w-q);else if(!r||wb[V]){if(U=h.s("attach.row.index"),z=h.s("attach.column.index"),I=H.getCellRect(U,z),!I)return;C=h.s("attach.row.span"),T=h.s("attach.column.span"),(1!==C||1!==T)&&(I=ym(I,H.getCellRect(U+C-1,z+T-1))),ko(I,h,"attach.padding",1),h.setRect(I)}}else if(H instanceof rd&&(M=h.s("attach.index"))>=0&&(!r||oj[V])){var _=h.s("attach.thickness");_!=o&&h.setHeight(H.getThickness()*_);var m=h.s("attach.offset"),d=H.getPoints(),k=d.size();if(k>M){var D=d.get(M),B=k===M+1?d.get(0):d.get(M+1),O=[B.x-D.x,B.y-D.y],G=Qm(O);if(G){h.s("attach.offset.relative")&&(m*=G),h.s("attach.offset.opposite")&&(m=G-m);var Z={x:D.x+O[0]/G*m,y:D.y+O[1]/G*m},S=h.s("attach.gap");S&&(h.s("attach.gap.relative")&&(S*=H.getThickness()),Z=Fk(o,Z,B,S)),h.p(Z),h.setRotation(g(O[1],O[0]))}}}else r&&(V===ie?h.translate(w.x-q.x,w.y-q.y):V===Kc?h.setElevation(h._54O+w-q):Vg[V]?h._11Q(H,V,w-q):("anchor"===V||"width"===V||"height"===V||"scale"===V)&&h.layout(H))},_11Q:function(){var V=new E.Math.Euler,S=E.Math.Euler.ReverseOrder,O=new E.Math.Vector2,Y=new E.Math.Vector2;return function(y,U,m){var j=this,T=y.p3(),A=y.r3(),e=j.p3(),r=j.r3();if(U===Bb&&(U="rotationY",m=-m),(U===Bb||"rotationY"===U)&&0===r[0]&&0===r[2]&&0===A[0]&&0===A[2]&&0===e[1]&&0===T[1])return j.setRotation(-r[1]-m),O.set(e[0],e[2]).rotateAround(Y.set(T[0],T[2]),-m),j.p(O.x,O.y),void 0;var K=id[y.getRotationMode()],v=K[0],E=K[1],W=K[2],I=Wp[v],D=Wp[E],f=Wp[W],X=wo();U===Bb+v?(f(X,A[od[W]]),D(X,A[od[E]]),I(X,m),D(X,-A[od[E]]),f(X,-A[od[W]])):U===Bb+E?(f(X,A[od[W]]),D(X,m),f(X,-A[od[W]])):U===Bb+W&&f(X,m);var c=Ni(e,T);Mr(c,X),j.p3(T[0]+c[0],T[1]+c[1],T[2]+c[2]);var l=j.getRotationMode();Gh(X,j.r3(),l),V.setFromRotationMatrix(X,S(l)),j.r3([V.x,V.y,V.z])}}(),isHostOn:function(D){var A=this;if(A._host&&D&&D._69O)for(var M={},q=A._host;q&&q!==A&&!M[q._id];){if(q===D)return!0;M[q._id]=q,q=q._host}return!1},isLoopedHostOn:function(u){return this.isHostOn(u)&&u.isHostOn(this)},getScaledSize:function(){var w=this.getSize(),G=this.getScale();return w.width*=Math.abs(G.x),w.height*=Math.abs(G.y),w},layout:function(a){if(a=a||this.getHost()){var y=this,X=y.s("layout.h")||"center",U=y.s("layout.v")||"center";if("center"!==X||"center"!==U){var A=new E.Math.Vector2,K=a.getPosition(),e=a.getAnchor(),p=a.getScaledSize();y.getPosition();var q,f,v,x,H,t=1,B=1;switch(y._layoutUpdating=!0,X){case"left":A.setX(y._layoutHValue-e.x*p.width);break;case"right":A.setX((1-e.x)*p.width-y._layoutHValue);break;case"leftright":q=p.width-y._layoutHValue[2],v=y.getRotation()-a.getRotation(),x=Math.abs(Math.sin(v)),H=Math.abs(Math.cos(v)),t+=H*q/y._layoutHValue[3],B+=x*q/y._layoutHValue[4],A.setX(y._layoutHValue[1]+(y._layoutHValue[5]-e.x)*p.width);break;case"center":A.setX((.5-e.x)*p.width-y._layoutHValue);break;case"scale":v=y.getRotation()-a.getRotation(),x=Math.abs(Math.sin(v)),H=Math.abs(Math.cos(v)),A.setX((.5-e.x)*p.width-y._layoutHValue[1]*p.width/y._layoutHValue[0]),f=p.width/y._layoutHValue[2]-1,t+=H*f,B+=x*f}switch(U){case"top":A.setY(y._layoutVValue-e.y*p.height);break;case"bottom":A.setY((1-e.y)*p.height-y._layoutVValue);break;case"topbottom":v||(v=y.getRotation()-a.getRotation(),x=Math.abs(Math.sin(v)),H=Math.abs(Math.cos(v))),q=p.height-y._layoutVValue[2],t+=x*q/y._layoutVValue[3],B+=H*q/y._layoutVValue[4],A.setY(y._layoutVValue[1]+(y._layoutVValue[5]-e.y)*p.height);break;case"center":A.setY((.5-e.y)*p.height-y._layoutVValue);break;case"scale":v||(v=y.getRotation()-a.getRotation(),x=Math.abs(Math.sin(v)),H=Math.abs(Math.cos(v))),A.setY((.5-e.y)*p.height-y._layoutVValue[1]*p.height/y._layoutVValue[0]),f=p.height/y._layoutVValue[2]-1,t+=x*f,B+=H*f}if("leftright"===X||"scale"===X||"topbottom"===U||"scale"===U){var Z=this.getScale(),V=Math.abs(Z.x),O=Math.abs(Z.y);"leftright"===X||"scale"===X?y.setSize(y._layoutHValue[3]*t/V,y._layoutHValue[4]*B/O):y.setSize(y._layoutVValue[3]*t/V,y._layoutVValue[4]*B/O)}A.rotateAround(null,a.getRotation()),this.setPosition(A.x+K.x,A.y+K.y),y._layoutUpdating=S}}},updateLayoutParameters:function(j,m){if(j=j||this.getHost()){var z=this,H=z.s("layout.h"),U=z.s("layout.v");if(H||U){var V,w,v,N,r,n,e=new E.Math.Vector2,Y=j.getPosition(),a=j.getAnchor(),t=j.getScaledSize(),J=z.getPosition(),x=z.getScaledSize();switch(e.set(J.x-Y.x,J.y-Y.y),e.rotateAround(null,-j.getRotation()),H){case"left":z._layoutHValue=e.x+a.x*t.width;break;case"right":z._layoutHValue=-e.x+(1-a.x)*t.width;break;case"center":z._layoutHValue=-e.x+(.5-a.x)*t.width;break;case"leftright":case"scale":"scale"===H?V=-e.x+(.5-a.x)*t.width:(w=z.getAnchor(),v=z.getRotation()-j.getRotation(),N=Math.cos(v),r=Math.sin(v),n=-Math.min(-w.x*N+w.y*r,-w.x*N-(1-w.y)*r,(1-w.x)*N+w.y*r,(1-w.x)*N-(1-w.y)*r),V=e.x-(n-a.x)*t.width),"position"===m&&"object"==typeof z._layoutHValue?(z._layoutHValue[0]=t.width,z._layoutHValue[1]=V):z._layoutHValue=[t.width,V,t.width,x.width,x.height,n]}switch(U){case"top":z._layoutVValue=e.y+a.y*t.height;break;case"bottom":z._layoutVValue=-e.y+(1-a.y)*t.height;break;case"center":z._layoutVValue=-e.y+(.5-a.y)*t.height;break;case"topbottom":case"scale":"scale"===U?V=-e.y+(.5-a.y)*t.height:(v||(w=z.getAnchor(),v=z.getRotation()-j.getRotation(),N=Math.cos(v),r=Math.sin(v)),n=-Math.min(-w.x*r-w.y*N,-w.x*r+(1-w.y)*N,(1-w.x)*r-w.y*N,(1-w.x)*r+(1-w.y)*N),V=e.y-(n-a.y)*t.height),"position"===m&&"object"==typeof z._layoutVValue?(z._layoutVValue[0]=t.height,z._layoutVValue[1]=V):z._layoutVValue=[t.height,V,t.height,x.width,x.height,n]}}}},getSerializableProperties:function(){var Y=Rd.superClass.getSerializableProperties.call(this);return vq(Y,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),Y}});var Gm=E.Edge=function(C,$){var h=this;ii(Gm,h),h.setSource(C),h.setTarget($)};Eb("Edge",Xd,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Ul},_22Q:function(){return Ql},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(s){if(s===this)return!1;if(Sl(s))return!0;for(var g,E,G,$,j,a=[this],z=-1,F=0;F>z;)if(z++,g=a[z],E=g._44I)for(E=E.getArray(),$=0,j=E.length;j>$;$++)if(G=E[$],Ej(G)&&!(a.indexOf(G)>=0)){if(G===s)return!1;a.push(G),F++}return!0},setSource:function(V){var D=this;if(D._source!==V&&D.canSetSourceTarget(V)){var R=D._source;D._source=V,R&&R._16I(D),V&&V._2I(D),D._7I(),D.fp("source",R,V)}},setTarget:function(x){var _=this;if(_._target!==x&&_.canSetSourceTarget(x)){var g=_._target;_._target=x,g&&g._18I(_),x&&x._4I(_),_._7I(),_.fp("target",g,x)}},isLooped:function(){var b=this;return b._source===b._target&&Sl(b._source)&&Sl(b._target)},onPropertyChanged:function(){var Z=this;Z._49I&&Z._49I.each(function(u){u.fp("agentChange",!0,!1)})},_7I:function(){var y,d=this,P=ok(d);d._40I!==P&&(y=this._40I,y&&y._15I(d),d._40I=P,P&&P._1I(d),d.fp("sourceAgent",y,P),xd(y,d._41I),xd(P,d._41I));var c=fp(d);d._41I!==c&&(y=d._41I,y&&y._17I(d),d._41I=c,c&&c._3I(d),d.fp("targetAgent",y,c),xd(y,d._40I),xd(c,d._40I))},_22I:function(b){this._52I=b,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var v=this;return v._52I&&v._52I.get(0)!==v&&!v.getStyle(Vh)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var u=this,V=u._52I;return V&&!u.getStyle(Vh)&&V.size()>1&&u===V.get(0)},toggle:function(){var $=this._52I,t=!this.s(Vh);$&&$.size()>1&&($.each(function(K){K.s(Vh,t)}),$.getSiblings().each(function(U){U!==$&&U.each(function(F){F.fp("edgeGroup",o,U)})}))},setStyle:function(l,a){(l===Mo||"edge.segments"===l)&&(a=Ai(a)),Gm.superClass.setStyle.call(this,l,a)},onStyleChanged:function(N){Gm.superClass.onStyleChanged.apply(this,arguments),fn[N]&&xd(this._41I,this._40I)},getSerializableProperties:function(){var q=Gm.superClass.getSerializableProperties.call(this);return vq(q,{source:1,target:1}),q}});var Oq=E.Group=function(){ii(Oq,this)};Eb("Group",Rd,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return Rk},onChildAdded:function(){Oq.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Oq.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var D=this;if(!D._54I&&!cn){var T=D.getChildrenRect();T&&(D._53I=1,D.p(Hq(D.s("group.position"),T,D.getSize())),delete D._53I)}},getChildrenRect:function(){var n,s=this;return s.eachChild(function(w){Sl(w)&&(n=ym(n,s.getChildRect(w)))}),n},getChildRect:function(h){var T;return Sl(h)&&h.s(ei)&&(sj(h)&&h.isExpanded()&&h.eachChild(function(n){T=ym(T,h.getChildRect(n))}),!T&&h.getRect&&(T=h.getRect())),T},setPosition:function(R,Q){var B=this;if(!B._54I){var Z;Z=2===arguments.length?{x:R,y:Q}:R,cn||B._53I||(B._54I=1,Yh(B._children,Z.x-B._position.x,Z.y-B._position.y),delete B._54I),Oq.superClass.setPosition.call(this,Z)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(B){var t=this;if(t._57O!==B){var Q=t._57O;t._57O=B,t.fp("expanded",Q,t._57O),t._fireInvalidateDeep(),t._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(_){sj(_)?_._fireInvalidateDeep():_.iv()})},_8I:function(){Oq.superClass._8I.call(this),this.eachChild(function(j){Sl(j)&&j._8I()})},onStyleChanged:function(j){Oq.superClass.onStyleChanged.apply(this,arguments),"group.position"===j&&this._81I()},getSerializableProperties:function(){var i=Oq.superClass.getSerializableProperties.call(this);return i.expanded=1,i}});var zm=E.Block=function(){ii(zm,this)};Eb("Block",Rd,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return bf},onChildAdded:function(){zm.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){zm.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var l=this;if(!cn&&!l._updatingToChildren&&l._syncSize&&!l._freezeSyncFromChildren){var z,g,F,Y,v,J=[],e=l.getRotation();if(l.eachChild(function(C){Sl(C)&&J.push.apply(J,C.getCorners())}),J.length){l._updatingFromChildren=1;var C=X(-e),$=V(-e),N=1/0,H=-1/0,m=1/0,h=-1/0;for(Y=0,v=J.length;v>Y;Y++)F=J[Y],z=F.x,g=F.y,F.x=C*z-$*g,F.y=$*z+C*g,N=Q(N,F.x),H=r(H,F.x),m=Q(m,F.y),h=r(h,F.y);var I=l.getScale();l.setSize(D((H-N)/I.x),D((h-m)/I.y));var q;I.x<0&&(q=N,N=H,H=q),I.y<0&&(q=m,m=h,h=q),C=X(e),$=V(e);var p=l.getAnchor();z=N+(H-N)*p.x,g=m+(h-m)*p.y,l.setPosition(C*z-$*g,$*z+C*g),delete l._updatingFromChildren}}},setPosition:function(X,s){var A=this;if(!A._updatingToChildren){var U;U=2===arguments.length?{x:X,y:s}:X,cn||A._updatingFromChildren||(A._updatingToChildren=1,Yh(A._children,U.x-A._position.x,U.y-A._position.y),delete A._updatingToChildren),zm.superClass.setPosition.call(this,U)}},setWidth:function(C){return this.setSize(C,this.getHeight())},setHeight:function(r){return this.setSize(this.getWidth(),r)},setSize:function(F,l){1>F&&(F=1),1>l&&(l=1);var P=this;if(!P._updatingToChildren){2!==arguments.length&&(l=F.height,F=F.width);var o=P.getWidth(),X=P.getHeight();if(F!==o&&zm.superClass.setWidth.call(P,F),l!==X&&zm.superClass.setHeight.call(P,l),!cn&&!P._updatingFromChildren){P._updatingToChildren=1;var b=F/o,j=l/X;P._adjustChildScaleOrSize(b,j,"size"),delete P._updatingToChildren,P.updateFromChildren()}}},_adjustChildScaleOrSize:function(B,$,P){var T=this;if(T._syncSize){var A=T.getPosition(),q=T.getRotation();T.getScale(),T.eachChild(function(s){if(Sl(s)){var r=s.getPosition(),N=s.getRotation(),R=s.getWidth(),F=s.getHeight(),T=s.getScale(),n=T.x*R,J=T.y*F,S=new bm(N,r.x,r.y,n,J);S.translate(-A.x,-A.y),S.rotate(-q),N=g(S.b*Math.sign(n),S.a*Math.sign(n)),S.scale(B,$);var O,y,D,h=X(N);if(Math.abs(h)<.001?(O=V(N),y=S.b/O,D=-S.c/O):(y=S.a/h,D=S.d/h),"scale"===P)s.setScale(y/R,D/F);
else if("size"===P){var k=y/T.x,I=D/T.y;s.setScale(Co(y)*Math.abs(T.x),Co(D)*Math.abs(T.y)),s instanceof E.Shape?(s.setWidthForce(Math.max(Math.abs(k),1e-5)),s.setHeightForce(Math.max(Math.abs(I),1e-5))):s.setSize(Math.max(.01,Math.abs(k)),Math.max(.01,Math.abs(I)))}S.rotate(q),S.translate(A.x,A.y),s.setPosition(S.tx,S.ty)}})}},_calcChangeFactor:function(y,n,M,l){var i,L,a,K;return i=D(y),L=D(M),a=i>L?i/L:L/i,i=D(n),L=D(l),K=i>L?i/L:L/i,r(a,K)},setAnchor:function(){var t=this;if(!t._updatingToChildren){var a=t.getAnchor();if(zm.superClass.setAnchor.apply(t,arguments),!cn&&!t._updatingFromChildren&&t._syncSize){t._updatingToChildren=1;var m=t.getAnchor();t.getPosition();var f=t.getSize(),M=t.getScale(),Q=t.getRotation(),r=-f.width*M.x*(a.x-m.x),d=-f.height*M.y*(a.y-m.y),B=V(Q),J=X(Q),e=J*r-B*d,x=B*r+J*d;t.eachChild(function(q){if(Sl(q)){var C=q.getPosition();q.setPosition(C.x-e,C.y-x)}}),delete t._updatingToChildren}}},setRotation:function(O){var q=this;if(!q._updatingToChildren){var l=q.getRotation();if(zm.superClass.setRotation.apply(q,arguments),!cn&&!q._updatingFromChildren){q._updatingToChildren=1;var p=q.getPosition(),o=O-l;q.eachChild(function(h){if(Sl(h)){var q=h.getMatrix();q.translate(-p.x,-p.y),q.rotate(o),q.translate(p.x,p.y);var s=Math.sign(h.getScale().x);h.setRotation(g(q.b*s,q.a*s)),h.setPosition(q.tx,q.ty)}}),delete q._updatingToChildren}}},setScale:function(C,k){var Z=this;if(!Z._updatingToChildren){null==k&&(k=C.y,C=C.x);var m=Z.getScale();if(D(C)<.01&&(C=.01*(Co(C)||Co(m.x))),D(k)<.01&&(k=.01*(Co(k)||Co(m.y))),zm.superClass.setScale.call(Z,C,k),!cn&&!Z._updatingFromChildren){Z._updatingToChildren=1;var I=C/m.x,f=k/m.y;Z._adjustChildScaleOrSize(I,f,"size"),delete Z._updatingToChildren,Z.updateFromChildren()}}},getSerializableProperties:function(){var c=zm.superClass.getSerializableProperties.call(this);return c.clickThroughEnabled=1,c.syncSize=1,c}});var bk=E.Grid=function(){ii(E.Grid,this)};Eb("Grid",Rd,{IRotatable:!1,_icon:"grid_icon",_image:o,getUIClass:function(){return Jf},setRotation:function(){},getCellRect:function(Y,$){var n=this,y=n.s("grid.row.count"),_=n.s("grid.column.count");if(0>=y||0>=_||0>Y||Y>=y||0>$||$>=_)return o;var R,w,P,I=n.getRect(),N=n.s("grid.row.percents"),S=n.s("grid.column.percents");if(ko(I,n,"grid.border",-1),N&&N._as&&(N=N._as),S&&S._as&&(S=S._as),N&&N.length===y){for(P=0,R=0;Y>R;R++)P+=I.height*N[R];I.y+=P,I.height=I.height*N[Y]}else I.height=I.height/y,I.y+=I.height*Y;if(S&&S.length===_){for(w=0,R=0;$>R;R++)w+=I.width*S[R];I.x+=w,I.width=I.width*S[$]}else I.width=I.width/_,I.x+=I.width*$;return me(I,-n.s("grid.gap")),I}});var yl=E.Text=function(){ii(yl,this),this.setSize(100,50),this.s("text","TEXT")};Eb("Text",Rd,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Pr},setWidth:function(V){V||(V=.001),yl.superClass.setWidth.call(this,V)},setHeight:function(A){A||(A=.001),yl.superClass.setHeight.call(this,A)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Dq("__text__",{width:{value:100,isSafeFunc:!0,func:function($){return $._width}},height:{value:50,isSafeFunc:!0,func:function(C){return C._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var rd=E.Shape=function(){ii(rd,this),this._59O=new Fj};rd.__de__=Sk,Eb("Shape",Rd,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return uc},_22Q:function(){return vr},getLength:function(A){return hh(Qc(this._59O,this._58O,A,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var w=this._58O;return w?new Fj(w._as.slice(0)):w},setSegments:function(T){var w=this._58O;T=T?Si(T)?new Fj(T.slice(0)):new Fj(T._as.slice(0)):null,(w&&T&&w._as.join(",")!==T._as.join(",")||w!==T)&&(this._58O=T,this.fp("segments",w,T))},getPoints:function(){return this._59O},toPoints:function(){var X=this._59O;return new Fj(X._as.slice(0))},setPoints:function(t,c){var e=this,r=e._59O;t=t?Si(t)?new Fj(t.slice(0)):new Fj(t._as.slice(0)):new Fj;var M,x,p,A,T,V;c&&(M=e.getPosition(),V=new bm(e.getRotation(),0,0,e.getScale().x,e.getScale().y)),(r&&t&&r._as.join(",")!==t._as.join(",")||r!==t)&&(e._59O=t,e.fs(),e.fp("points",r,t)),c&&(x=e.getPosition(),p=x.x-M.x,A=x.y-M.y,T=V.tf(p,A),e.setPosition(x.x-p+T.x,x.y-A+T.y))},addPoint:function(o,f,H){var a=this.toPoints();a.add(o,f),this.setPoints(a,H)},setPoint:function(o,S,H){var x=this.toPoints();x.set(o,S),this.setPoints(x,H)},removePointAt:function(O){var y=this.toPoints();y.removeAt(O),this.setPoints(y)},setWidthForce:function(w){var R=this;if(!R._55I&&!cn&&R.getWidth()){R._55I=1;var J=R._position.x,o=w/R.getWidth(),v=R.toPoints(),M=new Fj;1!==o&&(v.each(function(z){M.add({x:(z.x-J)*o+J,y:z.y,e:z.e})}),R.setPoints(M),Hf(R,[o,0,0,1,J*(1-o),0]),R.fs()),delete R._55I}rd.superClass.setWidth.call(R,w)},setWidth:function(p){return this.setWidthForce(1>p?1:p)},setHeightForce:function(_){var v=this;if(!v._55I&&!cn&&v.getHeight()){v._55I=1;var Q=v._position.y,o=_/v.getHeight(),n=v.toPoints(),g=new Fj;1!==o&&(n.each(function(E){g.add({x:E.x,y:(E.y-Q)*o+Q,e:E.e})}),v.setPoints(g),Hf(v,[1,0,0,o,0,Q*(1-o)]),v.fs()),delete v._55I}rd.superClass.setHeight.call(v,_)},setHeight:function(y){return this.setHeightForce(1>y?1:y)},setAnchorElevation:function(H){var y=this;y._55I=!0;var B=y._updatingAnchor3d,u=!cn&&!B;if(u){var N,Q=H,J=y.getAnchorElevation(),i=y.getTall();N=i*(J-Q),0!==N&&y.shiftPointsElevation(N)}var U=rd.superClass.setAnchorElevation.apply(y,arguments);return B||delete y._55I,U},getShapeElevation:function(){var A=this,E=A._54O;return E-(A.getTall()||0)*(A._anchorElevation-.5)},setAnchor3d:function(T,l,O,w){var H,X=this;"number"==typeof T?H={x:T,y:l,z:O}:(H=T.length?{x:T[0],y:T[1],z:T[2]}:T,w=l),X._55I=!0,X._updatingAnchor3d=!0;var i=X.getDataModel();if(i&&i.beginTransaction(),!cn){var G=X.getAnchor3d(),f=X.getSize(),s=X.getTall(),W=f.width*(G.x-H.x),n=f.height*(G.z-H.z),S=s*(G.y-H.y);w||X.shiftPoints(W,n,S);var x=X.p3()}var K=rd.superClass.setAnchor3d.apply(X,arguments);if(!cn&&w){var J=X.p3();X.shiftPoints(J[0]-x[0]+W,J[2]-x[2]+n,J[1]-x[1]+S)}return i&&i.endTransaction(),delete X._updatingAnchor3d,delete X._55I,K},setAnchor:function(R,r,A){var G=this;G._55I=!0;var c=G._updatingAnchor3d,F=!cn&&!c;if(F){var q,J,N;"number"==typeof R?N={x:R,y:r}:(N=R.length?{x:R[0],y:R[1]}:R,A=r);var Z=G.getAnchor(),I=G.getSize();q=I.width*(Z.x-N.x),J=I.height*(Z.y-N.y),A||G.shiftPoints(q,J);var K=G.getPosition()}var B=rd.superClass.setAnchor.apply(G,arguments);if(F){var s=G.getPosition();A&&G.shiftPoints(s.x-K.x+q,s.y-K.y+J)}return c||delete G._55I,B},shiftPoints:function(j,g,R){if(j||g||R){var c=this,q=c.getElevation()||0,A=c.toPoints(),Q=new Fj;A.each(function(P){var y=P.e;R&&(y=(y==o?q:y)+R),Q.add({x:P.x+j,y:P.y+g,e:y})}),c.setPoints(Q),c.fs()}},shiftPointsElevation:function(u){return this.shiftPoints(0,0,u)},setPosition:function(h,E){var l,r=this;if(!r._28Q){if(r._28Q=1,!r._55I&&!cn){l=2===arguments.length?{x:h,y:E}:h;var F=l.x-r._position.x,e=l.y-r._position.y;if(0===F&&0===e)return delete r._28Q,void 0;r._55I=1,r.shiftPoints(F,e),Hf(r,[1,0,0,1,F,e]),delete r._55I}rd.superClass.setPosition.apply(r,arguments),delete r._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var I=this;if(2!==I._59O.size())return!1;var T=I._58O;return T?2===T.size()&&1===T.get(0)&&2===T.get(1)?!0:!1:!0},fireShapeChange:function(){var v=this;if(!v._55I&&!cn){var S=uh(v._59O);S&&(v._55I=1,v.setRect(S),delete v._55I)}v.fp(Fl,!1,!0)},getSerializableProperties:function(){var Q=rd.superClass.getSerializableProperties.call(this);return Q.segments=1,Q.points=1,Q.thickness=1,Q.closePath=1,Q}});var Zn=E.Polyline=function(){ii(Zn,this),this.s({"shape.background":null,"shape.border.width":2})};Eb("Polyline",rd,{_icon:"polyline_icon",_22Q:function(){return pd},getUIClass:function(){return pc},setClosePath:function(){},setTall:function(P){var H=this,U=H.getDataModel();if(U&&U.beginTransaction(),!H._55I&&!H._24Q&&!cn&&H.getTall()){H._24Q=1;var e=H._54O,A=P/H.getTall();if(1!==A){var l=H.toPoints(),s=new Fj;l.each(function(V){s.add({x:V.x,y:V.y,e:V.e==o?V.e:(V.e-e)*A+e})}),H.setPoints(s),H.fs()}delete H._24Q}Zn.superClass.setTall.call(H,P),U&&U.endTransaction()},setElevation:function(j){var g=this,f=g.getDataModel();if(f&&f.beginTransaction(),!g._55I&&!g._24Q&&!cn){g._24Q=1;var N=j-g._54O;0!==N&&g.shiftPointsElevation(N),delete g._24Q}Zn.superClass.setElevation.apply(g,arguments),f&&f.endTransaction()},fireShapeChange:function(){var E=this,g=E._59O;if(!E._55I&&!E._24Q&&!cn){var $=g.size();if($){var O=1,n=g.get(0),x=E._54O;n.e==o&&(n.e=x);for(var V=n.e,X=0;$>O;O++){n=g.get(O),n.e==o&&(n.e=x);var C=Q(V,n.e),c=r(V+X,n.e);V=C,X=c-C}E._24Q=1,E.setTall(X),E.setElevation(V+X*E._anchorElevation),delete E._24Q}}Zn.superClass.fireShapeChange.apply(E,arguments)}});var Gj=E.SubGraph=function(){ii(Gj,this)};Eb("SubGraph",Rd,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Gj.superClass._8I.call(this),this.eachChild(function(J){Sl(J)&&J._8I()})}}),N.loadingRefGraph=0;var Sf=E.RefGraph=function(){ii(Sf,this)};Eb("RefGraph",zm,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(Y){var z=this._ref;this._ref=Y,this.fp("ref",z,Y),this.updateRef()},_21I:function(){Sf.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var B=this;if(N.loadingRefGraph++,B.clearChildrenFromDataModel(),N.loadingRefGraph--,B._ref&&B._dataModel){B._xhrLoadHandler&&(B._xhrLoadHandler.cancel=!0);var m=cn,b=B._xhrLoadHandler=function(P){if(P&&B._dataModel){N.loadingRefGraph++;var S=B._pendingUpdateInfo={needToRestore:m};m&&(S.position=B.p(),S.width=B.getWidth(),S.height=B.getHeight(),S.rotation=B.getRotation(),S.anchor=B.getAnchor(),S.scale=B.getScale()),B.p(0,0),B.setAnchor(.5,.5),B.setRotation(0),B.setScale(1,1);var d=N.parse(P),l=B._dataModel.deserialize(d,B,{justDatas:!0});l.each(function(N){N._refGraph=B}),B.checkPendingUpdateInfo(),N.loadingRefGraph--,N.handleRefGraphLoaded(B,l,d)}};b.xhrLoadCalled=!1,N.load(B._ref,function(H){b.cancel||(b.xhrLoadCalled?b(H):Rg(function(){b(H)}))}),b.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var d=this,H=d._pendingUpdateInfo;if(!H)return d.onPendingUpdated&&(N.loadingRefGraph++,d.onPendingUpdated(),N.loadingRefGraph--),void 0;var o=!0;this.eachChild(function(x){(x._pendingCheckImageJSON||x._pendingUpdateInfo)&&(o=!1)}),o&&(N.loadingRefGraph++,d._pendingUpdateInfo=null,d.updateFromChildren(),H.needToRestore&&(d.setSize(H.width,H.height),d.setAnchor(H.anchor),d.setRotation(H.rotation),d.setScale(H.scale),d.p(H.position)),this.getParent()instanceof Sf&&this.getParent().checkPendingUpdateInfo(),d.onPendingUpdated&&d.onPendingUpdated(),N.loadingRefGraph--)},getSerializableProperties:function(){var Q=Sf.superClass.getSerializableProperties.call(this);return Q.ref=1,Q}}),E.EdgeGroup=function($,w){this._70O=$,this._siblings=w;for(var R,x,p=0,X=$.size(),O=t[Vh];X>p;p++)if(R=$.get(p).getStyle(Vh,!1),R!=o){O=R;break}O==o&&(O=!0);var a=N.edgeGroupAgentFunc;for(a&&(x=a($),x&&x!==$.get(0)&&($.remove(x),$.add(x,0))),p=0;X>p;p++)$.get(p).s(Vh,O)},Eb("EdgeGroup",l,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(W){return this._70O.get(W)},indexOf:function(d){return this._70O.indexOf(d)},each:function(U,E){this._70O.each(U,E)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(_,K){this._siblings.each(function(m){m._70O.each(_,K)})}});var dn=function(V,D,E){var b=Dl[V]={type:V,action:D};if(E)for(var f in E)b[f]=E[f]};vq(N,{setConnectAction:dn,getConnectAction:function(l,O){if(!O){if(!l)return null;O=l.getCurrentConnectActionType()}return Dl[O]},doConnectAction:function(u,M,X,_){_=_||u.getCurrentConnectActionType();var Z=Dl[_];if(!Z)return!1;var d=Z.action;return d?(M instanceof Nl.Group?u.sm().getSelection().each(function(p){d.call(null,u,p,X)}):d.call(null,u,M,X),!0):!1},doDeleteConnectionAction:function(u,G,F){F=F||u.getCurrentConnectActionType();var $=Dl[F];if(!$||!$.delete)return!1;var I=$.delete.action;return I?(G instanceof Nl.Group?u.sm().getSelection().each(function(z){I.call(null,u,z)}):I.call(null,u,G),!0):!1}});var $f=E.JSONSerializer=function(F,k){this.dm=this._dataModel=F,this._hierarchical=N.forceHierarchicalSerialization?!0:k==o?F.isHierarchicalRendering():k};Eb("JSONSerializer",l,{ms_ac:["hierarchical"],serialize:function(B){return N.stringify(this.toJSON(),B)},toJSON:function(){var b=this,r=b.dm,Y=r.getRoots(),h=b.json={v:N.getVersion(),p:{},a:{},d:[]},D=r.getSerializableAttrs();r.getInit()&&(h.init=r.getInit()),r.getName()&&(h.p.name=r.getName()),r.getBackground()&&(h.p.background=r.getBackground()),r.getLayers()&&(h.p.layers=r.getLayers()),r.getEnvmap()&&(h.p.envmap=r.getEnvmap()),h.p.autoAdjustIndex=r.isAutoAdjustIndex(),h.p.hierarchicalRendering=r.isHierarchicalRendering();for(var E in D){var J=r.a(E);J!==S&&b[jh](E,J,h.a)}return de(h.a)&&delete h.a,b._hierarchical?Y.each(b.serializeData,this):r.each(function($){b.serializeData($)}),r.fireSerializeEvent({type:"serialize",json:h}),r.getPostProcessingData()&&(h.p.postProcessingData=r.getPostProcessingData()),h},isSerializable:function(){return!0},getProperties:function(h){return h.getSerializableProperties()},getStyles:function(r){return r.getSerializableStyles()},getAttrs:function(T){return T.getSerializableAttrs()},serializeData:function(T){var g=this;if(g.isSerializable(T)&&!T._refGraph){var i,R,K,W,L=kn(T.getClassName())||T.getClass(),d=new L,r={c:T.getClassName(),i:T.getId(),p:{},s:{},a:{}};g.json.d.push(r),i=g.getProperties(T);for(R in i)if(/^_/.test(R)){if(K=T[R],!("_width"!==R&&"_height"!==R||K!=o&&-1!==K)){var H;((T.s("layout.h")||T.s("layout.v"))&&T.getHost()||T instanceof E.Node&&(H=T.getParent())&&H instanceof E.Block||T.s("fullscreen"))&&(K=T[R]="_width"===R?T.getWidth():T.getHeight())}K!==d[R]&&g[jh](R.substr(1),K,r.p)}else W=Vr(R),T[W]&&(K=T[W](),K!==d[W]()&&g[jh](R,K,r.p));i=g.getStyles(T);for(R in i)K=T.s(R),K!==d.s(R)&&g[jh](R,K,r.s);i=g.getAttrs(T);for(R in i)K=T.a(R),K!==d.a(R)&&g[jh](R,K,r.a);de(r.p)&&delete r.p,de(r.s)&&delete r.s,de(r.a)&&delete r.a}g._hierarchical&&T.getChildren().each(g.serializeData,g)},serializeValue:function(q,c,x){oc(c)?c={__a:c._as}:c instanceof Xd&&(c={__i:c.getId()}),x[q]=c},deserialize:function(F,W,P){var Q=this;return rb(F)&&/.json$/.test(F)?(N.xhrLoad(F,function(o){Q.deserializeImpl(o,W,P)}),void 0):Q.deserializeImpl(F,W,P)},deserializeImpl:function(v,k,B){var O=this,U=O.dm;B=Vd(B)?{setId:B}:fd(B)?{finishFunc:B}:B||{},v=O.json=rb(v)?N.parse(v):v,v.a&&v.a.onPreDeserialize&&!B.disableOnPreDeserialize&&v.a.onPreDeserialize(v,U,B.view),U.beginTransaction(),cn++,O._82I={};var M=new Fj,t=new Fj,Y=0,j=v.d.length;if(B.justDatas||(fd(v.init)&&v.init(U),U.setInit(v.init)),!B.justDatas){for(var c in v.a)U.a(c,O[vl](v.a[c]));for(var d in v.p)U[In(d)](v.p[d])}for(;j>Y;Y++){var i=v.d[Y],q=kn(i.c),R=new q,a=i.i;B.setId&&a!=o&&(R._id=a),O._82I[a]=R,M.add(R),t.add(i)}for(Y=0;j>Y;Y++)O.deserializeData(M.get(Y),t.get(Y));return M.each(function(v){k&&!v.getParent()&&v.setParent(k),U.add(v)}),U.fireSerializeEvent({type:"deserialize",json:v}),cn--,U.endTransaction(),v.a&&v.a.onPostDeserialize&&!B.disableOnPostDeserialize&&v.a.onPostDeserialize(v,U,B.view,M),B.finishFunc&&B.finishFunc(v,U,B.view,M),M},deserializeData:function(y,_){for(var O in _.p)y[In(O)](this[vl](_.p[O]));for(O in _.s)y.s(O,this[vl](_.s[O]));for(O in _.a)y.a(O,this[vl](_.a[O]))},deserializeValue:function(Q){if(uq(Q)){var B=Q.__i;if(B!=o)return this._82I[B];if(B=Q.__a,Si(B))return new Fj(B)}return Q}}),vq(gm,{serialize:function(A,H){return new $f(this,H).serialize(A)},toJSON:function(z){return new $f(this,z).toJSON()},deserialize:function(q,d,V){return new $f(this).deserialize(q,d,V)}});var Qd=E.OverlappingBox=function(b){this.gv=b,this.boxes={}};Eb("OverlappingBox",l,{clear:function(){var k,h,y=this.boxes;for(k in y)h=y[k],h.length=0},isOverlapping:function(o,a){var l,r,L=this,X=L.boxes,y=X[o];y?(l=y.rects,r=y.length):y=X[o]={rects:l=[],length:r=0};var i,p,a;for(i=0;r>i;i++)if(p=l[i],p.x<a.x+a.w&&p.x+p.w>a.x&&p.y<a.y+a.h&&p.h+p.y>a.y)return!0;return l.length<=r?(l.push(a),y.length++):l[y.length++]=a,!1}}),vq(N,{fetch:function(h,d){var P="GET",s=!1,I=null,v="";d&&(P=d.method||"GET",s=d.sync,v=d.url,I=d.data||null),h.open(P,v,!s),d.responseType?h.responseType=d.responseType:d.overrideMimeType&&h.overrideMimeType&&h.overrideMimeType(d.overrideMimeType),h.send(I)},convertImageSrc:function(V,_){_&&"function"==typeof _||(_=function(){}),_(V)}});var nk=E.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Eb("Request",l,{_responseType:null,_overrideMimeType:"text/plain",send:function(M){var D=this._xhr,j=this.onload,I=this.onerror;this.getResponseType()?M.responseType=this.getResponseType():this.getOverrideMimeType()&&(M.overrideMimeType=this.getOverrideMimeType()),D.onload=j,D.onerror=I,N.fetch(D,M)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(R){this._responseType=R},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(X){this._overrideMimeType=X},getResponseText:function(){var w=this._xhr;return w.response||w.responseText}}),Mb.GraphView=function(s){var V=this;V._24I={},V._34I=new Fj,V._25I={},V._56I={},V._view=kb(1,V),V._canvas=ib(V._view),V.dm(s?s:new gm),this._coreInteractor=new Ir(this),V.setEditable(!1),V.setScrollBarVisible(N.graphViewScrollBarVisible)},Tq("GraphView",l,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[kj,ge,wh,jo,"resettable","editInteractor",Oc,"zoomable","pannable","rectSelectable","autoScrollZone",ll,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:N.graphViewZoomable,_resettable:N.graphViewResettable,_pannable:N.graphViewPannable,_rectSelectable:N.graphViewRectSelectable,_autoScrollZone:N.graphViewAutoScrollZone,_rectSelectBackground:N.graphViewRectSelectBackground,_rectSelectBorderColor:N.graphViewRectSelectBorderColor,_editPointSize:N.graphViewEditPointSize,_editPointBorderColor:N.graphViewEditPointBorderColor,_editPointBackground:N.graphViewEditPointBackground,_scrollBarColor:cl,_scrollBarSize:xl,_autoHideScrollBar:$d,_autoMakeVisible:Ip,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(x){this._dataModel.setLayers(x)},setEditable:function(l){var X=this,D=X.__interactorMap__;if(!D){var m=Mb.XEditInteractor;D=X.__interactorMap__={scrollBar:new wq(X),select:new bp(X),edit:m?new m(X):new kd(X),text:new Yp(X),move:new Lf(X),"default":new mq(X),touch:new ml(X,{editable:!1})}}l?(X._uieditable=!0,X.setInteractors([D.scrollBar,D.select,D.edit,D.text,D.move,D.default,D.touch])):(X._uieditable=!1,X.setInteractors([D.scrollBar,D.select,D.move,D.default,D.touch]))},getCanvas:function(){return this._canvas},_33I:function(p){var h=p.getUIClass();return h?new h(this,p):o},getDataUI:function(z){var o=this,g=o._25I[z._id];return g===S&&(g=o._33I(z),o._25I[z._id]=g),g},getNodeRect:function(_){return N.getNodeRect(this,_)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(X){var S=this.getDataUI(X);return S?(S._79o(),S._78o):null},getEdgeSourcePosition:function(M){var c=this,K=c.getDataUI(M),l=K.s,E=K._data._40I;return Kq(c,E,l("edge.source.position"),l("edge.source.offset.x"),l("edge.source.offset.y"),l("edge.source.anchor.x"),l("edge.source.anchor.y"))},getEdgeTargetPosition:function(w){var f=this,j=f.getDataUI(w),S=j.s,T=j._data._41I;return Kq(f,T,S("edge.target.position"),S("edge.target.offset.x"),S("edge.target.offset.y"),S("edge.target.anchor.x"),S("edge.target.anchor.y"))},invalidateAll:function(W){var X=this;if(W){for(var v in X._25I){var Z=X._25I[v];Z&&Z.dispose()}X._25I={},X._56I={},X._24I={},X._34I.clear(),X.redraw()}else X.dm().each(function(c){X.invalidateData(c)})},invalidateSelection:function(){var m=this;m.sm().each(function(T){m.invalidateData(T)})},invalidateData:function(z){var n=this;n._24I[z._id]=z,n._21Q(z),n.iv()},_21Q:function(C){var s=this,A=s._24I;if(Ej(C)&&dp[C.s(os)]){var m=C.getSourceAgent();m&&m.getAgentEdges().each(function(m){A[m._id]=m}),m=C.getTargetAgent(),m&&m.getAgentEdges().each(function(N){A[N._id]=N}),s.iv()}},redraw:function(A){var Z=this;Z._32I||(A?Z._34I.add(A):(Z._32I=1,Z._34I.clear()),Z.iv())},each:function(B,U){var r,p,G,a=0,y=this.getLayers(),P=this._dataModel,k=P._datas._as,f=k.length;if(y){for(var d=y.length;d>a;a++)if(G=y[a],uq(G)&&(G=G.name),P.isHierarchicalRendering()){var D=function(R){return R._layer===G?U?B.call(U,R):B(R):void 0};if(this._dataModel.eachByHierarchical(D)===!1)return}else for(var x=0;f>x;x++)if(r=k[x],r._layer===G&&(p=U?B.call(U,r):B(r),p===!1))return}else if(P.isHierarchicalRendering())this._dataModel.eachByHierarchical(B,null,U);else for(;f>a;a++)if(r=k[a],p=U?B.call(U,r):B(r),p===!1)return},reverseEach:function(v,$){var g,s,j,n,c=this._dataModel,T=c._layers,P=c._datas._as,M=P.length;if(T){for(g=T.length-1;g>=0;g--)if(n=T[g],uq(n)&&(n=n.name),c.isHierarchicalRendering()){var A=function(s){return s._layer===n?$?v.call($,s):v(s):void 0};if(c.reverseEachByHierarchical(A)===!1)return}else for(var o=M-1;o>=0;o--)if(s=P[o],s._layer===n&&(j=$?v.call($,s):v(s),j===!1))return}else if(c.isHierarchicalRendering())c.reverseEachByHierarchical(v,null,$);else for(g=M-1;g>=0;g--)if(s=P[g],j=$?v.call($,s):v(s),j===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var c=this,H=c._84I;if(!H){var d=this.dm().a("width"),O=this.dm().a("height");d>0&&O>0?c._84I={x:0,y:0,width:d,height:O}:(c.each(function(j){c.isVisible(j)&&(H=ym(H,c.getDataUIBounds(j)))}),c._84I=H?H:qb)}return c._84I},getScrollRect:function(){return ym(this.getContentRect(),this._29I)},makeCenter:function(x,P,Y){var k=this;if(!k.getWidth()||!k.getHeight())return Y||Rg(k.makeCenter,k,[x,P,!0],500),void 0;k.makeVisible(x),k.validate();var j=k.getDataUIBounds(x);if(j){var v=k.getWidth(),J=k.getHeight(),r=j.x+j.width/2,i=j.y+j.height/2,O=-r*k._zoom+v/2,u=-i*k._zoom+J/2;k.setTranslate(O,u,P)}},fitData:function(P,d,l,O,t){var r=this;if(!r.getWidth()||!r.getHeight())return t||Rg(r.fitData,r,[P,d,l,O,!0],500),void 0;var f=function(){r.makeVisible(P),r.validate();var z=r.getDataUIBounds(P);z&&(z=rj(z),me(z,l==o?20:l),r.fitRect(z,d,O))};d?N.callWhenLoaded(f):f()},fitContent:function(P,U,D,Y){var r=this;if(!r.getWidth()||!r.getHeight())return Y||Rg(r.fitContent,r,[P,U,D,!0],500),void 0;var b=function(){r.validate();var K=rj(r.getContentRect());me(K,U==o?20:U),r.fitRect(K,P,D)};P?N.callWhenLoaded(b):b()},fitRect:function(C,$,v){var Y=this,X=Y.getWidth(),p=Y.getHeight(),S=C.x+C.width/2,L=C.y+C.height/2,t=Q(X/C.width,p/C.height),R=Y._zoom,N=-S*R+X/2,r=-L*R+p/2;0===t||isNaN(t)||(v&&(t=Q(1,t)),$?(Y._65I&&(delete Y._65I.finishFunc,Y._65I.stop(!0)),Y._14o&&Y._14o.stop(!0),Y.setTranslate(N,r,{finishFunc:function(){Y.setZoom(t,$)}})):(Y.setTranslate(N,r),Y.setZoom(t)))},toCanvas:function(E,u){u=u||this._zoom,this.validateImpl();var F=this,q=F.getContentRect();q.width||(q.width=10),q.height||(q.height=10);var N=ib(),a=q.x*u,p=q.y*u,M=q.width*u,T=q.height*u;km(N,M,T,1);var O=Vn(N);return E=E||this._dataModel.getBackground(),E&&xe(O,0,0,M,T,E),te(O,-a,-p),O.scale(u,u),F._42(O),O.restore(),N},toDataURL:function(u,g,b){return this.toCanvas(u,b).toDataURL(g||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(z,Z){var K=this,k=K.dm().getBackground();if(k){var $=K.dm().a("width"),X=K.dm().a("height");$>0&&X>0&&xe(z,0,0,$,X,k)}var b=K.__htmlOrderList,W=[];if(K._93db(z,Z),K.each(function(q){var R=K.getDataUI(q);if(R){var O=K._56I[q._id],g=R._htmlView;if(O){var J=R._79o();if(g=R._htmlView,E.HtmlNode&&q instanceof E.HtmlNode)R._42(z);else{var P=K.getViewRect(),I=g&&g.layoutHTML;!Z||xk(Z,J)?(I&&(g.layoutHTML(),R.__outerLayout&&delete R.__outerLayout),R._42(z)):xk(P,J)||!I||R.__outerLayout||(g.layoutHTML(),R.__outerLayout=!0)}}g&&(W.push(g),g.getView&&(g=g.getView()),g.style.display=O?"block":hg)}}),b&&W.length>0){var m=!1;if(b.length!==W.length)m=!0;else for(var G=0;G<W.length;G++)if(W[G]!==b[G]){m=!0;break}m&&(W.forEach(function(m){m.autoAdjustIndex!==!1&&K.appendHTML(m,!0)}),this.__htmlOrderList=W)}else this.__htmlOrderList=W;K._92db(z,Z)},validateImpl:function(){this.tryUpdateRootData();var w,S,x,y,A,F=this,J=F.tx(),z=F.ty(),Q=F._zoom,_=F._canvas,c=this.getWidth(),M=this.getHeight(),V=F._29I,a={x:-J/Q,y:-z/Q,width:c/Q,height:M/Q},b={},X=F._34I,v=F._24I,s=F._32I,n=F._23I;F._24I={},(c!==_.clientWidth||M!==_.clientHeight)&&(km(_,c,M),s=1),s||Tl(a,V)||(s=1),F._29I=a,F.each(function(j){S=j._id;var R=b[S]=F.isVisible(j);R!==F._56I[S]&&(v[S]=j,x=F.getDataUI(v[S]),x&&x._84o(R),F._84o(j,R))},F);for(S in v)x=F.getDataUI(v[S]),x&&(!s&&F._56I[S]&&(A=x._79o(),A&&X.add(A)),x.invalidate()),F._83I=1;if(F._56I=b,!s)for(S in v)b[S]&&(x=F.getDataUI(v[S]),x&&(A=x._79o(),A&&X.add(A)));if(s?y=a:(X.each(function(x){xk(a,x)&&(y=ym(y,x))}),y&&(me(y,r(1,1/Q)),y.x=P(y.x*Q)/Q,y.y=P(y.y*Q)/Q,y.width=Z(y.width*Q)/Q,y.height=Z(y.height*Q)/Q,y=Ak(a,y))),F._74O=y,y){w=Vn(_);var $=y.x,D=y.y,R=y.width,L=y.height;$=Math.floor(($*Q+J)*bq),D=Math.floor((D*Q+z)*bq),R=Math.ceil(R*Q*bq)+1,L=Math.ceil(L*Q*bq)+1,s||(y.x=($/bq-J)/Q,y.y=(D/bq-z)/Q,y.width=R/bq/Q,y.height=L/bq/Q),w.beginPath(),w.rect($,D,R,L),w.clip(),w.clearRect($,D,R,L),yr(w,J,z,Q),F._42(w,y),w.restore(),delete F._74O}if(X.clear(),delete F._32I,n&&c>0&&M>0){var x=F.getDataUI(n);if(x){var A=x._79o(),g=F._29I,o=g.x,e=g.y,B=g.width,u=g.height,Q=F._zoom;A&&!xk(A,g)&&(A.x+A.width<o&&F.tx(-A.x*Q),A.x>o+B&&F.tx(-(A.x+A.width-B)*Q),A.y+A.height<e&&F.ty(-A.y*Q),A.y>e+u&&F.ty(-(A.y+A.height-u)*Q))}delete F._23I}F._83I&&(delete F._83I,delete F._84I),F._98O(),F.countFrame(),de(F._24I)||Rg(F.iv,F)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var Z,e=this.getFullscreenDatas();for(var x in e)Z=e[x],this.scaleRootData(Z);this._rootDataUpdating=!1}},scaleRootData:function(U){var M=U.s("fullscreen");if("uniform"===M||"fill"===M){U.getRotation()&&U.setRotation(0);var A=U.s("fullscreen.gap")||0,V=this.getWidth(),v=this.getHeight();if(V&&v){var j,z,J,t=V-2*A,I=v-2*A,Z=U.getAnchor(),P=U.getScaledSize(),n=P.width,W=P.height,H=U.s("fullscreen.lock");if(H)return"uniform"===M?t/I>n/W?(j=I/W,n=W*t/I):(j=t/n,W=n*I/t):"v"===H?(j=I/W,n=t/j,U.getWidth()!==n&&U.setWidth(n)):(j=t/n,W=I/j,U.getHeight()!==W&&U.setHeight(W)),this.setZoom(j),z=A-(U.getX()-Z.x*n)*j,J=A-(U.getY()-Z.y*W)*j,z!==this.tx()&&this.tx(z),J!==this.ty()&&this.ty(J),void 0;z=this.tx(),J=this.ty(),j=this._zoom;var f={x:(-z+A)/j,y:(-J+A)/j,width:t/j,height:I/j};if("uniform"===M){var F=n/W,h=Math.min(f.width,f.height*F),g=h/F;f.x+=.5*(f.width-h),f.y+=.5*(f.height-g),f.width=h,f.height=g}t=f.width/U.getScaleX(),I=f.height/U.getScaleY(),(U.getWidth()!=t||U.getHeight()!==I)&&U.setSize(t,I);var E=f.x+Z.x*f.width,C=f.y+Z.y*f.height,D=U.getPosition();(E!==D.x||C!==D.y)&&U.setPosition(E,C)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(V){var Y=this;V!==Y.isScrollBarVisible()&&(V?(xh(Y._view,Y._79O=Pd()),xh(Y._79O,Y._27I=Pd()),xh(Y._79O,Y._28I=Pd())):(tc(Y._79O),delete Y._79O,delete Y._27I,delete Y._28I),Y.fp("scrollBarVisible",!V,V))},getDebugTip:function(){return""},showScrollBar:function(){var R=this;R._79O&&(R._85I||(W(function(){R._86I()},Ef),R.iv()),R._85I=new Date)},_86I:function(){var b=this;if(b._85I){var q=new Date,G=q.getTime();G-b._85I.getTime()>=Ef?(delete b._85I,b.iv()):W(function(){b._86I()},Ef)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var e=this,A=this._27I,o=this._28I;if(e._79O){if(e._autoHideScrollBar&&!e._85I)return A.style.visibility=rc,o.style.visibility=rc,void 0;var a=e.getScrollBarColor(),P=e._zoom,V=e.getScrollBarSize(),b=e.getViewRect(),u=e.getScrollRect(),O=b.height*P,M=u.height*P,k=b.width*P-V-2,D=O*((b.y-u.y)*P/M),G=O*(O/M),n=A.style;M-.5>O?(qr>G&&(D=D+G/2-qr/2,0>D&&(D=0),D+qr>O&&(D=O-qr),G=qr),_o(A,k,D,V,G),n.visibility=Tr,n.background=a,n.borderRadius=V/2+Yg):n.visibility=rc;var f=b.width*P,I=u.width*P,D=b.height*P-V-2,k=f*((b.x-u.x)*P/I),i=f*(f/I),n=o.style;I-.5>f?(qr>i&&(k=k+i/2-qr/2,0>k&&(k=0),k+qr>f&&(k=f-qr),i=qr),_o(o,k,D,i,V),n.visibility=Tr,n.background=a,n.borderRadius=V/2+Yg):n.visibility=rc}},setDataModel:function($){var r=this,C=r._dataModel,q=r._selectionModel;C!==$&&(C&&(C.ump(r.handleDataModelPropertyChange,r),C.umm(r.handleDataModelChange,r),C.umd(r.handleDataPropertyChange,r),C.removeIndexChangeListener(r._75O,r),C.removeHierarchyChangeListener(r.handleHierarchyChange,r),q||C.sm().ums(r.handleSelectionChange,r)),r._dataModel=$,$.mp(r.handleDataModelPropertyChange,r),$.mm(r.handleDataModelChange,r),$.md(r.handleDataPropertyChange,r),$.addIndexChangeListener(r._75O,r),$.addHierarchyChangeListener(r.handleHierarchyChange,r),q?q._21I($):$.sm().ms(r.handleSelectionChange,r),r.invalidateAll(!0),r.fp(Nh,C,$),r.updateBackground())},getLayersInfo:function(){if(this._layersInfo===S){var t=this.getLayers();t?(this._layersInfo={},t.forEach(function(p){var O=uq(p)?p.name:p;this._layersInfo[O]=p},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(p,t,L){var G,m,f=this,P=f.getDataUI(p),E=vh(P),j=_k(t,function(x){return Tm(E,100*x)},100,.001),D=Tm(E,100*j);if(!L){var R=nj(P),s=new Qp(D.x,D.y),O=49/(f._zoom*f._zoom);for(G=0,m=R.length;m>G;G++)if(s.distanceToSquared(R[G])<O)return{index:G,point:R[G],distance:Math.sqrt((R[G].x-t.x)*(R[G].x-t.x)+(R[G].y-t.y)*(R[G].y-t.y))}}return{percent:j,point:D,distance:Math.sqrt((D.x-t.x)*(D.x-t.x)+(D.y-t.y)*(D.y-t.y))}},calculateAttachPoint:function(){var V=new Qp,I=new Qp,D=new Qp;return function(h,f){var i=this.getAttachPoints(h);if(!i||!i.length)return null;D.set(f.x,f.y);for(var s,C,O,Q,e=1/0,Z=0,W=i.length;W>Z;Z++)O=i[Z],I.x=O.x,I.y=O.y,V.x=O.offsetX||0,V.y=O.offsetY||0,Q=Kq(this,h,0,V.x,V.y,I.x,I.y),C=D.distanceToSquared(Q),e>C&&(s=Z,e=C);e=Math.sqrt(e);var x=this.getAttachStyle(h);if("close"===x){var g=h.s("attach.close.threshold")/this._zoom;if(e>g)return null}return{index:s,distance:e,info:i[s]}}}(),getAttachPoints:function(a){var g=a.s("attach.points");if(g)return g;var W=ng(a._image);return W?hd(W.attachPoints,a,this)||null:void 0},getAttachStyle:function(J){var v=J.s("attach.style");if(v)return v;var L=ng(J._image);return L?hd(L.attachStyle,J,this)||"close":void 0},updateLayers:function(){this._layersInfo=S,this.invalidateSelection(),this.redraw()},updateBackground:function(){var Y=this.dm().a("width"),J=this.dm().a("height");this._canvas.style.background=Y>0&&J>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(E){if("background"===E.property){var x=this._canvas.style.background,b=E.newValue||"";this.updateBackground(),this.fp("canvasBackground",x,b),this.redraw()}else"a:width"===E.property||"a:height"===E.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===E.property?this.updateLayers():"hierarchicalRendering"===E.property&&this.redraw()},handleDataPropertyChange:function(i){this.dm().isHierarchicalRendering()&&"parent"===i.property&&i.data.hasChildren()&&this.redraw(),this.invalidateData(i.data)
},onPropertyChanged:function(O){var F=this,k=O.property;if(F.redraw(),"zoom"===k){var R=F.sm().getSelection();R.size()&&R.each(function(f){f.invalidate()})}else"dataModel"===k&&(F._83I=1);Je[k]?F.showScrollBar():k===Oc&&F.onCurrentSubGraphChanged(O)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(J){var Y=this,A=J.kind,Q=J.data;if(Y._83I=1,"add"===A)Y.invalidateData(Q),Ej(Q)&&Q.getEdgeGroup()&&Q.getEdgeGroup().eachSiblingEdge(Y.invalidateData,Y);else if(A===cf){Y._21Q(Q);var M=Q._id,q=Y._25I[M];if(q){if(Y._56I[M]){var G=q._79o();G&&Y.redraw(G)}q.dispose(),delete Y._25I[M],delete Y._24I[M],delete Y._56I[M]}Q===Y._currentSubGraph&&Y.setCurrentSubGraph(o)}else A===ms&&(Y.invalidateAll(!0),Y.setCurrentSubGraph(o))},_75O:function(n){this.invalidateData(n.data)},handleHierarchyChange:function(g){this.dm().isHierarchicalRendering()&&g.data.hasChildren()&&this.redraw(),this.invalidateData(g.data)},adjustIndex:function(R){var s=this;if(s.isVisible(R)){s.dm().beginTransaction();for(var j=R;j._parent&&s.isVisible(j._parent);)j=j._parent;j&&j!==R&&s._dataModel.adjustIndex(j),s._dataModel.adjustIndex(R),s.dm().endTransaction()}},getImage:function(u){return u.getImage?u.getImage():S},getSelectWidth:function(V){var t=ng(this.getImage(V));return t&&hd(t.disableSelectedBorder,V,this)?0:V.s("select.width")},getSelectColor:function(G){return G.s("select.color")},isSelectable:function(L,n){if(this.isSelected(L))return!0;if(!n&&L.getParent()instanceof zm&&this.isSelectable(L.getParent(),!0)&&L.getParent().isSyncSize())return!1;var D=this.getLayersInfo();if(D){var l=D[L._layer];if(l&&l.selectable===!1)return!1}return L.s("2d.selectable")&&this.sm().isSelectable(L)},isMovable:function(P){var v=this;if(Ej(P)&&P.getStyle(os)!==Zq)return!1;var X=this.getLayersInfo();if(X){var l=X[P._layer];if(l&&l.movable===!1)return!1}return P.s("2d.movable")?v._movableFunc?v._movableFunc(P):!0:!1},isEditable:function(c){var w=this;if(E._uiSerializing)return w._uieditable;if(!w._editInteractor||!w.isSelected(c))return!1;if(sj(c)){var f=w.getDataUI(c);if(!f||f._88I)return!1}if(Ej(c)&&c.getStyle(os)!==Zq)return!1;var A=this.getLayersInfo();if(A){var o=A[c._layer];if(o&&o.editable===!1)return!1}return c.s("2d.editable")?w._editableFunc?w._editableFunc(c):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(v){return Sl(v)&&0!==v.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(v):!0},isRectEditable:function(t){return this._rectEditableFunc?this._rectEditableFunc(t):!0},isAnchorEditable:function(h){return this._anchorEditableFunc?this._anchorEditableFunc(h):!0},isRotationEditable:function(s){return s.setRotation&&s.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(s):!0:!1},isSourceTargetEditable:function(){return!0},getRotationPoint:function(d){var F=d.getAnchor(),U=d.getScale(),Y=this._zoom,M=wf(d.getRotation(),0,-d.getHeight()*U.y*F.y-(U.y<0?-1:1)*(Tk?32:16)/Y),o=d.p();return M.x+=o.x,M.y+=o.y,M},getLogicalPoint:function(c){var f=this;return Zl(c,f._canvas,f.tx(),f.ty(),f._zoom,f._zoom)},getScreenPoint:function(P,C){var X,s=this;return"object"==typeof P?P.x!==S?(X=P.x,C=P.y):(X=P[0],C=P[1]):X=P,Im(X,C,s._canvas,s.tx(),s.ty(),s._zoom,s._zoom)},getSelectedDataAt:function(_){var A=this;return this.getDataAt(_,function(k){return A.isSelected(k)})},getDataInfoAt:function(H,a,s){var r,h=this.lp(H),c=this.getDataAt(h,a,s);if(c){var I=this.getDataUI(c);r={data:c,ui:I,point:h};var g=I._38o;if(g){var F=g.icons;for(var S in F){var R=F[S],U=g.rects[S];if(U)for(var W=hd(R.names,c,this),n=W?W.length:0,J=U.rotation,O=n-1;O>=0;O--){var q=W[O],w=U[O];if(Ib(w,h,J))return r.part="icons",r.name=S,r.icon=q,r.rect=w,r.index=O,r.rotation=J,r}}}if(this.isNoteVisible(c)){if(I.note2Info&&Ib(I.note2Info.clickRect,h,o,I.note2Info.scale))return r.part="note2",r;if(I.noteInfo&&Ib(I.noteInfo.clickRect,h,o,I.noteInfo.scale))return r.part="note",r}if(this.isLabelVisible(c)){if(I.label2Info&&Ib(I.label2Info.rect,h,I.label2Info.rotation,I.label2Info.scale))return r.part="label2",r;if(I.labelInfo&&Ib(I.labelInfo.rect,h,I.labelInfo.rotation,I.labelInfo.scale))return r.part="label",r}if(c.isInRect&&c.isInRect(h))return r.part="body",r}return r},getDataAt:function(T,v,l){T.target&&(T=this.lp(T));var M,w=this._zoom;return this.reverseEach(function(n){return(v?v(n):this.isSelectable(n))&&this.rectIntersects(n,Dn(T.x,T.y,l,w))?(M=n,!1):void 0},this),M},getIconInfoAt:function(H,E){var X=this;if(H.target&&(H=X.lp(H)),E||(E=X.getDataAt(H)),E){var q=X.getDataUI(E);if(q&&q._38o){var N,$=q._38o,t=new Fj;for(N in $.icons)t.add(N);for(var e=t.size()-1;e>=0;e--){N=t.get(e);for(var j=$.rects[N],l=j.rotation,K=j.length-1;K>=0;K--){var S=j[K],z=S.width,L=S.height,Z={x:H.x-S.x-z/2,y:H.y-S.y-L/2};l!=o&&(Z=wf(-l,Z.x,Z.y));var S={x:-z/2,y:-L/2,width:z,height:L};if(Ib(S,Z))return{key:N,index:K,name:$.icons[N].names[K],rect:j[K],point:H,rotation:l,relativeRect:S,relativePoint:Z,data:E}}}}}return o},getDatasInRect:function(G,Y,m){m===S&&(m=1);var z=this,u=new Fj;return z.reverseEach(function(f){m&&!z.isSelectable(f)||(Y?z.rectIntersects(f,G):z.rectContains(f,G))&&u.add(f)}),u},moveSelection:function(F,O){var W=this;W.dm().beginTransaction(),Yh(W.sm().toSelection(W.isMovable,W),F,O),W.dm().endTransaction()},moveDatas:function(E,X,T){var J=this;J.dm().beginTransaction(),E instanceof Fj||(E=new Fj(E)),Yh(E,X,T),J.dm().endTransaction()},getDataUIBounds:function(F){var s=this.getDataUI(F);return s?s._79o():o},drawData:function(Q,q,S){var _=this.getDataUI(q);if(_){var o=_._79o();(!S||xk(S,o))&&(_._42(Q),q instanceof E.Block&&q.eachChild(function(g){this.drawData(Q,g,S)},this))}},getBoundsForGroup:function(d){return d.s(ei)?this.getDataUIBounds(d):o},isPixelPerfect:function(o){return o.s("pixelPerfect")},rectIntersects:function(e,h){this.validate();var s=o;if(this._56I[e._id]){var U=this._25I[e._id];if(U){var x=U._79o();if(Yk(h,x))s=!0;else if((h=Ak(h,x))&&(U.rectIntersects&&(s=U.rectIntersects(h)),s==o)){if(!this.isPixelPerfect(e))return!0;var C=h.x,D=h.y,v=h.width,l=h.height,E=this._zoom,$=N.hitMaxArea,m=v*l*E*E;if(m>$){var J=Math.sqrt($/m);E*=J}v*=E,l*=E,2>v&&(v=2),2>l&&(l=2),C*=E,D*=E;var B=yc(v,l);te(B,-C,-D),B.scale(E,E),this._drawForChecking=!0,this.drawData(B,e,h),this._drawForChecking=!1;try{for(var q=0,O=B.getImageData(0,0,v,l).data;q<O.length;q+=4)if(0!==O[q+3]){s=!0;break}B.restore()}catch(H){bg=o,s=!1}}}}return s?!0:!1},rectContains:function(s,D){if(this._56I[s._id]){var H=this._25I[s._id];if(H)return Yk(D,H._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(V){if(!N.isInput(V.target)){var U=this,F=U._focusData,r=F&&U._25I[F._id],H=0,X=U._dataModel._datas;if(!(F&&F._enabled&&F._editable&&r&&r.onKeyDown&&r.onKeyDown(V)===!0))if(9===V.keyCode&&(F&&(H=X.indexOf(F),$q(V)?-1===--H&&(H=0):++H===X.size()&&(H=0)),U._focusData=F=X.get(H),U.sm().setSelection(F)),qo(V)?U.selectAll():Pe(V)&&U.isResettable()&&U.reset(),U.sm().isEmpty()){if(U._editing)return;var v=U.tx(),K=U.ty(),Y=!1,a=$q()?100:10;Di(V)&&(v-=a,Y=!0),mr(V)&&(K-=a,Y=!0),vc(V)&&(v+=a,Y=!0),jn(V)&&(K+=a,Y=!0),Y&&U.setTranslate(v,K)}else{Lc(V)&&U.handleDelete(V);var n=$q()?10:1;Di(V)&&(U.moveSelection(-n,0),U.fi({kind:"moveLeft"})),mr(V)&&(U.moveSelection(0,-n),U.fi({kind:"moveUp"})),vc(V)&&(U.moveSelection(n,0),U.fi({kind:"moveRight"})),jn(V)&&(U.moveSelection(0,n),U.fi({kind:"moveDown"}))}}},handleScroll:function(H,E){if(Ge(H),this.isZoomable()){if(!this.getEditInteractor()){var L=this.getDataAt(H);if(L){var W=ng(this.getImage(L));if(W&&hd(W.scrollable,L,this))return}}var _=this.lp(H);E>0?this.scrollZoomIn(_):0>E&&this.scrollZoomOut(_)}},handlePinch:function(r,o,K){this.isZoomable()&&(o>K?this.pinchZoomIn(r):this.pinchZoomOut(r))},checkDoubleClickOnNote:function(E,V){var R=this,x=R.lp(E),S=R.getDataUI(V),b=S.note2Info;return b&&V.s("note2.toggleable")&&Ib(b.clickRect,x)?(V.s(yk,!V.s(yk)),R.fi({kind:"toggleNote2",event:E,data:V}),!0):(b=S.noteInfo,b&&V.s("note.toggleable")&&Ib(b.clickRect,x)?(V.s(dr,!V.s(dr)),R.fi({kind:"toggleNote",event:E,data:V}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(C,H){var v=this,E=v.getAutoScrollZone(),b=E/v.getZoom(),h=E/4,N=v._29I,G=v.lp(C),W={x:v.tx(),y:v.ty()};return G&&E>0&&N&&(G.x-N.x<b?v.translate(h,0):N.x+N.width-G.x<b&&v.translate(-h,0),G.y-N.y<b?v.translate(0,h):N.y+N.height-G.y<b&&v.translate(0,-h)),W.x=v.tx()-W.x,W.y=v.ty()-W.y,H&&(H.x+=W.x,H.y+=W.y),W},getMoveMode:function(w,O){var Q=O.s("2d.move.mode");return Q?Q:qj["88"]?"x":qj["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(A,F,n){var r=this;return"currentSubGraph"===F?{__i:A.getId()}:n.serializeProperty(A,F,r)},deserializeProperty:function(C,M,A){var N=this;if("currentSubGraph"===M){var T=N.dm(),O=T.__idMap;return O[C.__i]}return A.deserializeProperty(C,M,N)},setDefaultCursor:function(q,V){this._defaultCursor=q,V!==!1&&this.setCursor(q)},setCursor:function(L){"default"===L&&(L=this._defaultCursor||L);var r=this.getView().style;r.cursor=L,r.cursor="-webkit-"+L,r.cursor="-moz-"+L},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(u){return u===o||N.getConnectAction(null,u)?(this._currentActionType=u,this.redraw(),!0):!1},getEditStyle:function(Q){var V=this.getEditInteractor();return V?V.getStyle(Q):S},setEditStyle:function(H,$,e){var o=this.getEditInteractor();return o?(o.setStyle(H,$,e),!0):!1},isConnectActionVisible:function(f){var d=N.getConnectAction(this);if(!d)return!1;var X=d.visible;return fd(X)&&(X=X(this,f)),X},isInteractive:function(U){var R=ng(this.getImage(U));return R&&hd(R.interactive,U,this)?!0:U.s("interactive")},appendHTML:function(M,o){var b=this.getView();if(!(o||M&&M.parentNode!==b))return!1;var v=M.getView&&M.getView();if(!o&&v&&v.parentNode===b)return!1;(M.getView||M.isSelfViewEvent)&&(M=M.getView());var T=this.getEditInteractor();return T&&T._canvas?b.insertBefore(M,T._canvas):this.isScrollBarVisible()?b.insertBefore(M,this.getView().lastChild):xh(b,M),!0},_layoutHTMLImpl:function(R,Z,B){if(arguments.length>1){var q,U=this,K=U._zoom;if(Z.getView&&(q=Z,Z=Z.getView()),Z.style.position="absolute",B){var h=R.getRect();_o(q||Z,U.tx()+h.x*K,U.ty()+h.y*K,h.width*K,h.height*K)}else{var k=new Pf,h=R.getAnchorRect(),j=R.getPosition(),Q=R.getScale(),p=Z.style;_o(q||Z,h),k.appendTranslate(U.tx(),U.ty()),k.appendScale(K,K),k.append(new Pf(R.getRotation(),j.x,j.y,Q.x,Q.y)),Jr(p,"transform","matrix("+k.a.toFixed(5)+", "+k.b.toFixed(5)+", "+k.c.toFixed(5)+",\n    "+k.d.toFixed(5)+", "+k.tx.toFixed(5)+", "+k.ty.toFixed(5)+")"),Jr(p,"transformOrigin",(-h.x).toFixed(5)+"px "+(-h.y).toFixed(5)+"px"),Z.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(v){return v instanceof yl?{name:"text",accessType:"s",isMultiline:!1}:void 0},getState:function(B){var e="state",X=B.s(e);if(X)return X;var y=ng(B._image);return y?hd(y[e],B,this)||null:void 0}}),l.defineProperties(Mb.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(n){this._layoutHTML=n}}});var Rb=function(G,L){var P=this;P.gv=G,P.s=function(F){return L.getStyle(F)},P._data=L,P._87I=new Fj};pk(Rb,l,{_6I:o,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var M=this,W=M.gv.isSelected(M._data);return!W||M.isShadowed()?0:M.gv.getSelectWidth(M._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(R){var d=this._data,v=this.gv.getBodyColor(d);return v?v:R?d.getStyle(R):o},_2Q:function(Q){return this.s(Q)},_1Q:function(m,f,w,e){var j=this.s,C=j("2d.gray"),W=j(f+".dash.color");if(C&&(W=N.toGrayColor(W)),m.strokeStyle=W,m.lineWidth=w,m.stroke(),j(f+".dash.3d")){var A=j(f+".dash.3d.color");ij(m,W,C?N.toGrayColor(A):A,w,this.gv._zoom,j(f+".dash.3d.accuracy"))}Ch(m,e)},invalidate:function(){this._6I=o},_79o:function(){var V=this;if(!V._6I){var z=V._data,a=V.gv;V.labelInfo=V.label2Info=V.noteInfo=V.note2Info=V._38o=o,V._87I.clear(),V.interactiveInfo=a.isInteractive(z)?{}:o,V._3O(),V._55O=a.isEditable(z)?{_42O:a.isRectEditable(z),_43O:a.isPointEditable(z),_56O:a.isRotationEditable(z)}:o,V._6I=V._81o()}return V._6I},_3O:function(){},getPosition:function(){return qb},_68o:function($,P){$&&this._87I.add(zi($,P))},_81o:function(){var $=this,d=$.s;$._24O($h,"getLabel"),$._24O(Hr,"getLabel2"),$._26O(Fc,"getNote"),$._26O(Hn,"getNote2"),$._15O(),$._55O&&$._48O();var B;if($._87I.each(function(R){B=ym(B,R)}),B&&$.isShadowed()){var U=rj(B);U.x+=d("shadow.offset.x"),U.y+=d("shadow.offset.y"),me(U,d("shadow.blur")),B=ym(B,U)}return $._87I.clear(),B},_42:function(j){var l=this,V=l._data,F=l.gv,m=l.s,u=m("opacity"),R=this.isShadowed();if(R){var p=j.shadowOffsetX,K=j.shadowOffsetY,y=j.shadowBlur,O=j.shadowColor,J=F.getZoom();j.shadowOffsetX=m("shadow.offset.x")*J,j.shadowOffsetY=m("shadow.offset.y")*J,j.shadowBlur=m("shadow.blur")*J,j.shadowColor=l.getSelectColor()}if(u!=o){var P=j.globalAlpha;j.globalAlpha=u}l._80o(j),F.isLabelVisible(V)&&((!F._drawForChecking||m("label.selectable"))&&Wl(j,l.labelInfo),(!F._drawForChecking||m("label2.selectable"))&&Wl(j,l.label2Info)),F.isNoteVisible(V)&&(Cm(j,l.noteInfo),Cm(j,l.note2Info)),l._99O(j),u!=o&&(j.globalAlpha=P),R&&(j.shadowOffsetX=p,j.shadowOffsetY=K,j.shadowBlur=y,j.shadowColor=O)},_80o:function(){},_47O:function(){},_24O:function(n,$){var R=this,y=R._data,r=R.gv,w=R.s,Z=r[$](y);if(Z!=o){var b=w(n+".scale"),Y=w(n+".max"),k=w(n+".position"),U=R[n+"Info"]={label:Z,scale:b,color:r[$+"Color"](y),font:w(n+".font"),opacity:w(n+".opacity"),align:w(n+".align"),rotation:R.getRotation(w(n+".rotation"),!1,k),background:r[$+"Background"](y)},G=Re(U,Z);Y>0&&Y<G.width&&(U.labelWidth=G.width,G.width=Y),1!==b&&(G.width*=b,G.height*=b);var C=R.getPosition(k,w(n+".offset.x"),w(n+".offset.y"),G,w(n+".position.fixed"));if(G.x=C.x-G.width/2,G.y=C.y-G.height/2,R._68o(U.rect=G,U.rotation),1!==b){var f=G.width/b,q=G.height/b;U.rect={x:C.x-f/2,y:C.y-q/2,width:f,height:q}}}},_26O:function(H,m){var L=this,T=L.gv,p=L._data,u=L.s,G=T[m](p);if(G!=o){var N,J,K=u(H+".scale"),t=L[H+"Info"]={note:G,scale:K,data:p,view:T,expanded:u(H+".expanded"),font:u(H+".font"),color:u(H+".color"),opacity:u(H+".opacity"),align:u(H+".align"),icon:u(H+".icon"),backgroundImage:u(H+".backgroundImage"),borderWidth:u(H+".border.width"),borderColor:u(H+".border.color"),background:T[m+"Background"](p)},P=L.getPosition(u(H+".position"),u(H+".offset.x"),u(H+".offset.y")),O=P.x,k=P.y;if(t.expanded){var S,Y=u(H+".max"),A=u(H+".backgroundImage");A?(A=ng(A),S={width:rr(A,p),height:cc(A,p)}):S=Re(t,G),S.width+=6,S.height+=2,Y>0&&Y<S.width&&(t.labelWidth=S.width,S.width=Y),N=S.width,J=S.height+8,t.clickRect={x:O-N*K/2,y:k-J*K,width:N*K,height:J*K*S.height/J}}else{var Q=u(H+".icon");Q?(Q=ng(Q),N=rr(Q,p),J=cc(Q,p)):(N=12,J=18),t.clickRect={x:O-N*K/2,y:k-J*K,width:N*K,height:J*K}}t.rect={x:O-N/2,y:k-J*K/2-J/2,width:N,height:J};var c=Z(t.borderWidth/2)*K;L._68o({x:O-N*K/2-c,y:k-J*K-c,width:N*K+2*c,height:J*K+2*c})}},_48O:function(){},_99O:function(c){var P=this,t=P._38o;if(t){var p=P.gv,Z=P._data,J=t.icons,Y=P.interactiveInfo;Y&&(Y._38o={});for(var k in J){var u=J[k],g=t.rects[k];if(g){Y&&(Y._38o[k]=[]);var a=hd(u.opacity,Z,p),L=hd(u.names,Z,p),U=L?L.length:0,V=g.rotation;if(a!=o){var d=c.globalAlpha;c.globalAlpha*=a}for(var i=0;U>i;i++){var H=L[i],_=ng(H),h=g[i];if(V){var B=h.x+h.width/2,w=h.y+h.height/2;c.save(),te(c,B,w),Rh(c,V),te(c,-B,-w)}Y&&Y._38o[k].push(c.interactiveInfo={compInfos:[],matrix:V?new Pf(V,B,w).appendTranslate(-B,-w):new Pf}),li(c,_,hd(u.stretch,Z,p),h.x,h.y,h.width,h.height,P._data,P.gv),c.interactiveInfo=o,V&&c.restore()}a!=o&&(c.globalAlpha=d)}}}}});var Bk=function(c,p){ii(Bk,this,[c,p])};pk(Bk,Rb,{_checkEmptyRect:!0,_40O:function(b,y){var n=this,V=n.s,k=b.rect;(b.borderColor=n.gv.getBorderColor(n._data))&&(b.borderType=V("border.type"),b.borderWidth=V("border.width"),b.borderPadding=V("border.padding"),y=r(y,b.borderPadding+b.borderWidth/2));var g=n._data.getScale(),P=r(1,r(D(g.x),D(g.y)));if(b.selectWidth=n.getSelectWidth()){var o=n.gv._zoom;b.selectType=V("select.type"),b._97o=n.getSelectColor(),b.selectPadding=V("select.padding"),y=r(y,(b.selectPadding+b.selectWidth/2/o)/P)}y>0&&(y*=P,k=rj(k),me(k,y)),n._68o(k)},_39O:function(c,u){var Z,X=this,T=u.rect;if(u.borderWidth>0&&(Z=u.borderPadding,c.strokeStyle=u.borderColor,c.lineWidth=u.borderWidth,_c(c,u.borderType,{x:T.x-Z,y:T.y-Z,width:T.width+2*Z,height:T.height+2*Z}),c.stroke()),u.selectWidth>0){var M=X.gv._zoom;if(Z=u.selectPadding,c.strokeStyle=u._97o,c.lineWidth=u.selectWidth/M,u.rotation!=o){c.save(),c.translate(u.position.x,u.position.y),c.rotate(u.rotation);var B=X._data,R=B.getWidth(),i=B.getHeight(),l=u.scale,Q=u.anchor;T={x:l.x*-R*Q.x,y:l.y*-i*Q.y,width:l.x*R,height:l.y*i}}_c(c,u.selectType,{x:T.x-Z,y:T.y-Z,width:T.width+2*Z,height:T.height+2*Z}),u.rotation!=o&&c.restore(),c.stroke()}},dispose:function(){var W=this,A=W._htmlView;Bk.superClass._3O.call(W),A&&(A.onHTMLRemoved&&A.onHTMLRemoved(),tc(A))},_3O:function(){var w=this,P=w.s,N=w._data,W=w.gv,d=N.getStyle(Fl),F=w.getBodyColor(),U=w._83o=d?{shape:d,_53o:w.getBodyColor("shape.background"),_27Q:ng(P("shape.repeat.image"),F),shapeGradientPack:P("shape.gradient.pack"),_54o:P("shape.border.width"),_55o:P("shape.border.color"),_56o:P("shape.border.3d"),_57o:P("shape.border.3d.color"),_58o:P("shape.border.3d.accuracy"),shapeGradient:P("shape.gradient"),_59o:P("shape.gradient.color"),_60o:P("shape.border.pattern"),_61o:P("shape.border.cap"),_62o:P("shape.border.join"),shapeForeground:P("shape.foreground"),bodyColor:F,gray:P("2d.gray")}:{img:ng(W.getImage(N),F),bodyColor:F,gray:P("2d.gray"),stretch:P("image.stretch")};if(y&&!e);else{var c,T=U.img;T&&T.renderHTML?(w._htmlInfo&&w._htmlInfo.img!==T&&(w._htmlInfo=o),w._htmlInfo||(w._htmlInfo={img:T,cache:{}}),c=T.renderHTML(N,W,w._htmlInfo.cache)):w._htmlInfo=o,w._htmlView&&w._htmlView!==c&&(w._htmlView.onHTMLRemoved&&w._htmlView.onHTMLRemoved(),tc(w._htmlView.getView?w._htmlView.getView():w._htmlView)),(w._htmlView=c)&&W.appendHTML(c)&&(c.onHTMLAddedSync&&c.onHTMLAddedSync(),c.onHTMLAdded&&Rg(c.onHTMLAdded)),U.rect=N.getRect(),U.position=N.p(),U.scale=N.getScale(),U.anchor=N.getAnchor(),U.rotation=N.getRotation(),d===ir&&(U._63o=P("shape.depth"));var s=0;if(d)s=_r(o,U._54o/2,U._62o),w.s("shape.dash")&&(s=r(s,(w.s("shape.dash.width")||U._54o)/2));else if(T&&T.boundExtend)if(s=hd(T.boundExtend,N,W),T.boundExtendAbsolute){var Y=N.getScale();s/=W._zoom*r(1,r(D(Y.x),D(Y.y)))}else if(!hd(T.fitSize,N,W)){var Z=hd(T.width,N,W),q=hd(T.height,N,W);s*=r(N.getWidth()/Z,N.getHeight()/q)}w._40O(U,s);var K=P("clip.percentage");if(1>K&&(0>K&&(K=0),U.clipRect=vs(N.getAnchorRect(),P("clip.direction"),K)),d){var p=P("shape.fill.clip.percentage");1>p&&(0>p&&(p=0),U.shapeClipRect=vs(N.getAnchorRect(),P("shape.fill.clip.direction"),p));var $=P("shape.foreground.clip.percentage");1>$&&(0>$&&($=0),U.shapeForegroundClipRect=vs(N.getAnchorRect(),P("shape.foreground.clip.direction"),$))}}},getPosition:function(k,r,$,j){var B=Hq(k,this._83o.rect,j);return B.x+=r,B.y+=$,B},_80o:function(H){var s=this,D=s.s,r=s.gv,g=s._data,I=s._83o,c=I.rect,z=I.position,Y=I.rotation,w=I.anchor,p=I.scale,S=I.shape,i=I.clipRect;if(!s._checkEmptyRect||c.width>0&&c.height>0){var v=g.getSize();if(v.x=-v.width*w.x,v.y=-v.height*w.y,H.save(),te(H,z.x,z.y),Rh(H,Y),tl(H,p.x,p.y),i&&(H.beginPath(),H.rect(i.x,i.y,i.width,i.height),H.clip()),r._drawForChecking&&I.img&&hd(I.img.pixelPerfect,g,r)===!1)xe(H,v.x,v.y,v.width,v.height,"#888888");else if(s.freeDraw)s.freeDraw(H,v,I);else if(S){var k,V,j,h,X=I._60o,K=Pi(H,X),u=I._27Q,M=I._54o,W=I.shapeGradientPack,y=I.gray,T=H.lineJoin,Z=H.lineCap,l=function(z){return y?N.toGrayColor(z):z};"roundRect"===S?k=D("shape.corner.radius"):"polygon"===S?k=D("shape.polygon.side"):"arc"===S&&(k=D("shape.arc.from"),V=D("shape.arc.to"),j=D("shape.arc.close"),h=D("shape.arc.oval")),H.lineJoin=I._62o,H.lineCap=I._61o;var F=l(I._53o);if(F||u||W){var t=I.shapeClipRect;t&&(H.save(),H.beginPath(),H.rect(t.x,t.y,t.width,t.height),H.clip()),_c(H,S,v,k,V,j,h),W?On(H,W):u?Li(H,u,l(I.bodyColor),null,g,r):Ub(H,F,I.shapeGradient,l(I._59o),v),H.fill(),t&&H.restore(),W&&H.restore(),H!==K&&_c(K,S,v,k,V,j,h)}else _c(K,S,v,k,V,j,h);var e=I.shapeForeground;if(e){H.save();var P=I.shapeForegroundClipRect;P&&(H.beginPath(),H.rect(P.x,P.y,P.width,P.height),H.clip()),_c(H,S,v,k,V,j,h),Ub(H,e,D("shape.foreground.gradient"),l(D("shape.foreground.gradient.color")),v),H.fill(),H.restore()}if(M>0){var E=D("shape.border.width.absolute");E&&(H.save(),H.setTransform(1,0,0,1,0,0)),H.lineWidth=M;var f=l(I._55o);H.strokeStyle=f,H.stroke(),E&&H.restore(),I._56o&&ij(H,f,l(I._57o),M,r._zoom,I._58o)}if(Ch(H,X),D("shape.dash")){var $=D("shape.dash.width")||M;if($>0){X=D("shape.dash.pattern");var K=Pi(H,X,s._2Q("shape.dash.offset"));K!==H&&_c(K,S,v,k,V,j,h),s._1Q(H,"shape",$,X)}}Xh(H,F,I._63o,v),H.lineJoin=T,H.lineCap=Z}else{var U=s.interactiveInfo;U&&(H.interactiveInfo=U.bodyInfo={compInfos:[],matrix:new Pf(Y,z.x,z.y,p.x,p.y)}),I.gray&&(H.compGray=!0);var J=I.img;J&&J.cacheRule!=o&&(J=ef(H,J,I.stretch,v.width,v.height,g,r,I.bodyColor)),li(H,J,I.stretch,v.x,v.y,v.width,v.height,g,r,I.bodyColor),H.compGray=!1,H.interactiveInfo=o}H.restore()}s._39O(H,I)},_48O:function(){},_47O:function(){}});var Ul=function(H,D){ii(Ul,this,[H,D])},Ro=function(U,g,B,k){var j=Qm(U,g);return B=k?Q(B,j):Hm(B,j),j?B/=j:B=0,{x:U.x+(g.x-U.x)*B,y:U.y+(g.y-U.y)*B}};pk(Ul,Rb,{_3O:function(){var p,u=this,M=u._data,Q=u.gv,A=u.s,L=A(os),X=M.isLooped(),i=A("edge.width"),G=A("edge.center"),q=A("edge.offset"),j=Q.getBorderColor(M),T=j?A("border.width"):0,m=u.getSelectWidth(),w=M._40I,d=M._41I,P=u._78o=w&&d?{looped:X,type:L,width:i,center:G,color:u.getBodyColor("edge.color"),borderColor:j,borderWidth:T,_97o:m?u.getSelectColor():o,selectWidth:m,pattern:A("edge.pattern"),cap:A("edge.cap"),join:A("edge.join"),is3d:A("edge.3d"),_67o:A("edge.3d.color"),_66o:A("edge.3d.accuracy"),gray:A("2d.gray")}:o;if(P){var E=N.getEdgeType(L);if(E){var $=E(M,ap(u,Q,M,X,L),Q,u._19Q);$.points&&$.points.size()>1?(P.edgeTypeInfo=$,p=uh(P.edgeTypeInfo.points)):$[Ci]&&$.rect&&(P.edgeTypeInfo=$,p=$.rect)}else{var B=A("edge.source.anchor.x"),W=A("edge.source.anchor.y"),O=A("edge.target.anchor.x"),F=A("edge.target.anchor.y"),l=nr(Q,M,"source"),b=nr(Q,M,"target");if(L===Zq){var k=P.points=A(Mo)||Ep,Z=k.size();P.segments=A("edge.segments");var f=B!==S||W!==S||Ej(w),Y=O!==S||F!==S||Ej(d);if(!G)if(q)f||(l=Ro(l,Z?k.get(0):b,q,Z)),Y||(b=Ro(b,Z?k.get(Z-1):l,q,Z));else{var I;f||(I=ce(l,Z?k.get(0):b,ks(Q,w)),I&&(l={x:I[0],y:I[1]})),Y||(I=ce(Z?k.get(Z-1):l,b,ks(Q,d)),I&&(b={x:I[0],y:I[1]}))}p=ym(uh(P.points),uh(l,b))}else{var K=ap(u,Q,M,X,L);if(u._19Q||(K=-K),X)l=rj(l),l.x=Q.getNodeRect(w).x,P.radius=K,p={x:l.x-K,y:l.y-K,width:2*K,height:2*K};else{var R=Qm(l,b),h=Hm(q,R),z={x:h,y:K},U={x:R-h,y:K},C=g(b.y-l.y,b.x-l.x),H=P.mat=new bm(C);if(P.orienAngle=C,P.angle=b.x<l.x?C+s:C,P.rect={x:z.x,y:z.y,width:U.x-z.x,height:0},P.origin=l,z=H.tf(z),z.x+=l.x,z.y+=l.y,U=H.tf(U),U.x+=l.x,U.y+=l.y,G){var x={x:R,y:0};x=H.tf(x),x.x+=l.x,x.y+=l.y,p=uh([l,z,U,x]),P.c1=l,P.c2=x}else p=uh(z,U);l=z,b=U}}P.sourcePoint=l,P.targetPoint=b,M._lastSourcePoint=l,M._lastTargetPoint=b}var y=0;A("edge.dash")&&(y=A("edge.dash.width")||i);var D="square"===P.cap?.71:.5;_r(p,r(y*D,i*D+T+m),P.join),u._68o(p)}},getRotation:function($,x,n){$=$||0;var f=this._78o;if(f){var S,d=f.angle,O=f.points,B=f.edgeTypeInfo;if(d!=o)return x?f.orienAngle+$:d+$;if(B&&B[Ci])return B.getRotation?B.getRotation(this,$,x,n):0;if(B&&B.points){var M=B.points;return S=M.size(),Bh[n]?S&&0===S%2?uf(M.get(S/2-1),M.get(S/2),x,$):$:Ao[n]?uf(M.get(0),M.get(1),x,$):uf(M.get(S-2),M.get(S-1),x,$)}if(O)return S=O.size(),Bh[n]?S&&0===S%2?uf(O.get(S/2-1),O.get(S/2),x,$):$:Ao[n]?uf(f.sourcePoint,S?O.get(0):f.targetPoint,x,$):uf(S?O.get(S-1):f.sourcePoint,f.targetPoint,x,$)}return $},getPosition:function(P,h,G,j,S){var C=this._78o;if(C){var K,s=C.type,V=C.points,f=C.edgeTypeInfo,y=C.sourcePoint,d=C.targetPoint;if(!s)return C.looped?{x:y.x-C.radius+h,y:y.y+G}:(S&&y&&d&&(y.x>d.x||y.x===d.x&&y.y>d.y)&&(P=hj[P],G=-G),K=Hq(P,C.rect,j),K.x+=h,K.y+=G,K=C.mat.tf(K),K.x+=C.origin.x,K.y+=C.origin.y,K);if(f&&f[Ci])return f.getPosition?f.getPosition(this,P,h,G,j,S):{x:(y.x+d.x)/2,y:(y.y+d.y)/2};if(V){var K,T=V.size();if(Bh[P]){if(T){var D=T%2;if(0===D)return jd(V.get(T/2-1),V.get(T/2),P,h,G,j,S);K=V.get((T-D)/2)}else K={x:(y.x+d.x)/2,y:(y.y+d.y)/2};return K=Hq(P,{x:K.x,y:K.y,width:0,height:0},j),K.x+=h,K.y+=G,K}return Ao[P]?jd(y,T?V.get(0):d,P,h,G,j,S):jd(T?V.get(T-1):y,d,P,h,G,j,S)}if(f){var Y=f.points,T=Y.size();if(Bh[P]){var D=T%2;return 0===D?jd(Y.get(T/2-1),Y.get(T/2),P,h,G,j,S):(K=Y.get((T-D)/2),K=Hq(P,{x:K.x,y:K.y,width:0,height:0},j),K.x+=h,K.y+=G,K)}return Ao[P]?jd(Y.get(0),Y.get(1),P,h,G,j,S):jd(Y.get(T-2),Y.get(T-1),P,h,G,j,S)}}return qb},_42:function(C){this._78o&&Ul.superClass._42.call(this,C)},drawPath:function(l,x){l.beginPath();var Q=x.type,y=x.points,X=x.segments,A=x.edgeTypeInfo;if(!Q||y){var u=x.sourcePoint,E=u.x,T=u.y,I=x.targetPoint,c=I.x,o=I.y;if(Q)if(X){var B=new Fj({x:E,y:T});B.addAll(y),B.add({x:c,y:o}),Dc(l,B,X)}else l.moveTo(E,T),y.each(function(v){l.lineTo(v.x,v.y)}),l.lineTo(c,o);else x.looped?l.arc(E,T,x.radius,0,j,!0):x.center?(l.moveTo(x.c1.x,x.c1.y),l.lineTo(E,T),l.lineTo(c,o),l.lineTo(x.c2.x,x.c2.y)):(l.moveTo(E,T),l.lineTo(c,o))}else A&&(A.points?Dc(l,A.points,A.segments):A[Ci]&&A[Ci](l,A))},_80o:function(M){var x=this,B=x.s,u=x._78o,I=u.width,Q=u.selectWidth,S=u.borderWidth,D=M.lineJoin,y=M.lineCap,T=u.gray,K=u.pattern;M.lineJoin=u.join,M.lineCap=u.cap,x.drawPath(Pi(M,K),u);var $=B("edge.width.absolute");$&&(M.save(),M.setTransform(1,0,0,1,0,0)),Q&&(M.strokeStyle=u._97o,M.lineWidth=I+2*(S+Q),M.stroke()),S&&(M.strokeStyle=T?N.toGrayColor(u.borderColor):u.borderColor,M.lineWidth=I+2*S,M.stroke());var G=T?N.toGrayColor(u.color):u.color,z=T?N.toGrayColor(u._67o):u._67o;if(M.strokeStyle=G,M.lineWidth=I,M.stroke(),u.is3d&&ij(M,G,z,I,x.gv._zoom,u._66o),Ch(M,K),B("edge.dash")){K=B("edge.dash.pattern");var f=Pi(M,K,x._2Q("edge.dash.offset"));f!==M&&x.drawPath(f,u),x._1Q(M,"edge",B("edge.dash.width")||I,K)}$&&M.restore(),M.lineJoin=D,M.lineCap=y},_48O:function(){},_47O:function(){}});var Rk=function(x,n){ii(Rk,this,[x,n])};pk(Rk,Bk,{_3O:function(){var x,E,V=this,y=V.s,s=V._data,M=V.gv;if(V._88I=o,s.isExpanded()&&s.eachChild(function(y){if(Sl(y)){var S=M.getBoundsForGroup(y);S&&(E||(E=[]),E.push(S),x=ym(x,S))}}),x){var c=M.getLabel(s),l=y("group.type");x=Eh(l,E,x),ko(x,s,"group.padding",1);var m=V._88I={type:l,rect:x,_64o:x};if(!l&&c!=o){var b,r=V.labelInfo={label:c,color:y("group.title.color"),font:y("group.title.font"),align:y("group.title.align")},g=Re(r,c),k=g.width,e=g.height,$=y("group.title.align"),u=y("group.title.orientation");if((u===md||u===Il)&&k>x.width?x.width=k:(u===Ec||u===zn)&&k>x.height&&(x.height=k),r.rect={y:x.y-e,width:g.width,height:e},b=$===Ec?x.x:$===zn?x.x+x.width-k:x.x+x.width/2-k/2,r.rect.x=b,u===Il)m.titleRect={x:x.x,y:x.y+x.height,width:x.width,height:e},m.rect={x:x.x,y:x.y,width:x.width,height:x.height+e},r.rect={x:b,y:x.y+x.height,width:k,height:e};else if(u===Ec){var q=m.titleRect={x:x.x-e,y:x.y,width:e,height:x.height};m.rect={x:x.x-e,y:x.y,width:x.width+e,height:x.height},r.rect={x:q.x+e/2-x.height/2,y:q.y+x.height/2-e/2,width:x.height,height:e},r.rotation=-Math.PI/2}else if(u===zn){var q=m.titleRect={x:x.x+x.width,y:x.y,width:e,height:x.height};m.rect={x:x.x,y:x.y,width:x.width+e,height:x.height},r.rect={x:q.x+e/2-x.height/2,y:q.y+x.height/2-e/2,width:x.height,height:e},r.rotation=Math.PI/2}else m.titleRect={x:x.x,y:x.y-e,width:x.width,height:e+1},m.rect={x:x.x,y:x.y-e,width:x.width,height:x.height+e}}V._40O(m,y("group.border.width")/2)}else Rk.superClass._3O.call(V)},getPosition:function(f,B,e,K){var F=this._88I;if(F){var V=Hq(f,F.rect,K);return V.x+=B,V.y+=e,V}return Rk.superClass.getPosition.apply(this,arguments)},_24O:function(l,w){var a=this._88I;(!a||a.type||"label2"===l)&&Rk.superClass._24O.call(this,l,w)},_80o:function(N){var t=this,e=t._88I;if(e){var W=t._data,D=t.s,K=t.gv,G=e.type,Y=e.rect,T=e._64o,B=e.titleRect,S=t.getBodyColor(),H=ng(D("group.image"),S),j=D("group.image.stretch"),R=t.getBodyColor("group.background"),V=ng(D("group.repeat.image"),S),A=D("group.gradient.pack"),P=D("group.gradient"),M=D("group.gradient.color"),Q=D("group.border.width"),$=D("group.border.color"),s=D("group.border.pattern"),Z=D("group.title.orientation"),i=D("group.depth");if(G){var d=N.lineJoin,F=N.lineCap;if(N.lineJoin=D("group.border.join"),N.lineCap=D("group.border.cap"),H){if(N.save(),_c(N,G,Y),N.clip(),li(N,H,j,Y.x,Y.y,Y.width,Y.height,W,K,S),N.restore(),Q>0){var v=Pi(N,s);_c(v,G,Y),N.lineWidth=Q,N.strokeStyle=$,N.stroke(),Ch(N,s)}}else{var v=Pi(N,s);R||V||A?(_c(N,G,Y),A?On(N,A):V?Li(N,V,S,null,W,K):Ub(N,R,P,M,Y),N.fill(),A&&N.restore(),N!==v&&_c(v,G,Y)):_c(v,G,Y),Q>0&&(N.lineWidth=Q,N.strokeStyle=D("group.border.color"),N.stroke()),Ch(N,s),G===ir&&Xh(N,R,i,Y)}N.lineJoin=d,N.lineCap=F}else{var L=D("group.title.background"),O=D("group.border.radius");if(H)li(N,H,j,T.x,T.y,T.width,T.height,W,K,t.getBodyColor());else if(R||V)if(V?Li(N,V,S,null,W,K):Ub(N,R,P,M,T),0===Q)_c(N,ir,T),N.fill(),Xh(N,R,i,T);else{switch(N.beginPath(),Z){case Il:mf(N,T.x,T.y,T.width,T.height,O,O,0,0);break;case Ec:mf(N,T.x,T.y,T.width,T.height,0,O,0,O);break;case zn:mf(N,T.x,T.y,T.width,T.height,O,0,O,0);break;case md:mf(N,T.x,T.y,T.width,T.height,0,0,O,O)}N.fill()}if(B&&L)if(0===Q)xe(N,B.x,B.y,B.width,B.height,L),Xh(N,L,i,B);else{switch(N.beginPath(),N.fillStyle=L,Z){case Il:mf(N,B.x,B.y,B.width,B.height,0,0,O,O);break;case Ec:mf(N,B.x,B.y,B.width,B.height,O,0,O,0);break;case zn:mf(N,B.x,B.y,B.width,B.height,0,O,0,O);break;case md:mf(N,B.x,B.y,B.width,B.height,O,O,0,0)}N.fill()}if(Q>0){var v=Pi(N,s);if(_c(v,"roundRect",Y,O),N.lineWidth=Q,N.strokeStyle=$,B&&D("group.splitLine")){var U=B.x,C=B.y,X=B.width,n=B.height;Z===Il?(N.moveTo(U,C),N.lineTo(U+X,C)):Z===Ec?(N.moveTo(U+X,C),N.lineTo(U+X,C+n)):Z===zn?(N.moveTo(U,C),N.lineTo(U,C+n)):(N.moveTo(U,C+n),N.lineTo(U+X,C+n))}N.stroke(),Ch(N,s)}}t._39O(N,e)}else Rk.superClass._80o.call(t,N)}});var bf=function(r,p){ii(bf,this,[r,p])};pk(bf,Bk,{_80o:function(R){this._39O(R,this._83o)}});var uc=function(T,U){ii(uc,this,[T,U])};pk(uc,Bk,{_3O:function(){var _=this,U=_._data,J=_.s,M=_.gv,e=U.getPoints(),g=M.getBorderColor(U),F=g?J("border.width"):0,Y=_.getSelectWidth(),p=J("shape.border.width"),n=U.getRect(),a=U.getAnchorRect(),K=M.getBodyColor(U),q=_._99o=e.isEmpty()?o:{rect:n,rotation:U.getRotation(),fillRule:J("shape.fill.rule"),scale:U.getScale(),position:U.p(),points:e,segments:U.getSegments(),bodyColor:K,borderColor:g,borderWidth:F,_94o:J("shape.border.3d"),_95o:J("shape.border.3d.color"),_96o:J("shape.border.3d.accuracy"),_97o:Y?_.getSelectColor():o,selectWidth:Y,_53o:J("shape.background"),_27Q:ng(J("shape.repeat.image"),K),shapeGradientPack:J("shape.gradient.pack"),_54o:p,_55o:J("shape.border.color"),shapeGradient:J("shape.gradient"),_59o:J("shape.gradient.color"),_60o:J("shape.border.pattern"),_61o:J("shape.border.cap"),_62o:J("shape.border.join"),shapeForeground:J("shape.foreground"),gray:J("2d.gray")};
if(q){a.x+=q.position.x,a.y+=q.position.y,q.gradientRect=a;var H=U.getScale(),A=r(1,r(D(H.x),D(H.y)));J("shape.dash")&&J("shape.dash.width")>p&&(p=J("shape.dash.width"));var x,z=J("shape.border.width.absolute");x=z?(p+F+Y)/_.gv._zoom/A:p*("square"===q._61o?.71:.5)+F+Y/_.gv._zoom/A,x&&(x*=A,n=rj(n),_r(n,x,q._62o)),_._68o(n);var t=J("clip.percentage");1>t&&(0>t&&(t=0),q.clipRect=vs(U.getAnchorRect(),J("clip.direction"),t));var Q=J("shape.fill.clip.percentage");1>Q&&(0>Q&&(Q=0),q.shapeClipRect=vs(U.getAnchorRect(),J("shape.fill.clip.direction"),Q));var c=J("shape.foreground.clip.percentage");1>c&&(0>c&&(c=0),q.shapeForegroundClipRect=vs(U.getAnchorRect(),J("shape.foreground.clip.direction"),c))}},getPosition:function(T,z,H,$){var i=this._99o;if(i){var p=Hq(T,i.rect,$);return p.x+=z,p.y+=H,p}return qb},_42:function(P){this._99o&&uc.superClass._42.call(this,P)},_80o:function(Z){var B,Q=this,K=Q.s,m=Q._99o,q=m.position,c=m.scale,M=m.rotation,f=m.borderWidth,t=m.selectWidth/Q.gv._zoom,a=m._27Q,h=m.shapeGradientPack,P=m._54o,J=m.clipRect,X=m.shapeClipRect,T=m.points,V=m.segments,Y=Q._data.isClosePath(),_=m.fillRule,n=m.gray,j=function(r){return n?N.toGrayColor(r):r},E=j(m._53o),$=E||a||h;Z.save(),te(Z,q.x,q.y),Rh(Z,M),tl(Z,c.x,c.y),J&&(Z.beginPath(),Z.rect(J.x,J.y,J.width,J.height),Z.clip()),$&&X&&(Z.save(),Z.beginPath(),Z.rect(X.x,X.y,X.width,X.height),Z.clip()),te(Z,-q.x,-q.y);var z=m._60o,D=Pi(Z,z),p=Z.lineJoin,G=Z.lineCap;Z.lineJoin=m._62o,Z.lineCap=m._61o;var r=j(m.bodyColor);$?(Dc(Z,T,V,Y),h?On(Z,h):a?Li(Z,a,r,null,Q._data,Q.gv):(B=r?r:E,Ub(Z,B,m.shapeGradient,j(m._59o),m.gradientRect)),Z.fill(_),X&&(Z.restore(),te(Z,-q.x,-q.y)),h&&Z.restore(),D!==Z&&Dc(D,T,V,Y)):Dc(D,T,V,Y);var W=m.shapeForeground;if(W){Z.save();var d=m.shapeForegroundClipRect;d&&(te(Z,q.x,q.y),Z.beginPath(),Z.rect(d.x,d.y,d.width,d.height),Z.clip(),te(Z,-q.x,-q.y)),Dc(Z,T,V,Y),Ub(Z,W,K("shape.foreground.gradient"),j(K("shape.foreground.gradient.color")),m.gradientRect),Z.fill(_),Z.restore()}var g=K("shape.border.width.absolute");if(g&&(Z.save(),Z.setTransform(1,0,0,1,0,0)),t&&(Z.strokeStyle=m._97o,Z.lineWidth=P+2*(f+t),Z.stroke()),f&&(Z.strokeStyle=j(m.borderColor),Z.lineWidth=P+2*f,Z.stroke()),P&&(B=j(m._55o),!E&&r&&(B=r),Z.strokeStyle=B,Z.lineWidth=P,Z.stroke(),m._94o&&ij(Z,B,j(m._95o),P,Q.gv._zoom,m._96o)),Ch(Z,z),K("shape.dash")){var A=K("shape.dash.width")||P;if(A>0){z=K("shape.dash.pattern");var D=Pi(Z,z,Q._2Q("shape.dash.offset"));D!==Z&&Dc(D,T,V,Y),Q._1Q(Z,"shape",A,z)}}g&&Z.restore(),Z.lineJoin=p,Z.lineCap=G,Z.restore()},_48O:function(){},_47O:function(){}});var pc=function(j,B){ii(pc,this,[j,B])};pk(pc,uc,{getRotation:function(A,x,P){A=A||0;var w=this._data.getPoints(),e=w.size();return e>1?Bh[P]?e&&0===e%2?uf(w.get(e/2-1),w.get(e/2),x,A):A:Ao[P]?uf(w.get(0),w.get(1),x,A):uf(w.get(e-2),w.get(e-1),x,A):A},getPosition:function(d,k,Z,W,X){var h=this._data.getPoints(),_=h.size();if(_>1){if(Bh[d]){var f=_%2;if(0===f)return jd(h.get(_/2-1),h.get(_/2),d,k,Z,W,X);var Q=h.get((_-f)/2),w={x:Q.x,y:Q.y,width:0,height:0};return Q=Hq(d,w,W),Q.x+=k,Q.y+=Z,Q}return Ao[d]?jd(h.get(0),h.get(1),d,k,Z,W,X):jd(h.get(_-2),h.get(_-1),d,k,Z,W,X)}return qb}});var Jf=function(L,c){ii(Jf,this,[L,c])};pk(Jf,Bk,{_3O:function(){var h=this;Jf.superClass._3O.call(h);var X=h.s,H=h._83o;h._82o=H.img||H.shape?o:{background:h.getBodyColor("grid.background"),depth:X("grid.depth"),rect:H.rect,_88o:X("grid.cell.depth"),cellBorderColor:X("grid.cell.border.color"),_89o:X("grid.row.count"),_90o:X("grid.column.count"),block:X("grid.block"),_91o:X("grid.block.color"),_92o:X("grid.block.padding"),_93o:X("grid.block.width")}},_80o:function(x){var g=this,T=g._82o;if(!T)return Jf.superClass._80o.call(g,x),void 0;var L,G,U=g._data,m=T.background,B=T.rect,Z=T.block,q=T._91o,e=T._92o,I=T._93o,s=T._88o,M=T.cellBorderColor,v=T._89o,J=T._90o;if(m)if(xe(x,B.x,B.y,B.width,B.height,m),Xh(x,m,T.depth,B),s)for(L=0;v>L;L++)for(G=0;J>G;G++)B=U.getCellRect(L,G),B&&Xh(x,m,s,B);else if(M){for(x.beginPath(),L=0;v>L;L++)for(G=0;J>G;G++)B=U.getCellRect(L,G),B&&x.rect(B.x,B.y,B.width,B.height);x.strokeStyle=M,x.lineWidth=1,x.stroke()}if("h"===Z)for(L=0;v>L;L++)B=ym(U.getCellRect(L,0),U.getCellRect(L,J-1)),me(B,e),Ml(x,q,B.x,B.y,B.width,B.height,I);else if("v"===Z)for(G=0;J>G;G++)B=ym(U.getCellRect(0,G),U.getCellRect(v-1,G)),me(B,e),Ml(x,q,B.x,B.y,B.width,B.height,I);g._39O(x,g._83o)}});var Pr=function(o,Y){ii(Pr,this,[o,Y])};pk(Pr,Bk,{_checkEmptyRect:!1,_81o:function(){var w=this._data,W=Pr.superClass._81o.call(this),p=w.s("text");if(p!=o){var b,$,D=w.s("text.font"),E=w.s("text.align"),v=w.s("text.vAlign"),R=np(D,p),J=R.width,C=R.height,c=w.getAnchor(),m=w.getWidth(),l=w.getHeight();"left"===E?b=-m*c.x:"center"===E?b=-m*c.x+(m-J)/2:"right"===E&&(b=m*(1-c.x)-R.width),"top"===v?$=-l*c.y:"middle"===v?$=-l*c.y+(l-C)/2:"bottom"===v&&($=l*(1-c.y)-R.height);var Z,t=w.getMatrix();if(Z=uh([t.tf(b,$),t.tf(b+J,$),t.tf(b+J,$+C),t.tf(b,$+C)]),W=ym(W,Z),W&&w.s("text.shadow")){var h=rj(W);h.x+=w.s("text.shadow.offset.x"),h.y+=w.s("text.shadow.offset.y"),me(h,w.s("text.shadow.blur")),W=ym(W,h)}}return W}});var Tb=Mb.Interactor=function(v){this.gv=this._graphView=v};Tq("Interactor",l,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(f){this.gv.fi(f)},setCursor:function(a){Tk||this.gv.setCursor(a)},startDragging:function(b){var w=this;w._lastClientPoint=uk(b),w._lastLogicalPoint=w.gv.lp(b),Ho(w,b)},clearDragging:function(){var G=this;G._lastClientPoint=G._lastLogicalPoint=G._logicalPoint=o},autoScroll:function(c){return this.gv.autoScroll(c,this._lastClientPoint)}});var ic=o,tf=function(g){ic.handleWindowTouchMove(g)},sm=function(H){ic.handleWindowTouchEnd(H),u(d,ar,tf),u(d,Po,sm),ic=o},Vp=function(W){ic.handleWindowMouseMove(W)},Gr=function(E){ic.handleWindowMouseUp(E),u(d,Ti,Vp),u(d,Xk,Gr),ic=o},Hk=function(F,G){F!==ic&&(ic?Tk?ic.handleWindowTouchEnd(G):ic.handleWindowMouseUp(G):Tk?(A(d,ar,tf),A(d,Po,sm)):(A(d,Ti,Vp),A(d,Xk,Gr)),ic=F)},Ir=function(X){var h=this;h.gv=X,h._is2d=X instanceof Mb.GraphView,h._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Nf,"wheel"].forEach(function(K){h.addListener(K)}),h.initImageResource()};pk(Ir,Tb,{enableVR:function(O){var D=this;if(!!D._vrEnable!==O)if(D._vrEnable=O,O)D.gv.vr.mp(D.onVRControllerChange,D);else if(D.gv.vr.ump(D.onVRControllerChange,D),D._vrRayPolyline){var g=D.gv.dm();g.remove(D._vrRayPolyline),g.remove(D._vrRayHitPoint),D._vrRayPolyline=S,D._vrRayHitPoint=S}},onVRControllerChange:function(_){var d=this,G=_.property,P=_.newValue,R=d.gv.vr.getController(P.id),T=R.getRay();T&&("gamepad.button.trigger"===G?"down"===P._62O?d.handle_mousedown(T):d.handleWindowMouseUp(T):"gamepad.pose"===G&&(d.handle_mousemove(T),d.handleWindowMouseMove(T)))},drawVRRay:function($,n,x){var q,e=this,s=e.gv,F=e._vrRayPolyline,C=!1;if(F)q=e._vrRayHitPoint;else{var g=s.dm();e._vrRayPolyline=F=new E.Polyline,e._vrRayHitPoint=q=new E.Node,q.s({shape3d:"billboard","shape3d.transparent":!0,"texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),q.setAnchor3d(.5,.5,.499);var Q=.2/s.vr.measureOflength;q.s3(Q,Q,Q),F.s("intersect",!1),q.s("intersect",!1),g.add(F),g.add(q),C=!0}if(n){var X=x.world,N=x.worldNormal,a=X.x,f=X.y,K=X.z;F.s("shape.border.color","red"),F.setPoints([{x:$.origin.x,y:$.origin.z,e:$.origin.y},{x:a,y:K,e:f}]),q.s("3d.visible",!0),q.p3(a,f,K),q.lookAtDirection([N.x,N.y,N.z],"front")}else{F.s("shape.border.color","blue");var j=new E.Math.Vector3;j.copy($.direction).setLength(1e3/e.gv.vr.measureOflength).add($.origin),F.setPoints([{x:$.origin.x,y:$.origin.z,e:$.origin.y},{x:j.x,y:j.z,e:j.y}]),q.s("3d.visible",!1)}s.fi({kind:"vrRayIntersect",ray:$,data:n,intersect:x,polyline:F,hitNode:q,begin:C})},setPreventEventDefault:function(e,n){var c=this,J=c._eventListeners[e];J?J._prevent=n:c._eventListeners[e]=J={_removal:S,_prevent:n}},removeListener:function(G){var D=this,m=D._eventListeners[G];m&&m._removal&&(m._removal(),m._removal=S)},addListener:function(n){var R=this,w=R._eventListeners[n];if(w||(R._eventListeners[n]=w={_removal:S,_prevent:!0}),!w||!w._removal){var y=function(u){w._prevent&&N.preventDefault(u),R.disabled||("wheel"===n?Uh(R,u):R["handle_"+n](u))};A(R.gv.getView(),n,y),w._removal=function(){u(R.gv.getView(),n,y)}}},handleWindowTouchMove:function(j){this.handleWindowMouseMove(j)},handleWindowMouseMove:function(A){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",A):(this.handleDownInfo("onBeginDrag",A),this.isDragging=!0))},handleWindowTouchEnd:function(o){this.handleWindowMouseUp(o)},handleWindowMouseUp:function(h){if(this.isDragging&&(this.handleDownInfo("onEndDrag",h),this.isDragging=!1),this.downInfo){var n=this.handle("onUp",h);if(n&&n.data===this.downInfo.data){this.handleMissingUp(h);var A=this,V=2===h.button?"onContextMenu":"onClick";if(!A._dbclickTimer)return A._dbclickTimer=W(function(){delete A._dbclickTimer,A.handleClick(h,V,n),this.downInfo=o},N.clickDelay),void 0;w(A._dbclickTimer),delete A._dbclickTimer,V="onDoubleClick",A.handleClick(h,V,n)}else this.handleDownInfo("onUp",h);this.downInfo=o}},handle_mouseleave:function(D){var y=this,K=y.gv,t=y.currentInfo?y.currentInfo.data:o;if(t){t.s("onLeave")&&t.s("onLeave")(D,t,K),y.fire("data","onLeave",D,t);var X=y.currentInfo?y.currentInfo.hits:o;if(X)for(var s in X)y.handleLeave(D,s);y.currentInfo=o}},handle_mousewheel:function(s){s.scrollDelta=s.wheelDelta/40,this.handle("onScroll",s)},handle_DOMMouseScroll:function(N){N.scrollDelta=2===N.axis?-N.detail:0,this.handle("onScroll",N)},handle_touchstart:function(l){this.handle_mousedown(l)},handle_touchmove:function(c){this.handle("onMove",c)},handle_mousedown:function(B){this.isDragging&&(this.handleDownInfo("onEndDrag",B),this.isDragging=!1),this.downInfo=this.handle("onDown",B),this.downInfo&&Hk(this,B)},handle_mousemove:function(O){var $=this,b=$.gv;$._hoverTimer&&(w($._hoverTimer),delete $._hoverTimer);var p,Y,Q,q=$.handle("onMove",O),P=this.currentInfo?this.currentInfo.data:o,G=this.currentInfo?this.currentInfo.hits:o;if(q&&(Y=q.data,Q=q.hits,$._hoverTimer=W(function(){w($._hoverTimer),delete $._hoverTimer,$.handle("onHover",O,q)},b.getHoverDelay()||N.hoverDelay)),Y!==P){if(P&&(P.s("onLeave")&&P.s("onLeave")(O,P,b),this.fire("data","onLeave",O,P)),Y&&(Y.s("onEnter")&&Y.s("onEnter")(O,Y,b),this.fire("data","onEnter",O,Y)),G)for(p in G)this.handleLeave(O,p);if(Q)for(p in Q){var s=Q[p],x=Y._interactPrefix=s.prefix,C=x&&Y.a(x+"onEnter")||s.target.onEnter;C&&C.call(s.target,O,Y,b,s.point,s.width,s.height),this.fire(s.type,"onEnter",s.event,s.data,s.image,s.comp,s.point,s),Y._interactPrefix=null}}else{if(G)for(p in G)Q&&Q[p]||this.handleLeave(O,p);if(Q)for(p in Q)if(!G||!G[p]){var s=Q[p],x=Y._interactPrefix=s.prefix,C=x&&Y.a(x+"onEnter")||s.target.onEnter;C&&C.call(s.target,O,Y,b,s.point,s.width,s.height),this.fire(s.type,"onEnter",s.event,s.data,s.image,s.comp,s.point,s),Y._interactPrefix=null}}this.currentInfo=q},handle:function(g,s,l){var p,F=this,Q=F.gv;if(F._is2d){if(l=l||Q.getDataInfoAt(s),!l||!Q.isInteractive(l.data))return;if(p=l.ui.interactiveInfo){var i,D=l.data;if(D.s(g)&&D.s(g)(s,D,Q),this.fire("data",g,s,D),"body"===l.part&&p.bodyInfo)i="body",l.hits=this.handleImage(i,Q.getImage(D),g,s,D,l.point,p.bodyInfo);else if("icons"===l.part&&p._38o){var U=p._38o[l.name];U&&U[l.index]&&(i="icons|"+l.name+"|"+l.index,l.hits=this.handleImage(i,l.icon,g,s,D,l.point,U[l.index]))}}return l}var D,H;if(!l)if(s&&s instanceof E.Math.Ray){var M=Q.vr.intersectWorld(s);if(D=M.data,H=M.intersect,F.drawVRRay(s,D,H),!D)return;var b=Q.getData3dUI(D);if(p=b.interactiveInfo,!p)return;l={data:D,part:H.part,ui:b}}else{if(l=Q.getDataInfoAt(s),!l)return;l&&(l={data:l.data,part:l.part})}if(Q.isInteractive(l.data)){if(!H){D=l.data;var b=Q.getData3dUI(D);if(l.ui=b,p=b.interactiveInfo,!p)return l;if(H=Q.intersectObject(s,D),!H)return}D.s(g)&&D.s(g)(s,D,Q),this.fire("data",g,s,D);var h,W=H.part;return"body"!==W&&(h=D.s(W+".image")||D.s("shape3d."+W+".image")),h||(h=D.s("all.image")||D.s("shape3d.image")),p="object"==typeof h?p[h.uuid]:p[h],p&&p.bodyInfo?(l.part="body",l.interactiveInfo=p,l.point=H.uv.multiply({x:p.bodyInfo.rect.width,y:p.bodyInfo.rect.height}),l.image=h,l.hits=this.handleImage("body",h,g,s,D,l.point,p.bodyInfo),l):l}},_handleLeaveOrMissing:function(F,J,w){var $="leave"===F?this.currentInfo:this.downInfo;if($){var H=$.interactiveInfo||$.ui.interactiveInfo;if(H){var S,k,p=$.data;if(this._is2d){if(k=this.gv.lp(J),"body"===$.part&&H.bodyInfo)S="body","leave"===F?this.handleLeaveImage(w,S,this.gv.getImage(p),J,p,k,H.bodyInfo):this.handleMissingUpImage(S,this.gv.getImage(p),J,p,k,H.bodyInfo);else if("icons"===$.part&&H._38o){var m=H._38o[$.name];m&&m[$.index]&&(S="icons|"+$.name+"|"+$.index,"leave"===F?this.handleLeaveImage(w,S,$.icon,J,p,k,m[$.index]):this.handleMissingUpImage(S,$.icon,J,p,k,m[$.index]))}}else{if(!H.bodyInfo)return;var r=this.gv.intersectObject(J,p);k=r?r.uv.multiply({x:H.bodyInfo.rect.width,y:H.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===F?this.handleLeaveImage(w,"body",$.image,J,p,k,H.bodyInfo):this.handleMissingUpImage("body",$.image,J,p,k,H.bodyInfo)}}}},handleClick:function(l,G,S){var J=this,i=this.downInfo;if(i&&S){var h,m=S.interactiveInfo||S.ui.interactiveInfo,Q=S.data,C=this.gv;if(Q.s(G)&&Q.s(G)(l,Q,C),J.fire("data",G,l,Q),m)if(this._is2d){if(i.part===S.part){var E=C.lp(l);"body"===S.part&&m.bodyInfo&&(h="body",this.handleClickImage(h,C.getImage(Q),G,l,Q,E,m.bodyInfo,S))}}else{if(!m.bodyInfo)return;var e=C.intersectObject(l,Q);if(!e)return;E=e.uv.multiply({x:m.bodyInfo.rect.width,y:m.bodyInfo.rect.height}),this.handleClickImage("body",i.image,G,l,Q,E,m.bodyInfo,S)}}},handleDownInfo:function(k,U){if(this.downInfo){var h=this.downInfo,R=this.gv,Z=h.interactiveInfo||h.ui.interactiveInfo;if(Z){var d,e=h.data;if(e.s(k)&&e.s(k)(U,e,R),this.fire("data",k,U,e),this._is2d){var V=R.lp(U);if("body"===h.part&&Z.bodyInfo)d="body",this.handleDownInfoImage(d,R.getImage(e),k,U,e,V,Z.bodyInfo);else if("icons"===h.part&&Z._38o){var H=Z._38o[h.name];H&&H[h.index]&&(d="icons|"+h.name+"|"+h.index,this.handleDownInfoImage(d,h.icon,k,U,e,V,H[h.index]))}}else{if(!Z.bodyInfo)return;var x=R.intersectObject(U,e);if(!x)return;V=x.uv.multiply({x:Z.bodyInfo.rect.width,y:Z.bodyInfo.rect.height}),this.handleDownInfoImage("body",h.image,k,U,e,V,Z.bodyInfo)}}}},fire:function(x,G,a,y,I,B,d,H){this.gv.fi({kind:G,type:x,event:a,data:y,image:I,comp:B,view:this.gv,point:d,width:H?H.width:S,height:H?H.height:S})},handleImage:function(x,e,F,T,V,f,o){var M={};if(e&&(e=ng(e))){var N=this.gv,i=o.rect,C=this.convertPoint(f,o);C.inRect&&(e[F]&&e[F](T,V,N,C,i.width,i.height),this.fire("image",F,T,V,e,S,C,i),M[x+"|image"]={target:e,type:"image",image:e,data:V,event:T,point:C,width:i.width,height:i.height});for(var y=o.compInfos,u=e,A=y.length-1;A>=0;A--){var p=y[A],s=p.comp;if(C=this.convertPoint(f,p,u,s,N,V),C.inRect){i=p.rect;var m=V._interactPrefix=p.prefix,w=m&&V.a(m+F)||s[F];w&&w.call(s,T,V,N,C,i.width,i.height),this.fire("comp",F,T,V,e,s,C,i),(e=i.image)&&(e[F]&&e[F](T,V,N,C,i.width,i.height),this.fire("image",F,T,V,e,S,C,i)),V._interactPrefix=null,M[x+"|"+A]={target:s,type:"comp",comp:s,image:e,data:V,event:T,point:C,width:i.width,height:i.height,prefix:m},e&&(M[x+"|"+A+"|image"]={target:e,type:"image",image:e,data:V,event:T,point:C,width:i.width,height:i.height,prefix:m})}}}return M},handleLeave:function(o,a){return this._handleLeaveOrMissing("leave",o,a)},handleMissingUp:function(Z){return this._handleLeaveOrMissing("missing",Z)},handleLeaveImage:function(_,F,s,$,L,D,X){if(s&&(s=ng(s))){var j=this.gv,e=X.rect,O=this.convertPoint(D,X);_===F+"|image"&&(s.onLeave&&s.onLeave($,L,j,O,e.width,e.height),this.fire("image","onLeave",$,L,s,S,O,e));for(var I=X.compInfos,t=s,W=I.length-1;W>=0;W--){var x=I[W],H=x.comp;O=this.convertPoint(D,x,t,H,j,L),e=x.rect;var A=L._interactPrefix=x.prefix;if(_===F+"|"+W){var m=A&&L.a(A+"onLeave")||H.onLeave;m&&m.call(H,$,L,j,O,e.width,e.height),this.fire("comp","onLeave",$,L,s,H,O,e)}(s=e.image)&&_===F+"|"+W+"|image"&&(s.onLeave&&s.onLeave($,L,j,O,e.width,e.height),this.fire("image","onLeave",$,L,s,S,O,e)),L._interactPrefix=null}}},handleMissingUpImage:function(h,_,P,z,J,C){var p="onUp",k=this.downInfo.hits;if(k&&_&&(_=ng(_))){var i=this.gv,t=C.rect,e=this.convertPoint(J,C);!e.inRect&&k[h+"|image"]&&(_[p]&&_[p](P,z,i,e,t.width,t.height),this.fire("image",p,P,z,_,S,e,t));for(var R=C.compInfos,W=_,l=R.length-1;l>=0;l--){var y=R[l],X=y.comp;if(e=this.convertPoint(J,y,W,X,i,z),!e.inRect){t=y.rect;var $=z._interactPrefix=y.prefix;if(k[h+"|"+l]){var O=$&&z.a($+p)||X[p];O&&O.call(X,P,z,i,e,t.width,t.height),this.fire("comp",p,P,z,_,X,e,t)}(_=t.image)&&k[h+"|"+l+"|image"]&&(_[p]&&_[p](P,z,i,e,t.width,t.height),this.fire("image",p,P,z,_,S,e,t)),z._interactPrefix=null}}}},handleDownInfoImage:function(f,c,R,M,L,N,T){var O=this.downInfo.hits;if(O&&c&&(c=ng(c))){var q=this.gv,i=T.rect,$=this.convertPoint(N,T);O[f+"|image"]&&(c[R]&&c[R](M,L,q,$,i.width,i.height),this.fire("image",R,M,L,c,S,$,i));for(var V=T.compInfos,j=c,r=V.length-1;r>=0;r--){var X=V[r],K=X.comp;$=this.convertPoint(N,X,j,K,q,L),i=X.rect;var t=L._interactPrefix=X.prefix;if(O[f+"|"+r]){var z=t&&L.a(t+R)||K[R];z&&z.call(K,M,L,q,$,i.width,i.height),this.fire("comp",R,M,L,c,K,$,i)}(c=i.image)&&O[f+"|"+r+"|image"]&&(c[R]&&c[R](M,L,q,$,i.width,i.height),this.fire("image",R,M,L,c,S,$,i)),L._interactPrefix=null}}},handleClickImage:function(Y,v,Q,g,G,_,L,E){var W=this.downInfo.hits,K=E.hits;if(W&&v&&(v=ng(v))){var b=this.gv,r=L.rect,D=this.convertPoint(_,L);W[Y+"|image"]&&(v[Q]&&v[Q](g,G,b,D,r.width,r.height),this.fire("image",Q,g,G,v,S,D,r));for(var P=L.compInfos,y=v,e=P.length-1;e>=0;e--){var J=P[e],B=J.comp;D=this.convertPoint(_,J,y,B,b,G),r=J.rect;var A=G._interactPrefix=J.prefix;if(W[Y+"|"+e]&&K[Y+"|"+e]){var z=A&&G.a(A+Q)||B[Q];z&&z.call(B,g,G,b,D,r.width,r.height),this.fire("comp",Q,g,G,v,B,D,r)}(v=r.image)&&W[Y+"|"+e+"|image"]&&(v[Q]&&v[Q](g,G,b,D,r.width,r.height),this.fire("image",Q,g,G,v,S,D,r)),G._interactPrefix=null}}},initImageResource:function(){N.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(D,$,V,J,k,b){var W=$.rect,H=$.matrix.applyInverse(D).sub(W),L=H.x>=0&&H.y>=0&&H.x<=W.width&&H.y<=W.height;if(!L)return H;if(J&&hd(J.pixelPerfect,b,k)){var W,z=1;this._is2d?(z=k.getZoom(),W=Dn(D.x,D.y,S,z)):W=Dn(D.x,D.y);var Q=!1,l=W.x,Z=W.y,v=W.width,i=W.height,q=N.hitMaxArea,s=v*i*z*z;if(s>q){var d=Math.sqrt(q/s);z*=d}v*=z,i*=z,2>v&&(v=2),2>i&&(i=2),l*=z,Z*=z;var B=yc(v,i),e=new Pf(0,-l,-Z,z,z);e.append($.matrix),k._drawForChecking=!0,J.transform=e;var C=V.comps;V.comps=[J],sq(B,V,0,0,v,i,b,self),V.comps=C,delete J.transform,k._drawForChecking=!1;try{for(var t=0,r=B.getImageData(0,0,v,i).data;t<r.length;t+=4)if(0!==r[t+3]){Q=!0;break}B.restore()}catch(w){bg=o,Q=!1}H.inRect=Q}else H.inRect=!0;return H}});var mq=Mb.DefaultInteractor=function(G){ii(mq,this,[G])};Tq("DefaultInteractor",Tb,{handle_mousedown:function(M){Ge(M);var z=this,s=z.gv,j=s.getDataAt(M);if(s.setFocus(M)&&!s._editing&&!s._scrolling){Yj(M)?s.handleDoubleClick(M,j):s.handleClick(M,j);var f=dk(M);!Pe()&&!f&&j&&(s.isMovable(j)||s._39Q(j))||!s.isPannable()||!lg(M)&&!f||Xl(M)||(z._tx=s.tx(),z._ty=s.ty(),z.startDragging(M))}},handleWindowMouseUp:function(q){var A=this,$=A.gv;$._panning&&(delete $._panning,$.onPanEnded(),A.fi({kind:"endPan",event:q})),delete A._tx,delete A._ty,A.clearDragging()},handle_mousemove:function(h){var d=this,F=d.gv;d._hoverTimer&&(w(d._hoverTimer),delete d._hoverTimer),d._hoverTimer=W(function(){d.fi({kind:"hover",event:h}),w(d._hoverTimer),delete d._hoverTimer},F.getHoverDelay()||N.hoverDelay)},handle_touchmove:function(e){this.handle_mousemove(e)},handleWindowMouseMove:function(B){var g=this,G=g.gv;g.fi({kind:G._panning?"betweenPan":"beginPan",event:B}),G._panning=1;var L=nh(G,B,g._lastClientPoint);G.setTranslate(g._tx+L.x,g._ty+L.y)},handle_mousewheel:function(y){this.gv.handleScroll(y,y.wheelDelta)},handle_DOMMouseScroll:function(Q){2===Q.axis&&this.gv.handleScroll(Q,-Q.detail)},handle_keydown:function(j){this.gv.handleKeyDown(j)}});var bp=Mb.SelectInteractor=function(J){ii(bp,this,[J])};Tq("SelectInteractor",Tb,{_42:function(){var V=this,U=V.gv,e=U.getZoom(),y=V.mark,D=V.div;D||(D=V.div=Pd(),xh(V.getView(),D));var f={};f.x=y.x*e+U.tx(),f.y=y.y*e+U.ty(),f.width=y.width*e,f.height=y.height*e,_o(D,f),this.intersects()?(D.style.border="",D.style.background=U.getRectSelectBackground()):(D.style.background="",D.style.border="1px solid "+U.getRectSelectBorderColor())},handle_mousedown:function(O){var i=this,D=i.gv;if(i._57I=o,i.pendingClickThrough=o,!(D._editing||D._scrolling||Pe()||dk(O))){var H=D.getDataAt(O),k=D.sm();H?Xl(O)?k.co(H)?k.rs(H):k.as(H):k.co(H)?H instanceof zm&&H.isClickThroughEnabled()&&lg(O)&&(i.pendingClickThrough=uk(O)):k.ss(H):Xl(O)||!D.isPannable()?lg(O)&&(Xl(O)||k.cs(),D.isRectSelectable()&&(i.startDragging(O),D._77O=1)):lg(O)&&(i._57I=uk(O))}},handle_mouseup:function(i){var y=this,R=y.gv,B=y._57I;if(B&&(Qm(B,uk(i))<=1&&R.sm().cs(),y._57I=o),y.pendingClickThrough){if(Qm(y.pendingClickThrough,uk(i))<=1){var Y=R.getDataAt(i);if(Y instanceof zm&&Y.isClickThroughEnabled()){var b=R.getDataAt(i,function(M){var Z=M.getParent()===Y&&R.isSelectable(M,!0);return Z});b&&(i.clickThrough=!0,R.sm().ss(b))}}y.pendingClickThrough=o}},handleWindowMouseUp:function(w){this.clear(w)},handleWindowMouseMove:function(C){var T=this,j=T.gv;T._logicalPoint=j.lp(C),T.mark?(T.fi({kind:"betweenRectSelect",event:C}),j.isPannable()&&T.autoScroll(C),T.redraw()):T.fi({kind:"beginRectSelect",event:C}),T.mark=uh(T._lastLogicalPoint,T._logicalPoint),T.redraw()},intersects:function(){var D=this,Y=D._lastLogicalPoint,t=D._logicalPoint;return Y.x>t.x||Y.y>t.y},clear:function(p){var e=this,d=e.gv,x=e.mark;if(e._57I=o,e.pendingClickThrough=o,e._lastLogicalPoint){if(x){if(0!==x.width&&0!==x.height){var r=d.getDatasInRect(x,e.intersects());if(!r.isEmpty()){var w=d.sm(),O=w.toSelection();r.each(function(o){w.co(o)?O.remove(o):O.add(o)}),w.ss(O)}}tc(e.div),delete e.div,delete e.mark,e.redraw(),e.fi({kind:"endRectSelect",event:p}),d.onRectSelectEnded()}e.clearDragging(),delete d._77O}},redraw:function(){var d=this;d._draw||(d._draw=1,W(function(){d.mark&&d._42(),delete d._draw},16))}});var Lf=Mb.MoveInteractor=function(P){ii(Lf,this,[P])};Tq("MoveInteractor",Tb,{handle_mousedown:function(H){var Y=this,F=Y.gv;if(lg(H)&&!F._editing&&!F._scrolling&&!Pe()){var Z=F.getSelectedDataAt(H);!Z||F._39Q(Z)&&!F.isMovable(Z)?F._focusData=o:(Y._data=Z,F.handleMouseDown&&F.handleMouseDown(H,Z),Y.startDragging(H),F.isMovable(Z)&&(F._moving=1))}},handleWindowMouseUp:function(E){var e=this,C=e.gv;C.handleMouseUp&&C.handleMouseUp(E,e._data),e.clear(E)},handleWindowMouseMove:function(y){var Y=this,q=Y._data,Z=Y.gv;if((!Z._93O||!Z._93O(y,q))&&Z._moving){Y._logicalPoint||Y.fi({kind:"prepareMove",event:y});var J=Y._logicalPoint?"betweenMove":"beginMove",O={kind:J,event:y},t=Y._logicalPoint=Z.lp(y);"beginMove"!==J||Y._alreadyBeginTransaction||(Y._alreadyBeginTransaction=!0,Z.getDataModel().beginTransaction());var S=Y._calcShift(J,y),L=S.x,l=S.y,D=Y.gv.getMoveMode(y,q);D&&("x"===D?l=0:"y"===D?L=0:"xy"!==D&&(L=l=0)),Z.moveSelection(L,l),Y._lastLogicalPoint=t,Y.autoScroll(y),Y.fi(O)}},_calcShift:function(){var N=this,b=N._logicalPoint,x=N._lastLogicalPoint,i=b.x-x.x,$=b.y-x.y;return{x:i,y:$}},clear:function(u){var p=this,O=p.gv;p._lastLogicalPoint&&(p._lastLogicalPoint=p._data=O._moving=o,p._logicalPoint&&(p.fi({kind:"endMove",event:u}),O.onMoveEnded()),p.clearDragging()),p._alreadyBeginTransaction&&(p._alreadyBeginTransaction=!1,O.getDataModel().endTransaction())}});var Yp=Mb.TextEditInteractor=function(k){ii(Yp,this,[k]),this.init()};Tq("TextEditInteractor",Tb,{init:function(){var x=this,Y=this.input=L.createElement("input"),q=Y.style;Y.text="text",q.border="1px solid #d8d8d8",q.position="absolute",q.padding="2px 3px",q.outline="none",q.marginLeft="-90px",q.marginTop="-16px",q.backgroundColor="rgba(255,255,255, 0.9)",q.fontSize="14px",q.width="180px",q.height="32px",q.boxShadow="0 0 13px rgba(16,142,233, 0.5)",q.textAlign="center",q.boxSizing="border-box",A(Y,"keyup",function(n){lo(n)&&x.endTextEdit()}),A(Y,"focus",function(){Y.select()});var b=this.textarea=L.createElement("textarea"),c=this.wrap=L.createElement("div");c.appendChild(b),q=b.style,q.margin=0,q.padding="4px",q.overflow="hidden",q.boxSizing="border-box",q.position="absolute",q.outline="none",q.backgroundColor="transparent",q.resize="none",q.textAlign="center",q.fontSize="14px",q.border="none",q.borderWidth=0,q.width="100%",q.top="50%",q=c.style,q.boxSizing="border-box",q.margin=0,q.padding=0,q.position="absolute",q.boxShadow="0 0 13px rgba(16,142,233, 0.5)",q.border="1px solid #d8d8d8",q.backgroundColor="rgba(255,255,255, 0.9)",q.width="180px",q.marginLeft="-90px",A(b,"keydown",function(G){return($q()||Xl())&&lo(G)?(x.endTextEdit(),void 0):(x.calculateTextareaHeight(String.fromCharCode(G.keyCode)),void 0)}),A(b,"focus",function(){b.select()});var U=function(C){C.stopPropagation()};A(Y,"mousedown",U),A(Y,"touchstart",U),A(b,"mousedown",U),A(b,"touchstart",U),x.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],x.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",x.handleWindowClick=function(Y){var M=x._editingDOM;if(M){var n=M.getBoundingClientRect(),S=uk(Y);Ib(n,S)||x.endTextEdit()}}},handle_mousedown:function(f){var B=this,U=B.gv;if(Yj(f)&&!U._editing){var M=U.getDataAt(f);if(M){var V=U.getTextEditInfo(M);V&&(this._editInfo=V,this._editTarget=M,U._editing=!0,V.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var k=this,K=k.gv,Y=k._editTarget,u=k.getTargetValue(),r=k.textarea,Q=k.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===u||u===S)&&(u=""),r.value=u,k._editingDOM=r,K.getView().appendChild(Q),this.layoutHTML(Q,Y),this.calculateTextareaHeight(),W(function(){r.focus(),A(d,"mousedown",k.handleWindowClick),A(d,"touchstart",k.handleWindowClick)},10)},handleTextEdit:function(){var x=this,e=x.gv,v=x._editTarget,C=x.getTargetValue(),o=x.input;(null===C||C===S)&&(C=""),o.value=C,x._editingDOM=o,e.getView().appendChild(o),this.layoutHTML(o,v),W(function(){o.focus(),A(d,"mousedown",x.handleWindowClick),A(d,"touchstart",x.handleWindowClick)},10)},layoutHTML:function(Q,M){var _=this.gv,U=_.getZoom();if(M instanceof E.Node){var t=M.getRect();Q.style.left=(t.x+t.width/2)*U+_.tx()+"px",Q.style.top=(t.y+t.height/2)*U+_.ty()+"px"}else if(M instanceof E.Edge){var R=_.getDataUI(M),t=R._6I;Q.style.left=(t.x+t.width/2)*U+_.tx()+"px",Q.style.top=(t.y+t.height/2)*U+_.ty()+"px"}},endTextEdit:function(){var P=this,L=P._editInfo.isMultiline?P.wrap:P.input,O=P._editInfo.isMultiline?P.textarea:P.input;P.setTargetValue(O.value),P.gv.getView().removeChild(L),P.gv._editing=!1,delete P._editingDOM,u(d,"mousedown",P.handlelick),u(d,"touchstart",P.handleWindowClick)},setTargetValue:function(e){var N=this,M=N._editTarget,W=N._editInfo,K=W.accessType,A=W.name;if(A&&K||(K="p",A="name"),"p"===K){var s=E.Default.setter(A);M[s](e)}else"a"===K?M.a(A,e):M.s(A,e)},getTargetValue:function(){var b=this,F=b._editTarget,G=b._editInfo,Q=G.accessType,g=G.name;if(g&&Q||(Q="p",g="name"),"p"===Q){var H=E.Default.getter(g);return F[H]()}return"a"===Q?F.a(g):F.s(g)},createHiddenTextarea:function(){this.hiddenTextarea=L.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(e,h){if(h&&this.computedStyleCache)return this.computedStyleCache;var C=this,G=d.getComputedStyle(e),m=G.getPropertyValue("box-sizing")||G.getPropertyValue("-moz-box-sizing")||G.getPropertyValue("-webkit-box-sizing"),r=parseFloat(G.getPropertyValue("padding-bottom"))+parseFloat(G.getPropertyValue("padding-top")),Q=parseFloat(G.getPropertyValue("border-bottom-width"))+parseFloat(G.getPropertyValue("border-top-width")),A=C.SIZING_STYLE.map(function(c){return c+":"+G.getPropertyValue(c)}).join(";"),O={sizingStyle:A,paddingSize:r,borderSize:Q,boxSizing:m};return h&&(this.computedStyleCache=O),O},calculateTextareaHeight:function(n){n=n||"";var L=this,Q=L.textarea,R=L.hiddenTextarea,p=L.wrap,x=32,T=L.calculateHTMLStyle(Q,!1),f=T.paddingSize,i=T.borderSize,q=T.boxSizing,C=T.sizingStyle;R.setAttribute("style",C+";"+L.HIDDEN_TEXTAREA_STYLE),R.value=Q.value+n;var A=R.scrollHeight;"border-box"===q?A+=i:"content-box"===q&&(A-=f),Q.style.height=A+"px",Q.style.marginTop=0-.5*A+"px",p.style.height=Math.max(A,x)+"px",p.style.marginTop=A*-.5+"px"}});var wq=Mb.ScrollBarInteractor=function(d){ii(wq,this,[d])};Tq("ScrollBarInteractor",Tb,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(J){var b=this.gv.getViewRect();return this._41o()&&(b.x+b.width-this.gv.lp(J).x)*this.gv.getZoom()<$p},isH:function(G){var x=this.gv.getViewRect();return this._40o()&&(x.y+x.height-this.gv.lp(G).y)*this.gv.getZoom()<$p},handle_mousemove:function(S){this.handle_touchmove(S)},handle_touchmove:function(i){if(!Wc&&lg(i)&&this.gv.isScrollBarVisible()){var T=this,h=T.isV(i),o=T.isH(i);(h||o)&&T.gv.showScrollBar(),T.gv._scrolling=h||o}},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(P){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=o,this.fi({kind:"endScroll",event:P})},handle_mousedown:function(W){this.handle_touchstart(W)},handle_touchstart:function(S){var r=this;if(r.gv.setFocus(S),Ge(S),r.handle_touchmove(S),!(_f(S)>1)&&r.gv._scrolling&&r.gv.isScrollBarVisible()){r._cp=uk(S),r._tx=r.gv.tx(),r._ty=r.gv.ty();var z=r.isV(S);r._state=z?"vScroll":"hScroll",Ho(r,S),r.fi({kind:"beginScroll",event:S})}},handleWindowMouseMove:function(Y){this.handleWindowTouchMove(Y)},handleWindowTouchMove:function(T){var S=uk(T),D=this.gv.getViewRect(),M=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-S.y)*M.height/D.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-S.x)*M.width/D.width),this.fi({kind:"betweenScroll",event:T})}});var ml=Mb.TouchInteractor=function(A,D){D=D||{},D.selectable===S&&(D.selectable=!0),D.movable===S&&(D.movable=!0),D.pannable===S&&(D.pannable=!0),D.pinchable===S&&(D.pinchable=!0),D.editable===S&&(D.editable=!0),this.params=D,ii(ml,this,[A])};Tq("TouchInteractor",Tb,{ms_edit:1,setUp:function(){var z=this;ml.superClass.setUp.call(z),Tk&&z.params.editable&&z.gv.setEditInteractor(z)},tearDown:function(){var C=this;ml.superClass.tearDown.call(C),Tk&&C.params.editable&&C.gv.setEditInteractor(o)},clear:function(T){var f=this,m=f.gv;m._moving&&(f.fi({kind:"endMove",event:T}),delete m._moving,m.onMoveEnded(),m.dm().endTransaction()),m._panning&&(f.fi({kind:"endPan",event:T}),delete m._panning,m.onPanEnded()),m._pinching&&(f.fi({kind:"endPinch",event:T}),delete m._pinching,m.onPinchEnded()),m._editing&&(f._46O(T),f._77I=f._node=f._edge=f._shape=f._rect=f._89I=f._index=m._editing=o),f._moving=f._panning=f._pinching=f._editing=f._57I=f._data=f._beginHistory=o,f.clearDragging()
},handle_touchstart:function(w){var x=this;if(!x.gv._editing){Ge(w),x._57I=o;var B=x.params,E=x.gv,i=E.sm(),f=E.getDataAt(w),Q=_f(w);if(1===Q){if(Yj(w))return E.handleDoubleClick(w,f),void 0;E.handleClick(w,f),f&&(E.handleMouseDown&&E.handleMouseDown(w,f),x._data=f),B.selectable||(f=o),f&&(i.co(f)||i.ss(f),B.editable&&E.isEditable(f)&&x._79I(w,f,!0)?(x._editing=1,x.startDragging(w)):B.movable&&E.isMovable(f)&&(x._moving=1,x.startDragging(w))),f&&E.isMovable(f)||(x._57I=uk(w),B.pannable&&E.isPannable()&&(x._panning=1,x.startDragging(w),x._translate={x:E.tx(),y:E.ty()}))}else if(B.pinchable&&2===Q){if(f&&E._39Q(f))return;x._pinching=1,x.startDragging(w);var R=E.getView(),X=E.getZoom(),J=R.getBoundingClientRect(),N=w.touches[0],O=w.touches[1],b={x:(N.clientX+O.clientX)/2-J.left,y:(N.clientY+O.clientY)/2-J.top};b.x-=E.tx(),b.y-=E.ty(),b.x/=X,b.y/=X,x._p=b,x._d=Lj(w)}}},handle_touchend:function(S){var g=this,h=g.gv,P=g._57I,r=g._data;P&&(Qm(P,uk(S))<=1&&!h.getDataAt(S)&&h.sm().cs(),g._57I=o),r&&h.handleMouseUp&&h.handleMouseUp(S,r)},handleWindowTouchEnd:function(W){this.clear(W)},handleWindowTouchMove:function(Z){var D=this,o=D.gv,K=_f(Z);if(1===K){if(D._editing&&(D._beginHistory||(D._beginHistory=1,o.dm().beginTransaction()),o._editing=1,D._78I(Z)),D._moving)D._beginHistory||(D._beginHistory=1,o.dm().beginTransaction()),D.handleMove(Z);else if(D._panning){var s=uk(Z),r=nh(o,s,D._lastClientPoint);o.setTranslate(D._translate.x+r.x,D._translate.y+r.y),D.fi({kind:o._panning?"betweenPan":"beginPan",event:Z}),o._panning=1}}else if(2===K&&D._pinching){var v=Lj(Z);o.handlePinch(D._p,v,D._d),D._d=v,D.fi({kind:o._pinching?"betweenPinch":"beginPinch",event:Z}),o._pinching=1}},handleMove:function(r){var H=this,K=H.gv,$=K.lp(r);K._93O&&K._93O(r,H._data)||(K.moveSelection($.x-H._lastLogicalPoint.x,$.y-H._lastLogicalPoint.y),H._lastLogicalPoint=$,H.autoScroll(r),H.fi({kind:K._moving?"betweenMove":"beginMove",event:r}),K._moving=1)}});var E=d.ht,Nl=E.graph._editor={Math:E.Math,Guide:{}};Nl.getStyle=function(k){var O,L=Nl.StyleMap;return L&&(O=L[k],O!==S)?O:Nl.DefaultStyleMap[k]},Nl.setStyle=function(B,v){var n=Nl.StyleMap;n||(n=Nl.StyleMap={}),n[B]=v},Nl.inEdit=function(C){return C._inXEdit===!0},Nl.startEdit=function(v){v._inXEdit=!0,Nl.Inject.doInject(v)},Nl._46O=function(y){y._inXEdit=!1,Nl.Inject.undoInject(y)},Nl.toScreenPosition=function(x,h){var a=x.tx(),E=x.ty(),A=x._zoom;return new Nl.Math.Vector2(h.x*A+a,h.y*A+E)},Nl.checkHit=function(U,c,h){return U.distanceTo(c)<h?!0:!1},Nl.toWorldPosition=function(V,m){var f=V.tx(),y=V.ty(),v=V._zoom;return{x:(m.x-f)/v,y:(m.y-y)/v}},Nl.setAntialias=function(I,O){for(var x,y=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],P=0,X=y.length;X>P&&(x=y[P],!(x in I));P++);I[x],I[x]=O},Nl.getTargetCornersOnScreen=function($,t){if(!t)return null;var i,Z=[];if(qq(t,$)){var x=ks($,t);i=[{x:x.x,y:x.y},{x:x.x+x.width,y:x.y},{x:x.x+x.width,y:x.y+x.height},{x:x.x,y:x.y+x.height}]}else{if(!t.getCorners)return null;i=t.getCorners()}return i.forEach(function(s){var H=Nl.toScreenPosition($,s);Z.push(H.x,H.y)}),Z},Nl.log=function(){};var om=Nl.Inject={_modules:[]};om.registAsModule=function(S,y){var w={},n={};for(var o in S){var R=y.prototype[o];w[o]=R}S.getBackup=function(O){return w[O]},S.getBackups=function(){return w},n.doInject=function(){for(var P in S)"getBackup"!==P&&(y.prototype[P]=S[P])},n.undoInject=function(){for(var $ in S)"getBackup"!==$&&(y.prototype[$]=w[$])},om._modules.push(n)},om.doInject=function(z){for(var k,i=om._modules,D=0,R=i.length;R>D;D++)k=i[D],k.doInject(z)},om.undoInject=function(E){for(var c,T=om._modules,n=0,S=T.length;S>n;n++)c=T[n],c.undoInject(E)};var Tb=E.graph.EditInteractor=function(R){var D=this,k=L.createElement("canvas");k.className="editCanvas",k.style.position="absolute",D._styleMap={},D._canvas=k,D._context=k.getContext("2d"),Tb.superClass.constructor.call(D,R),this._editDetail=!1,Nl.setAntialias(D._context,!1),D._subModules=[new Nl.Anchor(D),new Nl.RotateX(D),new Nl.MoveDummy(D),new Nl.Rect(D),new Nl.Curve(D),new Nl.MoveHelper(D)],D._gridGuide=new Nl.Guide.Grid(D),D._rectGuide=new Nl.Guide.Rect(D),D._hoverGuide=new Nl.Guide.Hover(D)},kd=Tb;E.Default.def(Tb,E.graph.Interactor,{ms_edit:1,ms_fire:1}),l.defineProperties(Tb.prototype,{editDetail:{get:function(){var G=!!this._editDetail;return G},set:function(h){var f=this,U=f._editDetail;U!==h&&(f._editDetail=h,f.gv._editing=h,f.fp("editDetail",U,h),f.fp("pointsEditingMode",U,h),f.fi({kind:h?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(W){(!this._editDetail||W)&&(this.gv._editing=W,W||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(a){this._editing=a,this.gvEditing=a}},pointsEditingMode:{get:function(){return this.editDetail},set:function(n){var D=this;D.editDetail!==n&&(n?D._tryEnterEditDetailMode():D._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var t=this._gridEnabled;if(!t)return!1;var z=this.gv;return z?!0:!0},set:function(Y){Y!==this._gridEnabled&&(this._gridEnabled=Y,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(d){d!==this._agEnabled&&(this._agEnabled=d,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),Tb.prototype.getSubModule=function(Z){var R,M,P,x=this._subModules;for(M=0,P=x.length;P>M;M++)if(R=x[M],R.catalog===Z)return R},Tb.prototype.invokeSubModule=function(V,n){var $=this,o=$._subModules;if(o)for(var K,p,f,s=Array.prototype.slice.call(arguments,2),I=0,r=o.length;r>I;I++)if(K=o[I],p=K[V],p&&(f=p.apply(K,s),f!=S&&n))return K},Tb.prototype.invokeSubModuleInverse=function(m,N){var e=this,$=e._subModules;if($)for(var y,Z,H,D=Array.prototype.slice.call(arguments,2),g=$.length-1;g>=0;g--)if(y=$[g],Z=y[m],Z&&(H=Z.apply(y,D),H!=S&&N))return y},Tb.prototype.setUp=function(){Nl.log("setUp");var i=this,M=i.gv,K=M.getView(),l=i._canvas;Tb.superClass.setUp.call(i),M.setEditInteractor(i),M._79O?K.insertBefore(l,M._79O):K.appendChild(l),Nl.startEdit(M),i.invokeSubModule("setUp"),M.dm().mm(i._onDataModelChanged,i),M.dm().md(i._onDataPropertyChanged,i)},Tb.prototype.tearDown=function(){Nl.log("tearDown");var O=this,v=O.gv,q=v.getView();O._resetCustomCursorStyle(),Tb.superClass.tearDown.call(O),v.dm().umm(O._onDataModelChanged,O),v.dm().umd(O._onDataPropertyChanged,O),v.setEditInteractor(null),q.removeChild(O._canvas),O._drawTimer&&(w(O._drawTimer),O._drawTimer=null),Nl._46O(v),O.invokeSubModule("tearDown")},Tb.prototype._onDataModelChanged=function(h){var R=this;("clear"===h.kind||"remove"===h.kind&&R.editDetail&&h.data===R.getSubModule("Curve").target)&&(R.editDetail=!1,R._42())},Tb.prototype._onDataPropertyChanged=function(U){var j=this;if(j.editDetail){var a=j.getSubModule("Curve"),l=U.data;l===a.target&&(l._writing||a._handleDataChanged(U))}},Tb.prototype.clear=function(){Nl.log("clear")},Tb.prototype.redraw=function(){this._42()},Tb.prototype._42=function(){var V=this;V._drawTimer||(V._drawTimer=W(function(){V._drawTimer=null,V.drawImpl()},0))},Tb.prototype.drawImpl=function(){var g;for(g in{_42:!0})break;return function(){var j=this,q=j._canvas,M=j.gv,S=M.getWidth(),D=M.getHeight(),I=j._context,c=E.Default.getInternal(),v=d.devicePixelRatio;(q.width!==S||q.height!==D)&&c.setCanvas(q,S,D,v),I.clearRect(0,0,q.width,q.height);var s=j._getValidSelection();I.save(),I.scale(v,v),j._gridGuide._42(),j.invokeSubModuleInverse(g,!1,I,M,s),j._rectGuide._42(),j._hoverGuide._42(),I.restore()}}(),Tb.prototype._getValidSelection=function(){var n=this,x=n.gv,p=x.sm().getSelection(),D=[];return p.each(function(v){x.isVisible(v)&&x.isEditable(v)&&D.push(v)}),D},Tb.prototype.handle_touchmove=function(i){return this.handle_mousemove(i)},Tb.prototype.handle_mousemove=function(n){if(!E.Default.isDragging()){var y=this;if((y.editDetail||!Pe()&&!dk(n))&&!y.gv._externalEditing)if(y.gvEditing=!1,y._checkEdit(n))y.gvEditing=!0;else{if(!y.getStyle("hoverGuideVisible"))return;y.hoverData=y.gv.getDataAt(n),y._42()}}},Tb.prototype.handle_touchstart=function(n){return this.handle_mousedown(n)},Tb.prototype.handle_mousedown=function(q){Ge(q);var Z=this;if((Z.editDetail||!Pe()&&!dk(q))&&!Z.gv._externalEditing){if(Yj(q)&&!q.clickThrough){if(Z.editDetail){if(Z._tryQuitEditDetailMode(q))return}else if(Z._tryEnterEditDetailMode())return;Z.gv.dm().beginTransaction();var x=Z.invokeSubModule("handleDoubleClick",!0,q);if(Z.gv.dm().endTransaction(),x)return}var M=Z._checkEdit(q);M&&(Z._downPosition=Z._getLogicalPoint(q),Z.gv.dm().beginTransaction(),M.startEdit(Z,q),Z.editing=!0)}},Tb.prototype._checkEdit=function(C){var G=this,b=G.gv,D=G._getLogicalPoint(C),N=G.invokeSubModule("check",!0,b,C,D)||null;return G._editMod=N,N},Tb.prototype.handleWindowTouchMove=function(r){return this.handleWindowMouseMove(r)},Tb.prototype.handleWindowMouseMove=function(C){var m=this,V=m._downPosition;if(V){var x=m._getLogicalPoint(C);if(x.distanceTo(V)<m.getStyle("moveSensitivity"))return;delete m._downPosition}var c=m._editMod;c&&c.handleEdit(m.gv,C)},Tb.prototype._getLogicalPoint=function(I){var j=this,c=E.Default.getLogicalPoint(I,j._canvas);return new Nl.Math.Vector2(c)},Tb.prototype.handleWindowTouchEnd=function(T){return this.handleWindowMouseUp(T)},Tb.prototype.handleWindowMouseUp=function(){var g;for(g in{_46O:!0})break;return function(u){var z=this;z.editing=!1,z.setCursor("default"),z.invokeSubModule(g,!1,u),z._42(),z.gv.dm().endTransaction()}}(),Tb.prototype.handle_mousewheel=function(w){var E=this;Ge(w),E.invokeSubModule("preHandleScroll",!0)||E.gv.handleScroll(w,w.wheelDelta)},Tb.prototype.handleDelete=function(){var j=this;if(!j.editDetail){j.gv.dm().beginTransaction();var C=j.invokeSubModule("handleNormalStateDelete",!0);return j.gv.dm().endTransaction(),C||j.gv.removeSelection(),void 0}j.gv.dm().beginTransaction(),j.invokeSubModule("handleDelete",!0),j.gv.dm().endTransaction(),j._42()},Tb.prototype.handle_keydown=function(z){var t=this;if((z.metaKey||z.ctrlKey)&&t._42(),Pe(z)&&!t.editing)return t.gvEditing=!1,t.setCursor("default"),t._42(),void 0;var M=lo(z);return t.editDetail?((M||Lq(z))&&(t.editDetail=!1,t._42()),t.gv.dm().beginTransaction(),t.invokeSubModule("handle_keydown",!0,z),t.gv.dm().endTransaction(),void 0):(t.gv.dm().beginTransaction(),t.invokeSubModule("handleNormalStateKeyDown",!0,z),t.gv.dm().endTransaction(),M&&t._tryEnterEditDetailMode(),void 0)},Tb.prototype.handle_keyup=function(I){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,I),this.gv.dm().endTransaction()},Tb.prototype._tryEnterEditDetailMode=function(){var n=this;return!n.editDetail&&n.invokeSubModule("canEnterEditDetailMode",!0)&&1===n._getValidSelection().length?(n.editDetail=!0,n._42(),!0):void 0},Tb.prototype._tryQuitEditDetailMode=function(W){var s=this;return s.editDetail?!W||s.invokeSubModule("canQuitEditDetailMode",!0,W)?(s.editDetail=!1,s._42(),!0):!1:!1},Tb.prototype.setStyle=function(S,L,v){var y=this;v?Nl.setStyle(S,L):y._styleMap[S]=L,"baseColor"===S&&(ps=L),y.fp("styleChanged",null,{key:S,value:L,base:v}),y._42()},Tb.prototype.getStyle=function(q){var s=this,v=s._styleMap[q];return v!==S?v:Nl.getStyle(q)},Tb.prototype.setCursor=function(a){this._resetCustomCursorStyle(),E.graph.EditInteractor.superClass.setCursor.call(this,a)},Tb.prototype._resetCustomCursorStyle=function(){var C=this;if(C._customStyle){var p=this.gv.getView();p.classList&&p.classList.remove&&p.classList.remove(C._customStyle),C._customStyle=null}},Tb.prototype._setRotateCursor=function(c){var s=this,r=s._cursorFactory;r||(r=s._cursorFactory=new Nl.CursorFactory(s));var $=r.getRotateCursor(c),i=s.gv.getView();s._resetCustomCursorStyle(),s._customStyle=$,i.classList&&i.classList.add&&i.classList.add($)};var Gc=Nl.Group=function(N){var k=this;k._entities=N,k._64O=0,k._position={x:0,y:0},k._scale={x:1,y:1},k._anchor={x:.5,y:.5},k._anchor2={x:.5,y:.5}};Gc.prototype={},Gc.prototype.constructor=Gc;var zs=null;Gc.findOrCreateGroup=function(m){if(zs&&zs.checkIsMe(m))return zs;var $=new Nl.Group(m);return $.getKeyOb()?(zs=$,$):void 0},Gc.prototype.checkIsMe=function(t){var w=this._entities;if(w.length!==t.length)return!1;var V,j={},U=t.length;for(V=0;U>V;V++)j[t[V]._id]=!0;for(V=0;U>V;V++)if(!j[w[V]._id])return!1;return!0},Gc.prototype.getRotation=function(){return this._64O},Gc.prototype.getPosition=function(){return this._position},Gc.prototype.getAnchor=function(){return this._anchor},Gc.prototype.getWidth=function(){return this._width},Gc.prototype.getScale=function(){return this._scale},Gc.prototype.getSize=function(){return{width:this._width,height:this._height}},Gc.prototype.getHeight=function(){return this._height},Gc.prototype.getKeyOb=function(){for(var O=this._entities,v=O.length-1;v>=0;v--){var N=O[v];if(this.isNode(N))return N}},Gc.prototype.getAnchor2=function(){var I=this,O=I.rotateCenter;if(O)return O;var H=I.getKeyOb();if(!H)return I._anchor;var t=I._anchor2,z=H.getMatrix();return z.tf({x:H.getWidth()*(t.x-H.getAnchor().x),y:H.getHeight()*(t.y-H.getAnchor().y)})},Gc.prototype.setAnchor2=function(l,Z){var c=this,o=c.getKeyOb();if(o){var z,F=o.getMatrix();z="number"==typeof l?{x:l,y:Z}:l;var g=F.tfi(z);c._anchor2={x:o.getAnchor().x+g.x/o.getWidth(),y:o.getAnchor().y+g.y/o.getHeight()}}},Gc.prototype.setRotation=function(){},Gc.prototype.beginRotate=function(i){this.rotateCenter=i.pos,this.rotateMode=i.groupRotateMode},Gc.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Gc.prototype.addRotation=function(M,f,L){return"batch"===f?this._addRotationInBatchMode(M,L):"block"===f?this._addRotationInBlockMode(M,L):void 0},Gc.prototype._addRotationInBlockMode=function(w,U){var A=this,X=A.rotateCenter||A.getPosition();A._entities.forEach(function($){if(A.isNode($)&&(!U||U($))){var e=$.getMatrix();e.translate(-X.x,-X.y),e.rotate(w),e.translate(X.x,X.y);var l=Math.sign($.getScale().x);$.setRotation(g(e.b*l,e.a*l)),$.setPosition(e.tx,e.ty)}})},Gc.prototype._addRotationInBatchMode=function(j){var b=this,Y=b._anchor2;b._entities.forEach(function(G){if(b.isNode(G)&&(!filter||filter(G))){var I=G.getAnchor(),s=G.getMatrix(),C=s.tf({x:G.getWidth()*(Y.x-I.x),y:G.getHeight()*(Y.y-I.y)}),Q=new Nl.Math.Matrix2d;Q.set(s.a,s.b,s.c,s.d,s.tx,s.ty),Q.translate(-C.x,-C.y),Q.rotate(j),Q.translate(C.x,C.y);var n=Math.sign(G.getScale().x);G.setRotation(g(Q.b*n,Q.a*n)),G.setPosition(Q.tx,Q.ty)}})},Gc.prototype.setPosition=function(L){var g,p,B,h,t=this,X=t._position,H=L.x-X.x,K=L.y-X.y,$=t._entities;for(p=0,B=$.length;B>p;p++)g=$[p],Sl(g)&&(h=g.getPosition(),g.setPosition(h.x+H,h.y+K));t._position=L},Gc.prototype.setScale=function(b,D){var K=this,q=b/K._scale.x,d=D/K._scale.y;K._adjustChildScaleOrSize(q,d,"size"),K._scale={x:b,y:D}},Gc.prototype.getRect=function(){var z=this,o=z._position,R=z._width,I=z._height;return{x:o.x-R/2,y:o.y-I/2,width:R,height:I}},Gc.prototype.setSize=function(S,h){var D=this,S=Math.max(1,S),h=Math.max(1,h),A=S/D._width,k=h/D._height;D._adjustChildScaleOrSize(A,k,"size"),D._width=S,D._height=h},Gc.prototype._adjustChildScaleOrSize=function(D,V,S){var _,W,U,Z,P,m,l,k,Y,R,J,p,y,o,w=this,v=w._position,r=w._entities,d=new Nl.Math.Matrix2d;for(W=0,U=r.length;U>W;W++)if(_=r[W],w.isNode(_)){if(Z=_.getPosition(),P=_.getRotation(),m=_.getWidth(),l=_.getHeight(),k=_.getScale(),J=k.x*m,p=k.y*l,d.identity().scale(J,p).rotate(P).translate(Z.x,Z.y).translate(-v.x,-v.y).rotate(-w._64O),P=g(d.b*Math.sign(J),d.a*Math.sign(J)),d.scale(D,V),Y=Math.cos(P),R=Math.sin(P),Math.abs(Y)<.001?(y=d.b/R,o=-d.c/R):(y=d.a/Y,o=d.d/Y),"scale"===S)_.setScale(y/m,o/l);else if("size"===S){var Q=y/k.x,B=o/k.y;_.setScale(Co(y)*Math.abs(k.x),Co(o)*Math.abs(k.y)),_.setSize(Math.max(.1,Math.abs(Q)),Math.max(.1,Math.abs(B)))}d.rotate(w._64O).translate(v.x,v.y),_.setPosition(d.tx,d.ty)}},Gc.prototype.getMatrix=function(){var F=this,R=F._position,G=E.Default.getInternal(),I=F._scale;return new G.Mat(F._64O,R.x,R.y,I.x,I.y)},Gc.prototype.toGlobal=function(S){return this.getMatrix().tf(S)},Gc.prototype.getCorners=function(){var D=this,p=D._width,b=D._height,s=D._anchor,F=-p*s.x,e=-b*s.y,R=D.getMatrix();return[R.tf(F,e),R.tf(F,e+b),R.tf(F+p,e+b),R.tf(F+p,e)]},Gc.prototype.calcInfo=function(){var u,t,M,W,_,j,h=this,I=[],G=h._entities,S=h._64O;for(W=0,_=G.length;_>W;W++)j=G[W],h.isNode(j)&&j.getCorners&&I.push.apply(I,j.getCorners());if(I.length){var d=Math.cos(-S),e=Math.sin(-S),f=1/0,L=-1/0,R=1/0,q=-1/0;for(W=0,_=I.length;_>W;W++)M=I[W],u=M.x,t=M.y,M.x=d*u-e*t,M.y=e*u+d*t,f=Math.min(f,M.x),L=Math.max(L,M.x),R=Math.min(R,M.y),q=Math.max(q,M.y);h._width=(L-f)/h._scale.x,h._height=(q-R)/h._scale.y,d=Math.cos(S),e=Math.sin(S);var P=h._anchor;u=f+(L-f)*P.x,t=R+(q-R)*P.y,h._position={x:d*u-e*t,y:e*u+d*t}}},Gc.prototype.isNode=function(o){return Sl(o)?qq(o)?!1:!0:!1},Gc.prototype._42=function(U,$,E){var C,k,a,b,H,p,t,R,s=this,d=s._entities,f=s.rotateMode;for("batch"===f&&(R=s.getKeyOb()),C=0,k=d.length;k>C;C++)a=d[C],s.isNode(a)&&(p=a.getRect(),b=Nl.toScreenPosition(E,{x:p.x,y:p.y}),H=Nl.toScreenPosition(E,{x:p.x+p.width,y:p.y+p.height}),t={min:b,max:H},a===R&&(t.isKeyOb=!0),Nl.Icons.DrawIcon(U,$,Nl.Icons.GroupSubEntityRect,t))};var Uo=Nl.CurveActiving=function(b,N){this._curve=b,this._interactor=b._interactor;for(var V in N)this[V]=N[V]};Uo.prototype={},Uo.prototype.constructor=Uo,l.defineProperties(Uo.prototype,{point:{get:function(){return this._point},set:function(Z){var X=this;X._point=Z,X.editingCtrl||X._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(g){var r=this;r._pairs=g,r.editingCtrl&&r._firePointChange()}}}),Uo.prototype._firePointChange=function(){var i=this,C=i.getCurrentEditingPoint(),N=i._interactor;if(!C)return N.fi({kind:"selectPoint"}),void 0;var Q=this._curve.target;if(Q){var R=Nl.getDataMatrix(Q).invert(),g=C.e;C=R.apply(Nl.toWorldPosition(N.gv,C)),C.e=g;var L=i._lastFirePoint;L&&Math.abs(C.x-L.x)<1e-5&&Math.abs(C.y-L.y)<1e-5&&(C.e==S&&L.e==S||Math.abs(C.e-L.e)<1e-5)||(i._lastFirePoint=C,N.fi({kind:"selectPoint",x:C.x,y:C.y,e:C.e}))}},Uo.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Uo.prototype.getCurrentEditingPoint=function(){var k=this,s=k.editingCtrl;if(s){var D=k.pairs;if(D){var V=D[s.pairId],z=V[s.type];if(z)return z}}return k._point};var mc=Nl.CursorFactory=function(x){var b=this;b._interactor=x,b._rotateCursorStyles={}};mc.prototype={},mc.prototype.constructor=mc,mc.prototype.getRotateCursor=function(v){var t=this;0>v&&(v+=2*Math.PI);var F=t._interactor,X=F.getStyle("rotateCursorSize"),l=F.getStyle("rotateCursorRound"),B=Math.round(180*(v/Math.PI)/l);B*l>=360&&(B=0);var Y=t._rotateCursorStyles,a="htCustomRotateStyle_"+X+"_"+l+"_"+B;return Y[a]||(t._produceRotateCursor(a,X,l,B),Y[a]=!0),a},mc.prototype._produceRotateCursor=function(F,G,R,n){var m=this;m._interactor;var i=m._canvas;i||(i=m._canvas=L.createElement("canvas")),i.width=i.height=G*devicePixelRatio,i.style.width=i.style.height=G+" px";var w=i.getContext("2d");Nl.setAntialias(w,!1),w.scale(devicePixelRatio,devicePixelRatio);var e,H,V,S,v,J=Math.round(G/2),d=""+J+" "+J+",auto !important;",k=4;e=Math.PI/180*n*R,w.clearRect(0,0,G,G),w.save(),w.scale(G/32,G/32),w.translate(16,15),w.rotate(e+Math.PI/2),w.beginPath(),w.moveTo(-8,0),w.lineTo(-8,k),w.lineTo(-8+k,k),w.moveTo(8,0),w.lineTo(8,k),w.lineTo(8-k,k),w.moveTo(-8,k),w.quadraticCurveTo(0,-6,8,k),w.restore(),w.lineCap="round",w.lineJoin="miter",w.strokeStyle="white",w.lineWidth=4,w.stroke(),w.strokeStyle="black",w.lineWidth=2,w.stroke(),H=JSON.stringify(i.toDataURL()),S="cursor:url("+H+")"+d,1!==devicePixelRatio&&(V='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+G+'px" height="'+G+'px"><image xlink:href='+H+' width="'+G+'" height="'+G+'"/></svg>',S+="cursor:url(data:image/svg+xml;base64,"+btoa(V)+")"+d,S+="cursor:-webkit-image-set(url("+H+")"+devicePixelRatio+"x,url("+H+")1x)"+d),v=L.createElement("style"),v.textContent="body."+F+" *, ."+F+"{"+S+"}",L.head.appendChild(v)};var bk=Nl.Guide.Grid=function(h){var v=this;v._interactor=h,v._alignmentGuideId=0,v._xAlignmentGuide=[],v._yAlignmentGuide=[]};bk.prototype={},bk.prototype.constructor=bk,l.defineProperties(bk.prototype,{gridBlockSize:{get:function(){var z=this;return z._gridBlockSize||z._interactor.getStyle("gridBlockSize")},set:function(V){this._gridBlockSize=V,this._interactor._42()}},gridThickLinesEvery:{get:function(){var w=this;return w._gridThickLinesEvery||w._interactor.getStyle("gridThickLinesEvery")},set:function(O){this._gridThickLinesEvery=O,this._interactor._42()}},gridEnabled:{get:function(){var c=this,Q=c._interactor;return Q.gridEnabled&&c.isValidGrid()}}}),bk.prototype._42=function(){var R=this,x=R._interactor;R.gridEnabled&&R.drawGrid(),x.alignmentGuideEnabled&&R.drawAlignmentGuide()},bk.prototype.makeMatrix=function(){var K=this,k=K._interactor.getStyle("gridAngle"),h=K._interactor.getStyle("gridRotation"),V=new Nl.Math.Matrix2d,f=Math.sin(k),R=Math.cos(k);return V.set(1,0,R,f,0,0),V.rotate(h),V},bk.prototype.isValidGrid=function(){var O=this,J=Math.PI,I=O._interactor,y=I.gv;if(y._zoom<I.getStyle("gridZoomThreshold"))return!1;var c=I.getStyle("gridAngle"),K=Math.abs(180*(c%J/J)),Q=1-1e-8;return Q>K||K>180-Q?!1:!0},bk.prototype.drawAlignmentGuide=function(){var m=this,N=m._interactor,n=N.gv,r=N._canvas,V=N._context,B=r.width,i=r.height,D=n.tx(),q=n.ty(),c=n._zoom;V.beginPath(),V.strokeStyle=N.getStyle("gridAlignmentGuideColor"),V.lineWidth=1,m._xAlignmentGuide.forEach(function(T){var g=T.p*c+D;V.moveTo(g,0),V.lineTo(g,i)}),m._yAlignmentGuide.forEach(function(m){var e=m.p*c+q;V.moveTo(0,e),V.lineTo(B,e)}),V.stroke()},bk.prototype.drawGrid=function(){function O(f,h,L,v){var W=Nl.toScreenPosition(U,V.apply({x:f,y:h})),g=Nl.toScreenPosition(U,V.apply({x:L,y:v}));C.moveTo(W.x,W.y),C.lineTo(g.x,g.y)}var q=this,d=q._interactor,i=q.gridBlockSize,k=q.gridThickLinesEvery,u=d.getStyle("gridThickColor"),r=d.getStyle("gridLightColor"),U=d.gv,m=d._canvas,C=d._context,s=m.width,S=m.height,V=q.makeMatrix(),X=V.applyInverse(Nl.toWorldPosition(U,{x:0,y:0})),z=V.applyInverse(Nl.toWorldPosition(U,{x:s,y:0})),x=V.applyInverse(Nl.toWorldPosition(U,{x:0,y:S})),v=V.applyInverse(Nl.toWorldPosition(U,{x:s,y:S})),I=Math.min(X.x,z.x,x.x,v.x),f=Math.max(X.x,z.x,x.x,v.x),o=Math.min(X.y,z.y,x.y,v.y),M=Math.max(X.y,z.y,x.y,v.y);s=f-I,S=M-o;var a=Math.ceil(I/i),L=Math.floor(f/i),G=Math.ceil(o/i),g=Math.floor(M/i);U.tx(),U.ty(),U._zoom;var K,n,l;for(C.save(),C.lineWidth=1,C.beginPath(),C.strokeStyle=u,l=Math.ceil(a/k)*k;L>=l;l+=k)K=l*i,O(K,o,K,M);for(l=Math.ceil(G/k)*k;g>=l;l+=k)n=l*i,O(I,n,f,n);for(C.stroke(),C.beginPath(),C.strokeStyle=r,l=a;L>=l;l++)0!==l%k&&(K=l*i,O(K,o,K,M));for(l=G;g>=l;l++)0!==l%k&&(n=l*i,O(I,n,f,n));C.stroke(),C.restore()},bk.prototype.getAlignmentGuides=function(){var _=this;return{x:_._xAlignmentGuide,y:_._yAlignmentGuide}},bk.prototype.addAlignmentGuide=function(q,p,G){var u=this,B="x"===q?u._xAlignmentGuide:u._yAlignmentGuide,G=G?G:++u._alignmentGuideId,l={p:p,id:G};if(B.length){var s=u._findClosestAlignmentGuide(l.p,B);s.dis<0?B.splice(s.index+1,0,l):B.splice(s.index,0,l)}else B.push(l);return u._interactor._42(),G},bk.prototype.findClosest=function(W,a,$){var p=this,c=p._interactor,L=c.gv;$&&(W=Nl.toWorldPosition(L,W));var q,v,Q,E=1/0,t=1/0,d=W.x,K=W.y;if(p.gridEnabled){var R=p.gridBlockSize,i=p.makeMatrix(),G=i.applyInverse(W);G=i.apply({x:Math.round(G.x/R)*R,y:Math.round(G.y/R)*R}),E=G.x-d,t=G.y-K,Q=!0}if(c.alignmentGuideEnabled&&(q=p._findClosestAlignmentGuide(d,p._xAlignmentGuide).dis,v=p._findClosestAlignmentGuide(K,p._yAlignmentGuide).dis,Math.abs(q)<Math.abs(E)&&(E=q,Q=!0),Math.abs(v)<Math.abs(t)&&(t=v,Q=!0)),Q){Q=!1;var F=L._zoom,J=c.getStyle("smartGuideThreshold")/F,B={};if(Math.abs(E)<J&&"y"!==a&&(B.x=$?E*F:E,Q=!0),Math.abs(t)<J&&"x"!==a&&(B.y=$?t*F:t,Q=!0),Q)return B}},bk.prototype._findClosestAlignmentGuide=function(I,j){if(!j.length)return{dis:1/0};for(var K,n=0,U=j.length-1;U-n>1;)K=Math.floor((n+U)/2),j[K].p<I?n=K:U=K;var J=j[n].p-I,E=j[U].p-I;return Math.abs(J)<=Math.abs(E)?{line:j[n],dis:J,index:n}:{line:j[U],dis:E,index:U}},bk.prototype.removeAllAlignmentGuide=function(K){var U=this;"y"!==K&&(U._xAlignmentGuide=[]),"x"!==K&&(U._yAlignmentGuide=[]),U._interactor._42()},bk.prototype.removeAlignmentGuide=function(b){for(var t,J,_,n=this,V=n._xAlignmentGuide,W=0;2>W;W++)for(V=0===W?n._xAlignmentGuide:n._yAlignmentGuide,t=0,J=V.length;J>t;t++)if(_=V[t],_.id===b)return V.splice(t,1),n._interactor._42(),{axis:0===W?"x":"y",position:_.p};return!1},bk.prototype.adjustAlignmentGuide=function(P,k){var m=this,x=m.removeAlignmentGuide(P);return x?(m.addAlignmentGuide(x.axis,k,P),!0):!1};var wg=Nl.Guide.Rect=function(w){var E=this;E._interactor=w};wg.prototype={},wg.prototype.constructor=wg,wg.prototype.gatherRects=function(){var $,s,H,X,K=this,i=K._interactor.gv,R=[],k=[],D={x:R,y:k},h={},W=i.getDataModel(),c=W.a("width"),m=W.a("height");c&&m&&($=0,s=0,H=c,X=m,R.push({node:W,type:0,p:$},{node:W,type:1,p:$+H/2},{node:W,type:2,p:$+H}),k.push({node:W,type:0,p:s},{node:W,type:1,p:s+X/2},{node:W,type:2,p:s+X}),h[W._id||0]={x:$,y:s,width:H,height:X}),W.each(function(z){if(Sl(z)&&!i.isSelected(z)&&i.isVisible(z)&&i.isValidGuideLineSource(z)){var a=!1;if(i.sm().getSelection().each(function(Y){a||(z.isHostOn(Y)?a=!0:z.isDescendantOf(Y)&&(a=!0))}),!a){var O=z.getRect();$=O.x,s=O.y,H=O.width,X=O.height,R.push({node:z,type:0,p:$},{node:z,type:1,p:$+H/2},{node:z,type:2,p:$+H}),k.push({node:z,type:0,p:s},{node:z,type:1,p:s+X/2},{node:z,type:2,p:s+X}),h[z._id]=O}}}),R.sort(function(z,n){return z.p-n.p}),k.sort(function(F,t){return F.p-t.p}),K._grid=D,K._87I=h},wg.prototype.gatherLines=function(e,c,O){var x,m,A,R,p,q,_,Q,v,G,I,P,f=this,t=[f.findClosest({x:e.x,y:e.y},c),f.findClosest({x:e.x+e.w/2,y:e.y+e.h/2},c),f.findClosest({x:e.x+e.w,y:e.y+e.h},c)],B={},r=f._87I;O=O||255;var L,W;for(f._guideLine=[],x=0;2>x;x++)for(B={},0===x?(R="y",Q=e.x,v=Q+e.w):(R="x",Q=e.y,v=Q+e.h),m=0;3>m;m++)p=t[m],p&&isFinite(p[R])&&(L=1<<3*x+m,O&L&&(q=p[R+"Line"],_=q.node,W=_._id||0,B[W]||(B[W]=!0,P=r[W],"y"===R?(G=P.x,I=P.x+P.width):(G=P.y,I=P.y+P.height),A=q.p,f._guideLine.push({type:R,a:Q,b:v,c:G,d:I,p:A,center:1===q.type}))))},wg.prototype._binarySearchClosest=function(t,o){if(!o.length)return{dis:1/0};for(var g,l=0,s=o.length-1;s-l>1;)g=Math.floor((l+s)/2),o[g].p<t?l=g:s=g;var E=o[l].p-t,P=o[s].p-t;return Math.abs(E)<=Math.abs(P)?{line:o[l],dis:E}:{line:o[s],dis:P}},wg.prototype.findClosest=function(t,s,D){var f=this,F=f._interactor,S=F.gv,y=f._grid;D&&(t=Nl.toWorldPosition(S,t));var G,e=f._binarySearchClosest(t.x,y.x),A=f._binarySearchClosest(t.y,y.y),Q=e.dis,p=A.dis,d=S._zoom,_=F.getStyle("smartGuideThreshold")/d,m={};return Math.abs(Q)<_&&"y"!==s&&(m.x=D?Q*d:Q,m.xLine=e.line,G=!0),Math.abs(p)<_&&"x"!==s&&(m.y=D?p*d:p,m.yLine=A.line,G=!0),G?m:void 0},wg.prototype._42=function(){var d=this,b=d._guideLine;if(b&&!E.Default.isCtrlDown()){var C=d._interactor;if(C.getStyle("guideLineVisible")){var M,k,Y,j,T,c,H,p,R,L,Z,J,F,N,G,P,I,w=C.gv,r=C._context,a=w.tx(),K=w.ty(),V=w._zoom,O=C.getStyle("guideLineTextSpacing");for(M=0,k=b.length;k>M;M++)Y=b[M],p=Y.type,R=Y.p,L=Y.a,Z=Y.b,J=Y.c,F=Y.d,N=Math.min(L,J),G=Math.max(Z,F),"x"===p?(j=R*V+a,T=N*V+K,c=j,H=G*V+K):(j=N*V+a,T=R*V+K,c=G*V+a,H=T),Nl.Icons.DrawIcon(C,r,Nl.Icons.MoveLineGuide,{rect:[j,T,c,H],center:Y.center}),F>=L&&Z>=J||(N=L>F?F:Z,G=L>F?L:J,I=G-N,"x"===p?(Y.center2center||(j-=O,c=j),T=N*V+K,H=G*V+K,P=Nl.Icons.MoveLineGuideDistanceV):"y"===p&&(Y.center2center||(T-=O,H=T),j=N*V+a,c=G*V+a,P=Nl.Icons.MoveLineGuideDistanceH),Nl.Icons.DrawIcon(C,r,P,{x0:j,y0:T,x1:c,y1:H,dis:I}))}}},wg.prototype.clear=function(){this._guideLine=null};var hf=Nl.Guide.Hover=function(X){var S=this;S._interactor=X};hf.prototype={},hf.prototype.constructor=hf,l.defineProperties(hf.prototype,{}),hf.prototype._42=function(){var o=this._interactor;if(o.getStyle("hoverGuideVisible")&&!o.gvEditing){var u=o.hoverData,A=o.gv;if(!Sl(u)||A.isSelected(u))return o.hoverData=null,void 0;var H=ks(A,u),T=Nl.toScreenPosition(A,{x:H.x,y:H.y}),m=Nl.toScreenPosition(A,{x:H.x+H.width,y:H.y+H.height});Nl.Icons.DrawIcon(o,o._context,Nl.Icons.HoverDataRect,{min:T,max:m,color:o.getStyle("hoverGuideColor")||o.getStyle("baseColor")})}},Nl.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Vq=Nl.Icons={},Jg=1e4,Ik=null,ps=Nl.DefaultStyleMap.baseColor,no="rgb(183,232,135)",im="rgb(255,204,153)",tk=6;E.Default.setImage("Icons.RectPoint",{width:tk,height:tk,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return ps}},rect:[0,0,tk,tk]}]}),Vq.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var X=Vq.GroupSubEntityRect.data;if(!X)return[];var r=X.min,E=X.max;return[r.x,r.y,r.x,E.y,E.x,E.y,E.x,r.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Vq.GroupSubEntityRect.data.isKeyOb?ps:ps}}}]};var jf=4;Vq.HoverDataRect={comps:[{type:"shape",points:{func:function(){var Z=Vq.HoverDataRect.data;if(!Z)return[];var k=Z.min,I=Z.max,r=jf;return k.x-=r,k.y-=r,I.x+=r,I.y+=r,[k.x,k.y,k.x,I.y,I.x,I.y,I.x,k.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Vq.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},Vq.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Vq.Line.data.P1.x,Vq.Line.data.P1.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Vq.Line.data.P2.x,Vq.Line.data.P2.y],tk,tk]}}}]},Vq.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Vq.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Vq.Rect={comps:[{type:"shape",points:{func:function(){var A=Vq.Rect.data;if(!A)return[];var H=A.LT,r=A.LB,S=A.RB,w=A.RT;return[H.x,H.y,r.x,r.y,S.x,S.y,w.x,w.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return ps}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},rect:{func:function(){return[[Vq.Rect.data.LT.x,Vq.Rect.data.LT.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},rect:{func:function(){return[[Vq.Rect.data.LB.x,Vq.Rect.data.LB.y],tk,tk]
}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},rect:{func:function(){return[[Vq.Rect.data.RB.x,Vq.Rect.data.RB.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},rect:{func:function(){return[[Vq.Rect.data.RT.x,Vq.Rect.data.RT.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},visible:{func:function(){return Vq.Rect.data.L?!0:!1}},rect:{func:function(){return[[Vq.Rect.data.L.x,Vq.Rect.data.L.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},visible:{func:function(){return Vq.Rect.data.R?!0:!1}},rect:{func:function(){return[[Vq.Rect.data.R.x,Vq.Rect.data.R.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},visible:{func:function(){return Vq.Rect.data.T?!0:!1}},rect:{func:function(){return[[Vq.Rect.data.T.x,Vq.Rect.data.T.y],tk,tk]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Vq.Rect.data.rotation}},visible:{func:function(){return Vq.Rect.data.B?!0:!1}},rect:{func:function(){return[[Vq.Rect.data.B.x,Vq.Rect.data.B.y],tk,tk]}}}]};var sb=16;E.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return ps}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return ps}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Vq.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Vq.Anchor.data.POS.x,Vq.Anchor.data.POS.y],sb,sb]}}}]},Vq.TipShiftX=12,Vq.TipShiftY=12;var Pl=[8,28];Vq.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Vq.TipHelper.data.helperPos.x,Vq.TipHelper.data.helperPos.y,Pl[0]*Vq.TipHelper.data.size,Pl[1]]}},background:{func:function(){return Ik.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Vq.TipHelper.data.text}},rect:{func:function(){return[Vq.TipHelper.data.helperPos.x,Vq.TipHelper.data.helperPos.y,Pl[0]*Vq.TipHelper.data.size,Pl[1]]}},color:{func:function(){return Ik.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Nr=7;Vq.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!Vq.ShapePoint.data.dynamicVisible}},rect:{func:function(){var s=Vq.ShapePoint.data.point,C=Vq.ShapePoint.data.size||Nr;return[s,C+10,C+10]}},background:{func:function(){var Z=Date.now(),F=Vq.ShapePoint.data.dynamicPeriod||1500,K=Math.sin(Z%F/F*Math.PI);return"rgba(27,124,22,"+.5*K+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var d=Vq.ShapePoint.data.point,B=Vq.ShapePoint.data.size||Nr;return[d,B,B]}},background:{func:function(){var G=Vq.ShapePoint.data.isEnd;return G?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return Vq.ShapePoint.data.color||ps}}},{type:"rect",visible:{func:function(){return!!Vq.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return ps}},rect:{func:function(){var N=5;return[Vq.ShapePoint.data.point,N,N]}}}]},Vq.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!Vq.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return Vq.ShapeBgCurve.data.P}},segments:{func:function(){return Vq.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var w=Date.now(),V=Vq.ShapeBgCurve.data.dynamicPeriod||1500,C=Math.sin(w%V/V*Math.PI);return"rgba(27,124,22,"+.3*C+")"}}},{type:"shape",points:{func:function(){return Vq.ShapeBgCurve.data.P}},segments:{func:function(){return Vq.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return Vq.ShapeBgCurve.data.color||ps}}}]};var Ah=8;Vq.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var M=Vq.ShapeHighlighPoint.data;return[[M.x,M.y],Ah,Ah]}},background:{func:function(){return Ik.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Ph=10;Vq.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var X=Vq.ShapeHighlighRealPoint.data;return[[X.x,X.y],Ph,Ph]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return ps}}}]};var Gl=8;Vq.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var f=Vq.ShapeHighlighCtrlPoint.data,u=f.x,I=f.y,i=Gl/2;return[u-i,I-i,u-i,I+i,u+i,I+i,u+i,I-i]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ik.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return Ik.getStyle("shapeCtrlPointBorderColor")||ps}}}]};var qp=3;Vq.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Vq.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:qp,borderColor:{func:function(){return Ik.getStyle("curveHighlightColor")}}}]},Vq.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Vq.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Vq.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Vq.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Vq.MoveLineGuide.data.center?no:im}}}]};var fo=5;Vq.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var l=Vq.MoveLineGuideDistanceH.data,z=l.x0,m=l.y0;return[z,m-fo,z,m+fo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:im},{type:"shape",points:{func:function(){var m=Vq.MoveLineGuideDistanceH.data,r=m.x1,R=m.y1;return[r,R-fo,r,R+fo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:im},{type:"text",text:{func:function(){return Math.round(Vq.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var h=Vq.MoveLineGuideDistanceH.data;return[[(h.x0+h.x1)/2,h.y0-10],20,20]}},color:im,font:"12px Arial",align:"center"}]},Vq.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var l=Vq.MoveLineGuideDistanceV.data,v=l.x0,n=l.y0;return[v-fo,n,v+fo,n]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:im},{type:"shape",points:{func:function(){var u=Vq.MoveLineGuideDistanceV.data,m=u.x1,A=u.y1;return[m-fo,A,m+fo,A]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:im},{type:"text",text:{func:function(){return Math.round(Vq.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var r=Vq.MoveLineGuideDistanceV.data;return[[r.x0-10,(r.y0+r.y1)/2],20,20]}},color:im,font:"12px Arial",align:"center"}]},E.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Vq.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var v=Vq.EdgeElevationGuide.data,F=v.x,y=v.y,k=Ik.getStyle("curveElevationIntersectSize"),j=Ik.getStyle("curveElevationGuideShift");return F+=j[0],y+=j[1],[F-k,y-k,2*k,2*k]}}}]},E.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),E.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Vq.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Vq.ConnectGuide.data.rotation}},rect:{func:function(){var f=Vq.ConnectGuide.data.connect;f.x,f.y;var t=Ik.getStyle("connectGuideIntersectSize");return[[f.x,f.y],2*t,2*t]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var M=Vq.ConnectGuide.data.cursorPos||Vq.ConnectGuide.data.connect,r=Ik.getStyle("connectGuideIntersectSize");return[[M.x,M.y],2*r-2,2*r-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var E=Vq.ConnectGuide.data.connect,W=Vq.ConnectGuide.data.cursorPos||E;return[E.x,E.y,E.x+.5*(W.x-E.x),E.y,W.x+.5*(E.x-W.x),W.y,W.x,W.y]}}}]},E.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),E.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Vq.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var H=Vq.ConnectGuideGarbage.data.hover;return H?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var w=Vq.ConnectGuideGarbage.data,$=Ik.getStyle("connectGuideGarbageIntersectsize");return w.hover&&($+=5),[[w.x,w.y],2*$,2*$]}}}]};var wp=6;Vq.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Vq.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var Y=Vq.ShapeActivingCtrl.data;return[Y.point.x,Y.point.y,Y.c1.x,Y.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return ps}}},{type:"shape",visible:{func:function(){return Vq.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var n=Vq.ShapeActivingCtrl.data;return[n.point.x,n.point.y,n.c2.x,n.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return ps}}},{type:"shape",visible:{func:function(){return Vq.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var T=Vq.ShapeActivingCtrl.data.c1,s=T.x,i=T.y,Z=wp/2;return"c1"===Vq.ShapeActivingCtrl.data.hl&&(Z+=.5),[s-Z,i-Z,s-Z,i+Z,s+Z,i+Z,s+Z,i-Z]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ik.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Vq.ShapeActivingCtrl.data.hl?Ik.getStyle("shapeCtrlPointHighlightBorder")||ps:Ik.getStyle("shapeCtrlPointBorderColor")||ps}}},{type:"shape",visible:{func:function(){return Vq.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var q=Vq.ShapeActivingCtrl.data.c2,c=q.x,a=q.y,E=wp/2;return"c2"===Vq.ShapeActivingCtrl.data.hl&&(E+=.5),[c-E,a-E,c-E,a+E,c+E,a+E,c+E,a-E]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ik.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Vq.ShapeActivingCtrl.data.hl?Ik.getStyle("shapeCtrlPointHighlightBorder")||ps:Ik.getStyle("shapeCtrlPointBorderColor")||ps}}}]},Vq.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return ps}},rect:{func:function(){return[[Vq.RoundPoint.data.x,Vq.RoundPoint.data.y],tk,tk]}}}]},Vq.AttachPoint={comps:[{type:"rect",background:{func:function(){return Vq.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return ps}},rect:{func:function(){var U=Vq.AttachPoint.data.isAttach?tk+4:tk;return[[Vq.AttachPoint.data.x,Vq.AttachPoint.data.y],U,U]}}}]},Vq.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return Vq.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return Vq.SimpleRect.data.color||ps}},rect:{func:function(){var U=Vq.SimpleRect.data;return[U.x,U.y,U.width,U.height]}}}]},E.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),Vq.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var $=Vq.MoveDummy.data;return[[$.pos.x,$.pos.y],2*$.size,2*$.size]}}}]},Nl.Icons.DrawIcon=function(m,n,Z,p){Z.width=Z.height=Jg,Z.data=p,Ik=m,E.Default.drawImage(n,Z,0,0,Jg,Jg)},Nl.Icons.MapPoints=function(I,B){for(var T=0,m=I.length;m>T;T++)I[T]/=B},Nl.roundTo=function(R,l,u){var W=Math.abs(R%l);return u>W||u>l-W?l*Math.round(R/l):R},Nl.toFixed=function(z){return Math.round(100*z)/100},Nl.getDataMatrix=function(A){if(A instanceof E.Shape){var K=new E.Math.Matrix2d,V=A.getPosition();return K.translate(-V.x,-V.y).scale(A.getScale().x,A.getScale().y).rotate(A.getRotation()).translate(V.x,V.y),K}return A.getMatrix?A.getMatrix():new E.Math.Matrix2d};var xm=Nl.Math.Curve=function(){this._curves=[]};xm.prototype={},xm.prototype.constructor=xm,xm.prototype.createFromHtShape=function(B,H,x){H instanceof E.List&&(H=H.toArray());var g,t,b,p,c,n,z,P=this,D=null,l=null,e=0,N=Nl.Math.Vector2,s=Nl.Math.CubicBezier,I=function(s){return new N(B[s],B[s+1],x?x[s/2]:S)};for(t=0,b=H.length;b>t;t++){switch(p=H[t],c=null,p){case 1:l=I(e),D=l,e+=2;break;case 2:g=I(e),e+=2,c=new s(l,l.clone(),g.clone(),g),l=g;break;case 3:n=I(e),g=I(e+2),e+=4,c=new s(l,n.clone().sub(l).multiplyScalar(2/3).add(l),n.clone().sub(g).multiplyScalar(2/3).add(g),g),l=g;break;case 4:n=I(e),z=I(e+2),g=I(e+4),e+=6,c=new s(l,n,z,g),l=g;break;case 5:if(!D)break;c=new s(l,l.clone(),D.clone(),D),l=null,D=null}c&&(c._index=P._curves.length,P._curves.push(c))}},xm.prototype.checkPoint=function(t,I){var y,k,F,e,z,m=this,T=m._curves;for(y=0,k=T.length;k>y;y++)if(e=T[y],z=e.intersectRect(t,I,I),z.length)return F=0,z.forEach(function(H){F+=H.t}),F/=z.length,t=e.getPointAt(F),t.t=F,{bezier:e,intersection:t}},xm.prototype.insertKnot=function(w,G){var N=w.insertKnot(G),Z=this,U=Z._curves;U.splice(w._index,1,N[0],N[1])},xm.prototype._isCloseEnough=function(l,E){return Math.abs(l.x-E.x)<1e-6&&Math.abs(l.y-E.y)<1e-6},xm.prototype._isSamePoint=function(Q,e){return Q===e},xm.prototype.moveRealPoint=function(O,D){var L=this,f=L._curves,X=D.clone().sub(O);f.forEach(function(B){var i=B._p1;B._p2,B._p3;var o=B._p4;L._isSamePoint(i,O)&&(B._p2.add(X),B._p1=D),L._isSamePoint(o,O)&&(B._p3.add(X),B._p4=D)})},xm.prototype.moveCtrlDueToRealPointMovement=function(O,Z){var b=this,X=b._curves,x=function(F){F.add(Z),F.e&&Z.e&&(F.e+=Z.e)};X.forEach(function(m){var l=m._p1;m._p2,m._p3;var L=m._p4;b._isSamePoint(l,O)&&x(m._p2),b._isSamePoint(L,O)&&x(m._p3)})},xm.prototype.moveCtrlPoint=function(r,p,M){var v=r[M];if(v){v.e!==S&&(p.e=v.e);var X=this,_=X._curves;p.clone().sub(v),_.forEach(function(S){var o;"c2"===M?o="_p2":"c1"===M&&(o="_p3"),X._isSamePoint(S[o],v)&&(S[o]=p)}),r[M]=p}},xm.prototype.deleteRealPoint=function(_,p){var B,W,A,u,R,V,J,o=this,s=o._curves,E={},H=[],I=Nl.Math.CubicBezier;for(W=0,A=s.length;A>W;W++)B=s[W],u=B._p1,R=B._p2,V=B._p3,J=B._p4,(E[W]||!o._isSamePoint(u,_))&&(o._isSamePoint(J,_)?A>W+1&&o._isSamePoint(s[W+1]._p1,_)&&(p||H.push(new I(u,R,s[W+1]._p3,s[W+1]._p4))):H.push(B));o._curves=H},xm.prototype.findPairs=function(W,I){var A,X,q,Q,U,c,x,D,w=this,g=w._curves,H={},z=[];for(X=0,q=g.length;q>X;X++)A=g[X],Q=A._p1,U=A._p2,c=A._p3,x=A._p4,!H[X]&&w._isSamePoint(Q,W)&&(I?z.push({point:Q,r2:x}):z.push({point:Q,c2:U})),w._isSamePoint(x,W)&&(D=I?{point:x,r1:Q}:{point:x,c1:c},q>X+1&&w._isSamePoint(g[X+1]._p1,W)&&(I?D.r2=g[X+1]._p4:D.c2=g[X+1]._p2,H[X+1]=!0),z.push(D));return z},xm.prototype.toHtShape=function(){var N=this,h=N._curves,d=[],M=[],f={x:1/0,y:1/0};return h.forEach(function(t){var j=t._p1,q=t._p2,H=t._p3,S=t._p4;return N._isCloseEnough(j,f)||(d.push(1),M.push(j.clone())),f=S,N._isCloseEnough(j,q)&&N._isCloseEnough(H,S)?(d.push(2),M.push(S.clone()),void 0):(d.push(4),M.push(q.clone(),H.clone(),S.clone()),void 0)}),{segments:d,points:M}};var Cn=Nl.Math.CubicBezier=function(g,M,S,n){var t=this;t._id=Nl.Math.CubicBezier._globalId++,t._p1=g,t._p2=M,t._p3=S,t._p4=n};Cn._globalId=1,Cn.prototype={},Cn.prototype.constructor=Cn,Cn.prototype.toString=function(){return this._id},Cn.prototype.intersectRect=function(V,C,K){var o=C/2,d=K/2,p=V.x,n=V.y,Y=Nl.Math.Vector2,A=new Y(-o+p,-d+n),t=new Y(o+p,d+n),g=new Y(t.x,A.y),z=new Y(A.x,t.y),P=this,b=P.intersectLine(A,g),U=P.intersectLine(g,t),v=P.intersectLine(t,z),q=P.intersectLine(z,A),Q=b.concat(U).concat(v).concat(q);return Q},Cn.prototype.intersectLine=function(D,J){var H,A,$,j,h,v,y,d,G,e,E,f,c,m=this,Z=D.clone().min(J),T=D.clone().max(J);j=m._p1,h=m._p2,v=m._p3,y=m._p4,H=j.clone().multiplyScalar(-1),A=h.clone().multiplyScalar(3),$=v.clone().multiplyScalar(-3),E=H.add(A).add($).add(y),H=j.clone().multiplyScalar(3),A=h.clone().multiplyScalar(-6),$=v.clone().multiplyScalar(3),e=H.add(A).add($),H=j.clone().multiplyScalar(-3),A=h.clone().multiplyScalar(3),G=H.add(A),d=j.clone(),c=new Nl.Math.Vector2(D.y-J.y,J.x-D.x),f=D.x*J.y-J.x*D.y;for(var r=m.getRoots(c.dot(E),c.dot(e),c.dot(G),c.dot(d)+f),a=new Array,p=0,n=r.length;n>p;p++){var K=r[p];if(!(0>K||K>1)){var Y=j.clone().lerp(h,K),I=h.clone().lerp(v,K),W=v.clone().lerp(y,K),F=Y.lerp(I,K),t=I.lerp(W,K),N=F.lerp(t,K);N.t=K,D.x==J.x?Z.y<=N.y&&N.y<=T.y&&a.push(N):D.y==J.y?Z.x<=N.x&&N.x<=T.x&&a.push(N):N.x>=Z.x&&N.y>=Z.y&&N.x<=T.x&&N.y<=T.y&&a.push(N)}}return a},Cn.prototype.solveTForPoint=function(b){var w,B,z,W,t=this;w=t._p1.x-b.x,B=t._p2.x-b.x,z=t._p3.x-b.x,W=t._p4.x-b.x;for(var A=t.getRoots(W-3*z+3*B-w,3*z-6*B+3*w,3*B-3*w,w),U=S,X=1/0,E=0,g=A.length;g>E;E++){var p=A[E];if(!(0>p||p>1)){var M=t._p1.clone().lerp(t._p2,p),n=t._p2.clone().lerp(t._p3,p),V=t._p3.clone().lerp(t._p4,p),D=M.lerp(n,p),F=n.lerp(V,p),h=D.lerp(F,p);h.t=p;var d=Math.abs(h.y-b.y);X>d&&(X=d,U=h)}}return U},Cn.prototype.getPointAt=function(E){var s=this,G=s._p1,C=s._p2,h=s._p3,W=s._p4,R=G.clone().lerp(C,E),j=C.clone().lerp(h,E),m=h.clone().lerp(W,E),$=R.lerp(j,E),p=j.lerp(m,E);return $.lerp(p,E)},Cn.prototype.getRoots=function(D,s,q,A){var C,X,R,f,i,z=new Array;if(Math.abs(D)<1e-6){var C=s,X=q/C,R=A/C,f=X*X-4*R;if(f>0){var i=Math.sqrt(f);z.push(.5*(-X+i)),z.push(.5*(-X-i))}else 0==f&&z.push(.5*-X)}s/=D,q/=D,A/=D,C=(3*q-s*s)/3,X=(2*s*s*s-9*q*s+27*A)/27;var v=s/3,J=X*X/4+C*C*C/27,x=X/2;if(Math.abs(J)<=1e-6&&(J=0),J>0){var Q,M,i=Math.sqrt(J);Q=-x+i,M=Q>=0?Math.pow(Q,1/3):-Math.pow(-Q,1/3),Q=-x-i,Q>=0?M+=Math.pow(Q,1/3):M-=Math.pow(-Q,1/3),z.push(M-v)}else if(0>J){var S=Math.sqrt(-C/3),j=Math.atan2(Math.sqrt(-J),-x)/3,T=Math.cos(j),Z=Math.sin(j),K=Math.sqrt(3);z.push(2*S*T-v),z.push(-S*(T+K*Z)-v),z.push(-S*(T-K*Z)-v)}else{var Q;Q=x>=0?-Math.pow(x,1/3):Math.pow(-x,1/3),z.push(2*Q-v),z.push(-Q-v)}return z},Cn.prototype._70I=function(){var $=this;return $._p1.distanceToSquared($._p2)<1e-10&&$._p3.distanceToSquared($._p4)<1e-10},Cn.prototype.insertKnot=function(F){var j=this,x=j._p1,_=j._p2,J=j._p3,e=j._p4,i=x.clone().lerp(_,F),X=_.clone().lerp(J,F),u=J.clone().lerp(e,F),w=i.clone().lerp(X,F),o=X.clone().lerp(u,F),m=w.clone().lerp(o,F);return j._70I()?(x.clone().lerp(e,F),[new Nl.Math.CubicBezier(x,x.clone(),m.clone(),m),new Nl.Math.CubicBezier(m,m.clone(),e.clone(),e)]):[new Nl.Math.CubicBezier(x,i,w,m),new Nl.Math.CubicBezier(m,o,u,e)]};var Ul=E.Default.getInternal().ui().EdgeUI,Lo={_47O:function(_){var H=this,c=Lo.getBackups()._47O;Nl.inEdit(H.gv)||c.call(H,_)}};Nl.Inject.registAsModule(Lo,Ul);var Bk=E.Default.getInternal().ui().NodeUI,eq={_47O:function($){var Y=this,C=eq.getBackups()._47O;Nl.inEdit(Y.gv)||C.call(Y,$)},getSelectWidth:function(){var T=this,O=T.gv,S=T._data;if(O.isEditable(S)&&Nl.inEdit(O))return 0;var J=eq.getBackup("getSelectWidth");return J.call(T)}};Nl.Inject.registAsModule(eq,Bk);var Gd=E.graph.GraphView,tm={_editPointSize:function(){var Y=E.Default.isTouchable,A=Nl.getStyle("pointSize");return A[Y?0:1]}(),isPointEditable:function(c){var O=this;if(Nl.inEdit(O))return O._pointEditableFunc?O._pointEditableFunc(c):!0;var q=tm.getBackup("isPointEditable");q.call(O,c)},isEditable:function(m){var T,c=this,B=tm.getBackup("isEditable");if(T=m instanceof Nl.Group?!0:B.call(c,m),!Nl.inEdit(c))return T;if(!(m instanceof E.Edge))return T;if(!m.s("2d.editable"))return!1;var f=c.getEditableFunc();return f?f(m):!0},_42:function(f,y){var d=this,K=tm.getBackups()._42;if(K.call(d,f,y),Nl.inEdit(d)){var C=d.getEditInteractor();C.drawImpl()}}};Nl.Inject.registAsModule(tm,Gd);var uc=E.Default.getInternal().ui().ShapeUI,jm={_47O:function(L){var C=this,s=jm.getBackups()._47O;Nl.inEdit(C.gv)||s.call(C,L)}};Nl.Inject.registAsModule(jm,uc);var mq=E.graph.DefaultInteractor,he={handle_mousewheel:function(v){var d=this,C=he.getBackup("handle_mousewheel");Nl.inEdit(d.gv)||C.call(d,v)}};Nl.Inject.registAsModule(he,mq);var Lf=E.graph.MoveInteractor,Pk={_calcShift:function(R,_){var W=this,h=Pk.getBackup("_calcShift"),Z=W.gv;if(!Nl.inEdit(Z))return h.call(W,R,_);var l=Z.getEditInteractor(),K=l.getSubModule("Move").calcShift(R,_,W);return K||h.call(W,R,_)},clear:function(t){var M=this,g=Pk.getBackup("clear");g.call(M,t);var j=M.gv;if(Nl.inEdit(j)){var c=j.getEditInteractor();c.getSubModule("Move").clear(t)}}};Nl.Inject.registAsModule(Pk,Lf);var wg=Nl.Rect=function(Y){this.catalog="Rect",this._interactor=Y};wg.prototype={},wg.prototype.constructor=wg,wg.prototype.gatherInfo=function(v,W){var Q=this;if(1===W.length){var d=W[0];return d instanceof E.Shape&&d._70I()?Q.gatherLine(v,d):qq(d,v)?!1:Q.gatherSingleTarget(v,d)}return W.length>1?Q.gatherMultiTargets(v,W):!1},wg.prototype.gatherSingleTarget=function(H,Y){if(Y.getCorners){var Q,F=this,G=F.info;F.target=Y,Q=F.screenInfo={};var i=Y.getCorners();G.LT=new Nl.Math.Vector2(i[0]),G.LB=new Nl.Math.Vector2(i[1]),G.RB=new Nl.Math.Vector2(i[2]),G.RT=new Nl.Math.Vector2(i[3]),G.T=G.LT.clone().add(G.RT).divideScalar(2),G.B=G.LB.clone().add(G.RB).divideScalar(2),G.L=G.LT.clone().add(G.LB).divideScalar(2),G.R=G.RT.clone().add(G.RB).divideScalar(2);for(var r in G)Q[r]=Nl.toScreenPosition(H,G[r]);var P=F._interactor,s=P.getStyle("checkSize"),D=function(U,J,D){var G=J.clone().sub(U).setLength(-s),Y=D.clone().sub(U).setLength(-s),d=G.add(Y).add(U);return d};return Q.rotLT=D(Q.LT,Q.RT,Q.LB),Q.rotLB=D(Q.LB,Q.LT,Q.RB),Q.rotRB=D(Q.RB,Q.LB,Q.RT),Q.rotRT=D(Q.RT,Q.LT,Q.RB),Q.rotT=Q.rotLT.clone().add(Q.rotRT).divideScalar(2),Q.rotB=Q.rotLB.clone().add(Q.rotRB).divideScalar(2),Q.rotL=Q.rotLT.clone().add(Q.rotLB).divideScalar(2),Q.rotR=Q.rotRT.clone().add(Q.rotRB).divideScalar(2),Q.rotation=Y.getRotation(),F.gatherConnectInfo(),!0}},wg.prototype.gatherConnectInfo=function(){var b=this,p=b.target,V=b._interactor,h=b.screenInfo,l=V.gv;if(l.isConnectActionVisible(p)&&V.getStyle("connectGuideVisible")){var d;p.s&&(d=p.s("connectGuideShift")),d||(d=V.getStyle("connectGuideShift"));var n=p.getAnchor(),w=p.getSize(),x=p.toGlobal({x:w.width*(d[0]-n.x),y:w.height*(d[1]-n.y)});x=Nl.toScreenPosition(l,x),h.P1?x.add(h.P2.clone().sub(h.P1).setLength(d[2])):(x.add(h.RT.clone().sub(h.LT).setLength(d[2])),x.add(h.LB.clone().sub(h.LT).setLength(d[3]))),h.connect=x}},wg.prototype.gatherMultiTargets=function(P,x){var J=Nl.Group.findOrCreateGroup(x);if(!J)return!1;var c=this;return c.editing&&"rotate"!==c.editing.mode||J.calcInfo(),c.gatherSingleTarget(P,J)},wg.prototype.gatherLine=function(D,E){this.target=E;var T=this.screenInfo={},Z=E.getPoints(),b=Nl.getDataMatrix(E);return T.P1=Nl.toScreenPosition(D,b.apply(Z.get(0))),T.P2=Nl.toScreenPosition(D,b.apply(Z.get(1))),this.gatherConnectInfo(),!0},wg.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],wg.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],wg.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],wg.prototype.check=function(Y,L,J){if(E.Default.isLeftButton(L)){var G=this;if(G.editing=null,G.tipInfo=null,G.screenInfo){var f=G.target,F=Y.isEditable(f),p=G.screenInfo;if(F&&p.connect){var i=G._checkConnect(J);if(i)return i}if(p.P1)return G._checkLine(J);var e,g,r,C=null,B=G._interactor,V=B.getStyle("checkSize");if(F&&Y.isRectEditable(f))for(g=0;g<Nl.Rect.ResizeKeys.length;g++)if(r=Nl.Rect.ResizeKeys[g],Nl.checkHit(J,p[r],V)){C=r,e="resize";break}if(!C&&F&&Y.isRotationEditable(f)&&!B.getStyle("rotateAsClock")){var y=B.getStyle("rotateCheckSize");for(g=0;g<Nl.Rect.RotateKeys.length;g++)if(r=Nl.Rect.RotateKeys[g],Nl.checkHit(J,p[r],y)){C=r,e="rotate";break}}if(!C)return B.setCursor("default"),void 0;if("rotate"===e){var D,l=Y.lp(L);if(f instanceof Nl.Group){var Z=B.getStyle("groupRotateModeKey");"string"==typeof Z&&(Z=[Z]);for(var P=!1,A=0,k=Z.length;k>A;A++)if(L[Z[A]]){P=!0;break}var c=B.getStyle("groupRotateModeDefault");D=P?"batch"===c?"block":"batch":c}var R="batch"===D?f.getAnchor2():f.getPosition(),z=Math.atan2(l.y-R.y,l.x-R.x);B._setRotateCursor(z),G.editing={mode:e,key:C,pos:R,flipY:f.getScale().y<0,rotation:f.getRotation(),hitRot:z},D&&(G.editing.groupRotateMode=D)}else{var m=Nl.Rect.ResizeKeys.indexOf(C),W=Nl.Rect.ResizeDirection[m],Q=Math.cos(f.getRotation()),I=Math.sin(f.getRotation()),K=W.x*Math.sign(f.getScale().x),X=W.y*Math.sign(f.getScale().y),N=Math.atan2(-I*K-Q*X,Q*K-I*X),t=(Math.round(N/(Math.PI/4))+8)%8,b=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][t];this._interactor.setCursor(b);var u=f.getWidth(),O=f.getHeight(),d=f.getAnchor();G.editing={mode:e,key:C,rect:{x:-u*d.x,y:-O*d.y,width:u,height:O},anchor:d,matrix:f.getMatrix()}}return C}}},wg.prototype._checkLine=function(r){var X=this;X.screenInfo;var P,f=X._interactor.getStyle("checkSize");if(Nl.checkHit(r,X.screenInfo.P1,f))P="P1";else{if(!Nl.checkHit(r,X.screenInfo.P2,f))return this._interactor.setCursor("default"),void 0;P="P2"}return X.editing={mode:"line",key:P},P},wg.prototype._checkConnect=function(f){var K=this,t=K.screenInfo,d=K._interactor,S=d.getStyle("connectGuideIntersectSize"),U=t.connect,k=f.x,H=U.x;if(H>k&&S>H-k&&Math.abs(U.y-f.y)<S||k>=H&&Nl.checkHit(f,U,S)){var B="connect",s=N.getConnectAction(d.gv);if(K.editing={mode:B},s&&s.delete)if(K.target instanceof Nl.Group){var $=!0;d.gv.sm().getSelection().each(function(_){s.delete.visible.call(null,d.gv,_)||($=!1)}),K.editing.hasDeleteAction=$}else s.delete.visible.call(null,d.gv,K.target)&&(K.editing.hasDeleteAction=!0);return d.setCursor("default"),B}},wg.prototype._fireEditEvent=function(w,s){var L=this._interactor,S=this.editing;if(S){var D=S.mode;D="rotate"===D?"Rotation":"connect"===D?"Connection":"resize"===D?"Rect":D[0].toUpperCase()+D.slice(1),L.fi({kind:w+"Edit"+D,event:s})}},wg.prototype.startEdit=function(y,m){y.startDragging(m);var Y=this;Y._interactor.fi({kind:"prepareEdit",event:m});var s=Y.editing,g=Y.target;if(s){if(Y._fireEditEvent("begin",m),"rotate"===s.mode)return s.groupRotateMode&&g.beginRotate(s),void 0;if("connect"!==s.mode)("line"===s.mode||g&&0===g.getRotation())&&(Y._inSmartGuide=!0,Y._interactor.rectGuide.gatherRects());else if(s.hasDeleteAction){var N=y.gv,B=Y._interactor.getStyle("connectGuideGarbageShift");s.garbageInfo={x:N.getWidth()*B[0]+B[2],y:N.getHeight()*B[1]+B[3],size:Y._interactor.getStyle("connectGuideGarbageIntersectsize")},y._42()}}},wg.prototype._46O=function(u){var w,z,c=this,Z=c.editing,p=c.target;if(Z){if("connect"===Z.mode&&!Z.canceled&&!Z.deleted)try{Z.garbageInfo&&Z.garbageInfo.hover?N.doDeleteConnectionAction(c._interactor.gv,p):N.doConnectAction(c._interactor.gv,p,Z.target)}catch(o){console.error(o)}z=Z.freezeFlag,w=c.editing.groupRotateMode,c._fireEditEvent("end",u),c.editing=null}c.tipInfo=null,c._inSmartGuide&&(c._interactor.rectGuide.clear(),c._inSmartGuide=!1),w&&p&&p.endRotate(),p instanceof E.Block&&(z===S?delete p._freezeSyncFromChildren:p._freezeSyncFromChildren=z,p.updateFromChildren())},wg.prototype.handleNormalStateDelete=function(){var D=this,m=D.editing;if(m&&"connect"===m.mode&&!m.canceled&&!m.deleted){if(m.garbageInfo){try{N.doDeleteConnectionAction(D._interactor.gv,D.target)}catch(A){console.error(A)}m.garbageInfo=null
}return m.cursorPos=null,m.targetCorners=null,m.deleted=!0,D._interactor._42(),!0}},wg.prototype.handleNormalStateKeyDown=function(g){var C=this,x=C.editing;return!x||"connect"!==x.mode||x.canceled||x.deleted?void 0:E.Default.isEsc(g)?(x.cursorPos=null,x.targetCorners=null,x.canceled=!0,C._interactor._42(),!0):void 0},wg.prototype.handleEdit=function(T,n){var B=this,d=B.editing;if(d){var v,U,e,D,s,L=B.target,j=d.key,o=d.mode,M=T.lp(n),y=B._interactor;if("connect"===o){if(d.canceled)return;if(d.deleted)return;d.cursorPos=y._getLogicalPoint(n);var q=d.garbageInfo;return q&&Nl.checkHit(d.cursorPos,q,q.size)?(q.hover=!0,d.target=null,d.targetCorners=null):(q&&(q.hover=!1),d.target=T.getDataAt(M,function(G){return T.isSelectable(G)?Sl(G)?!0:!1:!1})||null,d.targetCorners=Nl.getTargetCornersOnScreen(T,d.target)),y._42(),void 0}if("rotate"===o){var H,m,C=d.pos,G=Math.atan2(M.y-C.y,M.x-C.x);if(d.groupRotateMode?m=G-d.hitRot:(H=G-d.hitRot,m=d.rotation+H),m%=2*Math.PI,0>m&&(m+=2*Math.PI),!E.Default.isCtrlDown(n)){var x,W;$q(n)?(x=y.getStyle("shiftRotateRound"),W=x/2):(x=y.getStyle("rotateRound"),W=y.getStyle("rotateSensitivity")),m=Nl.roundTo(m,x,W)}d.groupRotateMode?(H=m-(d.lastRotation||0),0!==H&&(L.addRotation(H,d.groupRotateMode,function(R){return T.isRotationEditable(R)}),d.lastRotation=m)):L.setRotation(m),y._setRotateCursor(G),m>Math.PI&&(m-=2*Math.PI);var t=180*(m/Math.PI);t=t.toFixed(2),v=""+t+"°"}else if("resize"===o){var u=d.rect;e=u.x,D=u.y;var c,O=u.width,i=u.height,A=d.anchor,k=d.matrix,$=L.s&&L.s("keepAspectRatio")||y.getStyle("keepAspectRatio");$q(n)&&($=!$);var g=B._unionPointMode1,I=B._unionPointMode2;if(B._inSmartGuide&&!E.Default.isCtrlDown(n)&&!$){var Z;"L"===j||"R"===j?Z="x":("T"===j||"B"===j)&&(Z="y"),B._adsorbedToClosest(M,Z),s=!0}c=k.tfi(M);var h;"LT"===j?(u=g(c,{x:e+O,y:D+i},O,i,$),h=9):"T"===j?(u=I({x:e,y:c.y},{x:e+O,y:D+i},O,i,$,"v"),h=1):"RT"===j?(u=g(c,{x:e,y:D+i},O,i,$),h=33):"L"===j?(u=I({x:c.x,y:D},{x:e+O,y:D+i},O,i,$,"h"),h=8):"R"===j?(u=I({x:e,y:D},{x:c.x,y:D+i},O,i,$,"h"),h=32):"LB"===j?(u=g(c,{x:e+O,y:D},O,i,$),h=12):"B"===j?(u=I({x:e,y:D},{x:e+O,y:c.y},O,i,$,"v"),h=4):"RB"===j&&(u=g(c,{x:e,y:D},O,i,$),h=36);var N=k.tf(u.x+u.width*A.x,u.y+u.height*A.y);L instanceof E.Block&&(d.hasOwnProperty("freezeFlag")||(d.freezeFlag=L._freezeSyncFromChildren,L._freezeSyncFromChildren=!0)),L.setPosition(N),L.setSize(u.width,u.height),s&&(U=L.getRect(),y.rectGuide.gatherLines({node:L,x:U.x,y:U.y,w:U.width,h:U.height},Z,h)),v=""+Math.round(u.width)+" * "+Math.round(u.height)}else if("line"===o){if($q(n)){var F=L.getPoints(),a="P1"===j?F.get(1):F.get(0),K={x:M.x-a.x,y:M.y-a.y},l=y.getStyle("shiftLineRotateRound"),p=B._shiftDirList;if(!p||B._shiftRotateRound!==l){B._shiftRotateRound=l,B._shiftDirList=p=[];for(var z=0;z<Math.PI;z+=l)p.push({x:V(z),y:X(z)})}for(var R,_=0,Q=0,S=p.length;S>Q;Q++){var J=p[Q],w=J.x*K.x+J.y*K.y;Math.abs(w)>Math.abs(_)&&(_=w,R=J)}M={x:a.x+R.x*_,y:a.y+R.y*_},y.rectGuide.clear()}else B._inSmartGuide&&!E.Default.isCtrlDown(n)&&(B._adsorbedToClosest(M),s=!0);var b=Nl.getDataMatrix(L).applyInverse(M);L.setPoint("P1"===j?0:1,b,!0);var P=L.getPoints(),Y=P.get(0),r=P.get(1);e=Y.x-r.x,D=Y.y-r.y,v=" "+Math.round(Math.sqrt(e*e+D*D))+" ",s&&(U=L.getRect(),y.rectGuide.gatherLines({node:L,x:U.x,y:U.y,w:U.width,h:U.height}))}if(v){var f=E.Default.getLogicalPoint(n,y._canvas);f.x+=Nl.Icons.TipShiftX,f.y+=Nl.Icons.TipShiftY,B.tipInfo={helperPos:f,text:v,size:v.length}}B._fireEditEvent("between",n)}},wg.prototype._unionPointMode1=function(y,K,$,k,r){if(r&&$&&k){var B=y.x-K.x,G=y.y-K.y;Math.abs(B*k)<Math.abs(G*$)?(G=Math.sign(G)*Math.abs(B*k/$),y.y=K.y+G):(B=Math.sign(B)*Math.abs(G*$/k),y.x=K.x+B)}return E.Default.unionPoint(y,K)},wg.prototype._unionPointMode2=function(t,Z,C,I,D,L){var T=E.Default.unionPoint(t,Z);if(D&&C&&I){var e;"v"===L?(e=T.x+T.width/2,T.width=C*T.height/I,T.x=e-T.width/2):(e=T.y+T.height/2,T.height=I*T.width/C,T.y=e-T.height/2)}return T},wg.prototype._adsorbedToClosest=function(d,U){var c=this,t=c._interactor,b=t.rectGuide.findClosest(d,U),z=t.gridGuide.findClosest(d,U),W=1/0,H=1/0;b&&(isFinite(b.x)&&(W=b.x),isFinite(b.y)&&(H=b.y)),z&&(isFinite(z.x)&&Math.abs(z.x)<Math.abs(W)&&(W=z.x),isFinite(z.y)&&Math.abs(z.y)<Math.abs(H)&&(H=z.y)),isFinite(W)&&(d.x+=W),isFinite(H)&&(d.y+=H)},wg.prototype._42=function(E,n,p){var s=this;s.info={},s.screenInfo=null;var y=s._interactor;if(!y.editDetail&&s.gatherInfo(n,p)){var z=s.editing,H=z?z.groupRotateMode:null,l=s.screenInfo;if("block"!==H){if(l.P1?Nl.Icons.DrawIcon(y,E,Nl.Icons.Line,l):Nl.Icons.DrawIcon(y,E,Nl.Icons.Rect,l),l.connect&&(Nl.Icons.DrawIcon(y,E,Nl.Icons.ConnectGuide,{rotation:l.rotation,connect:l.connect,cursorPos:z?z.cursorPos:null}),z)){if(z.targetCorners){for(var e={x:1/0,y:1/0},_={x:-1/0,y:-1/0},N=0,i=z.targetCorners.length;i>N;N+=2)e.x=Math.min(e.x,z.targetCorners[N]),_.x=Math.max(_.x,z.targetCorners[N]),e.y=Math.min(e.y,z.targetCorners[N+1]),_.y=Math.max(_.y,z.targetCorners[N+1]);Nl.Icons.DrawIcon(y,E,Nl.Icons.HoverDataRect,{min:e,max:_,color:y.getStyle("hoverGuideColor")||y.getStyle("baseColor")})}z.garbageInfo&&Nl.Icons.DrawIcon(y,E,Nl.Icons.ConnectGuideGarbage,z.garbageInfo)}s.tipInfo&&Nl.Icons.DrawIcon(y,E,Nl.Icons.TipHelper,s.tipInfo)}s.target instanceof Nl.Group&&s.target._42(y,E,n)}};var bo=Nl.Anchor=function(M){this.catalog="Anchor",this._interactor=M};bo.prototype={},bo.prototype.constructor=bo,bo.prototype.gatherInfo=function(Y,k){var j=this;if(1===k.length){var g=k[0];if(!g.getAnchor)return;if(g instanceof E.Shape&&g._70I())return;if(qq(g,Y))return;return j.gatherSingleTarget(Y,k[0])}return k.length>1?j.gatherMultiTargets(Y,k):!1},bo.prototype.gatherSingleTarget=function(u,M){var L=this;return L.info.POS=M.getPosition(),L.screenInfo.POS=Nl.toScreenPosition(u,L.info.POS),L.target=M,!0},bo.prototype.gatherMultiTargets=function(J,n){var g=this,s=Nl.Group.findOrCreateGroup(n);return s?(g.screenInfo.POS=Nl.toScreenPosition(J,s.getAnchor2()),g.target=s,!0):!1},bo.prototype.isVisible=function(){var d=this,Q=d._interactor;if(Q.getStyle("anchorVisible")===!1)return!1;var F=d.target;if(F){if(this.editing)return!0;var J=F.getAnchor(),c=Q.getStyle("anchorOutsideVisibleThreshold");if(J.x<-c||J.x>1+c||J.y<-c||J.y>1+c)return!0;var w=F.getSize(),y=F.getScale(),t=Math.min(Math.abs(w.width*y.x),Math.abs(w.height*y.y));if(t*Q.gv._zoom<Q.getStyle("anchorHideThreshold"))return!1}return!0},bo.prototype.check=function(S,x,o){if(E.Default.isLeftButton(x)){var M=this,_=M._interactor;if(M.isVisible()&&_.getStyle("anchorMovable")!==!1){M.editing=null,M.tipInfo=null;var I=M.target;if(I&&S.isAnchorEditable(I)&&S.isEditable(I)){var q;if(M.screenInfo&&(q=M.screenInfo.POS)&&Nl.checkHit(o,new Nl.Math.Vector2(q),_.getStyle("checkSize"))){if(I instanceof Nl.Group)return M.editing={},!0;var $=I.getWidth(),s=I.getHeight(),R=I.getAnchor();return M.editing={rect:{x:-$*R.x,y:-s*R.y,width:$,height:s},anchor:R,matrix:I.getMatrix()},!0}}}}},bo.prototype.startEdit=function(P,C){P.startDragging(C),P.fi({kind:"beginEditAnchor",event:C})},bo.prototype._46O=function(m){var K=this;K.editing&&(K.editing=null,K._interactor.fi({kind:"endEditAnchor",event:m})),K.tipInfo=null},bo.prototype.handleEdit=function(W,S){var i=this,c=i.target;if(c){var U=i.editing;if(U){var q=W.lp(S),F=i._interactor;if(c instanceof Nl.Group)return c.setAnchor2(q),F._42(),void 0;var Z=U.matrix,s=Z.tfi(q),f=U.rect,K=(s.x-f.x)/f.width,D=(s.y-f.y)/f.height;if(!E.Default.isCtrlDown(S)){var R=F.getStyle("anchorRound"),e=F.getStyle("anchorSensitivity");K=Nl.roundTo(K,R,e),D=Nl.roundTo(D,R,e)}c.setAnchor(K,D,!0);var m=E.Default.getLogicalPoint(S,F._canvas);m.x+=Nl.Icons.TipShiftX,m.y+=Nl.Icons.TipShiftY;var C=""+K.toFixed(2)+", "+D.toFixed(2);i.tipInfo={helperPos:m,text:C,size:C.length},F.fi({kind:"betweenEditAnchor",event:S})}}},bo.prototype._42=function(C,q,V){var p=this;p.info={},p.screenInfo={};var c=p._interactor;c.editDetail||p.gatherInfo(q,V)&&p.isVisible()&&(Nl.Icons.DrawIcon(c,C,Nl.Icons.Anchor,p.screenInfo),p.tipInfo&&Nl.Icons.DrawIcon(c,C,Nl.Icons.TipHelper,p.tipInfo))};var xj=Nl.MoveDummy=function(K){this.catalog="MoveDummy",this._interactor=K};xj.prototype={},xj.prototype.constructor=xj,xj.prototype.gatherInfo=function(){var k=this,K=this._interactor.getSubModule("Rect");if(K){var J=K.screenInfo;if(J){var H=k._interactor,i=k.getMovableTarget(K.target);if(i){var U=H.getStyle("moveDummyThreshold");if(U!==!1){var e=J.LT||J.P1,Z=J.RT||J.P2,d=J.LB||e;if(e){var T=J.P1,W=Math.min(e.distanceTo(d),e.distanceTo(Z));if(!(U!==!0&&W>U)){var n=H.getStyle("moveDummyPosition"),E=Z.clone().sub(e),C=d.clone().sub(e),F=n[2],A=n[3];if(T){var y=H.getStyle("moveDummyLineExtraShift");y&&(F+=y[0],A+=y[1])}var x=e.clone().add(E.clone().multiplyScalar(n[0])).add(E.setLength(F)).add(C.clone().multiplyScalar(n[1])).add(C.setLength(A));return k.screenInfo.pos=x,k.screenInfo.size=H.getStyle("moveDummySensitivity"),!0}}}}}}},xj.prototype.getMovableTarget=function(q){var d=this._interactor.gv;if(Sl(q)){if(d.isMovable(q))return q}else if(q instanceof Nl.Group)for(var N=q._entities,Z=N.length-1;Z>=0;Z--){var A=N[Z];if(Sl(A)&&d.isMovable(A))return A}return null},xj.prototype.getMoveInteractor=function(){for(var e,l,o,t=this._interactor.gv,W=t.getInteractors(),e=0,l=W.length;l>e;e++)if(o=W.get(e),o instanceof Lf)return o},xj.prototype.startEdit=function(k,C){k.startDragging(C);var h=this.getMoveInteractor();if(h){var B=this.selectedTarget,Y=k.gv;Y._moving=1,h._data=B,Y.handleMouseDown&&Y.handleMouseDown(C,B)}},xj.prototype._46O=function(o){var k=this,M=k.getMoveInteractor();M&&(M.handleWindowMouseUp(o),k.selectedTarget=null)},xj.prototype.handleEdit=function(J,g){var c=this.getMoveInteractor();c&&c.handleWindowMouseMove(g)},xj.prototype.check=function(e,d,U){if(this.selectedTarget=null,E.Default.isLeftButton(d)&&!e._scrolling&&!Pe()){var f=this;if(f.screenInfo){var j=f.screenInfo.pos;if(j&&!(U.distanceTo(j)>f.screenInfo.size)){var G=f._interactor;return f.selectedTarget=f.getMovableTarget(G.getSubModule("Rect").target),G.setCursor("default"),!0}}}},xj.prototype._42=function(E,g,w){var X=this;X.screenInfo={};var R=X._interactor;R.editDetail||X.gatherInfo(g,w)&&(!R.editing||X.selectedTarget)&&Nl.Icons.DrawIcon(R,E,Nl.Icons.MoveDummy,X.screenInfo)};var _j=Nl.RotateX=function(I){this.catalog="RotateX",this._interactor=I};_j.prototype={},_j.prototype.constructor=_j,_j.prototype.gatherInfo=function(k,C){var U=this;if(1===C.length){var F=C[0];return F instanceof E.Shape&&F._70I()||qq(F,k)?!1:U.gatherSingleTarget(k,F)}return C.length>1?U.gatherMultiTargets(k,C):!1},_j.prototype.gatherSingleTarget=function(){var D=new E.Math.Vector2,j=new E.Math.Vector2,L=new E.Math.Vector2,G=new E.Math.Vector2,b=function(E,m){var r=E.x-m.x,I=E.y-m.y;return r*r+I*I};return function(u,y){if(y.getCorners){var r=this,e=y.getCorners(),q=15,g=y.getPosition();D.copy(e[0]),L.copy(e[1]),G.copy(e[3]),j.copy(D).add(G).divideScalar(2).add(D.sub(L).setLength(q/u.getZoom()));var o=Math.max(b(g,e[0]),b(g,e[1]),b(g,e[2]),b(g,e[3]));return r.info.POS=j.clone(),r.screenInfo.POS=Nl.toScreenPosition(u,r.info.POS),r.screenInfo.LEN=Math.sqrt(o)*u.getZoom()+q,r.screenInfo.CENTER=Nl.toScreenPosition(u,g),r.target=y,!0}}}(),_j.prototype.gatherMultiTargets=function(p,f){var u=this,x=Nl.Group.findOrCreateGroup(f);if(!x)return!1;var u=this;return u.gatherSingleTarget(p,x)},_j.prototype.isVisible=function(){var k=this._interactor;if(!k.getStyle("rotateAsClock"))return!1;var r=this.target;if(!r)return!0;var W=k.gv;return W.isEditable(r)&&W.isRotationEditable(r)?!0:!1},_j.prototype.check=function(b,q,Z){var y=this,N=y._checkImpl(b,q,Z);return(N||y._clockPainted)&&y._interactor._42(),N},_j.prototype._checkImpl=function(e,o,K){if(E.Default.isLeftButton(o)){var Z=this;Z.editing=null,Z.tipInfo=null;var l;if(Z.screenInfo&&(l=Z.screenInfo.POS)&&Z.isVisible()){var u=Z._interactor;if(Nl.checkHit(K,l,u.getStyle("checkSize"))){var b=Z.target,H=e.lp(o),L=b.getPosition(),s=Math.atan2(H.y-L.y,H.x-L.x);return u._setRotateCursor(s),Z.editing={pos:L,rotation:b.getRotation(),hitRot:s,groupRotateMode:"block",screenInfo:{CENTER:Z.screenInfo.CENTER,LEN:Z.screenInfo.LEN}},!0}}}},_j.prototype.startEdit=function(D,F){D.startDragging(F),D.fi({kind:"beginEditRotation",event:F}),this.target instanceof Nl.Group&&this.target.beginRotate(this.editing)},_j.prototype._46O=function(O){var w=this;w.editing&&(w.editing=null,w._interactor.fi({kind:"endEditRotation",event:O})),w.target instanceof Nl.Group&&w.target.endRotate(),w.tipInfo=null},_j.prototype.handleEdit=function(r,h){var n=this,Y=n.editing;if(Y){var p,K,P=n.target,x=r.lp(h),v=n._interactor,S=Y.pos,d=Math.atan2(x.y-S.y,x.x-S.x),O=P instanceof Nl.Group;if(O?K=d-Y.hitRot:(p=d-Y.hitRot,K=Y.rotation+p),K%=2*Math.PI,0>K&&(K+=2*Math.PI),!E.Default.isCtrlDown(h)){var Z,i;$q(h)?(Z=v.getStyle("shiftRotateRound"),i=Z/2):(Z=v.getStyle("rotateRound"),i=v.getStyle("rotateSensitivity")),K=Nl.roundTo(K,Z,i)}O?(p=K-(Y.lastRotation||0),0!==p&&(P.addRotation(p,Y.groupRotateMode,function(g){return r.isRotationEditable(g)}),Y.lastRotation=K)):P.setRotation(K),v._setRotateCursor(d),K>Math.PI&&(K-=2*Math.PI);var $=180*(K/Math.PI),J=""+$.toFixed(2)+"°",F=E.Default.getLogicalPoint(h,v._canvas);F.x+=Nl.Icons.TipShiftX,F.y+=Nl.Icons.TipShiftY,n.tipInfo={helperPos:F,text:J,size:J.length},v.fi({kind:"betweenEditRotation",event:h})}},_j.prototype._42=function(q,N,w){var U=this;U._clockPainted=!1,U.info={},U.screenInfo={};var t=U._interactor;t.editDetail||U.gatherInfo(N,w)&&U.isVisible()&&(Nl.Icons.DrawIcon(t,q,Nl.Icons.RoundPoint,U.screenInfo.POS),U.tipInfo&&Nl.Icons.DrawIcon(t,q,Nl.Icons.TipHelper,U.tipInfo),U.editing&&U.drawClock(q))},_j.prototype.drawClock=function(l){l.save();var s=this;s._clockPainted=!0;var R=s.editing||{},h=R.screenInfo||s.screenInfo,F=h.LEN,L=F+8,r=F+18;l.save(),l.translate(h.CENTER.x,h.CENTER.y),l.beginPath(),l.strokeStyle="rgb(150, 150, 150)";for(var G,y,p,N,Q,D=0;360>D;D++)G=D*Math.PI/180,0===D%5&&(y=X(G)*F,p=V(G)*F,N=X(G)*L,Q=V(G)*L,l.moveTo(y,p),l.lineTo(N,Q)),0===D%45&&(y=X(G)*F,p=V(G)*F,N=X(G)*r,Q=V(G)*r,l.moveTo(y,p),l.lineTo(N,Q));l.stroke(),l.rotate(-v);var i=R.lastRotation||s.target.getRotation();l.beginPath(),l.fillStyle="rgba(255, 0, 0, 0.1)",l.strokeStyle="rgb(157, 157, 157)",l.moveTo(0,0),l.arc(0,0,r,0,i,!1),l.fill(),l.beginPath(),l.moveTo(0+r,0),l.arc(0,0,r,0,i,!1),l.stroke(),l.restore()};var xm=Nl.Curve=function(W){this.catalog="Curve",this._interactor=W};xm.prototype={},xm.prototype.constructor=xm,l.defineProperties(xm.prototype,{activing:{get:function(){return this._activing},set:function(K){var U=this;if(K)U._activing=new Nl.CurveActiving(this,K);else{var b=U._activing;b&&b.dispose(),U._activing=null}}}}),xm.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},xm.prototype.setUp=function(){var c=this,Z=c._interactor;Z&&Z.gv.mp(c._onGraphviewPropertyChanged,c)},xm.prototype._onGraphviewPropertyChanged=function(O){("zoom"===O.property||"translateX"===O.property||"translateY"===O.property)&&this._handleDataChanged()},xm.prototype.tearDown=function(){var H=this,y=H._interactor;y&&y.gv.ump(H._onGraphviewPropertyChanged,H)},xm.prototype.canEnterEditDetailMode=function(){var L=this,H=L._interactor,a=H._getValidSelection();if(1===a.length){var Z=a[0],j=Z instanceof E.Edge;if(Z instanceof E.Shape||j){if(j){var Q=Z.s("edge.type");if(Q&&"points"!==Q)return}var O=H.gv;if(O.isPointEditable(Z)&&O.isEditable(Z))return L.target=Z,!0}}},xm.prototype.canQuitEditDetailMode=function(A){var j=this,W=j._interactor._getLogicalPoint(A);return j._checkEditRealPoint(W)?void 0:j._interactor.gv.getDataAt(A)!==j.target?!0:void 0},xm.prototype.preHandleScroll=function(){var o=this.editing;return o&&o.inEdit?!0:void 0},xm.prototype.getCurrentSelectintStatus=function(){var Y=this;if(Y.activing&&!Y.activing.selections){if(Y.activing.status!=S)return Y.activing.status;var f=function(v){var q=Y.activing.status;Y.activing.status=v,Y._interactor.fp("shapePointStatus",q,v)},B=Nl.Curve.PointType,C=Y.activing.point,G=Y.activing.pairs;if(!G||1!==G.length)return f(B.Mirrored);var o=G[0],Q=o.c1&&o.c1.isNearEnough(C),V=o.c2&&o.c2.isNearEnough(C);if(!o.c1||!o.c2)return Q||V?f(B.Straight):f(B.Disconnected);if(Q&&V)return f(B.Straight);if(Q||V)return f(B.Asymmetric);var c=o.c1.clone().sub(C),H=o.c2.clone().sub(C);return Math.abs(c.x*H.y-c.y*H.x)>1e-5||c.x*H.x>0?f(B.Disconnected):Math.abs(c.length()-H.length())>1e-5?f(B.Asymmetric):f(B.Mirrored)}},xm.prototype.handle_keydown=function(i){var L=this;if(L._interactor.editDetail){var n=Nl.Curve.PointType;"1"===i.key?L._setCurrentSelectionStatus(n.Straight):"2"===i.key?L._setCurrentSelectionStatus(n.Mirrored):"3"===i.key?L._setCurrentSelectionStatus(n.Disconnected):"4"===i.key&&L._setCurrentSelectionStatus(n.Asymmetric)}},xm.prototype.setCurrentSelectionStatus=function(p){var t=this,s=t._interactor;if(s){var r=s.gv;r.dm().beginTransaction(),this._setCurrentSelectionStatus(p),r.dm().endTransaction()}},xm.prototype._setCurrentSelectionStatus=function(w){var Q=this,p=Q.activing;if(p){var r=Q.getCurrentSelectintStatus();if(null!==r&&r!==w){p.status=w;var H=Q.activing.point,M=Q.activing.pairs;if(M&&1===M.length){var d=M[0],R=Q.screenInfo.curve,h=Nl.Curve.PointType,U=Q._interactor,K=function(){Q._writeToHt(),U.fp("shapePointStatus",r,w),Q.check(U.gv,null,new Nl.Math.Vector2(U._lastLogicalPoint))};if(w===h.Straight)return R.moveCtrlPoint(d,H,"c1"),R.moveCtrlPoint(d,H,"c2"),K(),void 0;if(r===h.Straight){var u=R.findPairs(H,!0),B=u[0],c=B.r1||H,g=B.r2||H,F=g.clone().sub(c).multiplyScalar(.25);return R.moveCtrlPoint(d,H.clone().sub(F),"c1"),R.moveCtrlPoint(d,H.clone().add(F),"c2"),K(),void 0}var o=d.c1,$=d.c2;if(o&&$){if(w===h.Mirrored)return R.moveCtrlPoint(d,H.clone().multiplyScalar(2).sub($),"c1"),K(),void 0;if(w===h.Asymmetric&&r===h.Disconnected){var b=o.clone().sub(H).length(),F=H.clone().sub($).setLength(b).add(H);return R.moveCtrlPoint(d,F,"c1"),K(),void 0}}p._firePointChange(),U.fp("shapePointStatus",r,w),Q.check(U.gv,null,new Nl.Math.Vector2(U._lastLogicalPoint))}}}},xm.prototype._handleDataChanged=function(){var k="points,segments,shape,position,rotation,scale".split(",");return function(R){var Q=this;if(Q.screenInfo&&Q.target){if(R&&k.indexOf(R.property)<0)return;var F=Q._interactor;Q.gatherSingleTarget(F.gv,Q.target,!0),Q.check(F.gv,null,new Nl.Math.Vector2(F._lastLogicalPoint)),F._42()}}}(),xm.prototype.gatherSingleTarget=function(X,_,B){var a,A,s=this;s.screenInfo&&s.screenInfo.curve&&(A=s.screenInfo.curve._curves);var k=s.editing;a=k?s.screenInfo:s.screenInfo={};var J,F,Q=_ instanceof E.Edge;Q?(J=_.s("edge.segments"),F=_.s("edge.points")||new E.List):(J=_._58O,F=_._59O),a.S=J;var I,L=a.P=[],o=Nl.getDataMatrix(_);if(_ instanceof E.Polyline||_ instanceof E.Edge&&s._interactor.getStyle("edgeElevationEditable"))I=_.getElevation&&_.getElevation()||0,a.E=[];else{var H=!1;F.each(function(J){J.e!==S&&(H=!0)}),H&&(a.E=[])}if(F.each(function(i){a.E&&a.E.push(i.e||I),i=o.apply(i);var r=Nl.toScreenPosition(X,i);L.push(r.x,r.y)}),Q){var r=L.length,K=Nl.toScreenPosition(X,_._lastSourcePoint||(r?{x:L[0],y:L[1]}:{x:0,y:0})),P=Nl.toScreenPosition(X,_._lastTargetPoint||(r?{x:L[r-2],y:L[r-1]}:{x:0,y:0}));L.splice(0,0,K.x,K.y),L.push(P.x,P.y),a.E&&(a.E.splice(0,0,"head"),a.E.push("tail"))}if(!a.S||!a.S.size()){a.S=new E.List,a.S.add(1);for(var V=0;V<L.length/2-1;V++)a.S.add(2)}if((!k||B)&&s.convertToCubicBezier(A),s.activing&&(B||!s.editing||"realPoint"===s.editing.type)){var u=a.curve.findPairs(s.activing.point);s.activing.pairs=u}Q&&"points"!==_.s("edge.type")&&s._writeToHt()},xm.prototype._convertToNewPoint=function(Q,U,S,L){var i,$,o;for(i=0,$=U.length;$>i;i++){if(o=U[i],o._p1.isNearEnough(Q)&&(!L||L.indexOf(o._p1)<0))return o._p1;if(o._p4.isNearEnough(Q)&&(!L||L.indexOf(o._p4)<0))return o._p4}if(S)for(i=0,$=Math.min(S.length,$);$>i;i++){if(o=S[i],o._p1===Q&&(!L||L.indexOf(U[i]._p1)<0))return U[i]._p1;if(o._p4===Q&&(!L||L.indexOf(U[i]._p4)<0))return U[i]._p4}},xm.prototype.convertToCubicBezier=function(U){var w,k,Y=this,X=new Nl.Math.Curve,Z=Y.screenInfo;if(X.createFromHtShape(Z.P,Z.S,Z.E),Z.curve=X,Y.activing){var j=X._curves;w=Y.activing.point,k=Y._convertToNewPoint(w,j,U);var L=[];if(k&&(Y.activing.point=k,L.push(k)),Y.activing.selections){var o=-1,b=Y.activing.selections;b.forEach(function(m){o++,k=Y._convertToNewPoint(m,j,U,L),k&&(b[o]=k,L.push(k))})}}},xm.prototype.check=function(F,J,T){if(!J||lg(J)||dk(J)){var k=this;if(k._interactor.setCursor("default"),k.editing=null,k.highlight=null,k.tipInfo=null,k.edgeEditResult=null,k.screenInfo){if(Pe()||dk(J))return k._interactor._42(),!0;if(k._checkEditCtrlPoint(T))return k._interactor._42(),!0;if(k._checkEditRealPoint(T))return k._interactor._42(),!0;if(k._checkEditElevation(T))return k._interactor._42(),!0;var o=k.screenInfo.curve,v=o.checkPoint(T,k._interactor.getStyle("curveIntersectSize"));if(v){var N=k.highlight={};N.type="insertKnot",N.bezier=v.bezier,N.point=v.intersection}return k._interactor._42(),!0}}},xm.prototype._checkEditRealPoint=function(f){var z,N,e,d,i,j,m=this,h=m.screenInfo.curve._curves,_=m._interactor.getStyle("curvePointIntersectSize"),T=1/0;for(_*=_,e=0,d=h.length;d>e;e++)z=h[e],i=z._p1,j=f.distanceToSquared(i),T>j&&(T=j,N=i),i=z._p4,j=f.distanceToSquared(i),T>j&&(T=j,N=i);if(T>_)return!1;var U=m.highlight={};return U.type="changeRealPoint",U.point=N,m.editing={type:"realPoint",point:N,shiftGuide:{point:N.clone(),dir:"x",limit:0}},m._interactor.setCursor("crosshair"),!0},xm.prototype._checkEditElevation=function(X){var G=this;if(!G._interactor.getStyle("curveElevationVisible"))return!1;var U=G.activing;if(!U)return!1;var r=U.getCurrentEditingPoint();if(!r)return!1;var n=G._interactor,$=n.getStyle("curveElevationGuideShift"),s=n.getStyle("curveElevationIntersectSize"),N=X.distanceToSquared({x:r.x+$[0],y:r.y+$[1]});if(!(N>s*s)){var l=G.highlight={};l.type="elevation";var b=new Nl.Math.Vector2(X.x,X.y,r.e);return G.editing={type:"elevation",startPoint:b},G._interactor.setCursor("crosshair"),!0}},xm.prototype._checkEditCtrlPoint=function(o){var E=this;if(E.activing&&!E.activing.selections){var S=E.getCurrentSelectintStatus();if(S!==Nl.Curve.PointType.Straight){var W=E.activing.pairs;if(W){var Q=E._interactor.getStyle("curvePointIntersectSize");Q*=Q;var v,i,r,y,K,O,f,b,x,n=1/0;for(f=0,x=W.length;x>f;f++)for(y=W[f],b=0;2>b;b++)K=0===b?"c1":"c2",y[K]&&(O=o.distanceToSquared(y[K]),n>O&&(n=O,v=y,i=f,r=K));if(n>Q)return!1;E.activing.hlpair=v,E.activing.hltype=r;var I=E.highlight={};return I.type="changeCtrlPoint",I.point=v[r],E.editing={type:"ctrlPoint",pair:v,pairId:i,ctrlType:r,direction:v[r].clone().sub(E.activing.point).normalize()},E._interactor.setCursor("crosshair"),!0}}}},xm.prototype.startEdit=function(O,U){O.startDragging(U);var F=this;F.highlight&&"insertKnot"===F.highlight.type&&(F.insertKnot(),F.gatherSingleTarget(F._interactor.gv,F.target),F.activing=null,F._checkEditRealPoint(F._interactor._getLogicalPoint(U)));var V=F._activing;if(V){var l=F.editing?F.editing.type:null;"ctrlPoint"===l?V.editingCtrl={pairId:F.editing.pairId,type:V.hltype}:"realPoint"===l&&(V.editingCtrl=!1)}var q=F.highlight,Q=E.Default.isCtrlDown(U);if(!q||Pe()||dk(U)){var a=F._interactor.gv;if(!a.setFocus(U)||a._scrolling)return;return Q?F._multiSelect={startPoint:a.lp(U)}:a.isPannable()&&(lg(U)||dk(U))&&(F._pan={tx:a.tx(),ty:a.ty()},O.fi({kind:"beginPan",event:U})),void 0}if("changeRealPoint"===q.type){var A,b=F.activing?F.activing.point:null,B=F.activing?F.activing.selections:null;if(Q&&F.activing)b===q.point?(B?(F.activing={point:B[0]},B.length>1&&(B.splice(0,1),F.activing.selections=B)):F.activing=null,F.editing=null):B&&(A=B.indexOf(q.point))>=0?(B.length>1?B.splice(A,1):delete F.activing.selections,F.editing=null):B?(B.push(b),F.activing={point:q.point,selections:B}):F.activing={point:q.point,selections:[b]};else if(B)b===q.point||((A=B.indexOf(q.point))>=0?(B.splice(A,1,b),F.activing={point:q.point,selections:B}):F.activing={point:q.point});else{var m;b===q.point&&(m=F.activing.status),F.activing={point:q.point},m&&(F.activing.status=m)}O.fi({kind:"beginEditPoint",event:U})}},xm.prototype.insertKnot=function(){var E=this,h=E.highlight,U=E.screenInfo.curve;U.insertKnot(h.bezier,h.point.t),E._writeToHt()},xm.prototype._writeToHt=function(){var d,r,D,M,j=this,R=j.screenInfo.curve,T=R.toHtShape(),u=T.points,v=[],a=T.segments,o=j._interactor.gv,p=j.target,z=p instanceof E.Edge,I=Nl.getDataMatrix(p).invert();M=p instanceof E.Polyline||p instanceof E.Edge&&j._interactor.getStyle("edgeElevationEditable"),M&&(D=p.getElevation&&p.getElevation()||0);for(var W=0,Y=u.length;Y>W;W++)d=u[W],r=Nl.toWorldPosition(o,d),r=I.apply(r),d.e!=S&&d.e!==D&&(r.e=d.e),v.push(r);if(p._writing=!0,z){p.s("edge.type","points"),p.setStyle("edge.segments",a),p.setStyle("edge.points",v.slice(1,v.length-1)),p.setStyle("edge.source.offset.x",0),p.setStyle("edge.source.offset.y",0),p.setStyle("edge.target.offset.x",0),p.setStyle("edge.target.offset.y",0);var O=j._nextChangeEdgeHost;delete j._nextChangeEdgeHost,O&&("source"===O.type?p.setSource(O.host):p.setTarget(O.host)),j._writeEdgeHostAnchor("source",v[0]),j._writeEdgeHostAnchor("target",v[v.length-1])}else v.length?(p.setSegments(a),p.setPoints(v,!0)):p.removeFromDataModel();delete p._writing},xm.prototype._writeEdgeHostAnchor=function(p,t){var H=this,e=H.target,k=H._calcHostAnchor(e,p,t);k.index!==S?(e.setStyle("edge."+p+".index",k.index),e.setStyle("edge."+p+".percent",S),e.setStyle("edge."+p+".anchor.x",S),e.setStyle("edge."+p+".anchor.y",S)):k.percent!==S?(e.setStyle("edge."+p+".percent",k.percent),e.setStyle("edge."+p+".index",S),e.setStyle("edge."+p+".anchor.x",S),e.setStyle("edge."+p+".anchor.y",S)):(e.s("edge."+p+".anchor.x",k.x),e.s("edge."+p+".anchor.y",k.y),k.offsetX||k.offsetY?(e.s("edge."+p+".offset.x",k.offsetX),e.s("edge."+p+".offset.y",k.offsetY)):(e.s("edge."+p+".offset.x",0),e.s("edge."+p+".offset.y",0)))},xm.prototype._calcHostAnchor=function(u,f,$,l){l||(l="source"===f?u.getSource():u.getTarget());var k=this._interactor.gv,C=k.calculateAttachPoint(l,$);if(C)return C.info;if(Ej(l)){var S=k.calculateEdgePosition(l,$);return S}var h=l.getRotation(),z=l.getAnchor();qq(l,k)&&(h=0);var s=l.getScale();if(h||s.x<0||s.y<0){var Z=l.getMatrix(),b=Z.tfi($),J=l.getSize();return{x:b.x/J.width+z.x,y:b.y/J.height+z.y}}var r=ks(k,l),j={x:($.x-r.x)/r.width,y:($.y-r.y)/r.height};return j},xm.prototype._handlePanning=function(S){var b=this,g=b._pan;if(g){g.started=!0;var m=b._interactor,B=m.gv,D=m._lastClientPoint,$=uk(S),V=nh(B,$,D);B.setTranslate(g.tx+V.x,g.ty+V.y),b.gatherSingleTarget(m.gv,b.target),m._42(),m.fi({kind:"betweenPan",event:S})}},xm.prototype.handleEdit=function(N,p){var o=this,P=o.editing;if(o._pan)return o._handlePanning(p),void 0;if(o._multiSelect)return o._multiSelect.endPoint=N.lp(p),o._interactor.redraw(),void 0;if(P){P.inEdit=!0;var h,G,Q,a=o._interactor._getLogicalPoint(p),w=E.Default.isCtrlDown(p),i=E.Default.isShiftDown(p),m=P.type,D=o.activing;if(o._guideInfo=null,"ctrlPoint"===m&&i){var F=o.editing.direction.clone();h=D.point;var C=F.dot(a.clone().sub(h));a=F.setLength(C).add(h)}else if("ctrlPoint"===m||"realPoint"===m){var F;if("realPoint"===m&&i){var A=o.editing.shiftGuide;G=A.point;var Y=Math.abs(a.x-G.x),u=Math.abs(a.y-G.y);Y>u&&Y>A.limit&&"y"===A.dir&&(A.dir="x"),u>Y&&u>A.limit&&"x"===A.dir&&(A.dir="y"),F=A.dir,"x"===F?(a.y=G.y,A.limit=Math.max(A.limit,Y)):"y"===F&&(a.x=G.x,A.limit=Math.max(A.limit,u))}var R=o._isEditEdgeSourceTarget();if(R){var K=o._editEdgeSourceTarget(R,a,w);K&&(o.edgeEditResult=K,Q=K.tipText)}else if(!w){var T=o._guidingToEdit(a,F),s="realPoint"===m?o._interactor.gridGuide.findClosest(a,F,!0):null,H=1/0,r=1/0;s&&(s.x&&(H=s.x),s.y&&(r=s.y));var U=!1;T&&(T.xList&&(Math.abs(T.x)<=Math.abs(H)?(U=!0,H=T.x):delete T.xList),T.yList&&(Math.abs(T.y)<=Math.abs(r)?(U=!0,r=T.y):delete T.yList),U&&(o._guideInfo=T)),isFinite(H)&&(a.x+=H),isFinite(r)&&(a.y+=r),U&&(T.v=a)}}var f=o.screenInfo.curve;if("realPoint"===P.type){h=P.point,h.e!==S&&(a.e=h.e),f.moveRealPoint(h,a),P.point=a,o.highlight.point=a;var B=D.status,X=D.selections;if(o.activing={point:a,status:B},X){var d=a.clone().sub(h),t=0;X.forEach(function(p){var P=p.clone().add(d);f.moveRealPoint(p,P),X[t++]=P}),o.activing.selections=X}}else if("ctrlPoint"===P.type){var y=D.pairs,j=y[P.pairId];f.moveCtrlPoint(j,a,P.ctrlType);var Z=D.status,c=Nl.Curve.PointType;if((Z===c.Mirrored||Z===c.Asymmetric)&&j.c1&&j.c2){var h=new Nl.Math.Vector2(D.point),J="c1"===P.ctrlType?"c2":"c1";if(Z===Nl.Curve.PointType.Mirrored)f.moveCtrlPoint(j,h.clone().multiplyScalar(2).sub(a),J);else if(Z===c.Asymmetric){var C=j[J].clone().sub(h).length(),_=h.clone().sub(j[P.ctrlType]).setLength(C).add(h);isNaN(_.x)||f.moveCtrlPoint(j,_,J)}}D._firePointChange()}else if("elevation"===P.type){G=P.startPoint;var M=G.e+(G.y-a.y)/N._zoom;o._setCurrentPointImpl("e",M),D._firePointChange(),Q="E: "+Nl.toFixed(M)}var n=E.Default.getLogicalPoint(p,o._interactor._canvas);if(n.x+=Nl.Icons.TipShiftX,n.y+=Nl.Icons.TipShiftY,!Q){var z=Nl.toWorldPosition(N,a);Q=""+Nl.toFixed(z.x)+", "+Nl.toFixed(z.y)}o.tipInfo={helperPos:n,text:Q,size:Q.length},o._writeToHt(),o._interactor.fi({kind:"betweenEditPoint",event:p})}},xm.prototype._setCurrentPointImpl=function(V,p){var F=this,B=F._activing;if(!B)return!1;var N=F.target;if(!N)return!1;var M=B.getCurrentEditingPoint();if(!M)return!1;var W=B.editingCtrl;if(!W)var A=M.clone();if("e"===V)M.e=p;else{var P;if("x"===V||"y"===V){var o=B._lastFirePoint;P="x"===V?{x:p,y:o?o.y:0}:{x:o?o.x:0,y:p}}else"object"==typeof V?(P=V,V.e!==S&&(M.e=V.e)):(P={x:arguments[0],y:arguments[1]},arguments[2]!==S&&(M.e=arguments[2]));var d=Nl.getDataMatrix(N);P=Nl.toScreenPosition(F._interactor.gv,d.apply(P)),M.x=P.x,M.y=P.y}if(!W){var T=A.multiplyScalar(-1).add(M);M.e&&A.e&&(T.e=M.e-A.e),F.screenInfo.curve.moveCtrlDueToRealPointMovement(M,T)}return!0},xm.prototype.setCurrentPoint=function(F,r){return this._setCurrentPointImpl(F,r)?(this._writeToHt(),!0):!1},xm.prototype._isEditEdgeSourceTarget=function(){var L=this,X=L.target;if(!(X instanceof E.Edge))return!1;var j=L.editing.point,l=L.screenInfo.curve._curves;return j===l[0]._p1?"source":j===l[l.length-1]._p4?"target":!1},xm.prototype._editEdgeSourceTarget=function(o,z,Z){var e,U=this,V=U.target;if(e="source"===o?V.getSource():V.getTarget()){var t,n=U._interactor.gv,N=Nl.toWorldPosition(n,z),E=U._calcHostAnchor(V,o,N,e);if(t=E.index!==S||E.percent!==S?E.distance*n.getZoom()>U._interactor.getStyle("edgeHostEdgeMaxDistance"):U._interactor.getStyle("edgeHostDetectPerFrame")?!0:E.x<0||E.x>1||E.y<0||E.y>1?!0:!1){var T=n.getDataAt(N,function(R){return n.isSelectable(R)?n.isSourceTargetEditable(V,R,o)?V.canSetSourceTarget(R,o)?!0:!1:!1:!1});if(T){var k=U._calcHostAnchor(V,o,N,T);e=T,U._nextChangeEdgeHost={type:o,host:T},E=k}}var f,P,u;if(Z||E.x===S)(E.percent!==S||E.index!==S)&&(P=E.point);else{var r=U._interactor.getStyle("anchorRound"),H=U._interactor.getStyle("anchorSensitivity");f=n.calculateAttachPoint(e,N),f?E=f.info:(E.x=Nl.roundTo(E.x,r,H),E.y=Nl.roundTo(E.y,r,H)),P=Kq(n,e,0,E.offsetX||0,E.offsetY||0,E.x,E.y)}P&&(u=Nl.toScreenPosition(n,P),z.x=u.x,z.y=u.y),U._edgeHostGuideInfo={corners:Nl.getTargetCornersOnScreen(n,e),attach:f?f.index:-1,host:e};var D;return E.percent!==S?D="percent: "+E.percent.toFixed(2):E.index!==S?D="index: "+E.index:(D=""+E.x.toFixed(2)+", "+E.y.toFixed(2),(E.offsetX||E.offsetY)&&(D+=" offset: "+E.offsetX.toFixed(2)+", "+E.offsetY.toFixed(2))),{host:e,anchor:E,tipText:D}}},xm.prototype._guidingToEdit=function(I,d){var K,E,v=this;if(K=v.screenInfo.curve){E=K._curves;var A,z,b,y,p,F,u,q,s=1/0,e=1/0,n=[];for(v.editing&&"realPoint"===v.editing.type&&(q=v.editing.point),p=0,F=2*E.length;F>p;p++)u=E[Math.floor(p/2)][p%2?"_p4":"_p1"],n.indexOf(u)>=0||(n.push(u),q&&q===u||(b=u.x-I.x,y=u.y-I.y,Math.abs(b)<Math.abs(s)?(s=b,A=[u]):b===s&&A.push(u),Math.abs(y)<Math.abs(e)?(e=y,z=[u]):y===e&&z.push(u)));var O=v._interactor.getStyle("smartGuideThreshold");if((Math.abs(s)>O||"y"===d)&&(A=null),(Math.abs(e)>O||"x"===d)&&(z=null),A||z){var X=!1,Z={};
if(A&&(X=!0,Z.xList=A,Z.x=s),z&&(X=!0,Z.yList=z,Z.y=e),X)return Z}}},xm.prototype._46O=function(P){var C=this;C.editing&&(C.editing=null,C._interactor.fi({kind:"endEditPoint",event:P})),C._guideInfo=null,C._edgeHostGuideInfo=null,C._pan&&(C._pan=null,C._interactor.fi({kind:"endPan",event:P})),C._multiSelect&&(C._handleMultiSelect(C._multiSelect),C._multiSelect=null),C.tipInfo=null,C.edgeEditResult=null},xm.prototype._handleMultiSelect=function(b){if(b.startPoint&&b.endPoint){var F,w,z,A,H,Y=this,U=Y._interactor,q=U.gv,s=Nl.toScreenPosition(q,b.startPoint),_=Nl.toScreenPosition(q,b.endPoint),h=E.Default.unionPoint(s,_),g=Y.screenInfo.curve._curves,N=[],m=function(S){S.x>=h.x&&S.y>=h.y&&S.x<=h.x+h.width&&S.y<=h.y+h.height&&N.indexOf(S)<0&&N.push(S)};for(F=0,w=g.length;w>F;F++)H=g[F],m(H._p1),m(H._p4);if(N.length){var Z=Y.activing||{},T=Z.selections||[];for(Z.point&&T.push(Z.point),F=0,w=T.length;w>F;F++)z=T[F],A=N.indexOf(z),A>=0?N[A]=S:N.push(z);var C=N;for(N=[],F=0,w=C.length;w>F;F++)C[F]&&N.push(C[F]);w=N.length,0===w?Y.activing=null:1===w?Y.activing={point:N[0]}:(z=N[w-1],Y.activing={point:z,selections:N.splice(0,w-1)}),U.redraw()}}},xm.prototype._canDeletePoint=function(d,m){var O=this.target;if(!(O instanceof E.Edge))return!0;var X=d._curves[0],p=d._curves[d._curves.length-1];return X._p1===m||p._p4===m?!1:!0},xm.prototype.handleDelete=function(){var f=this;if(f.activing&&f.screenInfo){var s=E.Default.isShiftDown(),K=f.screenInfo.curve;f._canDeletePoint(K,f.activing.point)&&K.deleteRealPoint(f.activing.point,s),f.activing.selections&&f.activing.selections.forEach(function(e){f._canDeletePoint(K,e)&&K.deleteRealPoint(e,s)}),f.activing=null,delete f.editing,delete f.tipInfo,delete f.edgeEditResult,delete f._pan,delete f._multiSelect,f._writeToHt(),f._interactor.fp("deleteShapePoint",!1,!0)}},xm.prototype.handleDoubleClick=function(x){var Y=this,S=Y._interactor._getLogicalPoint(x);if(Y.screenInfo&&Y._checkEditRealPoint(S)){var P=Y.getCurrentSelectintStatus(),s=Nl.Curve.PointType;return P=P===s.Mirrored?s.Straight:s.Mirrored,Y._setCurrentSelectionStatus(P),Y._interactor._42(),!0}},xm.prototype._drawHighlight=function(l){var o=this,V=o.highlight;if(V){var s=V.bezier,r=o._interactor;s&&Nl.Icons.DrawIcon(r,l,Nl.Icons.ShapeHighlightCurve,[s._p1.x,s._p1.y,s._p2.x,s._p2.y,s._p3.x,s._p3.y,s._p4.x,s._p4.y]);var C=V.point;C&&"insertKnot"===V.type&&Nl.Icons.DrawIcon(r,l,Nl.Icons.ShapeHighlighPoint,C)}},xm.prototype._drawGuide=function(S){var C=this,Z=C._guideInfo;if(Z){var n,D,e,E,w=Z.v;for(n=0;2>n;n++)if(E=0===n?Z.xList:Z.yList)for(D=0,e=E.length;e>D;D++)Nl.Icons.DrawIcon(C._interactor,S,Nl.Icons.ShapeGuideLine,[w.x,w.y,E[D].x,E[D].y])}},xm.prototype._drawCurrentPoint=function(N){var L=this;if(L.activing){var D=L.activing,F=L.getCurrentSelectintStatus(),Q=L._interactor;if(F!==Nl.Curve.PointType.Straight){var p=D.pairs;D.hlpair,D.hltype;var A=D.selections,v=D.editingCtrl;if(p&&!A){var q,V,m;for(V=0,m=p.length;m>V;V++)q=p[V],v&&V===v.pairId&&q[v.type]?Nl.Icons.DrawIcon(Q,N,Nl.Icons.ShapeActivingCtrl,{point:q.point,c1:q.c1,c2:q.c2,hl:v.type}):Nl.Icons.DrawIcon(Q,N,Nl.Icons.ShapeActivingCtrl,q)}}Nl.Icons.DrawIcon(Q,N,Nl.Icons.ShapeHighlighRealPoint,L.activing.point),A&&A.forEach(function(K){Nl.Icons.DrawIcon(Q,N,Nl.Icons.ShapeHighlighRealPoint,K)})}},xm.prototype.clear=function(){var I=this;I.editing=null,I._guideInfo=null,I.activing=null,I.highlight=null},xm.prototype._42=function(_){var C=this;C.info={},C.editing||(C.screenInfo=null);var u=C._interactor;if(!u.editDetail)return C.clear(),void 0;var U=u.gv;if(!C.target||!U.isSelected(C.target)||!U.isVisible(C.target))return u.editDetail=!1,C.clear(),void 0;if(C.gatherSingleTarget(U,C.target),Nl.Icons.DrawIcon(u,_,Nl.Icons.ShapeBgCurve,C.screenInfo),C._drawHighlight(_),C._drawCurrentPoint(_),C._getRealPoint().forEach(function(j){Nl.Icons.DrawIcon(u,_,Nl.Icons.ShapePoint,j)}),C._drawGuide(_),C.tipInfo&&Nl.Icons.DrawIcon(u,_,Nl.Icons.TipHelper,C.tipInfo),C._edgeHostGuideInfo){Nl.Icons.DrawIcon(u,_,Nl.Icons.NodeHoverGuide,C._edgeHostGuideInfo.corners);var h=C._edgeHostGuideInfo.host;if(h){var G=U.getAttachPoints(h);if(G&&G.length)for(var T=0,e=G.length;e>T;T++){var I=G[T],s=Kq(U,h,0,I.offsetX||0,I.offsetY||0,I.x,I.y);s=Nl.toScreenPosition(U,s),s.isAttach=C._edgeHostGuideInfo.attach===T,Nl.Icons.DrawIcon(u,_,Nl.Icons.AttachPoint,s)}}}if(C._interactor.getStyle("curveElevationVisible")&&(C.target instanceof E.Polyline||C.target instanceof E.Edge&&C._interactor.getStyle("edgeElevationEditable"))&&C.activing){var o=C.activing.getCurrentEditingPoint();o&&"string"!=typeof o.e&&Nl.Icons.DrawIcon(u,_,Nl.Icons.EdgeElevationGuide,o)}if(C.edgeEditResult&&C._drawEdgeHostHighlight(_,C.edgeEditResult.host,C.edgeEditResult.anchor),C._multiSelect&&C._multiSelect.endPoint){var P=E.Default.unionPoint(Nl.toScreenPosition(U,C._multiSelect.startPoint),Nl.toScreenPosition(U,C._multiSelect.endPoint));P.color=U.getRectSelectBorderColor(),_.save(),_.setTransform(1,0,0,1,0,0);var y=d.devicePixelRatio,n=P.borderWidth=Math.round(y);n/=2,P.x=Math.round(P.x*y)+n,P.y=Math.round(P.y*y)+n,P.width=Math.round(P.width*y),P.height=Math.round(P.height*y),Nl.Icons.DrawIcon(u,_,Nl.Icons.SimpleRect,P),_.restore()}},xm.prototype._drawEdgeHostHighlight=function(L,T,u){this.drawEdgeHostHighlight(L,T,u),this._interactor.redraw()},xm.prototype.drawEdgeHostHighlight=function(K,n,L){if(Ej(n)){var k,l,Z,D,O=this,T=O._interactor,d=T.gv,W=d.getDataUI(n),u=Nb(W),m=[];for(Z=0,D=u.points.length;D>Z;Z++)l=Nl.toScreenPosition(d,u.points.get(Z)),m.push(l.x,l.y);u.segments&&(k=u.segments.toArray());var B=T.getStyle("edgeHostHighlighPeriod"),f=T.getStyle("edgeHostEdgeHighlighColor");Nl.Icons.DrawIcon(T,K,Nl.Icons.ShapeBgCurve,{P:m,S:k,color:f,dynamicVisible:L.index===S,dynamicPeriod:B}),f=T.getStyle("edgeHostPointHighlighColor");var i=nj(W);for(Z=0,D=i.length;D>Z;Z++){var H=i[Z],V=Nl.toScreenPosition(d,H);Nl.Icons.DrawIcon(T,K,Nl.Icons.ShapePoint,{point:{x:V.x,y:V.y},color:f,size:12,dynamicVisible:Z===L.index,dynamicPeriod:B})}}},xm.prototype._getRealPoint=function(){var r,t=this.screenInfo,$=t.P,C=t.S,Z=-1,s=[],J=-1,z=C.length;return C.each(function(o){J++;var H=1;if(3===o)H=2;else if(4===o)H=3;else if(5===o)return;Z+=H,r=J+1>=z?!0:1===C.get(J+1)?!0:!1,s.push({point:{x:$[2*Z],y:$[2*Z+1]},segmentIndex:J,pointIndex:Z,isEnd:r})}),s},xm.prototype.getEditingPointsInfo=function(j){var H=this,W=H.activing;if(!W)return!1;var m=W.point;if(!m)return!1;var X=this._getRealPoint(),T=[{screen:m}];W.selections&&W.selections.forEach(function(p){T.push({screen:p})});var R,K,C=X.length;return T.forEach(function(u){for(R=0;C>R;R++)if(K=X[R],u.screen.isNearEnough(K.point)){u.segmentIndex=K.segmentIndex,u.pointIndex=K.pointIndex,u.point=H.target.getPoints().get(K.pointIndex);break}}),j&&T.sort(function(Q,T){return Q.segmentIndex-T.segmentIndex}),T};var Rp=Nl.MoveHelper=function(H){var Q=this;Q.catalog="Move",Q._interactor=H};Rp.prototype={},Rp.prototype.constructor=Rp,Rp.prototype.calcShift=function(x,m,M){var d,j,t=this,G=t._interactor.gv,S=G.lp(m);if("beginMove"===x&&t._gatherGridInfo(M._lastLogicalPoint||S),d=t._target){var s=d.downPosition;if(s){var o=t._interactor.getStyle("moveSensitivity")/G._zoom;if(s.distanceTo(S)<o)return{x:0,y:0};delete d.downPosition}var q;j=E.Default.isShiftDown(m),j&&(S=t._dealShiftDown(S),q=d.shiftGuide.dir);var N,u=d.rawPos={x:d.pos.x+S.x-d.lp.x,y:d.pos.y+S.y-d.lp.y};if(E.Default.isCtrlDown(m)){if(N=t._calcShiftByAddon(),t._target.node instanceof Nl.Group){var _=t._target.node;_._position.x+=N.x,_._position.y+=N.y}return N}for(var V,F=d.x+u.x,g=d.y+u.y,b={x:F,y:g},W={x:F+d.w/2,y:g+d.h/2},r={x:F+d.w,y:g+d.h},U=t._interactor.rectGuide,f=t._interactor.gridGuide,C=[U.findClosest(b,q),U.findClosest(W,q),U.findClosest(r,q),f.findClosest(b,q),f.findClosest(W,q),f.findClosest(r,q)],h=1/0,H=1/0,P=0,n=C.length;n>P;P++)V=C[P],V&&(F=V.x,g=V.y,isFinite(F)&&Math.abs(F)<Math.abs(h)&&(h=F),isFinite(g)&&Math.abs(g)<Math.abs(H)&&(H=g));if(isFinite(h)||(h=0),isFinite(H)||(H=0),N=t._calcShiftByAddon(h,H),t._target.node instanceof Nl.Group){var _=t._target.node;_._position.x+=N.x,_._position.y+=N.y}var e=d.node;if(!qq(e,G)){var Z=u.x+h,I=u.y+H;t._interactor.rectGuide.gatherLines({node:e,x:d.x+Z,y:d.y+I,w:d.w,h:d.h},q)}return N}},Rp.prototype._calcShiftByAddon=function(E,x){var o=this._target,F=o.rawPos,D=o.node.getPosition();return E=E||0,x=x||0,{x:F.x-D.x+E,y:F.y-D.y+x}},Rp.prototype._dealShiftDown=function(l){var i=this,k=i._target.shiftGuide,K=i._target.lp,N=Math.abs(l.x-K.x),I=Math.abs(l.y-K.y);N>I&&N>k.limit&&"y"===k.dir&&(k.dir="x"),I>N&&I>k.limit&&"x"===k.dir&&(k.dir="y");var H=k.dir;return"x"===H?(l.y=K.y,k.limit=Math.max(k.limit,N)):"y"===H&&(l.x=K.x,k.limit=Math.max(k.limit,I)),l},Rp.prototype._gatherGridInfo=function(Y){var N,t=this,k=t._interactor,F=k._getValidSelection();if(F.length){if(1===F.length){if(N=F[0],!N.getRect)return t._target=null,void 0}else if(N=Nl.Group.findOrCreateGroup(F),!N)return t._target=null,void 0}else{var F=k.gv.sm().getSelection();if(F.length&&(N=F.get(0),!N.getRect))return t._target=null,void 0}var p=N.getPosition(),l=N.getRect();t._target={node:N,x:l.x-p.x,y:l.y-p.y,w:l.width,h:l.height,lp:{x:Y.x,y:Y.y},pos:{x:p.x,y:p.y},shiftGuide:{dir:"x",limit:0},downPosition:new Nl.Math.Vector2(Y)},k.rectGuide.gatherRects()},Rp.prototype.clear=function(){var r=this;r._interactor.rectGuide.clear(),r._interactor._42()};var di="directional",$r="point",xg="spot",Pg="light.color",Mj={},Un=function(e,k){rb(k)&&vf.test(k)?If(e,k):uq(k)&&k.modelType?xo(e,k):oq[e]=k},bs=function(r){return r},Sn=function(d){d=N.convertShape3dModelName(d);var D;if(uq(d)){if(d.modelType){if(d.uuid){if(D=oq[d.uuid])return D}else d.uuid=E.Math.generateUUID();return xo(d.uuid,d),S}return d}return D=oq[d],d&&D===S&&vf.test(d)&&(Yn&&Yn[d]||If(d,d)),D},Ag=function(L,l){L.frameStack?L.frameStack.push(l):L.frameStack=[l],L.bindFramebuffer(L.FRAMEBUFFER,l)},pe=function(L){var O=L.frameStack;if(O){if(O.pop(),O.length)return L.bindFramebuffer(L.FRAMEBUFFER,O[O.length-1]),void 0;L.frameStack=null}L.bindFramebuffer(L.FRAMEBUFFER,null)};vq(N,{graph3dViewAttributes:o,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:s/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:Ji,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewMaxPhi:s,graph3dViewMinPhi:0,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:s/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:Un,getShape3dModel:Sn,convertShape3dModelName:bs,getShape3dModelMap:function(){return oq},getCachedShape3dModelMap:function(){return pp},createMatrix:function(L,s){Si(L)||(L=[L]);for(var r=L.length-1;r>=0;r--){var V=L[r];s=si(V.mat,V.s3,V.r3,V.rotationMode,V.t3,s)}return s},transformVec:function(w,U){return Mr(w,U)},glBindFrame:Ag,glUnbindFrame:pe,createBoxModel:function(){return{vs:Ye,ns:Nk,uv:je,is:Uq}},createRoundRectModel:function(G,u){return qk.roundRect(G,u)},createStarModel:function(N,q){return qk.star(N,q)},createRectModel:function(i,b){return qk.rect(i,b)},createTriangleModel:function(p,X){return qk.triangle(p,X)},createRightTriangleModel:function(d,t){return qk.rightTriangle(d,t)},createParallelogramModel:function(U,q){return qk.parallelogram(U,q)},createTrapezoidModel:function(U,x){return qk.trapezoid(U,x)},createSmoothSphereModel:function(u,X,I,r,n,x,Z){return ze(new Wk(u,X,I,r,n,x,Z))},createSphereModel:function(Z,L,l,f,G,p,O){return Z?Zi(Z,L,l,f,G,p,O):N.createSmoothSphereModel()},createSmoothConeModel:function(B,_,U,r,Y){return co(B,_,U,r,Y)},createConeModel:function(y,R,k,V,I,U){return y?kg(y,R,k,V,I,U):co(U)},createSmoothCylinderModel:function(w,n,z,b,l,I,P,O){return ze(new gg(w,n,z,b,l,I,P,O))},createCylinderModel:function(c,l,z,H,K,_,V,$){return c?zr(c,l,z,H,K,_,V,$):ch(_,V)},createSmoothTorusModel:function(G,g,v,M,D,d){return ze(new Xn(G,g,v,M,D,d))},createTorusModel:function(x,s,D,U,u,Y,S,v){return x?An(x,s,D,U,u,Y,S,v):Ar(Y,S)},createExtrusionModel:function(c,w,l,U,Z,N,F,J){return tb(c,w,l,U,Z,N,F,J)},createSmoothRingModel:function(m,X,h,P,q,O){for(var K=[],c=0;c<m.length-1;c+=2)K.push({x:m[c],y:m[c+1]});for(m=Qc(K,X,h)[0],K=[],c=0;c<m.length;c++){var J=m[c];K.push(new Lk(J.x,0,J.y))}return ze(new lc(K,O,P,q))},createTextGeometry:function(n,O){return ze(new mj(n,O))},loadFontFace:function(J,w){N.xhrLoad(J,function(r){if(!r)return w();var j;try{j=JSON.parse(r)}catch(_){j=JSON.parse(r.substring(65,r.length-2))}kc.loadFace(j),w&&w(j.familyName.toLowerCase())},w?null:{sync:!0})},createRingModel:function(F,K,k,J,E,G,r,e,n,$){for(var B=[],L=0;L<F.length-1;L+=2)B.push({x:F[L],y:F[L+1]});G=G||N.shapeSide,r=r||0,e=e||G;var I,W,s,P,h,D,g,H,y,l,L,Z,d,p,S,a,f,R,x=[],Y=[],w=n?[]:o,u=n?[]:o,z=$?[]:o,C=$?[]:o,O=J?[]:o,c=J?[]:o,A=E?[]:o,T=E?[]:o,F=Qc(B,K,k),m=hh(F),q=0,Q=2*Math.PI/G;return F.forEach(function(M){if(s=M.length,s>1){if(P=M[0],J)for(D=P.x,H=P.y,L=r;e>L;L++)Z=L+1,d=L*Q,p=Z*Q,S=X(d),a=V(d),f=X(p),R=V(p),O.push(S*D,H,-a*D,f*D,H,-R*D,0,H,0),c.push(.5-.5*S,.5-.5*a,.5-.5*f,.5-.5*R,.5,.5);for(l=0;s>l;l++){for(h=M[l],D=P.x,g=h.x,H=P.y,y=h.y,I=q/m,q+=Qm(P,h),W=q/m,L=r;e>L;L++)Z=L+1,d=L*Q,p=Z*Q,S=X(d),a=V(d),f=X(p),R=V(p),x.push(S*g,y,-a*g,f*g,y,-R*g,S*D,H,-a*D,f*g,y,-R*g,f*D,H,-R*D,S*D,H,-a*D),Y.push(L/G,W,Z/G,W,L/G,I,Z/G,W,Z/G,I,L/G,I),n&&L===r&&(w.push(0,H,0,0,y,0,S*g,y,-a*g,S*g,y,-a*g,S*D,H,-a*D,0,H,0),u.push(0,.5-H,0,.5-y,2*g,.5-y,2*g,.5-y,2*D,.5-H,0,.5-H)),$&&Z===e&&(z.push(0,H,0,f*g,y,-R*g,0,y,0,f*g,y,-R*g,0,H,0,f*D,H,-R*D),C.push(1,.5-H,1-2*g,.5-y,1,.5-y,1-2*g,.5-y,1,.5-H,1-2*D,.5-H));P=h}if(E)for(D=P.x,H=P.y,L=r;e>L;L++)Z=L+1,d=L*Q,p=Z*Q,S=X(d),a=V(d),f=X(p),R=V(p),A.push(f*D,H,-R*D,S*D,H,-a*D,0,H,0),T.push(.5-.5*f,.5+.5*R,.5-.5*S,.5+.5*a,.5,.5)}}),{vs:x,uv:Y,bottom_vs:A,bottom_uv:T,top_vs:O,top_uv:c,from_vs:w,from_uv:u,to_vs:z,to_uv:C}}},!0),vq(t,{"3d.move.mode":S,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percent":1,"shape.border.gradient.color":S,"edge.gradient.color":S,"edge.source.t3":S,"edge.target.t3":S,"light.type":$r,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":s/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":wn,"wf.short":!1,"wf.mat":S,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:S,"transparent.mask":!1,brightness:S,"select.brightness":.7,"repeat.uv.length":S,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,alwaysOnTop:!1,"texture.cache":!1,"hide.overlapping.group":S,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"label.face":ph,"label.t3":S,"label.r3":S,"label.texture.scale":2,"label.rotationMode":jg,"label.light":!1,"label.blend":S,"label.reverse.flip":!1,"label.reverse.color":zf,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":ph,"label2.t3":S,"label2.r3":S,"label2.texture.scale":2,"label2.rotationMode":jg,"label2.light":!1,"label2.blend":S,"label2.reverse.flip":!1,"label2.reverse.color":zf,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":ph,"note.t3":S,"note.r3":S,"note.texture.scale":2,"note.rotationMode":jg,"note.light":!1,"note.blend":S,"note.reverse.flip":!1,"note.reverse.color":zf,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":ph,"note2.t3":S,"note2.r3":S,"note2.texture.scale":2,"note2.rotationMode":jg,"note2.light":!1,"note2.blend":S,"note2.reverse.flip":!1,"note2.reverse.color":zf,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:S,"shape3d.color":dd,"shape3d.top.color":S,"shape3d.bottom.color":S,"shape3d.from.color":S,"shape3d.to.color":S,"shape3d.image":S,"shape3d.top.image":S,"shape3d.bottom.image":S,"shape3d.from.image":S,"shape3d.to.image":S,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":S,"shape3d.side.to":S,"shape3d.smooth":S,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":S,"shape3d.opacity":S,"shape3d.reverse.flip":!1,"shape3d.reverse.color":zf,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":S,"shape3d.uv.scale":S,"shape3d.top.uv.offset":S,"shape3d.top.uv.scale":S,"shape3d.bottom.uv.offset":S,"shape3d.bottom.uv.scale":S,"shape3d.from.uv.offset":S,"shape3d.from.uv.scale":S,"shape3d.to.uv.offset":S,"shape3d.to.uv.scale":S,"shape3d.top.cap":S,"shape3d.bottom.cap":S,"shape3d.start.angle":0,"shape3d.sweep.angle":j,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":!1,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"shape3d.vector.dynamic":!1,"shape3d.texture.scale":1,"texture.mipmap.max":S,"texture.filter":S,"texture.filter.min":S,"texture.filter.mag":S,"all.light":!0,"all.visible":!0,"all.color":dd,"all.image":S,"all.blend":S,"all.opacity":S,"all.reverse.flip":!1,"all.reverse.color":zf,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":S,"all.uv.offset":S,"all.uv.scale":S,"all.discard.selectable":!0,mat:S,"left.mat":S,"right.mat":S,"top.mat":S,"bottom.mat":S,"front.mat":S,"back.mat":S},!0);var Xo,en=!1,ui=[0,0,0,0],gq={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:Ec,2:zn,3:md,4:Il,5:ph,6:Ic}},qi=function(A,H,P,o){if(H.getFaceVisible(A,P)){is(H,Hi(A,H.getFaceMat(A,P)||H.getMat(A)));var I=H._26I;H.getFaceReverseCull(A,P)?I.enable(I.CULL_FACE):I.disable(I.CULL_FACE),yg(I,H._prg.uFixPickReverseColor,gq[P]),Wm(I),Bc(I,o,6),fl(I),Gn(H)}},Ab=function(T){return T instanceof ye},jj=function(C){return[C.x,C.e||0,C.y]},hq=function(g,Y,n){for(var Y=zh(Y),I=Y[0],C=Y[1],w=Y[2];n--;)g.push(I,C,w)},ed=function(k,c,p){for(var c=zh(c),x=c[0],U=c[1],o=c[2],L=c[3];p--;)k.push(x,U,o,L)},re=function(q,I,U){if(I)for(var t,f,z,s=I[0],i=I[1],N=I[2],m=I[4],o=I[5],Y=I[6],P=I[8],h=I[9],T=I[10],j=I[12],X=I[13],w=I[14],S=U.length,O=0,O=0;S>O;O+=3)t=U[O],f=U[O+1],z=U[O+2],q.push(s*t+m*f+P*z+j,i*t+o*f+h*z+X,N*t+Y*f+T*z+w);else ad(q,U)},Qf=function(O,U){var C=U.s("light.intensity"),R=zh(U.s(Pg)),i=R[0],v=R[1],M=R[2];1!==C&&(i*=C,v*=C,M*=C),O.push(i,v,M,U.s("light.disabled")?1:0)},xb=function(A,$,G){yg($,G.uHeadlightRange,A._headlightRange),yg($,G.uHeadlightAmbientIntensity,A._headlightAmbientIntensity);var N=A._headlightIntensity,U=zh(A._headlightColor);1!==N&&(U=[U[0]*N,U[1]*N,U[2]*N]),yg($,G.uHeadlightColor,[U[0],U[1],U[2],A._headlightDisabled?1:0]);var Y=A._59O,f=A._spots,S=A._dirs;if(Y.length){var h=[],W=[],Z=[];Y.forEach(function(D){Qf(h,D),ad(W,A._transformPointToViewSpace(D.p3())),Z.push(D.s("light.range"))}),$.uniform4fv(G.uPointColor,h),$.uniform1fv(G.uPointRange,Z),$.uniform3fv(G.uPointPosition,W)}if(f.length){var P=[],C=[],j=[],D=[],p=[],E=[];f.forEach(function(Q){Qf(P,Q),ad(C,A._transformPointToViewSpace(Q.p3())),ad(p,A._transformDirectionToViewSpace(Q.p3(),Q.s("light.center"))),j.push(Q.s("light.range")),D.push(X(Q.s("light.angle")/2)),E.push(Q.s("light.exponent"))}),$.uniform4fv(G.uSpotColor,P),$.uniform1fv(G.uSpotRange,j),$.uniform1fv(G.uSpotAngle,D),$.uniform1fv(G.uSpotExponent,E),$.uniform3fv(G.uSpotPosition,C),$.uniform3fv(G.uSpotDirection,p)}if(S.length){var Q=[],r=[];S.forEach(function(K){Qf(Q,K),ad(r,A._transformDirectionToViewSpace(K.p3()))}),$.uniform4fv(G.uDirColor,Q),$.uniform3fv(G.uDirDirection,r)}},ji=function(h){return Math.max(N.graph3dViewMinPhi+So,Math.min(N.graph3dViewMaxPhi-So,h))},Xj=function(){return.05+M()/2},Sp=function(v,M,P,r){var K,l=v.getEye();return v.isOrtho()?(K=Ni(v.getCenter(),l),K[0]+=r[0],K[1]+=r[1],K[2]+=r[2]):K=l,bl(M,P,r,K)},bl=function(M,P,X,R){var k=Mq(M,P),_=Ni(R,X,!0),V=Mq(_,P);if(D(V)<So)return o;var S=(k-Mq(X,P))/V;return[X[0]+_[0]*S,X[1]+_[1]*S,X[2]+_[2]*S]},go=function(o,d){return{x:2*o.x-d.x,y:2*o.y-d.y}},Fk=function(w,N,E,s){var j,M;if(!w)return j=g(N.y-E.y,E.x-N.x),{x:N.x+s*V(j),y:N.y+s*X(j)};if(!E)return j=g(w.y-N.y,N.x-w.x),{x:N.x+s*V(j),y:N.y+s*X(j)};var b=Ni([w.x,w.y,0],[N.x,N.y,0],!0),a=Ni([E.x,E.y,0],[N.x,N.y,0],!0),Z=-(b[0]+a[0])/2,d=-(b[1]+a[1])/2,t=T(Z*Z+d*d);if(So>t)return j=g(w.y-N.y,N.x-w.x),{x:N.x+s*V(j),y:N.y+s*X(j)};var C=w.x-N.x,x=w.y-N.y,K=E.x-N.x,I=E.y-N.y,F=T(C*C+x*x),i=T(K*K+I*I);j=G(Mq(b,a))/2,M=b[1]*a[0]-b[0]*a[1]>0?-1:1,Z/=t,d/=t;var v=s/V(j),z=r(F,i)/X(j);t=Math.min(v,z);var S={x:N.x+M*t*Z,y:N.y+M*t*d};return E.b&&v>i/X(j)&&(S.adjust=!0),S},wd=function(i){var T=i[1],e=i[2],P=i[3],m=i[6],H=i[7],z=i[11];i[1]=i[4],i[2]=i[8],i[3]=i[12],i[4]=T,i[6]=i[9],i[7]=i[13],i[8]=e,i[9]=m,i[11]=i[14],i[12]=P,i[13]=H,i[14]=z},Sj=function(Q){var Y=Q[0],F=Q[1],i=Q[2],t=Q[3],B=Q[4],g=Q[5],q=Q[6],A=Q[7],K=Q[8],V=Q[9],s=Q[10],G=Q[11],U=Q[12],m=Q[13],e=Q[14],D=Q[15],C=Y*g-F*B,p=Y*q-i*B,c=Y*A-t*B,r=F*q-i*g,a=F*A-t*g,_=i*A-t*q,I=K*m-V*U,u=K*e-s*U,P=K*D-G*U,w=V*e-s*m,W=V*D-G*m,n=s*D-G*e,j=C*n-p*W+c*w+r*P-a*u+_*I;return j?(j=1/j,Q[0]=(g*n-q*W+A*w)*j,Q[1]=(i*W-F*n-t*w)*j,Q[2]=(m*_-e*a+D*r)*j,Q[3]=(s*a-V*_-G*r)*j,Q[4]=(q*P-B*n-A*u)*j,Q[5]=(Y*n-i*P+t*u)*j,Q[6]=(e*c-U*_-D*p)*j,Q[7]=(K*_-s*c+G*p)*j,Q[8]=(B*W-g*P+A*I)*j,Q[9]=(F*P-Y*W-t*I)*j,Q[10]=(U*a-m*c+D*C)*j,Q[11]=(V*c-K*a-G*C)*j,Q[12]=(g*u-B*w-q*I)*j,Q[13]=(Y*w-F*u+i*I)*j,Q[14]=(m*p-U*r-e*C)*j,Q[15]=(K*r-V*p+s*C)*j,void 0):o},ol=function(B,G){if(G){var j=G[0],Q=G[1],I=G[2];B[12]=B[0]*j+B[4]*Q+B[8]*I+B[12],B[13]=B[1]*j+B[5]*Q+B[9]*I+B[13],B[14]=B[2]*j+B[6]*Q+B[10]*I+B[14],B[15]=B[3]*j+B[7]*Q+B[11]*I+B[15]}},lm=function(l,s){if(s){var m=s[0],o=s[1],D=s[2];l[0]=l[0]*m,l[1]=l[1]*m,l[2]=l[2]*m,l[3]=l[3]*m,l[4]=l[4]*o,l[5]=l[5]*o,l[6]=l[6]*o,l[7]=l[7]*o,l[8]=l[8]*D,l[9]=l[9]*D,l[10]=l[10]*D,l[11]=l[11]*D}},$l=function(n,u,c){var G=u[0],z=u[1],y=u[2],N=u[3],S=u[4],d=u[5],t=u[6],m=u[7],r=u[8],f=u[9],P=u[10],h=u[11],q=u[12],J=u[13],M=u[14],Z=u[15],W=c[0],s=c[1],E=c[2],x=c[3];return n[0]=W*G+s*S+E*r+x*q,n[1]=W*z+s*d+E*f+x*J,n[2]=W*y+s*t+E*P+x*M,n[3]=W*N+s*m+E*h+x*Z,W=c[4],s=c[5],E=c[6],x=c[7],n[4]=W*G+s*S+E*r+x*q,n[5]=W*z+s*d+E*f+x*J,n[6]=W*y+s*t+E*P+x*M,n[7]=W*N+s*m+E*h+x*Z,W=c[8],s=c[9],E=c[10],x=c[11],n[8]=W*G+s*S+E*r+x*q,n[9]=W*z+s*d+E*f+x*J,n[10]=W*y+s*t+E*P+x*M,n[11]=W*N+s*m+E*h+x*Z,W=c[12],s=c[13],E=c[14],x=c[15],n[12]=W*G+s*S+E*r+x*q,n[13]=W*z+s*d+E*f+x*J,n[14]=W*y+s*t+E*P+x*M,n[15]=W*N+s*m+E*h+x*Z,n},io=function(S,j,P,K){var x,t,O,b,e,l,X,r,o,R,q=j[0],G=j[1],Y=j[2],M=K[0],N=K[1],I=K[2],U=P[0],W=P[1],z=P[2];return D(q-U)<So&&D(G-W)<So&&D(Y-z)<So?Sd(S):(X=q-U,r=G-W,o=Y-z,R=1/T(X*X+r*r+o*o),X*=R,r*=R,o*=R,x=N*o-I*r,t=I*X-M*o,O=M*r-N*X,R=T(x*x+t*t+O*O),R?(R=1/R,x*=R,t*=R,O*=R):(x=0,t=0,O=0),b=r*O-o*t,e=o*x-X*O,l=X*t-r*x,R=T(b*b+e*e+l*l),R?(R=1/R,b*=R,e*=R,l*=R):(b=0,e=0,l=0),S[0]=x,S[1]=b,S[2]=X,S[3]=0,S[4]=t,S[5]=e,S[6]=r,S[7]=0,S[8]=O,S[9]=l,S[10]=o,S[11]=0,S[12]=-(x*q+t*G+O*Y),S[13]=-(b*q+e*G+l*Y),S[14]=-(X*q+r*G+o*Y),S[15]=1,S)},qe=function(d,G,q,o,V){var J=1/K(G/2),h=1/(o-V);return d[0]=J/q,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=J,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=(V+o)*h,d[11]=-1,d[12]=0,d[13]=0,d[14]=2*V*o*h,d[15]=0,d},_e=function(n,v,k,o,f,Q,g){var z=1/(v-k),K=1/(o-f),Y=1/(Q-g);return n[0]=-2*z,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*K,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*Y,n[11]=0,n[12]=(v+k)*z,n[13]=(f+o)*K,n[14]=(g+Q)*Y,n[15]=1,n},Vf=function(h,T){var P=T[0],C=T[1],b=T[2],$=T[3],O=P*P+C*C+b*b+$*$,H=O?1/O:0;return h[0]=-P*H,h[1]=-C*H,h[2]=-b*H,h[3]=$*H,h},Hl=function(g,z){var W=z[0]+z[5]+z[10],_=0;return W>0?(_=2*Math.sqrt(W+1),g[3]=.25*_,g[0]=(z[6]-z[9])/_,g[1]=(z[8]-z[2])/_,g[2]=(z[1]-z[4])/_):z[0]>z[5]&z[0]>z[10]?(_=2*Math.sqrt(1+z[0]-z[5]-z[10]),g[3]=(z[6]-z[9])/_,g[0]=.25*_,g[1]=(z[1]+z[4])/_,g[2]=(z[8]+z[2])/_):z[5]>z[10]?(_=2*Math.sqrt(1+z[5]-z[0]-z[10]),g[3]=(z[8]-z[2])/_,g[0]=(z[1]+z[4])/_,g[1]=.25*_,g[2]=(z[6]+z[9])/_):(_=2*Math.sqrt(1+z[10]-z[0]-z[5]),g[3]=(z[1]-z[4])/_,g[0]=(z[8]+z[2])/_,g[1]=(z[6]+z[9])/_,g[2]=.25*_),g},el=function(e,q,M){var O=q[0],B=q[1],n=q[2],J=q[3],I=O+O,c=B+B,W=n+n,p=O*I,s=O*c,d=O*W,r=B*c,t=B*W,Z=n*W,i=J*I,f=J*c,m=J*W;return e[0]=1-(r+Z),e[1]=s+m,e[2]=d-f,e[3]=0,e[4]=s-m,e[5]=1-(p+Z),e[6]=t+i,e[7]=0,e[8]=d+f,e[9]=t-i,e[10]=1-(p+r),e[11]=0,e[12]=M[0],e[13]=M[1],e[14]=M[2],e[15]=1,e},Ae=function(J,K){if(J.vr.enable){var r=J.vr.getViewMatrix(K);if(r)return r}return io(K?K:wo(),J._eye,J._center,J._up)},ni=function(S,b){if(S.vr.enable){var v=S.vr.getProjectMatrix();if(v)return v}if(!b&&S._computedProjectMatrix)return Fq(S._computedProjectMatrix);var j=S.getAspect(),w=S._near,U=S._far,P=wo();if(S._ortho){var t=S._orthoWidth/2,I=t/j;_e(P,-t,t,-I,I,w,U)}else qe(P,S._fovy,j,w,U);return P},jq=function(r,D){if(!r)return o;var W=0,R=1,j=2,k=[],S=0,O=r.length,l=O/3;if(D){for(;O>S;S++)k[S]=0;for(S=0;S<D.length;S+=3){var G=[],L=[],m=[];G[W]=r[3*D[S+1]+W]-r[3*D[S]+W],G[R]=r[3*D[S+1]+R]-r[3*D[S]+R],G[j]=r[3*D[S+1]+j]-r[3*D[S]+j],L[W]=r[3*D[S+2]+W]-r[3*D[S+1]+W],L[R]=r[3*D[S+2]+R]-r[3*D[S+1]+R],L[j]=r[3*D[S+2]+j]-r[3*D[S+1]+j],m[W]=G[R]*L[j]-G[j]*L[R],m[R]=G[j]*L[W]-G[W]*L[j],m[j]=G[W]*L[R]-G[R]*L[W];for(var i=0;3>i;i++)k[3*D[S+i]+W]+=m[W],k[3*D[S+i]+R]+=m[R],k[3*D[S+i]+j]+=m[j]}}else for(S=0;l>S;S+=3){var G=[],L=[],m=[];G[W]=r[3*(S+1)+W]-r[3*S+W],G[R]=r[3*(S+1)+R]-r[3*S+R],G[j]=r[3*(S+1)+j]-r[3*S+j],L[W]=r[3*(S+2)+W]-r[3*(S+1)+W],L[R]=r[3*(S+2)+R]-r[3*(S+1)+R],L[j]=r[3*(S+2)+j]-r[3*(S+1)+j],m[W]=G[R]*L[j]-G[j]*L[R],m[R]=G[j]*L[W]-G[W]*L[j],m[j]=G[W]*L[R]-G[R]*L[W];for(var i=0;3>i;i++)k[3*(S+i)+W]=m[W],k[3*(S+i)+R]=m[R],k[3*(S+i)+j]=m[j]}for(S=0;O>S;S+=3){var V=[];V[W]=k[S+W],V[R]=k[S+R],V[j]=k[S+j];var E=T(V[W]*V[W]+V[R]*V[R]+V[j]*V[j]);0===E&&(E=So),V[W]=V[W]/E,V[R]=V[R]/E,V[j]=V[j]/E,k[S+W]=V[W],k[S+R]=V[R],k[S+j]=V[j]}return new $g(k)},Ke=function(D,n,C,c){if(C||(C=D.createTexture()),n){var w=D.TEXTURE_2D,i=D.REPEAT,z=D.CLAMP_TO_EDGE,P=D.TEXTURE_MIN_FILTER;c=c||ec;var q=c.minFilter||c.filter||D.LINEAR,m=c.magFilter||c.filter||D.LINEAR;Pq(D,C),D.texImage2D(w,0,D.RGBA,D.RGBA,D.UNSIGNED_BYTE,n),td(D,D.TEXTURE_MAG_FILTER,m);var j=n.naturalWidth||n.width,L=n.naturalHeight||n.height;Er.isPOT(j)&&Er.isPOT(L)&&!n.clampToEdge?(td(D,D.TEXTURE_WRAP_S,i),td(D,D.TEXTURE_WRAP_T,i),td(D,P,q===D.NEAREST?D.NEAREST_MIPMAP_NEAREST:D.LINEAR_MIPMAP_LINEAR),c.mipmapMaxLevel!==S&&td(D,D.TEXTURE_MAX_LEVEL,c.mipmapMaxLevel),D.generateMipmap(w)):(td(D,D.TEXTURE_WRAP_S,z),td(D,D.TEXTURE_WRAP_T,z),td(D,P,q)),Pq(D,o)}return C},gj=function(J,k){var L=new Uint8Array(4);return k=k||J.createTexture(),Pq(J,k),td(J,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,L),k},bh=function(L){L._26I&&L._prg&&(L._26I.deleteProgram(L._prg),L._prg=o)},pf=function($,E,q,T){var v=$.createShader(q);return $.shaderSource(v,T),$.compileShader(v),$.attachShader(E,v),v},vj=function(X){return X.createBuffer()},Pq=function(o,A){o.bindTexture(o.TEXTURE_2D,A)},td=function(C,h,Z){C.texParameteri(C.TEXTURE_2D,h,Z)},nn=function(J,S){J.enable(J.POLYGON_OFFSET_FILL),J.polygonOffset(S[0],S[1])},Gg=function(X){X.disable(X.POLYGON_OFFSET_FILL)},ls=function(p,r){if(r){var r=zh(r);p.clearColor(r[0],r[1],r[2],r[3])}},$o=function(T,p){yg(T,p.uFix,!0),up(T,p.aNormal)},bn=function(C,k){yg(C,k.uFix,!1),Ne(C,k.aNormal)},hi=function(G,t,E,b,J,W,g,p){G._picking||(E?(yg(G,t.uBlend,!0),yg(G,t.uBlendColor,E)):yg(G,t.uBlend,!1),yg(G,t.uLight,b==o?!0:b),Ie(J)&&1!==J&&yg(G,t.uPartOpacity,J),yg(G,t.uReverseFlip,W==o?!1:W),yg(G,t.uFixPickReverseColor,g||zf)),p?G.enable(G.CULL_FACE):G.disable(G.CULL_FACE)},ab=function(p,s){p._picking||yg(p,s.uPartOpacity,1)},Wm=function(){var V=[0,0,1,1];return function(C,b,c,U,h,D,H,B,P){return c?(yg(C,b.uTexture,!0),yg(C,b.uDiscardSelectable,Vd(U)?U:!0),Ne(C,b.aUv),pl(C,h,D,b.aUv,2),P?(yg(C,b.uBlendTexture,!0),C.activeTexture(C.TEXTURE1),Pq(C,P),C.uniform1i(b.uBlendSampler,1)):(yg(C,b.uBlendTexture,!1),C.activeTexture(C.TEXTURE1),Pq(C,C._emptyBlendTexture)),C.activeTexture(C.TEXTURE0),Pq(C,c),C.uniform1i(b.uSampler,0),H?(V[0]=H[0],V[1]=H[1]):(V[0]=0,V[1]=0),B?(V[2]=B[0],V[3]=B[1]):(V[2]=1,V[3]=1),yg(C,b.uOffsetScale,V),void 0):(C.activeTexture(C.TEXTURE0),Pq(C,C._emptyTexture),C.activeTexture(C.TEXTURE1),Pq(C,C._emptyBlendTexture),void 0)}}(),fl=function(X,s,G){X.activeTexture(X.TEXTURE0),Pq(X,o),X.activeTexture(X.TEXTURE1),Pq(X,o),G&&(up(X,s.aUv),yg(X,s.uTexture,!1),yg(X,s.uBlendTexture,!1))},sl=function(H,N,x,P,W,u){!x||dl||Vi||H.lineWidth(x),P&&!H._picking&&yg(H,N.uFixPickReverseColor,P),W&&pl(H,W,u,N.aPosition)},ug=function(D,s,I,u){Xo&&(u=D[Xo]),D.drawArrays(u==o?D.TRIANGLES:u,s,I);var Z=D._renderInfo;Z&&(Z.calls++,Z.vertices+=I,(u==o||u===D.TRIANGLES)&&(Z.faces+=I/3),u===D.LINES&&(Z.lines+=I/2))},Bc=function(F,I,K,$){Xo&&($=F[Xo]),F.drawElements($==o?F.TRIANGLES:$,K,F.UNSIGNED_SHORT,I==o?0:2*I);var n=F._renderInfo;n&&(n.calls++,n.vertices+=K,($==o||$===F.TRIANGLES)&&(n.faces+=K/3),$===F.LINES&&(n.lines+=K/2))},tp=function(A,e,T,O,g){var C=A.ARRAY_BUFFER;A.bindBuffer(C,e),T&&A.bufferData(C,T,A.STATIC_DRAW),O!=o&&A.vertexAttribPointer(O,g?g:3,A.FLOAT,!1,0,0)},pl=function(K,Y,Q,s,z){return Q?(Np(K,K.ARRAY_BUFFER,Y,Q),s!=o&&K.vertexAttribPointer(s,z?z:3,K.FLOAT,!1,0,0),void 0):tp(K,Y,Q,s,z)},Br=function(d,w,R){var l=d.ELEMENT_ARRAY_BUFFER;d.bindBuffer(l,w),R&&d.bufferData(l,R,d.STATIC_DRAW)},Io=function(J,g,b){Np(J,J.ELEMENT_ARRAY_BUFFER,g,b)},Np=function(H,Q,d,X){var b=X._bufId;b||(b=X._bufId=E.Math.generateIncreasingID());var d,N=H._bufPool;(d=N[b])&&d._buf?H.bindBuffer(Q,d._buf):(d=N[b]={_buf:vj(H)},H.bindBuffer(Q,d._buf),H.bufferData(Q,X,H.STATIC_DRAW)),d._fid=H._renderInfo.frame},yg=function(Y,f,e){if(e!=o&&f!=o){e=zh(e);var W=e.length;3===W?Y.uniform3fv(f,e):4===W?Y.uniform4fv(f,e):16===W?Y.uniformMatrix4fv(f,!1,e):Vd(e)?Y.uniform1i(f,e?1:0):2===W?Y.uniform2fv(f,e):Y.uniform1f(f,e)}},Ne=function(F,x){x!=o&&x>=0&&F.enableVertexAttribArray(x)},up=function(C,f){f!=o&&f>=0&&C.disableVertexAttribArray(f)},Gn=function(j,u){var M=j.getGL(),d=j._prg;j._7O=j._8O.pop(),u&&(yg(M,d.uMVMatrix,j._7O),j._6O=u,yg(M,d.uNMatrix,u))},_n=function(Q,V){return V||(V=wo()),Df(V,Q),Sj(V),wd(V),V},is=function(k,$){var f=k.getGL(),G=k._prg,b=k._7O;$&&(k._8O.push(Fq(b)),yg(f,G.uMMatrix,$),$l(b,b,$),k._7O=b),yg(f,G.uMVMatrix,b),yg(f,G.uNMatrix,_n(b,k._6O))},Cl=function(k,L,A,s,p,h){if(A){if(s){var S=A.value++,D=2147483648|S,E=[(255&D>>16)/255,(255&D>>8)/255,(255&D)/255,(255&D>>24)/255];A[S]={data:p,part:h}}else E=ui;return yg(k,L.uFixPickReverseColor,E),E}},ip=function(){var E={center:function(F,M,U,D,A){var v=-M[1]/2,O={x:-M[0]/2,y:v,width:M[0],height:M[1]},n=Hq(F,O,U);return[n.x+D,-n.y-A,Xj()]},front:function(u,Q,h,y,Z){var C=-Q[1]/2,m={x:-Q[0]/2,y:C,width:Q[0],height:Q[1]},x=Hq(u,m,h);return[x.x+y,-x.y-Z,Q[2]/2+Xj()]},back:function(k,a,h,r,p){var H=-a[0]/2,P=-a[1]/2,z={x:H,y:P,width:a[0],height:a[1]},M=Hq(k,z,h);return[-M.x-r,-M.y-p,-a[2]/2-Xj()]},left:function(m,f,g,O,j){var o=-f[1]/2,C={x:-f[2]/2,y:o,width:f[2],height:f[1]},H=Hq(m,C,g);return[-f[0]/2-Xj(),-H.y-j,H.x+O]
},right:function(P,l,n,$,J){var t=-l[2]/2,T=-l[1]/2,u={x:t,y:T,width:l[2],height:l[1]},H=Hq(P,u,n);return[l[0]/2+Xj(),-H.y-J,-H.x-$]},top:function(O,t,M,q,C){var n={x:-t[0]/2,y:-t[2]/2,width:t[0],height:t[2]},o=Hq(O,n,M);return[o.x+q,t[1]/2+Xj(),o.y+C]},bottom:function(m,x,h,c,I){var N=-x[2]/2,L={x:-x[0]/2,y:N,width:x[0],height:x[2]},P=Hq(m,L,h);return[P.x+c,-x[1]/2-Xj(),-P.y-I]}};return function(Y,z,i,m,g,B){return E[m](Y,z,i,g||0,B||0)}}(),jk=function(V,S,h,L,t,O,E,W,c,u){if(t&&(S[0]+=t[0],S[1]+=t[1],S[2]+=t[2]),ol(V,h),W){var A=wo();if(Gh(A,c,u),Mr(S,A),ol(V,S),V.auto=W,V.pos=Mr([0,0,0],V),O){var j=V.mat2=wo();Gh(j,O,E)}}else Gh(V,c,u),ol(V,S),L===Ec?Gb(V,-v):L===zn?Gb(V,v):L===md?Fe(V,-v):L===Il?Fe(V,v):L===Ic&&Gb(V,s),Gh(V,O,E);return V},lr=function(K,V){var C=V.auto,M=V.mat2,J=K.gv;if(C){var B,$=wo(),G=[0,0,0,0];B="string"==typeof C?[C.indexOf("x")<0?J._eye[0]:J._center[0],C.indexOf("y")<0?J._eye[1]:J._center[1],C.indexOf("z")<0?J._eye[2]:J._center[2]]:J._eye,Hl(G,io(wo(),B,J._center,J._up)),el($,Vf(G,G),V.pos),M&&$l($,$,M),is(J,$)}else is(J,V)},am=function(m,z,U,Y,R){var y=m.s,v=m.gv,Z=v.getGL(),$=v._prg,h=v._buffer,j=v._1O;Ke(Z,bg,j),lr(m,U),hi(Z,$,y(z+".blend"),y(z+".light"),y(z+".opacity"),y(z+".reverse.flip"),y(z+".reverse.color"),y(z+".reverse.cull")),Wm(Z,$,j,R,h.uv,Al),pl(Z,h.vs,Y,$.aPosition),pl(Z,h.ns,Fr,$.aNormal),Io(Z,h.is,rk),Bc(Z,0,rk.length),fl(Z,$,j),ab(Z,$),Gn(v)},Qn=function(Y,H,e){var q=Y.gv,M=Y.data,B=Y[H]={blend:q.getBodyColor(M)||q.getFaceBlend(M,H),light:q.getFaceLight(M,H),color:q.getFaceColor(M,H),opacity:q.getFaceOpacity(M,H),transparent:q.getFaceTransparent(M,H),reverseFlip:q.getFaceReverseFlip(M,H),reverseColor:q.getFaceReverseColor(M,H),reverseCull:q.getFaceReverseCull(M,H),texture:q.getFaceImage(M,H),blendTexture:q.getFaceBlendImage(M,H),discardSelectable:q.getFaceDiscardSelectable(M,H)};if("csg"!==H){B.uv=q.getFaceUv(M,H)||e&&e[H+"Uv"],B.uvScale=q.getFaceUvScale(M,H)||e&&e[H+"UvScale"],B.uvOffset=q.getFaceUvOffset(M,H)||e&&e[H+"UvOffset"];var c=q.getFaceMat(M,H);c&&(B.mat=Hi(M,c))}return B},Qb=function(Q,M,s,g,q){var N=Q[g];if(N){if(!q(N.transparent))return;var H=Q.data,m=Q.gv,y=m._buffer,i=m.getTexture(N.texture,H,g),C=m.getTexture(N.blendTexture,H);Wm(M,s,i,N.discardSelectable,y.uv,N.tuv,N.uvOffset,N.uvScale,C),hi(M,s,N.blend,N.light,N.opacity,N.reverseFlip,N.reverseColor,N.reverseCull),yg(M,s.uDiffuse,N.color||t["color.empty"]),pl(M,y.vs,N.vs,s.aPosition),pl(M,y.ns,N.ns,s.aNormal),ug(M,0,N.vs.length/3),ab(M,s),fl(M,s,i)}},Bg=function(A,S,R,y,b,e){var O,a,s,F,K,D,$,Z,i,w,Q,m=[y-S,b-R],Y=A?A.length:0;for(s=0;Y>s;s++){for(F=2,O=A[s],K=O[0],D=O[1];F+1<O.length;){if($=O[F],Z=O[F+1],a=Cq(S,R,y,b,K,D,$,Z,!0)){i=[$-K,Z-D],w=Qm(i),i[0]/=w,i[1]/=w,w=Mq(m,i),w=w>0?e:-e,Q=[i[0]*w,i[1]*w];break}K=$,D=Z,F+=2}if(Q)break}if(Q)for(y=S+Q[0],b=R+Q[1],s=0;Y>s;s++)for(F=2,O=A[s],K=O[0],D=O[1];F+1<O.length;){if($=O[F],Z=O[F+1],a=Cq(S,R,y,b,K,D,$,Z,!0))return[0,0];K=$,D=Z,F+=2}return Q?Q:[y-S,b-R]},gl=E.graph3d={},Id=function(Z,a,d){pk(x+".graph3d."+Z,a,d)},mg="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj<*opjujtpQb)4dfw!>!opjujtpQw~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjujtpQw!4dfw!hojzsbw<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",lp="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~~<esbdtje|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw|!*1!?!opjudfsjEqjmDv)!gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<opjujtpQw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<uofdsfQqjmDv!ubpmg!nspgjov<opjudfsjEqjmDv!uoj!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";vq(N,{setBatchInfo:function(E,W){tr[E]=W},getBatchInfo:function(M){return tr[M]}},!0);var bc=[1,1,1],xs=[1,0,0,0,0,1,0,1,1,1,1,0],Wq=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Pj=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],_d=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],zq=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Vc=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],Bq=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],eg=function(T,h){eo(T,h,"_batchModelMap","_batchIndexMap"),cr(T,h,"_wireframeModelMap","_wireframeIndexMap"),cr(T,h,"_polylineModelMap","_polylineIndexMap"),cr(T,h,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),cr(T,h,"_polylineModelMapSwap","_polylineIndexMapSwap")},eo=function(C,k,R,e){if(!k)return C[R]={},C[e]={},void 0;var r=k._id,O=C[e],z=O[r];if(z){var w=C[R],I=z.batch,G=w[I],N=G.ds,c=z.index;if(G.invalidate=!0,delete O[r],N.splice(c,1),Ad(N))return delete w[I],void 0;for(var g=z.begin,j=z.size,S=3*g,s=3*j,a=4*g,T=4*j,q=G.vs,i=G.ps,u=G.uv,p=G.cs,d=G.bs,V=G.rs,P=G.ns,_=G.ls;c<N.length;c++)z=O[N[c]._id],z.index--,z.begin-=j;q.splice(S,s),i.splice(a,T),u&&u.splice(2*g,2*j),p&&p.splice(a,T),d&&d.splice(S,s),V&&V.splice(g,j),P&&P.splice(S,s),_&&_.splice(g,j)}},cr=eo,pi=function(P,H,E,h){if(!h)return o;var B=H[h];if(!B){var M=tr[h]||ec,e=M.image?[]:o;B=H[h]={vs:[],ns:[],uv:e,cs:e?o:M.color?o:[],bs:M.blend?[]:o,ps:[],rs:M.brightness?[]:o,ds:[]}}return B.invalidate=!0,P[E._id]={index:B.ds.length,begin:B.vs.length/3,batch:h},B.ds.push(E),B},lk=function(M,t){return t!=o&&1!==t?[M[0]*t,M[1]*t,M[2]*t,M[3]]:M},Vm=function(){var h;return function(G,z,l){var x=G.getData3dUI(z),R=x.shapeModel;R||(R=dc(x));var o,m=z.s("wf.combineTriangle");if(l.geometry){if(!R&&(z instanceof E.Node&&!(z instanceof E.Shape)?(h||(h={vs:Ye,is:Uq,uv:je}),R=h):R=[x.left,x.front,x.right,x.back,x.top,x.bottom],!R))return S;if(m?(m=0|Math.min(3,Math.max(1,isNaN(m)?1:m)),o=Qe[m-1](R)):o=Lm(R),!o||0===o.length)return}else o=l.short?$c:ro;var r=G.getBrightness(z),j=zh(l.color||"white"),n=j[3]<1,H=Math.ceil(l.width)||1,s=(n?"T":"O")+H,P=G._wireframeIndexMap,v=G._wireframeModelMap,u=v[s];u||(u=v[s]={vs:[],cs:[],ps:[],ds:[],T:n,W:H}),u.invalidate=!0;var W=u.vs,w=u.cs,O=u.ds,Z=P[z._id]={index:O.length,begin:W.length/3,batch:s};O.push(z);var Y=x.mat;if(!Y||!l.geometry&&z instanceof E.Shape){Y=Hi(z,l.mat);var B=x._calcAnchorMat(z);B&&$l(Y,Y,B)}re(W,Y,o);var A=Z.size=W.length/3-Z.begin;ed(w,lk(j,r),A)}}(),hn=function($,P,s,b,B,n,J,V,T){var v=$.getBrightness(P);v==o&&(v=1);var _=lk(zh(b),v),q=_[3]<1;n=Math.ceil(n)||1;var i=(q?"T":"O")+n;if(J){var h=J[0],K=(J[1]||h)+h;i+="-"+h+"-"+K,T&&(i+="-"+$i(T)+"-"+v,T=lk(zh(T),v))}var f=$._polylineIndexMap,t=$._polylineModelMap,C=t[i];C||(C=t[i]={vs:[],cs:[],ps:[],ds:[],ls:J?[]:o,T:q,W:n},J&&(C.D=h,C.G=K,C.A=T)),C.invalidate=!0;var A,k=C.vs,a=C.cs,D=C.ds,m=C.ls,L=f[P._id]={index:D.length,begin:k.length/3,batch:i};D.push(P),ad(k,s);var g,M=L.size=k.length/3-L.begin,p=s.length,R=0,Z=[];if(J||B)for(A=0;p>A;A+=6)g=Qm([s[A],s[A+1],s[A+2]],[s[A+3],s[A+4],s[A+5]]),Z.push(g),R+=g;if(R&&B){var c,E=lk(zh(B),v),F=[E[0]-_[0],E[1]-_[1],E[2]-_[2],E[3]-_[3]],w=0;for(A=0;p>A;A+=6)c=w/R,ed(a,[_[0]+F[0]*c,_[1]+F[1]*c,_[2]+F[2]*c,_[3]+F[3]*c],1),w+=Z[A/6],c=w/R,ed(a,[_[0]+F[0]*c,_[1]+F[1]*c,_[2]+F[2]*c,_[3]+F[3]*c],1)}else ed(a,_,M);if(J)for(w=V||0,A=0;p>A;A+=6)m.push(w),w+=Z[A/6],m.push(w)},Fp=function(z,R,Z){if(R)for(var k=4*R.begin,P=Z[R.batch].ps,E=0;E<R.size;E++)P[k++]=z[0],P[k++]=z[1],P[k++]=z[2],P[k++]=z[3]},Zo=function(d,D){var X=D+["32"],F=d[D],z=d[X];F?z&&z.length===F.length?(z.set(F),z._bufId=null):d[X]=new $g(F):delete d[X]},Ff=function(B,p,t,T,n,Y,j,d,y){if(Si(t))t.forEach(function(e){Ff(B,p,e,T,n,Y,j,d,y)});else if(rb(t))Ff(B,p,dc(T,t),T,n,Y,j,d,y);else if(uq(t)){var V,Z=hd(t.mat,p,B),L=hd(t.s3,p,B),S=hd(t.t3,p,B),r=hd(t.r3,p,B);if((L||r||S||Z)&&(V=si(Z,L,r,hd(t.rotationMode,p,B),S),Y.push(V)),t.shape3d)Ff(B,p,t.shape3d,T,n,Y,j,d,t);else{var A=T.s;y=y||ec;var J=Y[0],k=Y.length,w=A("shape3d.color",t.color,y.color);if(n||(n=A("shape3d.blend",t.blend,y.blend)),k>1){J=Fq(J);for(var b=1;k>b;b++)$l(J,J,Y[b])}t.vs&&A(pq,t.visible,y.visible)&&jb(J,j,d,t.vs,t.uv,t.is,n,w),t.top_vs&&A(kh,t.topVisible,y.topVisible)&&jb(J,j,d,t.top_vs,t.top_uv,t.top_is,n,A("shape3d.top.color",t.topColor,y.topColor)||w),t.bottom_vs&&A(oe,t.bottomVisible,y.bottomVisible)&&jb(J,j,d,t.bottom_vs,t.bottom_uv,t.bottom_is,n,A("shape3d.bottom.color",t.bottomColor,y.bottomColor)||w),t.from_vs&&A(nf,t.fromVisible,y.fromVisible)&&jb(J,j,d,t.from_vs,t.from_uv,t.from_is,n,A("shape3d.from.color",t.fromColor,y.fromColor)||w),t.to_vs&&A(ws,t.toVisible,y.toVisible)&&jb(J,j,d,t.to_vs,t.to_uv,t.to_is,n,A("shape3d.to.color",t.toColor,y.toColor)||w)}V&&Y.pop()}},jb=function(d,n,f,E,x,k,g,j){var F,y=n.cs,Y=n.uv,C=n.bs;if(k){F=k.length;for(var I=0;F>I;I++){var s=k[I];re(f,d,[E[3*s],E[3*s+1],E[3*s+2]]),Y&&ad(Y,[x[2*s],x[2*s+1]])}}else F=E.length/3,re(f,d,E),Y&&ad(Y,x);y&&ed(y,j,F),C&&(g?hq(C,g,F):ad(C,bc,F))},ag=function(E,J,w,o){var O=[];o?Ff(E.gv,E.data,o,E,E.getBodyColor(),[J],w,O):(yj(E,Ec,J,w,O),yj(E,zn,J,w,O),yj(E,ph,J,w,O),yj(E,Ic,J,w,O),yj(E,md,J,w,O),yj(E,Il,J,w,O),yj(E,"csg",J,w,O)),O.length&&(ad(w.vs,O),ad(w.ns,jq(O)))},yj=function(N,e,j,u,V){var g=N[e];if(g){var _=g.tuv;if(_){var i,F,k,A,r=g.uvScale,D=g.uvOffset;if(r)for(i=_.length,F=r[0],k=r[1],A=0;i>A;A+=2)_[A]*=F,_[A+1]*=k;if(D)for(i=_.length,F=D[0],k=D[1],A=0;i>A;A+=2)_[A]+=F,_[A+1]+=k}jb(j,u,V,g.vs,_,o,g.blend,g.color)}},Sg=function(U,E,a,N,Z,v,Q,K){var j,b=a.cs,n=a.uv,S=a.bs;if(U.getFaceVisible(E,v)){var F=U.getFaceMat(E,v);if(F&&(Z=Hi(E,F)),re(Q,Z,K),b&&ed(b,U.getFaceColor(E,v),6),n){var t=U.getFaceUv(E,v)||N[v+"Uv"],W=U.getFaceUvScale(E,v)||N[v+"UvScale"],x=U.getFaceUvOffset(E,v)||N[v+"UvOffset"];t=t?[t[6],t[7],t[0],t[1],t[2],t[3],t[2],t[3],t[4],t[5],t[6],t[7]]:xs;var P=t[0],O=t[1],R=t[2],o=t[3],J=t[4],i=t[5],V=t[6],l=t[7],r=t[8],I=t[9],B=t[10],C=t[11];if(W){var d=W[0],s=W[1];P*=d,O*=s,R*=d,o*=s,J*=d,i*=s,V*=d,l*=s,r*=d,I*=s,B*=d,C*=s}if(x){var z=x[0],y=x[1];P+=z,O+=y,R+=z,o+=y,J+=z,i+=y,V+=z,l+=y,r+=z,I+=y,B+=z,C+=y}n.push(P,O,R,o,J,i,V,l,r,I,B,C)}S&&(j=U.getBodyColor(E)||U.getFaceBlend(E,v),j?hq(S,j,6):ad(S,bc,6))}},Ii=function(M,c,J,j){var l=M.getGL(),i=M._prg,V=M._buffer;if(!M.drawFilter&&!de(c)){is(M),$o(l,i);for(var z in c){var p=c[z];if(!(j&&!p.T||!j&&p.T)){p.invalidate?(p.invalidate=!1,Zo(p,"vs"),Zo(p,"cs"),Zo(p,"ls"),Zo(p,"ps")):J&&Zo(p,"ps");var y=p.vs32,E=J?p.ps32:p.cs32;sl(l,i,p.W,o,V.vs,y);var G=p.D,S=!M._dashDisabled&&G;yg(l,i.uAlphaTest,t.alphaTest),S&&(yg(l,i.uDash,!0),yg(l,i.uDashDistance,G),yg(l,i.uDashGapDistance,p.G),Ne(l,i.aLineDistance),pl(l,V.lineDistance,p.ls32,i.aLineDistance,1),yg(l,i.uDiffuse,p.A||t["color.empty"]));var H=!M._batchColorDisabled;H&&(yg(l,i.uBatchColor,!0),Ne(l,i.aBatchColor),pl(l,V.batchColor,E,i.aBatchColor,4)),Wm(l),ug(l,0,y.length/3,l.LINES),fl(l),H&&(yg(l,i.uBatchColor,!1),up(l,i.aBatchColor)),S&&(yg(l,i.uDash,!1),up(l,i.aLineDistance))}}bn(l,i)}},Fi=function(Y,L,y){var R,_,w,p,H,a,W,s,f,F,E,D=Y.getGL(),h=Y._prg,u=Y._buffer,z=Y._batchModelMap;if(!de(z)){is(Y);for(R in z)if(_=tr[R]||ec,!(y&&!_.transparent||!y&&_.transparent)&&(w=z[R],L||!_.transparentMask)){var n=y&&_.autoSort!==!1&&(Y._33Q||w.invalidate);if(w.invalidate?(w.invalidate=!1,Zo(w,"vs"),Zo(w,"ns"),Zo(w,"cs"),Zo(w,"rs"),Zo(w,"ps"),Zo(w,"bs"),Zo(w,"uv")):L&&Zo(w,"ps"),H=w.vs32,a=L?w.ps32:w.cs32,f=w.uv32,W=w.bs32,s=w.rs32,E=H.length/3,n&&(w.is=Fd(H,Y.getEye())),E){p=_.light,F=Y.getTexture(_.image),hi(D,h,o,_.light,_.opacity,_.reverseFlip,_.reverseColor,_.reverseCull),a?Y._batchColorDisabled||(yg(D,h.uBatchColor,!0),Ne(D,h.aBatchColor),pl(D,u.batchColor,a,h.aBatchColor,4)):yg(D,h.uDiffuse,_.color||t["color.empty"]);var N=_.alphaTest;yg(D,h.uAlphaTest,N===S?t.alphaTest:N),_.envmap!==S?(yg(D,h.uUseEnvMap,!0),yg(D,h.uReflectivity,_.envmap)):(yg(D,h.uUseEnvMap,!1),yg(D,h.uReflectivity,0));var J=W&&!Y._batchBlendDisabled;J&&(yg(D,h.uBatchBlend,!0),Ne(D,h.aBatchBlend),pl(D,u.batchBlend,W,h.aBatchBlend));var A=s&&!Y._batchBrightnessDisabled;A&&(yg(D,h.uBatchBrightness,!0),Ne(D,h.aBatchBrightness),pl(D,u.batchBrightness,s,h.aBatchBrightness,1)),f?Wm(D,h,F,_.discardSelectable,u.uv,f,_.uvOffset,_.uvScale):Wm(D),pl(D,u.vs,H,h.aPosition),pl(D,u.ns,w.ns32,h.aNormal),w.is?(Br(D,u.is,w.is),Bc(D,0,E)):ug(D,0,E),f?fl(D,h,F):fl(D),a&&!Y._batchColorDisabled&&(yg(D,h.uBatchColor,!1),up(D,h.aBatchColor)),J&&(yg(D,h.uBatchBlend,!1),up(D,h.aBatchBlend)),A&&(yg(D,h.uBatchBrightness,!1),up(D,h.aBatchBrightness)),ab(D,h)}}}},Fd=function(L,z){for(var n=L.length/3,Q=new Array(n),P=n/3,B=new Array(P),i=0;P>i;i++)B[i]=i;B.sort(function(W,K){var p=9*W,M=[(L[p]+L[p+3]+2*L[p+6])/4,(L[p+1]+L[p+4]+2*L[p+7])/4,(L[p+2]+L[p+5]+2*L[p+8])/4];p=9*K;var V=[(L[p]+L[p+3]+2*L[p+6])/4,(L[p+1]+L[p+4]+2*L[p+7])/4,(L[p+2]+L[p+5]+2*L[p+8])/4],d=Qm(z,M)-Qm(z,V);return d>0?-1:0>d?1:0});for(var i=0;P>i;i++){var M=3*i,k=3*B[i];Q[M]=k,Q[M+1]=k+1,Q[M+2]=k+2}return new gn(Q)},Wg={obj:function(g,I){var F={mat:g.mat,s3:g.s3,r3:g.r3,rotationMode:g.rotationMode,t3:g.t3,cube:g.cube==o?!0:g.cube,center:g.center==o?!0:g.center,ignoreMtls:g.ignoreMtls,ignoreTransparent:g.ignoreTransparent,ignoreColor:g.ignoreColor,ignoreImage:g.ignoreImage,ignoreNormal:g.ignoreNormal,prefix:g.prefix,flipY:g.flipY,flipFace:g.flipFace,reverseFlipMtls:g.reverseFlipMtls,finishFunc:function(X,Q){if(X){var Q=[];for(var e in X){var k=X[e];Q.rawS3=k.rawS3,Q.push(k),g.eachModel&&g.eachModel(e,k)}Q.json=g,I(Q)}else I()}};N.loadObj(g.obj,g.mtl,F)}};N.getModelTypeHandlers=function(){return Wg},N.setModelTypeHandler=function(f,g){Wg[f]=g},N.getModelTypeHandler=function(W){return Wg[W]},N.handleModelLoaded=function(){},N.handleUnfoundModel=function(){};var Yn=o,yq=o,aq=function(x){Yn&&!x._loadingModelView_&&(yq||(yq={}),yq[x._loadingModelView_=Gk()]=x)},If=function(i,j){Yn||(Yn={});var p=Yn[i];if(p){if(p.url===j)return;p.request.onload=Hj,p.request.onerror=Hj}var s=new nk;if(Yn[i]={request:s,url:j},j=N.beforeLoadURL(j),j.data){var e=N.parse(j.data);xo(i,e,j)}else{s.onload=function(){if(200===this.status||0===this.status){delete Yn[i];var u=N.parse(s.getResponseText());xo(i,u,j)}else Xc(i,N.handleUnfoundModel(i,j)||o)},s.onerror=function(){Xc(i,N.handleUnfoundModel(i,j)||o)};var W={};W.url=encodeURI(j),W.sync=!1,s.send(W)}},xo=function(J,y,P){var u=y.modelType;if(!u)return Xc(J,y),N.handleModelLoaded(J,y),void 0;var k=N.getModelTypeHandler(u);if(k){if(Yn||(Yn={}),Yn[J])return;Yn[J]=!0;var s=function(v){v?(Xc(J,v),N.handleModelLoaded(J,v)):Xc(J,N.handleUnfoundModel(J,P)||o)};k(y,s)}else Xc(J,N.handleUnfoundModel(J,P)||o)},Xc=function(Y,G){if(oq[Y]=G,delete Yn[Y],de(Yn)&&(Yn=o,yq)){for(var d in yq){var x=yq[d];x.invalidateAll&&x.invalidateAll(S,"modelLoaded",Y),x.redraw&&x.redraw(),x.iv(),delete x._loadingModelView_}yq=o}if(G&&yq)for(var d in yq){var x=yq[d];x.invalidateAll&&x.invalidateAll(S,"modelLoading",Y),x.redraw&&x.redraw(),x.iv()}},Al=new $g([0,0,0,1,1,1,1,0]),Fr=new $g([0,0,1,0,0,1,0,0,1,0,0,1]),rk=new gn([0,1,2,2,3,0]),Ye=new $g([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Uq=new gn([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),je=new $g([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Nk=jq(Ye,Uq),gr=(new $g([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new gn([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[Ec,ph,zn,Ic,md,Il]),ro=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],$c=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Zi=function(C,S,G,h,k,M,$){M=M||16,C=C||16,S=S||0,G=G||C;var A,r,E,l,Q,L,U,v,W,i=.5,u=[],e=[],g=j/C,H=s/M;for(A=0;M>A;A++)for(L=A+1,l=A*H,W=L*H,r=S;G>r;r++)U=r+1,E=r*g,v=U*g,u.push(i*V(l)*X(E),i*X(l),-i*V(l)*V(E),i*V(W)*X(v),i*X(W),-i*V(W)*V(v),i*V(l)*X(v),i*X(l),-i*V(l)*V(v),i*V(l)*X(E),i*X(l),-i*V(l)*V(E),i*V(W)*X(E),i*X(W),-i*V(W)*V(E),i*V(W)*X(v),i*X(W),-i*V(W)*V(v)),e.push(r/C,A/M,U/C,L/M,U/C,A/M,r/C,A/M,r/C,L/M,U/C,L/M);if($){var _=[];for(A=0,Q=u.length;Q>A;A+=3)_.push(2*u[A],2*u[A+1],2*u[A+2])}if(h){var P=[],z=[];for(E=S*g,A=0;M>A;A++)L=A+1,l=A*H,W=L*H,P.push(0,0,0,i*V(W)*X(E),i*X(W),-i*V(W)*V(E),i*V(l)*X(E),i*X(l),-i*V(l)*V(E)),z.push(0,.5,S/C,L/M,S/C,A/M)}if(k){var F=[],O=[];for(E=G*g,A=0;M>A;A++)L=A+1,l=A*H,W=L*H,F.push(0,0,0,i*V(l)*X(E),i*X(l),-i*V(l)*V(E),i*V(W)*X(E),i*X(W),-i*V(W)*V(E)),O.push(1,.5,G/C,A/M,G/C,L/M)}var t={vs:u,uv:e,from_vs:P,from_uv:z,to_vs:F,to_uv:O};return $&&(t.ns=_),t},Ar=function(L,J,c){L=L||.17,J=J||12,c=c||18,0>L?L=0:L>.25&&(L=.25);var M,I,E,p,i,F,H,A=.5,K=[],m=[],x=[],w=j/c,o=j/J,e=A-L;for(I=0;J>=I;I++)for(p=-s+I*o,F=X(p),i=V(p),M=0;c>=M;M++)E=M*w,H=e+L*F,K.push(X(E)*H,i*L,-V(E)*H),m.push(M/c,1-I/J);for(I=0;J>I;I++){var z=I*(c+1),g=(I+1)*(c+1);for(M=0;c>M;M++)x.push(z+M,g+M+1,g+M,z+M,z+M+1,g+M+1)}return{vs:K,uv:m,is:x}},An=function(G,$,w,e,i,K,l,n){l=l||12,G=G||18,$=$||0,w=w||G,K=K||.17,0>K?K=0:K>.25&&(K=.25);var f,C,L,v,c,U,A,H,t,B,Q=.5,m=[],T=[],Z=j/G,O=j/l,g=Q-K,a=n?[]:S;for(L=0;l>L;L++)for(v=L+1,A=-s+L*O,H=-s+v*O,f=$;w>f;f++)C=f+1,c=f*Z,U=C*Z,t=g+K*X(A),B=g+K*X(H),m.push(X(c)*t,V(A)*K,-V(c)*t,X(U)*t,V(A)*K,-V(U)*t,X(U)*B,V(H)*K,-V(U)*B,X(c)*t,V(A)*K,-V(c)*t,X(U)*B,V(H)*K,-V(U)*B,X(c)*B,V(H)*K,-V(c)*B),T.push(f/G,1-L/l,C/G,1-L/l,C/G,1-v/l,f/G,1-L/l,C/G,1-v/l,f/G,1-v/l),n&&a.push(X(c)*X(A),V(A),-V(c)*X(A),X(U)*X(A),V(A),-V(U)*X(A),X(U)*X(H),V(H),-V(U)*X(H),X(c)*X(A),V(A),-V(c)*X(A),X(U)*X(H),V(H),-V(U)*X(H),X(c)*X(H),V(H),-V(c)*X(H));if(e){var p=[],R=[];for(L=0;l>L;L++)v=L+1,A=-s+L*O,H=-s+v*O,c=$*Z,t=g+K*X(A),B=g+K*X(H),p.push(X(c)*t,V(A)*K,-V(c)*t,X(c)*B,V(H)*K,-V(c)*B,X(c)*g,0,-V(c)*g),R.push(.5+.5*X(A),.5-.5*V(A),.5+.5*X(H),.5-.5*V(H),.5,.5)}if(i){var d=[],D=[];for(L=0;l>L;L++)v=L+1,A=-s+L*O,H=-s+v*O,c=w*Z,t=g+K*X(A),B=g+K*X(H),d.push(X(c)*t,V(A)*K,-V(c)*t,X(c)*g,0,-V(c)*g,X(c)*B,V(H)*K,-V(c)*B),D.push(.5-.5*X(A),.5-.5*V(A),.5,.5,.5-.5*X(H),.5-.5*V(H))}var h={vs:m,uv:T,from_vs:p,from_uv:R,to_vs:d,to_uv:D};return n&&(h.ns=a),h},ch=function(x,L){for(var U,d,M,c=.5,Y=16,D=[],A=[],e=[],r=j/Y,o=0;Y>=o;o++)U=o*r,d=X(U)*c,M=V(U)*c,D.push(d,-c,M,d,c,M),A.push(1-o/Y,1,1-o/Y,0);for(o=0;Y>o;o++)e.push(2*o,2*o+1,2*o+3,2*o,2*o+3,2*o+2);if(L){var J=[],I=[],B=[];for(J.push(0,-c,0),I.push(.5,.5),o=0;Y>=o;o++)U=o*r,d=X(U),M=V(U),J.push(d*c,-c,-M*c),I.push(.5+.5*d,.5+.5*M);for(o=0;Y>o;o++)B.push(0,o+2,o+1)}if(x){var f=[],G=[],n=[];for(f.push(0,c,0),G.push(.5,.5),o=0;Y>=o;o++)U=o*r,d=X(U),M=V(U),f.push(d*c,c,-M*c),G.push(.5+.5*d,.5-.5*M);for(o=0;Y>o;o++)n.push(0,o+1,o+2)}return{vs:D,uv:A,is:e,bottom_vs:J,bottom_uv:I,bottom_is:B,top_vs:f,top_uv:G,top_is:n}},zr=function(y,o,O,K,R,D,q,r){y=y||12,o=o||0,O=O||y;for(var _,x,c,$,i,A,Q,Y,g,t=.5,e=[],s=[],w=j/y,v=o;O>v;v++)_=v+1,x=v*w,c=_*w,$=X(x)*t,i=V(x)*t,A=X(c)*t,Q=V(c)*t,e.push($,-t,-i,A,-t,-Q,$,t,-i,A,-t,-Q,A,t,-Q,$,t,-i),s.push(v/y,1,_/y,1,v/y,0,_/y,1,_/y,0,v/y,0);if(r){var d=[];for(v=0,g=e.length;g>v;v+=3)d.push(2*e[v],0,2*e[v+2])}if(q){var G=[],p=[];for(v=o;O>v;v++)x=w*v,c=w*(v+1),$=X(x),i=V(x),A=X(c),Q=V(c),G.push($*t,-t,-i*t,0,-t,0,A*t,-t,-Q*t),p.push(.5+.5*$,.5+.5*i,.5,.5,.5+.5*A,.5+.5*Q)}if(D){var J=[],S=[];for(v=o;O>v;v++)x=w*v,c=w*(v+1),$=X(x),i=V(x),A=X(c),Q=V(c),J.push($*t,t,-i*t,A*t,t,-Q*t,0,t,0),S.push(.5+.5*$,.5-.5*i,.5+.5*A,.5-.5*Q,.5,.5)}if(K){var M=[],l=[];x=w*o,$=X(x)*t,i=V(x)*t,Y=o/y,M.push(0,t,0,0,-t,0,$,-t,-i,$,-t,-i,$,t,-i,0,t,0),l.push(0,0,0,1,Y,1,Y,1,Y,0,0,0)}if(R){var N=[],f=[];x=w*O,$=X(x)*t,i=V(x)*t,Y=O/y,N.push(0,-t,0,0,t,0,$,t,-i,$,t,-i,$,-t,-i,0,-t,0),f.push(1,1,1,0,Y,0,Y,0,Y,1,1,1)}var P={vs:e,uv:s,bottom_vs:G,bottom_uv:p,top_vs:J,top_uv:S,from_vs:M,from_uv:l,to_vs:N,to_uv:f};return r&&(P.ns=d),P},co=function(v,x,E,p,T){x=x||18,E=E||0,p=p==o?j:p,T=T==o?.5:T;for(var J,e,B,A,C,b,$=[0,.5,.75,.875,.9375],M=[],f=[],N=[],q=p/x,R=0;R<$.length;R++){var g=0===R%2?0:.5;for(J=0;x>=J;J++)e=(J+g)*q+E,B=1-$[R],M.push(X(e)*T*B,-T+2*$[R]*T,-V(e)*T*B),f.push((J+g)/x,B)}for(R=0;R<$.length-1;R++){var w=R*(x+1),i=(R+1)*(x+1);for(J=0;x>J;J++)N.push(w+J,i+J+1,i+J,w+J,w+J+1,i+J+1)}for(b=M.length/3-(x+1),J=0;x>J;J++)M.push(0,T,0),f.push((J+.5)/x,0);for(J=0;x>J;J++)N.push(b+J,b+J+1,b+(x+1)+J);if(v){var K=[],u=[],k=[];for(K.push(0,-T,0),u.push(.5,.5),J=0;x>=J;J++)e=J*q+E,A=X(e),C=V(e),K.push(A*T,-T,-C*T),u.push(.5+.5*A,.5+.5*C);for(J=0;x>J;J++)k.push(0,J+2,J+1)}return{vs:M,uv:f,is:N,bottom_vs:K,bottom_uv:u,bottom_is:k}},kg=function(M,w,K,t,c,x){M=M||16,w=w||0,K=K||M;for(var o=.5,l=[],T=[],b=j/M,k=w;K>k;k++){var J=k+1,n=b*k,Z=b*J;l.push(X(n)*o,-o,-V(n)*o,X(Z)*o,-o,-V(Z)*o,0,o,0),T.push(k/M,1,J/M,1,(k+J)/2/M,0)}if(x){var I=[],E=[];for(k=w;K>k;k++){n=b*k,Z=b*(k+1);var C=X(n),N=V(n),q=X(Z),g=V(Z);I.push(C*o,-o,-N*o,0,-o,0,q*o,-o,-g*o),E.push(.5+.5*C,.5+.5*N,.5,.5,.5+.5*q,.5+.5*g)}}if(t){var O=[],d=[];n=b*w,O.push(0,o,0,0,-o,0,X(n)*o,-o,-V(n)*o),d.push(0,0,0,1,w/M,1)}if(c){var B=[],F=[];n=b*K,B.push(0,-o,0,0,o,0,X(n)*o,-o,-V(n)*o),F.push(1,1,1,0,K/M,1)}return{vs:l,uv:T,bottom_vs:I,bottom_uv:E,from_vs:O,from_uv:d,to_vs:B,to_uv:F}},tb=function(T,f,U,c,E,_,R,N){for(var C=[],G=0;G<T.length-1;G+=2)C.push({x:T[G],y:T[G+1]});return so(C,f,U,c,E,_,R,N,!1)},qk={roundRect:function(R,w){return tb([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],R,w,3)},star:function(Y,E){return tb([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],Y,E)},rect:function(B,P){return tb([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],B,P)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(k,h){return tb([0,-.5,.5,.5,-.5,.5],[1,2,2,5],k,h)},rightTriangle:function(t,A){return tb([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],t,A)},parallelogram:function(r,Y){return tb([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],r,Y)},trapezoid:function(c,F){return tb([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],c,F)}},_m={sphere:1,cylinder:1,cone:1,torus:1},to={torus:1,sphere:1},fj=vq(rj(qk),{cylinder:1}),pg=vq(rj(qk),{cylinder:1,cone:1}),Qr=function(X,h,R){var D,H=hd(X.anchor3d,R,h),E=hd(X.mat,R,h),P=hd(X.s3,R,h),O=hd(X.t3,R,h),M=hd(X.r3,R,h),i=P||M||O||E;if(H||i){D=Fq(h._6O);var U=i?si(E,P,M,hd(X.rotationMode,R,h),O):wo();H&&ol(U,[.5-H[0],.5-H[1],.5-H[2]]),is(h,U)}return D},Mf=function(M,u,N,Q,$,A,V){if(Si(N))N.forEach(function(O){Mf(M,u,O,Q,$,A,V)});else if(rb(N))Mf(M,u,dc(Q,N),Q,$,A,V);else if(uq(N))if(N.shape3d){var T=Qr(N,M,u);Mf(M,u,N.shape3d,Q,$,A,N),T&&Gn(M,T)}else Ld(M,u,N,Q.s,$,A,V)},Ld=function(m,U,P,k,W,b,H){if(H=H||ec,!b||b(k("shape3d.transparent",P.transparent,H.transparent))){var v=Qr(P,m,U);Af(P);var J=m._26I,z=m._prg,l=m._buffer,S=k("shape3d.color",P.color,H.color);W||(W=k("shape3d.blend",P.blend,H.blend));var V,d=P.opacity==o?H.opacity:P.opacity,F=k("shape3d.opacity");V=F!=o&&d!=o?d*F:d!=o?d:F,hi(J,z,W,k("shape3d.light",P.light,H.light),V,k("shape3d.reverse.flip",P.reverseFlip,H.reverseFlip),k("shape3d.reverse.color",P.reverseColor,H.reverseColor),k("shape3d.reverse.cull",P.reverseCull,H.reverseCull));var h=k("polygonOffset",P.polygonOffset,H.polygonOffset);P.vs&&k(pq,P.visible,H.visible)&&nm(J,z,l,S,m.getTexture(k("shape3d.image",P.image,H.image),U),k("shape3d.discard.selectable",P.discardSelectable,H.discardSelectable),P.vs,P.uv,P.ns,P.is,k("shape3d.uv.offset",P.uvOffset,H.uvOffset),k("shape3d.uv.scale",P.uvScale,H.uvScale),h),P.top_vs&&k(kh,P.topVisible,H.topVisible)&&nm(J,z,l,k("shape3d.top.color",P.topColor,H.topColor)||S,m.getTexture(k("shape3d.top.image",P.topImage,H.topImage),U,"top"),k("shape3d.top.discard.selectable",P.topDiscardSelectable,H.topDiscardSelectable),P.top_vs,P.top_uv,P.top_ns,P.top_is,k("shape3d.top.uv.offset",P.topUvOffset,H.topUvOffset),k("shape3d.top.uv.scale",P.topUvScale,H.topUvScale),h),P.bottom_vs&&k(oe,P.bottomVisible,H.bottomVisible)&&nm(J,z,l,k("shape3d.bottom.color",P.bottomColor,H.bottomColor)||S,m.getTexture(k("shape3d.bottom.image",P.bottomImage,H.bottomImage),U,"bottom"),k("shape3d.bottom.discard.selectable",P.bottomDiscardSelectable,H.bottomDiscardSelectable),P.bottom_vs,P.bottom_uv,P.bottom_ns,P.bottom_is,k("shape3d.bottom.uv.offset",P.bottomUvOffset,H.bottomUvOffset),k("shape3d.bottom.uv.scale",P.bottomUvScale,H.bottomUvScale),h),P.from_vs&&k(nf,P.fromVisible,H.fromVisible)&&nm(J,z,l,k("shape3d.from.color",P.fromColor,H.fromColor)||S,m.getTexture(k("shape3d.from.image",P.fromImage,H.fromImage),U,"from"),k("shape3d.from.discard.selectable",P.fromDiscardSelectable,H.fromDiscardSelectable),P.from_vs,P.from_uv,P.from_ns,P.from_is,k("shape3d.from.uv.offset",P.fromUvOffset,H.fromUvOffset),k("shape3d.from.uv.scale",P.fromUvScale,H.fromUvScale),h),P.to_vs&&k(ws,P.toVisible,H.toVisible)&&nm(J,z,l,k("shape3d.to.color",P.toColor,H.toColor)||S,m.getTexture(k("shape3d.to.image",P.toImage,H.toImage),U,"to"),k("shape3d.to.discard.selectable",P.toDiscardSelectable,H.toDiscardSelectable),P.to_vs,P.to_uv,P.to_ns,P.to_is,k("shape3d.to.uv.offset",P.toUvOffset,H.toUvOffset),k("shape3d.to.uv.scale",P.toUvScale,H.toUvScale),h),ab(J,z),v&&Gn(m,v)
}},nm=function(A,O,$,S,R,g,K,X,y,j,r,k,G){K&&(G&&nn(A,G),yg(A,O.uDiffuse,S||t["color.empty"]),X?Wm(A,O,R,g,$.uv,X,r,k):Wm(A),pl(A,$.vs,K,O.aPosition),pl(A,$.ns,y,O.aNormal),j?(Io(A,$.is,j),Bc(A,0,j.length)):ug(A,0,K.length/3),X?fl(A,O,R):fl(A),G&&Gg(A))},dc=function(y,C){var T=y.s;if(C||(C=T(dh)),!C)return o;var u=Sn(C);if(u)return u;if("text"===C){var k={amount:T("shape3d.text.amount"),size:T("shape3d.text.size"),font:T("shape3d.text.font"),style:T("shape3d.text.style"),weight:T("shape3d.text.weight"),fill:T("shape3d.text.fill"),curveSegments:T("shape3d.text.curveSegments"),spacing:T("shape3d.text.spacing")},W=y.gv.getShape3dText(y.data),D=W;for(var X in k)D+="_"+(k[X]===S?"U":k[X]);return y._cachedTextKey===D?y._cachedTextGeometry:(y._cachedTextKey=D,y._cachedTextGeometry=N.createTextGeometry(W,k))}var X=C;if(_m[C]){var q=T("shape3d.side"),Z=T("shape3d.side.from"),z=T("shape3d.side.to"),V=T(nf),x=T(ws);3>q?(q=0,Z=0,z=0,V=!1,x=!1):((Z==o||0>Z)&&(Z=0),(z==o||z>q)&&(z=q),0===Z&&z===q&&(V=!1,x=!1));var Y="cone"===C?!1:T("shape3d.smooth");X+="-"+q+"-"+Z+"-"+z+"-"+V+"-"+x+(Y?1:0)}if(fj[C]){var h=T(kh);X+="-"+h}if(pg[C]){var i=T(oe);X+="-"+i}if("torus"===C){var a=T("shape3d.torus.radius");0>a?a=0:a>.25&&(a=.25),X+="-"+a}if(to[C]){var p=T(Ve);X+="-"+p}return u=pp[X],u||("box"===C?u=N.createBoxModel():qk[C]?u=qk[C](h,i):"sphere"===C?u=N.createSphereModel(q,Z,z,V,x,p,Y):C===Qq?u=N.createCylinderModel(q,Z,z,V,x,h,i,Y):"cone"===C?u=N.createConeModel(q,Z,z,V,x,i):"torus"===C&&(u=N.createTorusModel(q,Z,z,V,x,a,p,Y)),pp[X]=u),u},Af=function(){var X=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],S=["is","top_is","bottom_is","from_is","to_is"];return p=Xg(mg.substr(mg.indexOf("^#")+2)),we(N[Vr(wc+X[15]+"n"+X[16])]())&&Op()?function(k){k&&!k._complete_&&(k._complete_=!0,k.vs&&Ad(k.ns)&&(k.ns=jq(k.vs,k.is)),k.top_vs&&Ad(k.top_ns)&&(k.top_ns=jq(k.top_vs,k.top_is)),k.bottom_vs&&Ad(k.bottom_ns)&&(k.bottom_ns=jq(k.bottom_vs,k.bottom_is)),k.from_vs&&Ad(k.from_ns)&&(k.from_ns=jq(k.from_vs,k.from_is)),k.to_vs&&Ad(k.to_ns)&&(k.to_ns=jq(k.to_vs,k.to_is)),X.forEach(function(m){var n=k[m];Si(n)&&(k[m]=new $g(n))}),S.forEach(function(g){var Q=k[g];Si(Q)&&(k[g]=new gn(Q))}))}:void 0}(),Um=function(u,d){var S=u[d];Si(S)&&(u[d]=new $g(S))};vq(_l,{_25Q:function(V){V._16O=function(C,A,b,D,M,F,P,f,L){var K=this.info;if(K){var v,Y,V,p,w,J,Q=wo();if(Bh[A]?(v=K.p3,Y=K.c1,V=K.c2):Ao[A]?(Y=K.s1||K.c1,V=K.s2||K.c2):(Y=K.t1||K.c1,V=K.t2||K.c2),v)J=ip(A,$n,b,D,f,L);else{var S=Ni(V,Y),X=Qm(Y,V);p=[0,-g(S[2],S[0]),R(S[1]/X)],w="zyx",v=[(Y[0]+V[0])/2,(Y[1]+V[1])/2,(Y[2]+V[2])/2],J=ip(A,[X,0,0],b,D,f,L)}return jk(Q,J,v,D,M,F,P,C,p,w)}return Bj},V._80o=function(y,u,O){var e=this,h=e.shapeModel;if(h){var d=e.gv;is(d),Mf(d,e.data,h,e,e.getBodyColor(),O)}},V.createLineModel=function(N,q,T,l,D){for(var w=this,h=w.s,x=nq(N,q,h(Ve)),L=[],O=0;O<x.length;O++){var Q=x[O],S=Q.length;if(S>1){var f=Q[0];L.push(f.x,f.y,f.z);for(var E=1;S-1>E;E++)f=Q[E],L.push(f.x,f.y,f.z),L.push(f.x,f.y,f.z);f=Q[S-1],L.push(f.x,f.y,f.z)}}var V,p,g,$=h(l+".color"),c=h(D),z=0;return c&&(p=h(D+".color"),V=h(D+".pattern"),z=h(D+".offset"),g=$),hn(w.gv,w.data,L,p||$,g?o:h(l+".gradient.color"),T,V||h(l+".pattern"),z,g),x},V.createTubeModel=function(T,c,z,i){for(var g=this,u=g.s,A=u("shape3d.side")||dj,q=u("shape3d.start.angle"),B=u("shape3d.sweep.angle"),v=u(kh)?u("shape3d.top.cap"):o,y=u(oe)?u("shape3d.bottom.cap"):o,V="flat"===v,Q="flat"===y,R=V&&(i?i.uv:u("shape3d.top.image")),h=Q&&(i?i.uv:u("shape3d.bottom.image")),K=i?i.uv:u("shape3d.image"),f={vs:[],uv:K?[]:o,top_vs:V?[]:o,top_uv:R?[]:o,bottom_vs:Q?[]:o,bottom_uv:h?[]:o},O=nq(T,c,u(Ve),z),W=0,S=O.length;S>W;W++)Dj(f,O[W],u(Jo),z,A,q,B,v,y);if(i){var $=[];Ff(g.gv,g.data,f,g,g.getBodyColor(),[],i,$),$.length&&(ad(i.vs,$),ad(i.ns,jq($)))}else g.shapeModel=f;return O},V.getCache=function(){var e=this.info;if(e){var h=e.list;if(h){var x=e.cache;return x||(x=e.cache=yi(h)),x}}return o}}});var Wn=function(t,E){for(var M,B=0,D=t.length,X=0,a=D-1;a>=X;)if(B=P(X+(a-X)/2),M=t[B].length-E,0>M)X=B+1;else{if(!(M>0)){a=B;break}a=B-1}B=a;var v=t[B],m=v.point;return B===D-1||v.length===E||(m=(new Lk).subVectors(t[B+1].point,m).normalize().multiplyScalar(E-v.length).add(m)),{point:m,tangent:v.tangent}},yi=function(y){for(var T,z,c=[],M=0,h=0;h<y.length;h++){for(var C=y[h],G=0;G<C.length;G++){T=C[G],z&&(M+=z.distanceTo(T));var Q=new Lk,f=C[G+1];f?Q.subVectors(f,T):z?Q.subVectors(T,z):Q.x=1,Q.normalize(),c.push({point:T,length:M,tangent:Q}),z=T}z=null}return c},nq=function(J,e,I,T){I=I||zc;for(var y=[],v=0,R=J.size();R>v;v++){var W=J.get(v);y.push(new Lk(W.x,W.e||0,W.y))}e&&(oc(e)&&(e=e._as),e.length||(e=null));for(var d,G,S,B,i,K=[],Y=0,O=0,E=e?e.length:R;E>O;O++)if(i=e?e[O]:0===O?1:2,1===i)K.push(S=[]),S.push(y[Y++]);else if(2===i||5===i)if(B=2===i?y[Y++]:S[0],T){var n=e?e[O+1]:E>O+1?2:o;if(2===n||5===n){var j=S[S.length-1],P=2===n?y[Y]:S[0],p=(new Lk).subVectors(j,B),_=(new Lk).subVectors(P,B),L=p.length(),c=_.length();if(L&&c)if(T>L/2&&T>c/2)S.push(B);else for(p.multiplyScalar(Q(T,L/2)/L).add(B),_.multiplyScalar(Q(T,c/2)/c).add(B),d=new Hh(p,B,_).getPoints(I),G=0;I>=G;G++)S.push(d[G])}else S.push(B)}else S.push(B);else if(3===i)for(d=new Hh(S[S.length-1],y[Y++],y[Y++]).getPoints(I),G=1;I>=G;G++)S.push(d[G]);else if(4===i)for(d=new Sc(S[S.length-1],y[Y++],y[Y++],y[Y++]).getPoints(I),G=1;I>=G;G++)S.push(d[G]);return K},Jj=function(d){for(var m,B,c=new Lk,b=[],R=[],P=[],r=0,x=d.length;x>r;r++)m=d[r],B=d[r+1],B?c.subVectors(B,m):c.subVectors(m,d[r-1]),b.push(c.normalize().clone());var J,W,o,X,i=new Lk,O=new Lk,p=new wl,u=1e-4,e=Number.MAX_VALUE,C=b[0],T=R[0]=new Lk,Q=P[0]=new Lk;for(W=D(C.x),o=D(C.y),X=D(C.z),e>=W&&(e=W,i.set(1,0,0)),e>=o&&(e=o,i.set(0,1,0)),e>=X&&i.set(0,0,1),O.crossVectors(C,i).normalize(),T.crossVectors(C,O),Q.crossVectors(C,T),r=1;x>r;r++)R[r]=R[r-1].clone(),P[r]=P[r-1].clone(),O.crossVectors(b[r-1],b[r]),O.length()>u&&(O.normalize(),J=G(Ud(b[r-1].dot(b[r]),-1,1)),R[r].applyMatrix4(p.makeRotationAxis(O,J))),P[r].crossVectors(b[r],R[r]);return{B:P,T:b,N:R}},Dj=function(){var $=function(B){for(var N=1;N<arguments.length;N++){var i=arguments[N];B.push(i.x,i.y,i.z)}},x=function(d){for(var O=1;O<arguments.length;O++){var w=arguments[O].uv;d.push(w[0],w[1])}},J=function(j,B,M,q,c){var W=-q*X(c),l=q*V(c);return new Lk(j.x+W*M.x+l*B.x,j.y+W*M.y+l*B.y,j.z+W*M.z+l*B.z)},h=function(t,f,e,m,O,d,g,R){g=g||j;for(var Q=[],c=g/O,r=0;O>=r;r++){var H=J(t,f,e,m,r*c+d);Q.push(H),R!=o&&(H.uv=[R,r/O])}return Q},G=function(w,v,k,n,B,A,r,e,d){d=d||j;var M=v?w.top_vs:w.bottom_vs;if(M)for(var L=v?w.top_uv:w.bottom_uv,t=d/r,s=0;r>s;s++){var K,u;v?(K=s*t+e,u=(s+1)*t+e):(u=s*t+e,K=(s+1)*t+e),$(M,J(k,n,B,A,K),J(k,n,B,A,u),k),L&&L.push(.5-.5*X(K),.5-.5*V(K),.5-.5*X(u),.5-.5*V(u),.5,.5)}};return function(Q,u,j,H,V,w,m,_,p){var e=u.length;if(e>1){var J,c,Y,N,i,r,M,d=Jj(u),O=d.T,q=d.N,W=d.B;"flat"===_&&G(Q,!0,u[0],W[0],q[0],H,V,w,m),"flat"===p&&G(Q,!1,u[e-1],W[e-1],q[e-1],H,V,w,m);var v,f,y=[],l=Z(V/2),L="round"===_,P="round"===p,k=u[0],U=O[0],n=W[0],K=q[0],g=u[e-1],s=O[e-1],C=W[e-1],B=q[e-1];if(L){for(Y=1;l>=Y;Y++)q.splice(0,0,K),W.splice(0,0,n),O.splice(0,0,U),f=-Y/l*H,u.splice(0,0,U.clone().multiplyScalar(f).add(k)),y[l-Y]=T(H*H-f*f);e+=l}if(P){for(Y=1;l>=Y;Y++)q.push(B),W.push(C),O.push(s),f=Y/l*H,u.push(s.clone().multiplyScalar(f).add(g)),y[u.length-1]=T(H*H-f*f);e+=l}if(Q.uv){var A=0,R=0,a=[];for(j&&(A=j),i=u[0],a[0]=0,Y=1;e>Y;Y++)N=u[Y],a[Y]=i.distanceTo(N),i=N,j||(A+=a[Y]);for(v=[],Y=0;e>Y;Y++)R+=a[Y],v[Y]=A?R/A:0}for(Y=0;e>Y;Y++){if(N=u[Y],r=W[Y],M=q[Y],J=h(N,r,M,y[Y]===S?H:y[Y],V,w,m,v?v[Y]:o),c)for(var X=0;V>X;X++){var E=c[X],b=c[X+1]||c[0],F=J[X],D=J[X+1]||J[0];$(Q.vs,b,E,F,F,D,b),Q.uv&&x(Q.uv,b,E,F,F,D,b)}c=J}}}}();vq(N,{getLineLength:function(F){return F[F.length-1].length},getLineOffset:function(c,d){return Wn(c,d)},getLineCacheInfo:function(H,e,Y,D){return yi(nq(H,e,Y,D))}});var Kr=E.graph3d.RenderLite={},Nc=new Array(0),Kg=Kr.Buffer=function(Q,D,A,z){this.gl=Q,this.buffer=Q.createBuffer(),this.type=D||Q.ARRAY_BUFFER,this.drawType=z||Q.STATIC_DRAW,this.data=Nc,A&&this.upload(A)};Kg.prototype.upload=function(P,K,N){N||this.bind();var s=this.gl;P=P||this.data,K=K||0,this.data.byteLength>=P.byteLength?s.bufferSubData(this.type,K,P):s.bufferData(this.type,P,this.drawType),this.data=P},Kg.prototype.bind=function(){var b=this.gl;b.bindBuffer(this.type,this.buffer)},Kg.createVertexBuffer=function(F,p,$){return new Kg(F,F.ARRAY_BUFFER,p,$)},Kg.createIndexBuffer=function(X,Z,t){return new Kg(X,X.ELEMENT_ARRAY_BUFFER,Z,t)},Kg.create=function(M,H,B,J){return new Kg(M,H,J)},Kg.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var Jq=Kr.Shader=function(P,M,o){this.gl=P,this.program=ac(P,M,o),this.attributes=be(P,this.program);var w=Fg(P,this.program);this.uniforms=iq(P,w)};Jq.prototype.bind=function(){this.gl.useProgram(this.program)},Jq.prototype.destroy=function(){this.gl};var ac=function(N,V,Y){var r=Mp(N,N.VERTEX_SHADER,V),b=Mp(N,N.FRAGMENT_SHADER,Y);N.getShaderParameter(b,N.COMPILE_STATUS)||console.error(N.getError());var z=N.createProgram();return N.attachShader(z,r),N.attachShader(z,b),N.linkProgram(z),N.getProgramParameter(z,N.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",N.getProgramParameter(z,N.VALIDATE_STATUS)),console.error("gl.getError()",N.getError()),""!==N.getProgramInfoLog(z)&&console.warn("Warning: gl.getProgramInfoLog()",N.getProgramInfoLog(z)),N.deleteProgram(z),z=null),N.deleteShader(r),N.deleteShader(b),z},Mp=function(d,k,c){var N=d.createShader(k);return d.shaderSource(N,c),d.compileShader(N),d.getShaderParameter(N,d.COMPILE_STATUS)?N:(console.log(d.getShaderInfoLog(N)),null)},Fg=function(T,R){for(var P={},Y=T.getProgramParameter(R,T.ACTIVE_UNIFORMS),L=0;Y>L;L++){var _=T.getActiveUniform(R,L),q=_.name.replace(/\[.*?\]/,""),J=ek(T,_.type);P[q]={type:J,size:_.size,location:T.getUniformLocation(R,q),value:nc(J,_.size)}}return P},be=function(I,f){for(var O={},v=I.getProgramParameter(f,I.ACTIVE_ATTRIBUTES),p=0;v>p;p++){var s=I.getActiveAttrib(f,p),$=ek(I,s.type);O[s.name]={type:$,size:fc($),gl:I,location:I.getAttribLocation(f,s.name),pointer:dg}}return O},dg=function(z,U,K,S,C){var F=this.gl;F.enableVertexAttribArray(this.location),z instanceof Kr.Buffer||(z=Kr.Buffer.createVertexBuffer(F,z)),F.bindBuffer(z.type,z.buffer),F.vertexAttribPointer(this.location,this.size,U||F.FLOAT,K||!1,S||0,C||0)},fc=function(o){return ai[o]},ai={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},ek=function(e,W){if(!Eg){var I=l.keys(ep);Eg={};for(var N=0;N<I.length;++N){var o=I[N];Eg[e[o]]=ep[o]}}return Eg[W]},Eg=null,ep={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},nc=function(H,d){switch(H){case"float":return 0;case"vec2":return new Float32Array(2*d);case"vec3":return new Float32Array(3*d);case"vec4":return new Float32Array(4*d);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*d);case"ivec3":return new Int32Array(3*d);case"ivec4":return new Int32Array(4*d);case"bool":return!1;case"bvec2":return tq(2*d);case"bvec3":return tq(3*d);case"bvec4":return tq(4*d);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},tq=function(N){for(var u=new Array(N),I=0;I<u.length;I++)u[I]=!1;return u},iq=function(R,z){var Q={data:{}};Q.gl=R;for(var j=l.keys(z),Z=0;Z<j.length;Z++){var V=j[Z],v=V.split("."),t=v[v.length-1],p=jp(v,Q),J=z[V];p.data[t]=J,p.gl=R,l.defineProperty(p,t,{get:rn(t),set:af(t,J)})}return Q},rn=function(z){var g=uo.replace("%%",z);return new Function(g)},af=function(_,F){var z,g=Sh.replace(/%%/g,_);return z=1===F.size?Zm[F.type]:Uc[F.type],z&&(g+="\nthis.gl."+z+";"),new Function("value",g)},jp=function(G,L){for(var P=L,J=0;J<G.length-1;J++){var d=P[G[J]]||{data:{}};P[G[J]]=d,P=d}return P},uo=["return this.data.%%.value;"].join("\n"),Sh=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Zm={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},Uc={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},ye=E.Light=function(){ii(ye,this),this.s(Pg,t[Pg]),this.s(dh,"sphere"),this.s3(20,20,20)};Eb("Light",Rd,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(s,G,H){ye.superClass.onStyleChanged.apply(this,arguments),s===Pg&&this.s("shape3d.color",H)}});var Ym=gl.Graph3dView=function(B,c){var R=this;R._webGLVersion=1,R._attributes=c||N.graph3dViewAttributes,R._25I={},R._view=kb(1,R);var $=R._canvas=ib(R._view);A($,"webglcontextlost",function(N){N.preventDefault(),bh(R),R._26I&&R._doBufferGC(R._26I,!0),R._26I=o,R._1o.texture=o,R._35O=!0}),A($,"webglcontextrestored",function(){R._35O=!1,R.iv()}),R._batchIndexMap={},R._batchModelMap={},R._wireframeIndexMap={},R._wireframeModelMap={},R._wireframeIndexMapSwap={},R._wireframeModelMapSwap={},R._polylineIndexMap={},R._polylineIndexMap={},R._polylineIndexMapSwap={},R._polylineIndexMapSwap={},R._8O=[],R._7O=wo(),R._6O=wo(),R._1o=new oi(R),R._30O=new Bf(R),R._31O=new Xb(R),R._32O=new dm(R),R._raycaster=new rp(R),R._highlightHelper=new Cg(R),R._postProcessing=new qn(R),R._cameras=[],R._cameraId=0,R.vr=new Ze(R),R._33Q=!0,R._eye=rj(N.graph3dViewEye),R._center=rj(N.graph3dViewCenter),R._up=rj(N.graph3dViewUp),R._lightChanged=!1,R._59O=[],R._spots=[],R._dirs=[],R._frameId=0,R.overlappingBox=new Qd(R),R.dm(B?B:new gm),R._coreInteractor=new Ir(this),R.setInteractors([new Bm(R)])},vp={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},Wd=function(g,o,V,Q){g.clearColor(0,0,0,0),g.clearDepth(1),g.enable(g.DEPTH_TEST),g.depthFunc(g.LEQUAL),g.disable(g.CULL_FACE),g.enable(g.BLEND),g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA),g.useProgram(V),yg(g,V.uBrightness,1),yg(g,V.uOpacity,1),yg(g,V.uPartOpacity,1),yg(g,V.uPick,Q._picking),yg(g,V.uTexture,!1),yg(g,V.uBlendTexture,!1),yg(g,V.uAlphaTest,t.alphaTest),yg(g,V.uTransparent,!1),yg(g,V.uFix,!1),yg(g,V.uBatchColor,!1),yg(g,V.uBatchBlend,!1),yg(g,V.uBatchBrightness,!1),yg(g,V.uReflectivity,Q._envmapReflectivity),yg(g,V.uCameraPosition,o.getEye()),yg(g,V.uPMatrix,Q._projectMatrix),yg(g,V.uViewMatrix,Q._viewMatrix),o.bindEnvMap(g),Q._picking||(xb(o,g,V),o._fogDisabled||(yg(g,V.uFogColor,o._fogColor),yg(g,V.uFogNear,o._fogNear),yg(g,V.uFogFar,o._fogFar))),Ne(g,V.aPosition),Ne(g,V.aNormal),up(g,V.aUv),up(g,V.aBatchColor),up(g,V.aBatchBlend),up(g,V.aBatchBrightness),up(g,V.aLineDistance),g.depthMask(!0)},gb=0;Id("Graph3dView",l,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",Oc,wh,"firstPersonMode",ll,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Ob,Oj,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:N.graph3dViewEditHelperDisabled,_devicePixelRatio:S,_boundaries:S,_moveStep:N.graph3dViewMoveStep,_rotateStep:N.graph3dViewRotateStep,_pannable:N.graph3dViewPannable,_rotatable:N.graph3dViewRotatable,_walkable:N.graph3dViewWalkable,_resettable:N.graph3dViewResettable,_zoomable:N.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:N.graph3dViewFirstPersonMode,_mouseRoamable:N.graph3dViewMouseRoamable,_gridVisible:N.graph3dViewGridVisible,_gridSize:N.graph3dViewGridSize,_gridGap:N.graph3dViewGridGap,_gridColor:N.graph3dViewGridColor,_originAxisVisible:N.graph3dViewOriginAxisVisible,_centerAxisVisible:N.graph3dViewCenterAxisVisible,_axisXColor:N.graph3dViewAxisXColor,_axisYColor:N.graph3dViewAxisYColor,_axisZColor:N.graph3dViewAxisZColor,_ortho:N.graph3dViewOrtho,_orthoWidth:N.graph3dViewOrthoWidth,_fovy:N.graph3dViewFovy,_near:N.graph3dViewNear,_far:N.graph3dViewFar,_headlightColor:N.graph3dViewHeadlightColor,_headlightIntensity:N.graph3dViewHeadlightIntensity,_headlightRange:N.graph3dViewHeadlightRange,_headlightAmbientIntensity:N.graph3dViewHeadlightAmbientIntensity,_headlightDisabled:N.graph3dViewHeadlightDisabled,_rectSelectable:N.graph3dViewRectSelectable,_rectSelectBackground:N.graph3dViewRectSelectBackground,_editSizeColor:N.graph3dViewEditSizeColor,_autoMakeVisible:Ip,_fogDisabled:N.graph3dViewFogDisabled,_fogColor:N.graph3dViewFogColor,_fogNear:N.graph3dViewFogNear,_fogFar:N.graph3dViewFogFar,_dashDisabled:N.graph3dViewDashDisabled,_batchColorDisabled:N.graph3dViewBatchColorDisabled,_batchBlendDisabled:N.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:N.graph3dViewBatchBrightnessDisabled,addCamera:function(A){var B=l.freeze({id:this._cameraId++,priority:A.priority||0,ignoreInPick:!!A.ignoreInPick,useDefaultProgram:!!A.useDefaultProgram,render:A.render});this._cameras.push(B),this._cameras.sort(function(i,Y){return i.priority!==Y.priority?i.priority-Y.priority:i.id-Y.id})},setEye:function(c,h,d){1===arguments.length&&(h=c[1],d=c[2],c=c[0]);var i=this._eye;i[0]=c,i[1]=h,i[2]=d,this.fp(Ob,o,i)},setCenter:function(q,m,d){1===arguments.length&&(m=q[1],d=q[2],q=q[0]);var G=this._center;G[0]=q,G[1]=m,G[2]=d,this.fp(Oj,o,G)},setUp:function(L,n,b){1===arguments.length&&(n=L[1],b=L[2],L=L[0]);var D=this._up;D[0]=L,D[1]=n,D[2]=b,this.fp("up",o,D)},getDevicePixelRatio:function(){return this._devicePixelRatio||bq},isTransparentMask:function(p){return p.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var S=this,O=S._aspect;return O?O:(O=S.getWidth()/S.getHeight(),O||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(M){var R=this,z=R._dataModel,u=R._selectionModel;z!==M&&(z&&(z.ump(R.handleDataModelPropertyChange,R),z.umm(R.handleDataModelChange,R),z.umd(R.handleDataPropertyChange,R),u||z.sm().ums(R.handleSelectionChange,R)),R._dataModel=M,M.mp(R.handleDataModelPropertyChange,R),M.mm(R.handleDataModelChange,R),M.md(R.handleDataPropertyChange,R),u?u._21I(M):M.sm().ms(R.handleSelectionChange,R),R._postProcessing.handleDataModleChange(z,M),R.invalidateAll(!0),R.invalidateLight(),R.fp(Nh,z,M),R._canvas.style.background=M.getBackground()||"")},handleDataModelPropertyChange:function(h){if("background"===h.property){var g=this._canvas.style.background,T=h.newValue||"";this._canvas.style.background=T,this.fp("canvasBackground",g,T)}else"envmap"===h.property&&this.iv()},handleDataPropertyChange:function(K){var q=K.data;this.invalidateData(q),Ab(q)&&"s:light.type"===K.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(Q){var E=this,u=Q.property;E.iv(),E._18Q=o,"eye"===u?E._33Q=!0:"devicePixelRatio"===u?E._42(o,E.getDevicePixelRatio()):vp[u]&&bh(E)},_5O:function(R){var j=R._22Q();return j?new j(this,R):o},getData3dUI:function(q){var U=this._25I[q._id];return U===S&&(U=this._5O(q),this._25I[q._id]=U),U},invalidateAll:function(m){var b=this;if(m){for(var w in b._25I){var x=b._25I[w];x&&x.dispose()}b._25I={},b.iv(),eg(b)}else eg(b),b.dm().each(function(m){b.invalidateData(m)})},invalidateSelection:function(){var v=this;v.sm().each(function(y){v.invalidateData(y)})},invalidateData:function(S){var b=this,u=b.getData3dUI(S);u&&(u.iv(),b.iv()),eg(b,S)},getShape3dText:function(c){return c.getStyle("shape3d.text")||this.getLabel(c)},invalidateBatch:function(h){var n=this,V=n._batchModelMap,d=V[h],C=[],q={};if(d){d.ds.forEach(function(M){var N=n.getData3dUI(M);N&&N.iv(),delete n._batchIndexMap[M._id],C.push(M._id)}),delete V[h];for(var X,U,k,e,y,O,r,t,G,g=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],_=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],v=0;v<g.length;v++){var H=n[g[v]],B=n[_[v]];for(q={},t=0;t<C.length;t++){var s=B[C[t]];if(s){delete B[C[t]],G=s.batch,X=H[G];var a=s.begin,b=s.size,l=3*a,j=3*b,Z=4*a,K=4*b;for(U=X.ds,k=X.vs,e=X.cs,y=X.ps,O=X.ls,r=s.index,X.invalidate=!0,U[r]=S,r=l;l+j>r;r++)k[r]=S;for(r=Z;Z+K>r;r++)e[r]=S;for(r=Z;Z+K>r;r++)y[r]=S;if(O)for(r=l;l+j>r;r++)O[r]=S;q[G]=!0}}for(G in q){X=H[G],U=X.ds,k=X.vs,e=X.cs,y=X.ps,O=X.ls;var f=[];for(r=0;r<U.length;r++)U[r]!==S&&f.push(U[r]);if(0===f.length)delete H[G];else{for(X.ds=f,f=[],r=0;r<k.length;r++)k[r]!==S&&f.push(k[r]);for(X.vs=f,f=[],r=0;r<e.length;r++)e[r]!==S&&f.push(e[r]);for(X.cs=f,f=[],r=0;r<y.length;r++)y[r]!==S&&f.push(y[r]);if(X.ps=f,O){for(f=[],r=0;r<O.length;r++)O[r]!==S&&f.push(O[r]);X.ls=f}}}}n.iv()}},handleDataModelChange:function(f){var j=this,t=f.kind,u=f.data;if("add"===t)j.invalidateData(u),Ej(u)&&u.getEdgeGroup()&&u.getEdgeGroup().eachSiblingEdge(j.invalidateData,j),Ab(u)&&j.invalidateLight();else if(t===cf){var i=u._id,z=j._25I[i];z&&(z.dispose(),delete j._25I[i],j.iv()),u===j._currentSubGraph&&j.setCurrentSubGraph(o),eg(j,u),Ab(u)&&j.invalidateLight()}else t===ms&&(j.invalidateAll(!0),j.setCurrentSubGraph(o),eg(j),j.invalidateLight())},toCanvas:function(t,U,h){var d=this,J=d.getGL();if(d.validate(),t){var X=J.getParameter(J.COLOR_CLEAR_VALUE);ls(J,t)}d._42(o,1);var k=d.getWidth(),y=d.getHeight(),z=new Uint8Array(4*k*y),L=ib(),A=L.getContext("2d");J.readPixels(0,0,k,y,J.RGBA,J.UNSIGNED_BYTE,z),km(L,k,y,1);for(var b=A.getImageData(0,0,k,y),n=b.data,S=0;S<n.length;S+=4){var r=S/4,q=P(r/k),j=r-q*k;r=4*((y-1-q)*k+j),n[r]=z[S],n[r+1]=z[S+1],n[r+2]=z[S+2],n[r+3]=z[S+3]}if(A.putImageData(b,0,0),t&&ls(J,X),d._42(o,d.getDevicePixelRatio()),U&&h){var Z=ib(),G=Z.getContext("2d");return U=U,h=h,km(Z,U,h,1),N.drawImage(G,L,0,0,U,h),Z}return L},toDataURL:function(S,y){var L=this,D=L.getGL();if(L.validate(),S){var P=D.getParameter(D.COLOR_CLEAR_VALUE);ls(D,S)}L._42(o,1);var M=L._canvas.toDataURL(y||"image/png",1);return S&&ls(D,P),L._42(o,L.getDevicePixelRatio()),M},getGL:function(){var b=this._26I;if(b)return this.acquireProgram(),b;var K=this,E=K._canvas,i=K._attributes;try{b=E.getContext("webgl2",i)||E.getContext("experimental-webgl2",i),b&&(K._webGLVersion=2,K._26I=b)}catch(m){}if(!b)try{b=E.getContext("webgl",i)||E.getContext("experimental-webgl",i)}catch(m){throw new Error("WebGL not supported")}if(!b)throw new Error("WebGL not supported");K._26I=b,K._glExtensions=new $(b),K._glCapabilities=new n(b,K._glExtensions),K._2O={},b._compiledShader={},b._emptyTexture=gj(b),b._emptyBlendTexture=gj(b),b._bufPool={},b._id=++gb,K._buffer={vs:vj(b),ns:vj(b),is:vj(b),uv:vj(b),batchColor:vj(b),batchBlend:vj(b),batchBrightness:vj(b),lineDistance:vj(b)},K._1O=Ke(b);var I=K._cube={vs:vj(b),ns:vj(b),is:vj(b),uv:vj(b)};return tp(b,I.vs,Ye),tp(b,I.ns,Nk),tp(b,I.uv,je),Br(b,I.is,Uq),K.acquireProgram(),b},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<16?null:this.dm().getEnvmap()},acquireProgram:function(){var p=this,P=p._26I;if(P){var Z=N.getImage(p.getEnvmap()),m=Z&&Z.tagName?!0:!1,q=p._prg&&p._prg.envMapFlag?!0:!1;if(!p._prg||m!==q){var H=p._prg=P.createProgram();if(!H)return o;H.envMapFlag=m;var U=p._dirs.length,S=p._spots.length,w=p._59O.length,W=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogNear","uFogFar"];U&&W.push("uDirColor","uDirDirection"),S&&W.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),w&&W.push("uPointColor","uPointRange","uPointPosition"),ls(P,[0,0,0,0]),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.enable(P.BLEND),P.blendFuncSeparate(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA),en||(mg=Xg(mg.substring(0,mg.indexOf("^#"))),lp=Xg(lp),en=!0);var i=["#define MAX_DIR "+U,"#define MAX_SPOT "+S,"#define MAX_POINT "+w,p._fogDisabled?"":"#define FOG",p._dashDisabled?"":"#define DASH",m?"#define USE_ENVMAP":"",p.isOrtho()?"#define ORTHOGRAPHIC":"",p._batchColorDisabled?"":"#define BATCHCOLOR",p._batchBlendDisabled?"":"#define BATCHBLEND",p._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),Y=pf(P,H,P.VERTEX_SHADER,mg.replace("PREFIX",i));P.getShaderParameter(Y,P.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",P.getShaderInfoLog(Y));var Q=pf(P,H,P.FRAGMENT_SHADER,lp.replace("PREFIX",i));P.getShaderParameter(Q,P.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",P.getShaderInfoLog(Q)),dl?W.push("aPosition"):(H.aPosition=0,P.bindAttribLocation(H,0,"aPosition")),P.linkProgram(H),W.forEach(function(h){H[h]=/^u/.test(h)?P.getUniformLocation(H,h):P.getAttribLocation(H,h)}),P.useProgram(H),P.deleteShader(Y),P.deleteShader(Q)}}},getBrightness:function(d){var Z=d.s("brightness"),J=this.isSelected(d)?d.s("select.brightness"):o;return Z==o?J:J==o?Z:Z*J},setHighlightMode:function(Q){var z;z="selection"===Q?Cg.Mode.Selection:"mouseover"===Q?Cg.Mode.MouseOver:Cg.Mode.Disable,this._highlightHelper.mode=z},getHighlightMode:function(){var j=this._highlightHelper.mode;return j===Cg.Mode.Selection?"selection":j===Cg.Mode.MouseOver?"mouseover":"disable"},bindEnvMap:function(x){var D=this,H=D._prg,y=5,c=D.getEnvmap(),A=N.getImage(c);if(A&&A.tagName){if(c!==D._lastEnvMap){A=N.resizeImagePOT(A,!0),D._envMapTexture&&x.deleteTexture(D._envMapTexture);var $=D._envMapTexture=x.createTexture();x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_CUBE_MAP,$),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,A),x.bindTexture(x.TEXTURE_CUBE_MAP,null),D._lastEnvMap=c}x.activeTexture(x.TEXTURE0+y),x.bindTexture(x.TEXTURE_CUBE_MAP,D._envMapTexture),x.uniform1i(H.uEnvMap,y)}},getWireframe:function(c){var x=c.s("wf.visible"),O=c.s("wf.width");return x===!0||O>0&&"selected"===x&&this.isSelected(c)?{color:c.s("wf.color"),width:O,"short":c.s("wf.short"),mat:c.s("wf.mat")}:void 0},_transformPointToViewSpace:function(Y){var n=[Y[0],Y[1],Y[2]];return Mr(n,this._viewMatrix),n},_transformDirectionToViewSpace:function(U,I){var h=[U[0],U[1],U[2]];Mr(h,this._viewMatrix);var S=I?[I[0],I[1],I[2]]:[0,0,0];Mr(S,this._viewMatrix);var N=S[0]-h[0],W=S[1]-h[1],j=S[2]-h[2],c=Math.sqrt(N*N+W*W+j*j);return c?[N/c,W/c,j/c]:[N,W,j]},getWireframeGeometry:function(d){return d.s("wf.geometry")?{color:d.s("wf.color"),width:d.s("wf.width"),mat:d.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(g){return g.s("body.color")},getMat:function(j){return j.getMat?j.getMat():j.s("mat")},getFaceMat:function(u,Q){return u.getFaceMat?u.getFaceMat(Q):u.s(Q+".mat")},getFaceBlend:function(S,P){return S.s(P+".blend")||S.s("all.blend")},getFaceColor:function(S,n){return S.s(n+".color")||S.s("all.color")},getFaceImage:function(t,r){return t.s(r+".image")||t.s("all.image")},getFaceBlendImage:function(G,i){return G.s(i+".blend.image")||G.s("all.blend.image")},getFaceDiscardSelectable:function(r,L){var j=r.s(L+".discard.selectable");return j==o?r.s("all.discard.selectable"):j},getFaceUv:function(p,W){return p.s(W+".uv")||p.s("all.uv")},getFaceUvOffset:function(X,p){return X.s(p+".uv.offset")||X.s("all.uv.offset")},getFaceUvScale:function(t,Q){return t.s(Q+".uv.scale")||t.s("all.uv.scale")},getFaceLight:function(C,S){var x=C.s(S+".light");return x==o?C.s("all.light"):x},getFaceVisible:function(R,E){var A=R.s(E+".visible");return A==o?R.s("all.visible"):A},getFaceOpacity:function(p,k){var r=p.s(k+".opacity");return r==o?p.s("all.opacity"):r},getFaceTransparent:function(p,j){var n=p.s(j+".transparent");return n==o?p.s("all.transparent"):n},getFaceReverseColor:function(R,J){return R.s(J+".reverse.color")||R.s("all.reverse.color")},getFaceReverseFlip:function(c,V){var j=c.s(V+".reverse.flip");return j==o?c.s("all.reverse.flip"):j},getFaceReverseCull:function(C,f){var y=C.s(f+".reverse.cull");return y==o?C.s("all.reverse.cull"):y},getTextureMap:function(){return this._2O},deleteTexture:function(b){var G=this,s=G._2O[b];s&&(delete G._2O[b],G.getGL().deleteTexture(s))},invalidateCachedTexture:function(D){var N=this.getData3dUI(D);N.invalidateCachedTexture(this.getGL()),this.invalidateData(D)},invalidateShape3dCachedImage:function(Z){this.invalidateCachedTexture(Z)},isInteractive:function(s){return s.s("interactive")},getTexture:function(B,z,H){if(!B)return o;var f=this,v=f.getGL(),W=f._2O[B];if(!W){var a=ng(B),K={mipmapMaxLevel:z?z.s("texture.mipmap.max"):S};if(!a)return v._emptyTexture;if(a.uuid||(a.uuid=E.Math.generateUUID()),a.tagName){if(a.dynamic)return Ke(v,a,f._1O,K);W=f._2O[B]=Ke(v,a,S,K)}else{var V,L=z&&(z.s("texture.cache")||z.s("shape3d.image.cache"))&&!f.isInteractive(z),$=f.vr.isPresenting();if($&&(z._textureUpdateFrame===v._renderInfo.frame?L=!0:z._textureUpdateFrame=v._renderInfo.frame),L&&(V=f.getData3dUI(z),W=V.getCachedTexture(H)),!W){var T=v._renderInfo.textureCache;if(L){if(T.time>N.graph3dMaxVectorCacheTime)return f.redraw(),v._emptyTexture;if(!Qh(a,z))return v._emptyTexture}var I,j=z&&(z.s("fixSizeOnScreen")||z.s("shape3d.fixSizeOnScreen")),Q=j?v.NEAREST:v.LINEAR;
j||z&&(z.s("vector.dynamic")||z.s("shape3d.vector.dynamic"))&&(V||(V=f.getData3dUI(z)),j=V.getVectorDynamicSize(),j&&(I=f.getDevicePixelRatio(),j[0]*=I,j[1]*=I));var Z;z&&(1!==z.s("texture.scale")?Z=z.s("texture.scale"):1!==z.s("shape3d.texture.scale")&&(Z=z.s("shape3d.texture.scale"))),Z||(Z=1);var n,t,b,O=z&&z.s("shape3d");"billboard"===O?b=z.getTall()/z.getWidth():"plane"===O&&(b=z.getHeight()/z.getWidth());var C=rr(a,z);if(j?(I||(I=f.getDevicePixelRatio()),n=j[0]>0?j[0]:Z*C*I,t=j[1]>0?j[1]:Z*(b?cc(a,z,f,Math.min(4096,C*b)):cc(a,z))*I):(n=Z*C,t=Z*(b?cc(a,z,f,Math.min(4096,C*b)):cc(a,z))),n>=1&&t>=1){var g=0;L&&(g=Date.now());var G=yc(n,t);if(!V&&z&&(V=f.getData3dUI(z)),V&&V.interactiveInfo){var _=B;"object"==typeof _&&(_=_.uuid||(_.uuid=E.Math.generateUUID()));var l=V.interactiveInfo[_]={};G.interactiveInfo=l.bodyInfo={compInfos:[],matrix:new Pf,rect:{x:0,y:0,width:n,height:t}}}sq(G,a,0,0,n,t,z,f),G.interactiveInfo&&(G.interactiveInfo=null),G.restore(),T.count++,T.pixels+=n*t,K.minFilter=z.s("texture.filter.min")||z.s("texture.filter")||Q,K.magFilter=z.s("texture.filter.mag")||z.s("texture.filter")||Q,L||$?(W=Ke(v,bg,null,K),V.setCachedTexture(W,H),T.time+=Date.now()-g,bg=null):W=Ke(v,bg,f._1O,K)}}}}return W},redraw:function(){this.iv()},validateImpl:function(){var D=this;if(D._lightChanged){D._lightChanged=!1;var S=[],v=[],Y=[];D.dm().each(function(x){if(Ab(x)){var j=x.s("light.type");j===$r?S.push(x):j===xg?v.push(x):j===di&&Y.push(x)}}),(S.length!==D._59O.length||v.length!==D._spots.length||Y.length!==D._dirs.length)&&bh(D),D._59O=S,D._spots=v,D._dirs=Y}D._42(),D._1o.iv()},getRenderInfo:function(){var C=this.getGL();return C?C._renderInfo:void 0},getDebugTip:function(){var M=this,g=M.getRenderInfo();if(g){var $=M.getGL()._validBufCount||0,c="Draw Calls: "+g.calls+"<br/>"+"Vertices: "+g.vertices+"<br/>"+"Faces: "+g.faces+"<br/>"+"Lines: "+g.lines+"<br/>"+"Buffer Count: "+$;M.vr.isPresenting()&&(c+="<br/>VR fps: "+M.vr.getFps());var a=g.textureCache.count;if(c+="<br/>2D Dynamic Textures: "+g.textureCache.count,a>0){var w,Y=g.textureCache.pixels;w=Y>1e6?Math.round(Y/1e6)+"M":Y>1e3?Math.round(Y/1e3)+"K":Math.round(Y),c+="<br/>2D Dynamic pixels: "+w}return c}},_42:function(w,_){var R=this;if(!R._35O&&(!lh||Vb(lh))){var A,d;w&&(w instanceof Rd?d=w:A=w);var a=R._canvas,h=R.getGL(),D=R._prg;if(h){var G=R.getWidth(),u=R.getHeight();if(G&&u){_?w||km(a,G,u,_):(_=R.getDevicePixelRatio(),w||G===a.clientWidth&&u===a.clientHeight||(km(a,G,u,_),G&&Math.abs(h.drawingBufferWidth-G*_)>1&&(R.setDevicePixelRatio(_=h.drawingBufferWidth/G),km(a,G,u,_)))),h.clear(h.COLOR_BUFFER_BIT),R.drawFilter||(h._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:w?R._frameId:++R._frameId,textureCache:{time:0,count:0,pixels:0}});var W,r=this._cameras,g=0,s=r.length,B=!1,m=E.Default.cameraPriority.skybox,k=E.Default.cameraPriority.main,v=E.Default.cameraPriority.top,I=G*_,S=u*_,N=function(){R.overlappingBox.clear(),R._81O=o,h.clear(h.DEPTH_BUFFER_BIT),h._picking=!!w;var O={_picking:!!w,_envmapReflectivity:R._envmapReflectivity||.5,_projectMatrix:R._projectMatrix=ni(R),_viewMatrix:Ae(R,R._7O)};if(R._viewMatrix=Fq(R._7O),d){Wd(h,R,D,O);var Y=h.getParameter(h.COLOR_CLEAR_VALUE);h.clearColor(0,0,0,0),h.disable(h.BLEND),up(h,D.aNormal),tp(h,R._cube.vs,o,D.aPosition),Br(h,R._cube.is),qi(d,R,Ec,0),qi(d,R,ph,6),qi(d,R,zn,12),qi(d,R,Ic,18),qi(d,R,md,24),qi(d,R,Il,30),Ne(h,D.aNormal),ls(h,Y)}else if(A){for(A.value=2;s>g;g++)if(W=r[g],!W.ignoreInPick){if(W.priority>=k)break;W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R,A)}Wd(h,R,D,O);var Y=h.getParameter(h.COLOR_CLEAR_VALUE);for(h.clearColor(0,0,0,0),h.disable(h.BLEND),R._95I(h,D,A),Fi(R,A),Ii(R,R._polylineModelMap,A),Ii(R,R._wireframeModelMap,A),yg(h,D.uTransparent,!0),R._95I(h,D,A,!0),Fi(R,A,!0),Ii(R,R._polylineModelMap,A,!0),Ii(R,R._wireframeModelMap,A,!0),yg(h,D.uTransparent,!1);s>g;g++)if(W=r[g],!W.ignoreInPick){if(W.priority>=v)break;W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R,A),B=!0}for(B&&(Wd(h,R,D,O),B=!1),h.clear(h.DEPTH_BUFFER_BIT),R._swapLineMap(),R._95I(h,D,A,!1,!0),Ii(R,R._polylineModelMap,A),Ii(R,R._wireframeModelMap,A),R._swapLineMap(),R._swapLineMap(),R._95I(h,D,A,!1,!0),Ii(R,R._polylineModelMap,A),Ii(R,R._wireframeModelMap,A),yg(h,D.uTransparent,!0),R._95I(h,D,A,!0,!0),Ii(R,R._polylineModelMap,A,!0),Ii(R,R._wireframeModelMap,A,!0),yg(h,D.uTransparent,!1),R._swapLineMap(),h.disable(h.DEPTH_TEST),R.drawFilter||R._30O._42(h,D,A),h.enable(h.DEPTH_TEST);s>g;g++)W=r[g],W.ignoreInPick||(W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R,A));ls(h,Y)}else{for(;s>g&&(W=r[g],!(W.priority>=m));g++)W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R);for(Wd(h,R,D,O),h.disable(h.BLEND),R.drawSky(h,D),R.drawReflectors(h,I,S,N,w)&&(O._projectMatrix=R._projectMatrix=ni(R),O._viewMatrix=Ae(R,R._7O),R._viewMatrix=Fq(R._7O),Wd(h,R,D,O));s>g&&(W=r[g],!(W.priority>=k));g++)W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R),B=!0;for(B&&(Wd(h,R,D,O),B=!1),R._31O._42(h,D),R._95I(h,D),Fi(R),Ii(R,R._polylineModelMap),Ii(R,R._wireframeModelMap),h.enable(h.BLEND),h.depthMask(!1),yg(h,D.uTransparent,!0),R._95I(h,D,o,!0),Fi(R,o,!0),Ii(R,R._polylineModelMap,o,!0),Ii(R,R._wireframeModelMap,o,!0),h.depthMask(!0),yg(h,D.uTransparent,!1);s>g&&(W=r[g],!(W.priority>=v));g++)W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R),B=!0;for(B&&(Wd(h,R,D,O),B=!1),h.clear(h.DEPTH_BUFFER_BIT),R._swapLineMap(),h.disable(h.BLEND),R._95I(h,D,o,!1,!0),Ii(R,R._polylineModelMap),Ii(R,R._wireframeModelMap),h.enable(h.BLEND),yg(h,D.uTransparent,!0),h.depthMask(!1),R._95I(h,D,o,!0,!0),Ii(R,R._polylineModelMap,o,!0),Ii(R,R._wireframeModelMap,o,!0),h.depthMask(!0),yg(h,D.uTransparent,!1),R._swapLineMap(),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),R._32O._42(h,D),R._30O._42(h,D),R._highlightHelper._42(h,D),h.enable(h.DEPTH_TEST);s>g;g++)W=r[g],W.useDefaultProgram&&Wd(h,R,D,O),W.render(h,R)}tp(h,o),Br(h,o)},p=!1,Z=R.vr;Z.enable&&Z._42(h,I,S,N)&&(p=!0);var e=R.envRenderer;e&&e.enable&&e._42(h,I,S,N)&&(p=!0);var P=R._postProcessing;P._42(h,I,S,N,w)&&(p=!0),p||(R.setViewport(h,0,0,G*_,u*_),N()),R._33Q=!1,R.drawFilter||R.countFrame(),R._doBufferGC(h)}}}},drawReflectors:function(s,K,w,a,$){var l,J,f,C=this,c=C._dataModel.getReflectors(),X=!1;for(l in c)J=c[l],C.isVisible(J)&&(f=C.getData3dUI(J),f&&f.drawReflector(s,K,w,a,$)&&(X=!0));return X},enablePostProcessing:function(R,G){return this._postProcessing.enableModule(R,G)},getPostProcessingModule:function(o){return this._postProcessing.getModule(o)},setViewport:function(M,N,r,P,K){this._viewport=[N,r,P,K],M.viewport(N,r,P,K)},getViewport:function(){return this._viewport},setBufferGCInterval:function(F){this._bufferGCInterval=F},_doBufferGC:function(D,O){var z,Q,y=D._bufPool,W=0,a=0,E=D._renderInfo.frame,h=this._bufferGCInterval||10;for(z in y)W++,Q=y[z],Q&&(O||E-Q._fid>h?(D.deleteBuffer(Q._buf),Q._buf=null,y[z]=null):a++);if(W/2>a&&W>128){var R={};for(z in y)y[z]&&(R[z]=y[z]);D._bufPool=R}D._validBufCount=a},_swapLineMap:function(){var a=this;Ue=a._polylineModelMap,a._polylineModelMap=a._polylineModelMapSwap,a._polylineModelMapSwap=Ue,Ue=a._wireframeModelMap,a._wireframeModelMap=a._wireframeModelMapSwap,a._wireframeModelMapSwap=Ue,Ue=a._polylineIndexMap,a._polylineIndexMap=a._polylineIndexMapSwap,a._polylineIndexMapSwap=Ue,Ue=a._wireframeIndexMap,a._wireframeIndexMap=a._wireframeIndexMapSwap,a._wireframeIndexMapSwap=Ue},_updateSkyBox:function(Y){if(this._skyBox&&Y){var T=Y.property,W=!1,N=this._skyBox;if("eye"===T||"forceUpdate"===T){var w=this._eye;N.p3(w[0],w[1],w[2]),W=!0}if("near"===T||"far"===T||"forceUpdate"===T){var B=this._near,f=this._far,A=N.getFinalScale3d();if(A[0]/=2,A[1]/=2,A[2]/=2,A[0]<=B||A[0]>=f||A[1]<=B||A[1]>=f||A[2]<=B||A[2]>=f){var x=2*B*f/(B+f),j=Math.min(A[0],A[1],A[2]),Z=x/j,n=N.getScale3d();N.setScale3d(n[0]*Z,n[1]*Z,n[2]*Z),W=!0}}W&&this.invalidateData(N)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(G){var P=this._skyBox;P&&(this._skyBoxStyleMap&&P.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&P.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&P.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=G,this.ump(this._updateSkyBox,this),G&&(G.dm()&&G.dm().remove(G),this._skyBoxStyleMap=E.Default.clone(G.getStyleMap()),this._skyBoxAnchor3d=G.getAnchor3d(),G.setAnchor3d(.5,.5,.5),this._skyBoxP3=G.p3().slice(0),G.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",P,G)},drawSky:function(Q,D,x){var k=this,E=k._skyBox;if(E){var y=k._headlightIntensity,l=zh(k._headlightColor),D=k._prg;1!==y&&(l=[l[0]*y,l[1]*y,l[2]*y]),yg(Q,D.uHeadlightColor,[l[0],l[1],l[2],1]);var K=k.getData3dUI(E);if(K){var d,u=k.isOrtho(),V=u||this._computedProjectMatrix;V&&(d=k._projectMatrix,u&&(k._ortho=!1),yg(Q,D.uPMatrix,k._projectMatrix=ni(k,!0)));var J=E.p3(),H=this._eye;(J[0]!==H[0]||J[1]!==H[1]||J[2]!==H[2])&&(E._position.x=H[0],E._54O=H[1],E._position.y=H[2]),K._42(Q,D,x,function(){return!0}),V&&(u&&(k._ortho=!0),yg(Q,D.uPMatrix,k._projectMatrix=d))}Q.clear(Q.DEPTH_BUFFER_BIT),yg(Q,D.uHeadlightColor,[l[0],l[1],l[2],k._headlightDisabled?1:0])}},_95I:function(P,U,s,m,z){function C(O){if(!(!O.s("alwaysOnTop")&&!O.s("shape3d.alwaysOnTop"))==!!z&&q.isVisible(O)&&(!y||e)){if(!s&&q.isTransparentMask(O))return;var o=q.getData3dUI(O);o&&o._42(P,U,s,H)}}var q=this,H=function(T){return m?T:!T};q.sky&&P.clear(P.DEPTH_BUFFER_BIT);var h=q.drawFilter;h?q.dm().each(function(B){h(B)||C(B)}):q.dm().each(function(c){C(c)})},getLogicalPoint:function(X){return Zl(X,this._canvas)},isRectOverlapping:function(s){var Q=this.getData3dUI(s);return Q._rectOverlapping},getHitFaceInfo:function(r){r.target&&(r=this.lp(r));var b=this.getDataInfoAt(r);if(b){var w=this._1o.face(b.data,Dn(r.x,r.y));if(w)return{data:b.data,face:w}}return o},unproject:function(e,I){var u=this,x=u.getWidth(),r=u.getHeight(),Q=e.target?u.lp(e):e,C=Q.x-x/2,D=Q.y-r/2,H=2*(C/x),h=2*(-1*D/r);I=I||0;var k=wo(),$=ni(u),j=Ae(u);$l(k,$,j),Sj(k);var n=hl([H,h,I,1],k);return[n[0]/n[3],n[1]/n[3],n[2]/n[3]]},getDataAt:function(Y){var T=this.getDataInfoAt(Y);return T?T.data:o},getDataInfoAt:function(l,z){return l.target&&(l=this.lp(l)),this._1o.get(Dn(l.x,l.y,z),!0)},getDatasInRect:function(D){return this._1o.get(D)},setEditable:function(F){var O=this,w=O._editable;O._editable=F,this.fp(Ko,w,F)},isEditable:function(f){var i=this;return i._editable?Sl(f)?f.s("3d.editable")?i._editableFunc?i._editableFunc(f):!0:!1:!1:!1},isSelectable:function(I){return I.s("3d.selectable")&&this.sm().isSelectable(I)},isMovable:function(n){var R=this;return Ej(n)&&n.getStyle(os)!==Zq?!1:n.s("3d.movable")?R._movableFunc?R._movableFunc(n):!0:!1},isSizeEditable:function(s){return Sl(s)?this._sizeEditableFunc?this._sizeEditableFunc(s):!0:!1},isRotationEditable:function(v){return Sl(v)&&v.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(v):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(s){this.setZoom(Fn,s)},zoomOut:function(n){this.setZoom(1/Fn,n)},setZoom:function(){var n=new Of,a=new Of,V=new Of,R=new Of;return function(F,k){if(1!==F){var m=this;m._14o&&m._14o.stop(!0);var C,z=1/F;n.copy(m.getCenter()),a.copy(m.getEye());var W=m._ortho;if(W){if(C=m._orthoWidth,C<m._moveStep&&F>1)return}else if(n.distanceTo(a)<m._moveStep&&1>z)return;var p=!1;return m._zoomToCenter===!1&&m._lastZoomLP&&(V.copy(a).sub(n).normalize(),m._81O=null,R.copy(m.getHitPosition(m._lastZoomLP,n.toArray(),V.toArray())),p=!0,m._lastZoomHit=R),(k=zg(k))?(k.action=function(Q){m.fi({kind:m._zooming?"betweenZoom":"beginZoom"}),m._zooming=1;var T=(z-1)*Q+1;W&&m.setOrthoWidth(C*T),p?(m.setEye(V.lerpVectors(R,a,T).toArray()),m.setCenter(V.lerpVectors(R,n,T).toArray())):W||m.setEye(V.lerpVectors(n,a,T).toArray())},k._37o=function(){delete m._14o,delete m._zooming,m.fi({kind:"endZoom"}),m.onZoomEnded()},m._14o=Jc(k)):(W&&m.setOrthoWidth(C*z),p?(m.setEye(V.lerpVectors(R,a,z).toArray()),m.setCenter(V.lerpVectors(R,n,z).toArray())):W||m.setEye(V.lerpVectors(n,a,z).toArray()),void 0)}}}(),setOrthoZoom:function(l,$){return this.setZoom(l,$)},getPositionInfo:function(S){var E=this,r=E._eye,p=E._center,Z=E.getAspect(),Y=S?Mq(Ni(p,r,!0),Ni(S,r)):Qm(r,p);if(E._ortho){var X=E._orthoWidth;return{length:Y,height:X/Z,width:X}}var x=2*K(E._fovy/2)*Y;return{length:Y,height:x,width:x*Z}},getCenterInfo:function(){var x=this;return x._81O||(x._81O=x.getPositionInfo()),rj(x._81O)},rotate:function(R,e,K,J){var Z=this;if(R||e){J==o&&(J=Z._firstPersonMode),Z._88O&&Z._88O.stop(!0);var j=Z._center,l=Z._eye,r=Z.getCenterInfo().length,y=J?j:l,q=J?l:j,C=Ni(y,q),m=g(C[0],C[2]),S=g(T(C[0]*C[0]+C[2]*C[2]),C[1]),F=J?Oj:Ob;return J&&(e=-e),(K=zg(K))?(K.action=function(L){Z.fi({kind:Z._rotating?"betweenRotate":"beginRotate"}),Z._rotating=1;var c=m+R*L,l=S+e*L;l=J?s-ji(s-l):ji(l),C[0]=r*V(l)*V(c),C[1]=r*X(l),C[2]=r*V(l)*X(c),y[0]=q[0]+C[0],y[1]=q[1]+C[1],y[2]=q[2]+C[2],Z.fp(F,o,y)},K._37o=function(){delete Z._88O,delete Z._rotating,Z.fi({kind:"endRotate"}),Z.onRotateEnded()},Z._88O=Jc(K)):(m+=R,S+=e,S=J?s-ji(s-S):ji(S),C[0]=r*V(S)*V(m),C[1]=r*X(S),C[2]=r*V(S)*X(m),y[0]=q[0]+C[0],y[1]=q[1]+C[1],y[2]=q[2]+C[2],Z.fp(F,o,y),void 0)}},pan:function(P,G,w,W){if(P||G){var N=this;W==o&&(W=N._firstPersonMode),N._89O&&N._89O.stop(!0);var _=Ae(N),A=[_[0]*P,_[4]*P,_[8]*P],Y=[_[1]*G,_[5]*G,_[9]*G],E=A[0]+Y[0],U=A[1]+Y[1],Z=A[2]+Y[2],t=N._center,s=N._eye;if(W){var X=Bg(N.getBoundaries(),s[0],s[2],s[0]+E,s[2]+Z,T(E*E+Z*Z));E=X[0],Z=X[1]}if(w=zg(w)){var O=rj(s),K=rj(t);return w.action=function(Q){N.fi({kind:N._panning?"betweenPan":"beginPan"}),N._panning=1,t[0]=K[0]+E*Q,t[1]=K[1]+U*Q,t[2]=K[2]+Z*Q,s[0]=O[0]+E*Q,s[1]=O[1]+U*Q,s[2]=O[2]+Z*Q,N.fp(Ob,o,s),N.fp(Oj,o,t)},w._37o=function(){delete N._89O,delete N._panning,N.fi({kind:"endPan"}),N.onPanEnded()},N._89O=Jc(w)}t[0]+=E,t[1]+=U,t[2]+=Z,s[0]+=E,s[1]+=U,s[2]+=Z,N.fp(Ob,o,s),N.fp(Oj,o,t)}},walk:function(v,p,J){if(v){var Y=this;J==o&&(J=Y._firstPersonMode),Y._90O&&Y._90O.stop(!0);var $=Y._center,u=Y._eye,h=Ni($,u,!0);if(J){var X=Bg(Y.getBoundaries(),u[0],u[2],u[0]+h[0]*v,u[2]+h[2]*v,D(v));if(v=Qm(X),!v)return;h=[X[0]/v,0,X[1]/v]}if(p=zg(p)){var m=rj(u),K=rj($);return p.action=function(g){Y.fi({kind:Y._walking?"betweenWalk":"beginWalk"}),Y._walking=1;var q=v*g;u[0]=m[0]+h[0]*q,u[1]=m[1]+h[1]*q,u[2]=m[2]+h[2]*q,$[0]=K[0]+h[0]*q,$[1]=K[1]+h[1]*q,$[2]=K[2]+h[2]*q,Y.fp(Ob,o,u),Y.fp(Oj,o,$)},p._37o=function(){delete Y._90O,delete Y._walking,Y.fi({kind:"endWalk"}),Y.onWalkEnded()},Y._90O=Jc(p)}u[0]+=h[0]*v,u[1]+=h[1]*v,u[2]+=h[2]*v,$[0]+=h[0]*v,$[1]+=h[1]*v,$[2]+=h[2]*v,Y.fp(Ob,o,u),Y.fp(Oj,o,$)}},handleScroll:function(D,q){D.preventDefault();var e=this,x=e._moveStep,p=e.getDataInfoAt(D);if(p){var j=p.data;if(j&&e.isInteractive(j)){var h=e.intersectObject(D,j);if(h){var _=h.part,n=ng(j.s(_+".image")||j.s("shape3d."+_+".image")||j.s("all.image")||j.s("shape3d.image"));if(n&&hd(n.scrollable,j,e))return}}}return e.isFirstPersonMode()?(e.isPannable()&&e.pan(0,q>0?x:-x),void 0):(e.isZoomable()&&(e._lastZoomLP=e.lp(D),e.setZoom(0>q?1/Fo:Fo),e._lastZoomLP=e._lastZoomHit=null),void 0)},handlePinch:function(s,$){this.isZoomable()&&this.setZoom($>s?1/Vj:Vj)},reset:function(){this.setCenter(N.graph3dViewCenter),this.setEye(N.graph3dViewEye),this.setUp(N.graph3dViewUp)},moveSelection:function(C,r,q){var d=this;d.dm().beginTransaction(),Yh(this.sm().toSelection(this.isMovable,this),C,r,q),d.dm().endTransaction()},getMoveMode:function(P,B){var E=B.s("3d.move.mode");if(E)return E;var x="88",o="89",j="90";return $q(P)||qj[x]&&qj[o]&&qj[j]?"xyz":qj[x]&&qj[o]?"xy":qj[x]&&qj[j]?"xz":qj[o]&&qj[j]?"yz":qj[x]?"x":qj[o]?"y":qj[j]?"z":"xz"},handleTick:function(){var F=this,I=!1,h=F._moveStep,s=h,f=!1,V=!0,R=F._rotateStep*(V?-1:1);if(F.isWalkable()||(s=0),F.isPannable()||(h=0),F.isRotatable()||(R=0),F._32Q){var q=(Hg()-F._32Q)/50;s*=q,h*=q,R*=q}F._31Q&&(bb(F._31Q),delete F._31Q,delete F._32Q),il()&&(I=!0,F.pan(-h,0,f,V)),hb()&&(I=!0,F.pan(h,0,f,V)),jc()&&(I=!0,$q()?F.pan(0,h,f,V):F.walk(s,f,V)),Bo()&&(I=!0,$q()?F.pan(0,-h,f,V):F.walk(-s,f,V)),Di()&&(I=!0,F.rotate(-R,0,f,V)),vc()&&(I=!0,F.rotate(R,0,f,V)),mr()&&(I=!0,F.rotate(0,-R/2,f,V)),jn()&&(I=!0,F.rotate(0,R/2,f,V)),I&&(F._32Q=Hg(),F._31Q=Rg(F.handleTick,F))},handleKeyDown:function(O){var R=this;!Xl(O)&&ik[O.keyCode]?R.handleTick():qo(O)?R.selectAll():Lc(O)?R.handleDelete(O):Pe(O)&&this.isResettable()&&R.reset()},checkDoubleClickOnNote:function(A,$,Q){var p=this;if(Q===Fc){if($.s("note.toggleable"))return $.s(dr,!$.s(dr)),p.fi({kind:"toggleNote",event:A,data:$,part:Q}),!0}else if(Q===Hn&&$.s("note2.toggleable"))return $.s(yk,!$.s(yk)),p.fi({kind:"toggleNote2",event:A,data:$,part:Q}),!0;return!1},checkDoubleClickOnRotation:function(H,h,k){return k===$k?(h.setRotationX(0),!0):k===Rq?(h.setRotationY(0),!0):k===Kd?(h.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(J){var x=this;if(x.isOrtho())return x.getWidth()/x.getOrthoWidth();var M=x.getCenter(),o=x.getHeight(),q=x.getEye(),p=[M[0]-q[0],M[1]-q[1],M[2]-q[2]],Q=[J[0]-q[0],J[1]-q[1],J[2]-q[2]],v=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),X=1/Math.tan(x.getFovy()/2);return o*v*X/(Q[0]*p[0]+Q[1]*p[1]+Q[2]*p[2])},inViewSpace:function(N){var h,m=this,S=m._transformPointToViewSpace(N),i=m.getAspect(),d=m.getNear(),t=m.getFar();return-S[2]<d||-S[2]>t?!1:m.isOrtho()?(h=m.getOrthoWidth()/2,Math.abs(S[0])<=h&&Math.abs(S[1]*i)<=h):(h=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])*Math.tan(m.getFovy()/2),Math.abs(S[1]<=h)&&Math.abs(S[0])<=h*i)},getPVMatrix:function(){var n=this,o=n.getWidth()/2,M=n.getHeight()/2,D=n._18Q;return D&&D._wh===o/M||(D=ni(n),n._18Q=$l(D,D,Ae(n)),n._18Q._wh=o/M),D},getFrustum:function(){var f=new Me,U=new Em,j=new Array(16);return function(){for(var G=this.getPVMatrix(),x=!1,M=0;16>M;M++)G[M]!==j[M]&&(x=!0,j[M]=G[M]);return x&&U.setFromMatrix(f.fromArray(G)),U}}(),toViewPosition:function(Y){var B=this,r=B.getWidth()/2,Q=B.getHeight()/2,y=B.getPVMatrix();return Y=hl([Y[0],Y[1],Y[2],1],y),{x:r+r*Y[0]/Y[3],y:Q-Q*Y[1]/Y[3],z:Y[2]/Y[3]}},getHitPosition:function(V,K,e){var q=this,r=q.getWidth(),h=q.getHeight(),N=V.target?q.lp(V):V,G=N.x-r/2,m=N.y-h/2,a=q.getCenterInfo(),C=Ae(q);K=K?K:[0,0,0],e=e?e:[0,1,0],G=G/r*a.width,m=-1*m/h*a.height;var R=[C[0]*G,C[4]*G,C[8]*G],M=[C[1]*m,C[5]*m,C[9]*m],F=[R[0]+M[0],R[1]+M[1],R[2]+M[2]],L=q.getCenter(),g=Sp(q,K,e,[F[0]+L[0],F[1]+L[1],F[2]+L[2]]);return g?g:[0,0,0]},intersectObject:function(K,R){return this._raycaster.intersectObject(K,R)},intersectObjects:function(V,e,O){return this._raycaster.intersectObjects(V,e,O)},getLineLength:function(K){this.validate();var h=this.getData3dUI(K);if(h&&h.getCache){var F=h.getCache();if(F)return F[F.length-1].length}return 0},getLineOffset:function(G,X){var Q=this.getData3dUI(G);if(Q&&Q.getCache){var _=Q.getCache();if(_){var R=Wn(_,X),e=G.r3();if(0===e[0]&&0===e[1]&&0===e[2])return R;var I=new Of(G.p3()),i=new Of(R.point).sub(I),V=new Of(R.tangent).add(i),r=(new Oh).setFromEuler(new Dd(e,G.getRotationMode(),!0));return i.applyQuaternion(r),V.applyQuaternion(r),{point:i.add(I),tangent:V.sub(i).normalize()}}}return o},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function($,S,e){var B=this,t=B.getEye();t=[t[0],t[1],t[2]];var w=B.getCenter();if(w=[w[0],w[1],w[2]],$||($=t),S||(S=w),B._flyAnim&&B._flyAnim.stop(!0),e=zg(e),!e)return B.setEye($[0],$[1],$[2]),B.setCenter(S[0],S[1],S[2]),delete B._flyAnim,!0;var K=[$[0]-t[0],$[1]-t[1],$[2]-t[2]],Y=[S[0]-w[0],S[1]-w[1],S[2]-w[2]];return e.action=function(_){B.setCenter(w[0]+Y[0]*_,w[1]+Y[1]*_,w[2]+Y[2]*_),B.setEye(t[0]+K[0]*_,t[1]+K[1]*_,t[2]+K[2]*_)},e._37o=function(){delete B._flyAnim},B._flyAnim=Jc(e)},flyTo:function(){function Q(b,Z,k){if(k instanceof E.Node){o.fromArray(Hi(k,Z.getMat(k)));var K=k.getAnchor3d();b.push((new Of).set(0-K.x,0-K.y,0-K.z).applyMatrix4(o)),b.push((new Of).set(0-K.x,0-K.y,1-K.z).applyMatrix4(o)),b.push((new Of).set(0-K.x,1-K.y,0-K.z).applyMatrix4(o)),b.push((new Of).set(0-K.x,1-K.y,1-K.z).applyMatrix4(o)),b.push((new Of).set(1-K.x,0-K.y,0-K.z).applyMatrix4(o)),b.push((new Of).set(1-K.x,0-K.y,1-K.z).applyMatrix4(o)),b.push((new Of).set(1-K.x,1-K.y,0-K.z).applyMatrix4(o)),b.push((new Of).set(1-K.x,1-K.y,1-K.z).applyMatrix4(o))}}var M=new Of,g=new Of,Y=new Of,z=new Of,o=new Me,f=new E.Math.Quaternion,$=new Dd;return function(X,D,H){var s=this;if(H!==S)D={animation:D,ratio:H};else{var o=typeof D;("boolean"===o||"object"===o&&D.duration)&&(D={animation:D})}D=D||{},M.fromArray(s.getEye()),g.fromArray(s.getCenter());var k,w,I=[],F=D.center,A=D.distance===S;if(F&&Y.fromArray(F),X instanceof E.Node)F||Y.fromArray(X.p3()),A&&(Q(I,s,X),k=I.length);else{if(X||(X=s.dm().getDatas()),!X.length)return;if((A||!F)&&(I=[],X.forEach(function(f){Q(I,s,f)}),k=I.length,!k))return;if(!F){for(Y.set(0,0,0),w=0;k>w;w++)Y.add(I[w]);Y.multiplyScalar(1/k)}}if(s.setCenter(Y.x,Y.y,Y.z),z.subVectors(M,g),D.direction||D.worldDirection){!D.worldDirection&&X instanceof E.Node?f.setFromEuler($.set(X.r3(),X.getRotationMode(),!0)):f.set(0,0,0,1);var G=z.length();z.fromArray(D.worldDirection||D.direction).applyQuaternion(f).setLength(G)}var T=0;if(A){var C,N,m,H=D.ratio||.8,e=D.xRatio||H,y=D.yRatio||H;if(s.isOrtho()){var V=-1/0;for(s._eye[0]=z.x+Y.x,s._eye[1]=z.y+Y.y,s._eye[2]=z.z+Y.z,C=ni(s),$l(C,C,Ae(s)),w=0;k>w;w++)m=I[w],N=hl([m.x,m.y,m.z,1],C),V=Math.max(V,Math.max(Math.abs(N[0])/e,Math.abs(N[1])/y));T=s.getOrthoWidth()*V,z.add(Y)}else{for(var P,q,R=s.getNear(),h=10;h--;){for(s._eye[0]=z.x+Y.x,s._eye[1]=z.y+Y.y,s._eye[2]=z.z+Y.z,C=ni(s),$l(C,C,Ae(s)),P=!0,q=-1/0,w=0;k>w;w++){if(m=I[w],N=hl([m.x,m.y,m.z,1],C),N[3]<R&&h){z.multiplyScalar(2),P=!1;break}q=Math.max(q,Math.max(Math.abs(N[0])/e,Math.abs(N[1])/y)-N[3])}if(P)break}z.setLength(q+z.length()).add(Y)}}else z.setLength(D.distance).add(Y);s._flyAnim&&s._flyAnim.stop(!0);var u=zg(D.animation);if(u){s.setEye(M.x,M.y,M.z),s.setCenter(g.x,g.y,g.z);var r=(new Of).subVectors(z,M),x=(new Of).subVectors(Y,g);if(T)var U=s.getOrthoWidth();var b=new Of,v=new Of,B=u.action,L=u._37o;return u.action=function(p,n){b.copy(M).addScaledVector(r,p),v.copy(g).addScaledVector(x,p),s.setCenter(v.x,v.y,v.z),s.setEye(b.x,b.y,b.z),T&&s.setOrthoWidth((T-U)*p+U),B&&B(p,n)},u._37o=function(){delete s._flyAnim,L&&L()},{lastEye:M,lastCenter:g,eye:z,center:Y,orthoWidth:T,animation:s._flyAnim=Jc(u)}}return s.setEye(z.x,z.y,z.z),T&&s.setOrthoWidth(T),delete s._flyAnim,{lastEye:M,lastCenter:g,eye:z,center:Y,orthoWidth:T}}}(),getBoundingBox:function(){function e(h,c,A){Y.fromArray(Hi(A,c.getMat(A)));var u=A.getAnchor3d();h.push((new Of).set(0-u.x,0-u.y,0-u.z).applyMatrix4(Y)),h.push((new Of).set(0-u.x,0-u.y,1-u.z).applyMatrix4(Y)),h.push((new Of).set(0-u.x,1-u.y,0-u.z).applyMatrix4(Y)),h.push((new Of).set(0-u.x,1-u.y,1-u.z).applyMatrix4(Y)),h.push((new Of).set(1-u.x,0-u.y,0-u.z).applyMatrix4(Y)),h.push((new Of).set(1-u.x,0-u.y,1-u.z).applyMatrix4(Y)),h.push((new Of).set(1-u.x,1-u.y,0-u.z).applyMatrix4(Y)),h.push((new Of).set(1-u.x,1-u.y,1-u.z).applyMatrix4(Y))}var Y=new Me;return function(R){if(R=R||this.sm().getSelection(),R instanceof E.Node&&(R=[R]),0===R.length)return o;var Z=[];R.forEach(function(o){e(Z,this,o)},this);var n=[1/0,1/0,1/0],X=[-1/0,-1/0,-1/0];return Z.forEach(function(l){n[0]=Math.min(l.x,n[0]),n[1]=Math.min(l.y,n[1]),n[2]=Math.min(l.z,n[2]),X[0]=Math.max(l.x,X[0]),X[1]=Math.max(l.y,X[1]),X[2]=Math.max(l.z,X[2])}),{min:n,max:X}}}()}),gl.RenderEnv=function(e){this.gv=e,this.enable=!1},l.defineProperties(gl.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(Y){this._debugOn=Y,this.capture&&this.capture()}}}),l.assign(gl.RenderEnv.prototype,{renderEnvToCube:function(B,k,S,s){var W=this,j=W.gv;if(!B||!k||!S)return W.enable=!1,W._42=null,void 0;W.enable=!0;var $=Math.floor(s/B*k),g=j.getGL(),d=W._renderTargets;d?d.length<S&&(d=W._renderTargets=d.concat(new Array(S-d.length))):d=W._renderTargets=new Array(S);for(var r=0;S>r;r++)d[r]?d[r].setSize(g,s,$):d[r]=new gl.RenderTarget(j,g,s,$);var c=!1;W.capture=function(){c=!0,j._42(),c=!1};var P=new Of,h=new Of,U=new Of,w=new Of,I=(new Of).setY(0),D=2*Math.PI/S,Z=B/2/Math.tan(Math.PI/S),x=2*Math.atan2(k/2,Z),G=B/k;W._42=function(z,p,Q,R){var m=W._debugOn;if(!c&&!m)return!1;P.copy(j.getEye()),w.copy(j.getCenter()).sub(P);var M=Math.atan2(w.z,w.x),$=j.getNear(),k=j.getFovy(),O=j.getAspect();h.copy(j.getCenter());for(var t,y=0;S>y;y++)if(t=d[y],I.setZ(Math.cos(M)).setX(Math.sin(M)).multiplyScalar(Z),M-=D,U.addVectors(P,I),j.setNear(Z),j.setCenter([U.x,U.y,U.z]),j.setFovy(x),j.setAspect(G),m){var s=Math.round(p/S);z.viewport(s*y,0,s,Q),R()}else Ag(z,t.frame),z.viewport(0,0,t.width,t.height),z.clear(z.COLOR_BUFFER_BIT),R(),pe(z),t.assureTexture();return j.setNear($),j.setCenter([h.x,h.y,h.z]),j.setFovy(k),j.setAspect(O),!0},W.capture()},getTextureInfo:function(y){var L=this._renderTargets;if(!L)return null;var N=this._renderTargets[y];return N?{index:y,texture:N.texture,textureName:N.uuid}:null}}),l.assign(gl.Graph3dView.prototype,{renderEnvToCube:function(n,i,k,b){var Z=this;Z.envRenderer||(Z.envRenderer=new gl.RenderEnv(Z)),Z.envRenderer.renderEnvToCube(n,i,k,b)}}),gl.RenderTarget=function(t,Y,c,_,q){var w=this;q=q||{},q.samples=Math.min(t._glCapabilities.maxSamples,q.samples&&q.samples>1&&2===t._webGLVersion?q.samples:0),w.options=q,w.uuid=E.Math.generateUUID(),w.gv=t,w.init(t,Y,q),q.samples&&!t._glCapabilities._maxSamplesChecked?w.setSize(Y,c||1,_||1):w.setSize(Y,c,_)},l.assign(gl.RenderTarget.prototype,{bind:function(V){Ag(V,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(Q){pe(Q),this.options.samples&&(Q.bindFramebuffer(Q.READ_FRAMEBUFFER,this._MSAAFbo),Q.bindFramebuffer(Q.DRAW_FRAMEBUFFER,this.frame),Q.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,Q.COLOR_BUFFER_BIT,Q.NEAREST),Q.bindFramebuffer(Q.READ_FRAMEBUFFER,null),Q.bindFramebuffer(Q.DRAW_FRAMEBUFFER,null))},init:function(A,I,Y){var K=this,P=K.texture=I.createTexture();I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE);var m=Y.samples,y=m?I.NEAREST:I.LINEAR;I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,Y.minFilter||y),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,Y.magFilter||y),I.bindTexture(I.TEXTURE_2D,null),K.render=I.createRenderbuffer(),K.frame=I.createFramebuffer(),A._2O[K.uuid]=P},assureTexture:function(){var F=this,E=F.uuid,R=F.gv._2O;R[E]||(R[E]=F.texture)},setSize:function(e,r,h){var c=this;if(r&&h&&(c.width!==r||c.height!==h)){var i=e.RGBA,d=e.TEXTURE_2D,R=e.RENDERBUFFER,M=e.FRAMEBUFFER,S=c.options.samples;if(Pq(e,c.texture),e.texImage2D(d,0,i,r,h,0,i,e.UNSIGNED_BYTE,o),e.bindRenderbuffer(R,c.render),S){var H=c.gv._glCapabilities;if(H._maxSamplesChecked)e.renderbufferStorageMultisample(R,S,e.DEPTH_COMPONENT16,r,h);else{for(e.getError();S>1&&(e.renderbufferStorageMultisample(R,S,e.DEPTH_COMPONENT16,r,h),e.getError());)S=Math.floor(S>>1);1>=S&&(S=0,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,c.options.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,c.options.magFilter||e.LINEAR),e.renderbufferStorage(R,e.DEPTH_COMPONENT16,r,h)),H._maxSamplesChecked=!0,H.maxSamples=c.options.samples=S}}else e.renderbufferStorage(R,e.DEPTH_COMPONENT16,r,h);S&&!c._MSAAFbo&&(c._MSAAFbo=e.createFramebuffer(),c._MSAARbO=e.createRenderbuffer()),Ag(e,c.frame),e.framebufferTexture2D(M,e.COLOR_ATTACHMENT0,d,c.texture,0),S||e.framebufferRenderbuffer(M,e.DEPTH_ATTACHMENT,R,c.render),pe(e),S&&(e.bindRenderbuffer(e.RENDERBUFFER,c._MSAARbO),e.renderbufferStorageMultisample(e.RENDERBUFFER,S,e.RGBA8,r,h),Ag(e,c._MSAAFbo),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c._MSAARbO),e.framebufferRenderbuffer(M,e.DEPTH_ATTACHMENT,R,c.render),pe(e)),Pq(e,o),e.bindRenderbuffer(R,o),c.width=r,c.height=h}},toCanvas:function(){var p=this,g=p.gv.getGL();Ag(g,p.frame);var $=p.width,J=p.height,D=new Uint8Array(4*$*J);g.readPixels(0,0,$,J,g.RGBA,g.UNSIGNED_BYTE,D),pe(g);var o=L.createElement("canvas");o.width=$,o.height=J;var W=o.getContext("2d"),U=W.createImageData($,J);return U.data.set(D),W.putImageData(U,0,0),o}});var pm=gl.Interactor=function(x){this.gv=x};Id("Interactor",l,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var Bm=gl.DefaultInteractor=function(M){ii(Bm,this,[M])};Id("DefaultInteractor",pm,{handle_contextmenu:function(V){Ge(V)},handle_mousewheel:function(b){this.gv.handleScroll(b,b.wheelDelta/40)},handle_DOMMouseScroll:function(K){2===K.axis&&this.gv.handleScroll(K,-K.detail)},handle_keydown:function(E){this.gv.handleKeyDown(E)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(B){Ge(B);var H=this,D=H.gv,R=lg(B),Y=D.getDataInfoAt(B),Z=Y?Y.data:o,E=Y?Y.part:o,$=D.sm(),v=df(B),C=_f(B);D.setFocus(B)&&(H._62O=o,H._57I=o,Z?Xl(B)?$.co(Z)?$.rs(Z):$.as(Z):$.co(Z)||$.ss(Z):R&&(Xl(B)?D.isRectSelectable()&&(H._62O=ih):H._57I=uk(B)),H._31Q&&(bb(H._31Q),delete H._31Q,delete H._32Q),H._62O||(D.isFirstPersonMode()&&($q(B)||dk(B)||C>2?H._62O="pan":D.isMouseRoamable()||Tk?(H._62O="roaming",H.foward=v&&lg(B),H._32Q=Hg(),H._31Q=Rg(H.tick,H)):R||(H._62O="roaming")),H._62O||(R&&v&&us[E]?(H._62O=E,H.p3=Z.p3()):R&&v&&Sl(Z)&&D.isSelected(Z)?D.isMovable(Z)?(H._62O="move",H.p3=Z.p3(),H.movedata=Z):D._39Q(Z)&&(H._62O="none"):Tk&&(C>2?H._62O="pan":2===C&&(H.dist=Lj(B),H._62O="pinch")))),H.point=D.lp(B),Ho(H,B),Yj(B)?D.handleDoubleClick(B,Z,E):D.handleClick(B,Z,E))},tick:function(){var A=this,J=A.gv,u=J._moveStep;A.point&&J.isWalkable()&&(A._32Q&&(u*=(Hg()-A._32Q)/50),J.walk(A.foward?u:-u),A._32Q=Hg(),A._31Q=Rg(A.tick,A))},handle_mouseup:function(d){this.handle_touchend(d)},handle_touchend:function(t){var E=this._57I;E&&(Qm(E,uk(t))<=1&&this.gv.sm().cs(),this._57I=o)},handleWindowMouseMove:function(f){this.handleWindowTouchMove(f)},handleWindowTouchMove:function(U){var t,f,O=this,l=O.gv,L=O._62O,n=O.point,g=l.dm(),N=l.lp(U),o=N.x-n.x,H=N.y-n.y,z=l.getWidth(),x=l.getHeight();if(z&&x){var I=-j*o/z,X=-j*H/x;if("roaming"===L)O.rotate(U,I/2,X/2);else if(L===$k||L===Rq||L===Kd)l._86O||g.beginTransaction(),l.fi({kind:l._86O?"betweenEditRotation":"beginEditRotation",event:U}),l._86O=1,l.sm().each(function(x){if(Sl(x)&&l.isRotationEditable(x)){var P=D(I)>D(X)?I:X;L===$k?x.setRotationX(x.getRotationX()+P):L===Rq?x.setRotationY(x.getRotationY()+P):L===Kd&&x.setRotationZ(x.getRotationZ()+P)}});else if("move"===L||us[L]){L===Og||L===po||L===Pb?(l._87O||g.beginTransaction(),l.fi({kind:l._87O?"betweenEditScale":"beginEditScale",event:U}),l._87O=1):(l._moving||g.beginTransaction(),l.fi({kind:l._moving?"betweenMove":"beginMove",event:U}),l._moving=1);var d,s=O.p3,e=l.getPositionInfo(s),W=Ae(l);d=L===mp?"x":L===Go?"y":L===er?"z":L===Og?"sx":L===po?"sy":L===Pb?"sz":l.getMoveMode(U,O.movedata),o=o/z*e.width,H=-1*H/x*e.height;var J,$,K=[W[0]*o,W[4]*o,W[8]*o],k=[W[1]*H,W[5]*H,W[9]*H],A=K[0]+k[0],i=K[1]+k[1],u=K[2]+k[2],y=[s[0]+A,s[1]+i,s[2]+u],P=Ni(l.getEye(),y,!0);if("xyz"===d?(J=y,l.moveSelection(A,i,u)):"xz"===d?(J=Sp(l,s,[0,1,0],y),J&&l.moveSelection(J[0]-s[0],0,J[2]-s[2])):"xy"===d?(J=Sp(l,s,[0,0,1],y),J&&l.moveSelection(J[0]-s[0],J[1]-s[1],0)):"yz"===d?(J=Sp(l,s,[1,0,0],y),J&&l.moveSelection(0,J[1]-s[1],J[2]-s[2])):"x"===d||"sx"===d?(P[0]=0,J=Sp(l,s,P,y),J&&($=J[0]-s[0],"x"===d?l.moveSelection($,0,0):l.sm().each(function(h){Sl(h)&&l.isSizeEditable(h)&&(t=h.getScaleX()+$/100,f=t/h.getScaleX(),h.setScaleX(t),$q(U)&&(h.setScaleY(h.getScaleY()*f),h.setScaleTall(h.getScaleTall()*f)))
}))):"y"===d||"sy"===d?(P[1]=0,J=Sp(l,s,P,y),J&&($=J[1]-s[1],"y"===d?l.moveSelection(0,$,0):l.sm().each(function(X){Sl(X)&&l.isSizeEditable(X)&&(t=X.getScaleTall()+$/100,f=t/X.getScaleTall(),X.setScaleTall(t),$q(U)&&(X.setScaleY(X.getScaleY()*f),X.setScaleX(X.getScaleX()*f)))}))):("z"===d||"sz"===d)&&(P[2]=0,J=Sp(l,s,P,y),J&&($=J[2]-s[2],"z"===d?l.moveSelection(0,0,$):l.sm().each(function(O){Sl(O)&&l.isSizeEditable(O)&&(t=O.getScaleY()+$/100,f=t/O.getScaleY(),O.setScaleY(t),$q(U)&&(O.setScaleX(O.getScaleX()*f),O.setScaleTall(O.getScaleTall()*f)))}))),!J)return;O.p3=J}else if(L===ih){var S=O.div;S||(S=O.div=Pd(),xh(O.getView(),S),S.op=n,S.style.background=l.getRectSelectBackground()),l.fi({kind:l._rectSelecting?"betweenRectSelect":"beginRectSelect",event:U}),l._rectSelecting=1,S.rect=uh(S.op,N),_o(S,S.rect)}else if("pinch"===L&&2===_f(U)){l.fi({kind:l._pinching?"betweenPinch":"beginPinch",event:U}),l._pinching=1;var $=Lj(U);l._lastZoomLP||(l._lastZoomLP=Aj(U)),l.handlePinch($,O.dist),O.dist=$}else"pan"===L||$q(U)||dk(U)?O.pan(U,o,H):"none"===L||l.isFirstPersonMode()||O.rotate(U,I,X);O.point=N}},pan:function(l,D,_){var Q=this.gv;if(Q.isPannable()){var o=Q.getWidth(),B=Q.getHeight();if(!o||!B)return;var Y=Q.getCenterInfo(),L=D/o*Y.width,x=-1*_/B*Y.height;Q.fi({kind:Q._panning?"betweenPan":"beginPan",event:l}),Q._panning=1,Q.pan(-L,-x)}},rotate:function(f,$,N){var E=this.gv;E.isRotatable()&&(E.fi({kind:E._rotating?"betweenRotate":"beginRotate",event:f}),E._rotating=1,E.rotate($,N))},handleWindowMouseUp:function(h){this.handleWindowTouchEnd(h)},handleWindowTouchEnd:function($){var r=this,F=r.gv,U=F.dm(),p=r.div;if(p){var l=F.getDatasInRect(p.rect);if(!l.isEmpty()){var X=F.sm(),g=X.toSelection();l.each(function(x){X.co(x)?g.remove(x):g.add(x)}),X.ss(g)}tc(p)}F._moving&&(delete F._moving,F.fi({kind:"endMove",event:$}),F.onMoveEnded(),U.endTransaction()),F._panning&&(delete F._panning,F.fi({kind:"endPan",event:$}),F.onPanEnded()),F._rotating&&(delete F._rotating,F.fi({kind:"endRotate",event:$}),F.onRotateEnded()),F._86O&&(delete F._86O,F.fi({kind:"endEditRotation",event:$}),U.endTransaction()),F._87O&&(delete F._87O,F.fi({kind:"endEditScale",event:$}),U.endTransaction()),F._pinching&&(delete F._pinching,F.fi({kind:"endPinch",event:$}),F.onPinchEnded()),F._rectSelecting&&(delete F._rectSelecting,F.fi({kind:"endRectSelect",event:$}),F.onRectSelectEnded()),F._walking&&(delete F._walking,F.fi({kind:"endWalk",event:$}),F.onWalkEnded()),F._lastZoomLP=F._lastZoomHit=null,r.dist=r.point=r._62O=r.p3=r.movedata=r.div=r._57I=r._32Q=r._31Q=r.foward=o}});var kk=gl.MapInteractor=function(J){ii(kk,this,[J]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this.maxPhi=5*Math.PI/12};Id("MapInteractor",pm,{handle_contextmenu:function(M){Ge(M)},handle_mousewheel:function(Y){this.gv.handleScroll(Y,Y.wheelDelta/40)},handle_DOMMouseScroll:function(B){2===B.axis&&this.gv.handleScroll(B,-B.detail)},handle_keydown:function(k){this.gv.handleKeyDown(k)},handle_mousedown:function(D){this.handle_touchstart(D)},handle_touchstart:function(T){Ge(T);var Q=this,J=Q.gv;if(J.setFocus(T)){var r=J.getDataInfoAt(T),m=r?r.data:o,A=r?r.part:o,i=Q.editing={point:J.lp(T)};Tk?i.touch=!0:(i.touch=!1,i.clickLeft=lg(T),i.pan=dk(T)?!0:"left"===this.panButton===i.clickLeft),m&&J._39Q(m)&&(i.preventDefault=!0),Ho(Q,T),Yj(T)?J.handleDoubleClick(T,m,A):J.handleClick(T,m,A)}},handle_mouseup:function(e){this.handle_touchend(e)},handle_touchend:function(){},handleWindowMouseMove:function(o){this.handleWindowTouchMove(o)},handleWindowTouchMove:function(l){var N=this,T=N.gv,c=N.editing;if(c){var X=T.lp(l),M=c.point,I=X.x-M.x,i=X.y-M.y;if(!c.moved){if(Math.abs(I)<N.threshold&&Math.abs(i)<N.threshold&&!(l.touches&&l.touches.length>1))return;c.moved=!0}if(!c.preventDefault)if(c.point=X,c.touch){var W=l.touches.length;if(2!==W)N.pan(l,I,i);else{if(1>=W)return;var O=l.touches,G={x:O[0].clientX,y:O[0].clientY},C={x:O[1].clientX,y:O[1].clientY},A={x:C.x-G.x,y:C.y-G.y},Q=c.lastCenter,b=Math.atan2(A.y,A.x),m=c.theta,x=0;m==o?m=c.theta=b:(x=b-m,c.thetaStarted||Math.abs(x)>N.touchRotateThreshold?(c.thetaStarted=!0,c.theta=b):x=0);var R=s*(G.y+C.y)/2/T.getHeight(),Y=c.phi,E=0;Y==o?Y=c.phi=R:(E=R-Y,c.phiStarted||Math.abs(E)>N.touchRotateThreshold?(c.phiStarted=!0,c.phi=R):E=0);var U,f=Math.sqrt(A.x*A.x+A.y*A.y),y=c.vlen;if(y){var D=G.x-Q.x,_=G.y-Q.y,e=C.x-Q.x,V=C.y-Q.y,F=Math.sqrt(D*D+_*_),P=Math.sqrt(e*e+V*V),k=y/2,v=N._sign2(F-k),n=N._sign2(P-k);0>v*n||0===v&&0===n?(U=1,c.vlen=f):(U||(U=f/y),c.scaleStarted||Math.abs(U-1)>N.touchScaleThreshold?(c.vlen=f,c.scaleStarted=!0):U=1)}else y=c.vlen=f,U=1;1!==U&&T.setZoom(U),(E||x)&&N.rotate(l,x,-E),c.lastCenter={x:(C.x+G.x)/2,y:(C.y+G.y)/2}}}else if(c.pan)N.pan(l,I,i);else{var B=T.getWidth(),t=T.getHeight();if(!B||!t)return;var p=-j*I/B,d=-j*i/t;N.rotate(l,p,d)}}},_sign2:function(m){return Math.abs(m)<this._touchScaleCheckAccuracy?0:m>0?1:-1},handleWindowMouseUp:function(P){this.handleWindowTouchEnd(P)},handleWindowTouchEnd:function(x){var U=this,s=U.editing;if(U.editing=null,s){var T=U.gv;if(s.moved||!s.clickLeft&&!s.touch)T._panning=null,T._rotating=null,T.fi({kind:s.pan?"endPan":"endRotate",event:x});else{var v=T.getDataAt(x);v?T.sm().setSelection([v]):T.sm().clearSelection()}}},pan:function(y,b,G){var g=this,f=g.gv;if(f.isPannable()){var T=f.getWidth(),n=f.getHeight();if(T&&n){var C=f.getCenterInfo(),v=-b/T*C.width,B=1*G/n*C.height;f.fi({kind:f._panning?"betweenPan":"beginPan",event:y}),f._panning=1;var w=g.keepHorizon,Q=g.editing.touch;if((Q&&y.touches&&y.touches.length>1||!Q&&$q(y))&&(w=!w),!w)return f.pan(v,B);if(v||B){var J=Ae(f),m=[J[0]*v,J[4]*v,J[8]*v],L=[J[1],0,J[9]],k=Math.sqrt(L[0]*L[0]+L[2]*L[2]);k&&(L=[L[0]/k*B,0,L[2]/k*B]);var p=m[0]+L[0],N=m[1]+L[1],X=m[2]+L[2],c=f._center,q=f._eye;c[0]+=p,c[1]+=N,c[2]+=X,q[0]+=p,q[1]+=N,q[2]+=X,f.fp(Ob,o,q),f.fp(Oj,o,c)}}}},rotate:function(H,j,k){var M=this,K=M.gv;if(K.isRotatable()){var S=K._center,U=K._eye,W=Ni(U,S),q=g(T(W[0]*W[0]+W[2]*W[2]),W[1]),D=ji(q+k);k=D-q,K.fi({kind:K._rotating?"betweenRotate":"beginRotate",event:H}),K._rotating=1,K.rotate(j,k)}}}),l.defineProperties(kk.prototype,{panButton:{get:function(){return this._panButton},set:function(U){this._panButton=U}},minPhi:{get:function(){return N.graph3dViewMinPhi},set:function(S){N.graph3dViewMinPhi=S}},maxPhi:{get:function(){return N.graph3dViewMaxPhi},set:function(T){N.graph3dViewMaxPhi=T}},keepHorizon:{get:function(){return this._keepHorizon},set:function(a){this._keepHorizon=a}},threshold:{get:function(){return this._threshold},set:function(N){this._threshold=N}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(d){this._touchScaleThreshold=d}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(g){this._touchRotateThreshold=g}}});var cs,Xp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",yd=32,ae=gl.GlobeInteractor=function(R,X){ii(ae,this,[R]);var q,n=X.radius||6378137,y=this,G=null;cs||(cs=Pd(),cs.style.border="",cs.style.backgroundImage="url("+Xp+")");var g=new Oh,k=new Of,a=new Of,F=new Of,c=new vd,v="number"==typeof n?{x:n,y:n,z:n}:n,s={center:new Of(0,0,0),radius:v},M=function(x){R._81O=null;var T=R.getHitPosition(x,R.getCenter(),k.copy(R.getEye()).sub(a.copy(R.getCenter())).toArray());return c.origin.copy(R.getEye()),c.direction.copy(T).sub(c.origin).normalize(),c.intersectEllipsoid(s)},Y=function(J,x){R._81O=null,c.origin.copy(R.getEye());for(var O,u,S=R.getCenter(),C=k.copy(R.getEye()).sub(a.copy(R.getCenter())).toArray(),i=1,H=16,o=0,T=1,D={x:0,y:0};H--;){if(D.x=x.x+(J.x-x.x)*i,D.y=x.y+(J.y-x.y)*i,O=R.getHitPosition(D,S,C),c.direction.copy(O).sub(c.origin).normalize(),u=c.intersectEllipsoid(s),u&&1===i)return{hit:u};u?o=i:T=i,i=(o+T)/2}return{hit:u,out:1>i}},E=function(P,w){if(G){var q=Date.now();G.deltaTime=G.lastTime?q-G.lastTime:1e3,G.lastTime=q,G.lastAxis=P,G.lastAngle=w}w&&(g.setFromAxisAngle(P,w),R.setEye(k.copy(R.getEye()).applyQuaternion(g).toArray()),R.setCenter(k.copy(R.getCenter()).applyQuaternion(g).toArray()),R.setUp(k.copy(R.getUp()).applyQuaternion(g).toArray()))};y._showCrossIcon=function(C){xh(y.getView(),cs),_o(cs,{x:C.clientX-yd/2,y:C.clientY-yd/2,width:yd,height:yd})},y._hideCrossIcon=function(){tc(cs)},y._scrollImpl=function(a,X){G={point:R.lp(a),screen:uk(a),hit:M(a),type:"right"},G.hitNormalize=G.hit?G.hit.clone().normalize():new Of;var W={clientX:G.screen.x,clientY:G.screen.y+10*X};y._handleMoveImpl(W),y._endMoveImpl(W)},y._startMoveImpl=function(Z){q&&(q.stop(!0),q=null),G={point:R.lp(Z),screen:uk(Z),hit:M(Z)},G.hitNormalize=G.hit?G.hit.clone().normalize():new Of,Tk?1===Z.touches.length?G.hit&&(G.type="left"):2===Z.touches.length&&(G.type="touch2"):(lg(Z)?G.hit&&(G.type="left"):gs(Z)?G.type="right":dk(Z)&&G.hit&&(G.type="middle"),!G.hit||"right"!==G.type&&"middle"!==G.type||y._showCrossIcon(Z)),G.type&&Ho(y,Z)},y._handleMoveImpl=function(F){if(G)switch(G.type){case"left":return y._handleLeft(F);case"right":return y._handleRight(F);case"middle":return y._handleMiddle(F);case"touch2":return y._handleTouch2(F)}},y._endMoveImpl=function(){if(G){if(this._hideCrossIcon(),"left"===G.type||"middle"===G.type){var I=1e3*(G.lastAngle/(G.deltaTime||30)),K=G.lastAxis,t=G.lastTime,L=function(){var S=Date.now(),b=(S-t)/1e3;return t=S,I*=Math.pow(Math.abs(y.decelerationRate),3*b),Math.abs(I)<.01?(I=0,q&&q.stop(),void 0):(E(K,I*b),void 0)};q=Jc({action:function(){L(arguments)},duration:5e3})}G=null}},y._handleLeft=function(s){if(!G.finished){var I=uk(s),q=Y(I,G.lastScreen||G.screen);if(G.lastScreen=I,!q.hit)return G.finished=!0,y._endMoveImpl(s),void 0;var g=q.hit;g.normalize();var X=G.hitNormalize,S=Math.acos(g.dot(X)),h=g.cross(X).normalize();E(h,S),q.out&&(G.finished=!0,y._endMoveImpl(s))}},y._handleRight=function(p){var A=G.lastScreen||G.screen,x=A.y;A=G.lastScreen=uk(p);var r=A.y,z=r-x;if(z){var j=Math.min(.5,z*y.scaleSpeed);k.copy(R.getEye());var V=G.hit;V||(V=k.clone().divide(v).normalize().multiply(v)),a.copy(k).lerp(V,j),R.setEye(a.toArray()),k.copy(R.getUp()),a.normalize();var q=k.clone().cross(a).normalize();if(F.copy(R.getCenter()),F.sub(q.multiplyScalar(F.dot(q))),R.setCenter(F.toArray()),G.hit){var B=M(G.screen),P=G.hitNormalize;if(B){B.normalize();var H=Math.acos(B.dot(P)),h=B.cross(P).normalize();H&&E(h,H)}}}};var C=function(s){return Math.abs(s)<.01?0:s>0?1:-1};y._handleTouch2=function(O){var J=O.touches.length;if(2===J){var X=O.touches,s={x:X[0].clientX,y:X[0].clientY},d={x:X[1].clientX,y:X[1].clientY},k={x:d.x-s.x,y:d.y-s.y},p=G.lastCenter,U=Math.atan2(k.y,k.x),u=G.theta,H=0;u==o?u=G.theta=U:(H=U-u,G.thetaStarted||Math.abs(H)>.03?(G.thetaStarted=!0,G.theta=U):H=0);var j,z=Math.sqrt(k.x*k.x+k.y*k.y),h=G.vlen;if(h){var K=s.x-p.x,I=s.y-p.y,g=d.x-p.x,i=d.y-p.y,Q=Math.sqrt(K*K+I*I),D=Math.sqrt(g*g+i*i),Y=h/2,T=C(Q-Y),v=C(D-Y);0>T*v||0===T&&0===v?(j=1,G.vlen=z):(j||(j=z/h),G.scaleStarted||Math.abs(j-1)>.05?(G.vlen=z,G.scaleStarted=!0):j=1)}else h=G.vlen=z,j=1;var k=a.copy(R.getEye()).clone();1!==j&&R.setEye(k.setLength((k.length()-n)/j+n).toArray()),H&&E(k.normalize(),H),G.lastCenter={x:(d.x+s.x)/2,y:(d.y+s.y)/2}}},y._handleMiddle=function(U){var W=uk(U),n=G.screen;G.screen=W;var H=(W.y-n.y)/180*Math.PI*y.rollSpeed;a.copy(R.getCenter()).sub(k.copy(R.getEye())).normalize(),k.copy(R.getUp()).cross(a).normalize(),a.copy(R.getEye()).sub(G.hit).applyAxisAngle(k,H).add(G.hit);var i=a.clone();a.copy(R.getCenter()).sub(G.hit).applyAxisAngle(k,H).add(G.hit);var c=a.clone(),$=a.copy(R.getUp()).applyAxisAngle(k,H).clone(),P=!1;H>0&&(F.copy($),a.copy(c).sub(i).normalize(),k.copy(i).multiplyScalar(-1).normalize(),k.dot(F)-a.dot(F)>0&&(P=!0)),P||F.copy(G.hit).sub(i).dot(G.hitNormalize)>=0&&(P=!0),P||(R.setEye(i.toArray()),R.setCenter(c.toArray()),R.setUp($.toArray()));var f=-(W.x-n.x)/180*Math.PI*y.rotateSpeed;E(G.hitNormalize,f)}};Id("GlobeInteractor",pm,{handle_contextmenu:function(j){Ge(j)},handle_mousewheel:function(X){this._scrollImpl(X,X.wheelDelta/40)},handle_DOMMouseScroll:function(J){2===J.axis&&this._scrollImpl(J,-J.detail)},handle_keydown:function(c){this.gv.handleKeyDown(c)},handle_mousedown:function(H){this.handle_touchstart(H)},handle_touchstart:function(W){Ge(W);var e=this.gv;if(e.setFocus(W)){var T=e.getDataInfoAt(W),P=T?T.data:o;P&&e.isInteractive(P)||this._startMoveImpl(W);var H=T?T.part:o;Yj(W)?e.handleDoubleClick(W,P,H):e.handleClick(W,P,H)}},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(){},handleWindowMouseMove:function(K){this.handleWindowTouchMove(K)},handleWindowTouchMove:function(J){this._handleMoveImpl(J)},handleWindowMouseUp:function(M){this.handleWindowTouchEnd(M)},handleWindowTouchEnd:function(U){this._endMoveImpl(U)}}),l.defineProperties(ae.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(n){this._rotateSpeed=n}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(Q){this._rollSpeed=Q}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(c){this._scaleSpeed=c}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(v){this._decelerationRate=v}}});var oi=function(e){this.gv=e};pk(oi,l,{_iv:!0,iv:function(){this._iv=!0},face:function(f,u){var p=this,Y=p.gv.getGL();if(!Y||!Sl(f))return o;var A=u.x,D=u.width,T=u.height,U=p.height-u.y-T,e=P(D/2),Z=new Uint8Array(4*D*T),w=0;for(p.iv(),p.validate(f),Ag(Y,p.frame),Y.readPixels(A,U,D,T,Y.RGBA,Y.UNSIGNED_BYTE,Z),pe(Y),p.iv();e>=w;w++)for(var k=e-w,O=e+w,h=k;O>=h;h++)for(var X=k;O>=X;X++)if(h===k||h===O||X===k||X===O){var y=gq.m[Z[4*(h*D+X)]];if(y)return y}},get:function(G,i){this.validate();var L=this,Q=L.gv.getGL();if(!Q)return o;var V,B,p=G.x,j=G.width,v=G.height,f=L.height-G.y-v,b=P(j/2),W=new Uint8Array(4*j*v),I=0,M=W.length,s=i?o:new Fj,g=i?o:{};if(Ag(Q,L.frame),Q.readPixels(p,f,j,v,Q.RGBA,Q.UNSIGNED_BYTE,W),pe(Q),i){for(;b>=I;I++)for(var k=b-I,w=b+I,E=k;w>=E;E++)for(var F=k;w>=F;F++)if((E===k||E===w||F===k||F===w)&&(V=L.info(W,4*(E*j+F))))return V}else for(;M>I;I+=4)V=L.info(W,I),V&&(B=V.data,g[B._id]||(s.add(B),g[B._id]=B));return s},info:function(q,h){return this.colorMap[(q[h]<<16)+(q[h+1]<<8)+q[h+2]+((127&q[h+3])<<24)]},validate:function(X){var D=this,J=D.gv,G=J.getGL();if(G){var R=J.getWidth(),d=J.getHeight(),g=G.RGBA,E=G.TEXTURE_2D,w=G.RENDERBUFFER,e=G.FRAMEBUFFER;D.texture||(D.texture=Ke(G),D.render=G.createRenderbuffer(),D.frame=G.createFramebuffer()),(D.width!==R||D.height!==d)&&(Pq(G,D.texture),G.texImage2D(E,0,g,R,d,0,g,G.UNSIGNED_BYTE,o),td(G,G.TEXTURE_MIN_FILTER,G.LINEAR),G.bindRenderbuffer(w,D.render),G.renderbufferStorage(w,G.DEPTH_COMPONENT16,R,d),Ag(G,D.frame),G.framebufferTexture2D(e,G.COLOR_ATTACHMENT0,E,D.texture,0),G.framebufferRenderbuffer(e,G.DEPTH_ATTACHMENT,w,D.render),Pq(G,o),G.bindRenderbuffer(w,o),pe(G),D.width=R,D.height=d),D._iv&&(D._iv=!1,Ag(G,D.frame),J._42(X||(D.colorMap={}),1),pe(G))}}});var Xb=function(v){this.gv=v};pk(Xb,l,{gap:0,size:0,_42:function(R,P){var y=this,K=y.gv,A=K._gridGap,J=K._gridSize;if(K._gridVisible){if(y.gap!==A||y.size!==J){for(var x=[],l=K._gridSize/2,c=A*l,g=0;2*l+1>g;g++){var t=6*g,q=6*(2*l+1)+t;x[t]=-c,x[t+1]=0,x[t+2]=-c+g*A,x[t+3]=c,x[t+4]=0,x[t+5]=-c+g*A,x[q]=-c+g*A,x[q+1]=0,x[q+2]=-c,x[q+3]=-c+g*A,x[q+4]=0,x[q+5]=c}y.vs=new $g(x),y.gap=A,y.size=J}is(K),$o(R,P),Wm(R),sl(R,P,1,K._gridColor,K._buffer.vs,y.vs),ug(R,0,y.vs.length/3,R.LINES),fl(R),bn(R,P)}else y.vs=y.gap=y.size=o}});var dm=function(F){this.gv=F};pk(dm,l,{_42:function(i,j){var Y=this.gv,O=Y._buffer.vs,k=Y._axisXColor,T=Y._axisYColor,d=Y._axisZColor,N=Y._originAxisVisible,D=Y._centerAxisVisible;if(N||D){var E=dl?i.TRIANGLES:i.TRIANGLE_FAN,R=i.LINES;if(is(Y),$o(i,j),Wm(i),N){var v=Y.getCenterInfo(),H=Q(v.width,v.height)/5,I=.8*H,b=.05*H;sl(i,j,1.5,k,O,new $g([0,0,0,H,0,0,I,b,0,I,0,b,I,-b,0,I,0,-b,I,b,0,0,0,0,0,H,0,b,I,0,0,I,b,-b,I,0,0,I,-b,b,I,0,0,0,0,0,0,H,b,0,I,0,b,I,-b,0,I,0,-b,I,b,0,I])),ug(i,0,2,R),ug(i,1,6,E),sl(i,j,o,T),ug(i,7,2,R),ug(i,8,6,E),sl(i,j,o,d),ug(i,14,2,R),ug(i,15,6,E)}if(D){var t=Y._center,X=t[0],G=t[1],y=t[2],v=Y.getPositionInfo(t);H=Q(v.width,v.height)/20,sl(i,j,1.5,k,O,new $g([X,G,y,X+H,G,y,X,G,y,X,G+H,y,X,G,y,X,G,y+H])),ug(i,0,2,R),sl(i,j,o,T),ug(i,2,2,R),sl(i,j,o,d),ug(i,4,2,R)}fl(i),bn(i,j)}}});var Cg=function(e){this.gv=e,this.onMouseOver=this.onMouseOver.bind(this),this.mode=Cg.Mode.Disable};Cg.Mode={Disable:0,Selection:1,MouseOver:2},pk(Cg,l,{onMouseOver:function(M){N.preventDefault(M);var Y=this.gv.getDataAt(M);Y!==this.mouseOverData&&(this.mouseOverData=Y,this.gv.iv())},setFetchTargetFunc:function(w){this.fetchTargetFunc=w},_42:function(d,l){var O,g=this,s=g._mode;if(s!==Cg.Mode.Disable&&(s===Cg.Mode.Selection?O=g.gv.sm().getSelection().toArray(function(f){return f.s("highlight.visible")}):s===Cg.Mode.MouseOver&&g.mouseOverData&&g.mouseOverData.s("highlight.visible")&&(O=[g.mouseOverData]),g.fetchTargetFunc&&(O=g.fetchTargetFunc(O)),O&&O.length)){var n=g.gv,B=n.vr.isPresenting(),W=n.getWidth();if(B){var a=n.getWidth;W/=2,n.getWidth=function(){return W};var w=n.getViewport()}var D,Q=n.getDevicePixelRatio(),y=W*Q,G=n.getHeight()*Q;(D=g._renderTarget)?D.setSize(d,y,G):g._renderTarget=D=new gl.RenderTarget(n,d,y,G),Ag(d,D.frame),n.drawFilter=function(T){return O.indexOf(T)<0?!0:void 0},n._42({}),n.drawFilter=null,pe(d),B&&(n.getWidth=a,n.setViewport(d,w[0],w[1],w[2],w[3]));var A=d._compiledShader.highlight;if(A||(A=d._compiledShader.highlight=new Kr.Shader(d,wm.vs,wm.fs)),A.bind(),d.enable(d.BLEND),d.activeTexture(d.TEXTURE0+0),d.bindTexture(d.TEXTURE_2D,D.texture),A.uniforms.image=0,A.uniforms.textureSize=[y,G],A.uniforms.edgeWidth=t["highlight.width"],g.highlightColor!==t["highlight.color"]){var N=$i(g.highlightColor=t["highlight.color"]);g.highlightColorData=[N[0]/255,N[1]/255,N[2]/255,N[3]/255]}A.uniforms.edgeColor=g.highlightColorData,g.ibuffer?(g.ibuffer.upload(),g.vbuffer.upload()):(g.ibuffer=Kr.Buffer.createIndexBuffer(d,new Uint16Array([0,2,1,1,2,3])),g.vbuffer=Kr.Buffer.createVertexBuffer(d,new Float32Array([0,0,1,0,0,1,1,1]))),A.attributes.pos.pointer(g.vbuffer),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),d.disable(d.BLEND),d.bindTexture(d.TEXTURE_2D,null),d.useProgram(l)}}}),l.defineProperties(Cg.prototype,{mode:{get:function(){return this._mode},set:function(X){var G=this._mode;X!==G&&(this._mode=X,X===Cg.Mode.MouseOver?A(this.gv.getView(),"mousemove",this.onMouseOver):G===Cg.Mode.MouseOver&&u(this.gv.getView(),"mousemove",this.onMouseOver))}}});var wm={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Bf=function(N){this.gv=N},mp="edit_tx",Go="edit_ty",er="edit_tz",$k="edit_rx",Rq="edit_ry",Kd="edit_rz",Og="edit_sx",po="edit_sy",Pb="edit_sz",us={};us[mp]=1,us[Go]=1,us[er]=1,us[$k]=1,us[Rq]=1,us[Kd]=1,us[Og]=1,us[po]=1,us[Pb]=1,pk(Bf,l,{_42:function(P,d,z){var K=this,y=K.gv,w=y.sm().ld();if(w&&y.isEditable(w)&&!y.isEditHelperDisabled()&&Sl(w)&&(!y.isFirstPersonMode()||!y.isMouseRoamable()&&!Tk)){is(y);var J,g,h=y.isMovable(w),L=y.isRotationEditable(w),q=y.isSizeEditable(w),b=y._axisXColor,c=y._axisYColor,l=y._axisZColor,I=y._editSizeColor,Z=w.p3(),e=Qm(y.getEye(),Z)/10,A=e/(z?5:10),m=.7*e,k=.4*m,_=Z[0],M=Z[1],E=Z[2];J=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],h&&K._17O(P,d,w,z,mp,b,J,[_,M-A,E,_+m,M-A,E,_+m,M,E,_+m,M,E,_,M,E,_,M-A,E,_,M-A,E+A,_+m,M-A,E+A,_+m,M-A,E,_+m,M-A,E,_,M-A,E,_,M-A,E+A]),g=_+m,q&&K._17O(P,d,w,z,Og,I,J,[g,M-A,E,g+k,M-A,E,g+k,M,E,g+k,M,E,g,M,E,g,M-A,E,g,M-A,E+A,g+k,M-A,E+A,g+k,M-A,E,g+k,M-A,E,g,M-A,E,g,M-A,E+A]),g+=k,L&&K._17O(P,d,w,z,$k,b,J,[g,M-A,E,g+k,M-A,E,g+k,M,E,g+k,M,E,g,M,E,g,M-A,E,g,M-A,E+A,g+k,M-A,E+A,g+k,M-A,E,g+k,M-A,E,g,M-A,E,g,M-A,E+A]),J=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],h&&K._17O(P,d,w,z,Go,c,J,[_,M,E,_,M+m,E,_-A,M+m,E,_-A,M+m,E,_-A,M,E,_,M,E,_,M,E,_,M,E-A,_,M+m,E-A,_,M+m,E-A,_,M+m,E,_,M,E]),g=M+m,q&&K._17O(P,d,w,z,po,I,J,[_,g,E,_,g+k,E,_-A,g+k,E,_-A,g+k,E,_-A,g,E,_,g,E,_,g,E,_,g,E-A,_,g+k,E-A,_,g+k,E-A,_,g+k,E,_,g,E]),g+=k,L&&K._17O(P,d,w,z,Rq,c,J,[_,g,E,_,g+k,E,_-A,g+k,E,_-A,g+k,E,_-A,g,E,_,g,E,_,g,E,_,g,E-A,_,g+k,E-A,_,g+k,E-A,_,g+k,E,_,g,E]),J=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],h&&K._17O(P,d,w,z,er,l,J,[_,M,E,_,M,E+m,_,M-A,E+m,_,M-A,E+m,_,M-A,E,_,M,E,_,M-A,E,_-A,M-A,E,_-A,M-A,E+m,_-A,M-A,E+m,_,M-A,E+m,_,M-A,E]),g=E+m,q&&K._17O(P,d,w,z,Pb,I,J,[_,M,g,_,M,g+k,_,M-A,g+k,_,M-A,g+k,_,M-A,g,_,M,g,_,M-A,g,_-A,M-A,g,_-A,M-A,g+k,_-A,M-A,g+k,_,M-A,g+k,_,M-A,g]),g+=k,L&&K._17O(P,d,w,z,Kd,l,J,[_,M,g,_,M,g+k,_,M-A,g+k,_,M-A,g+k,_,M-A,g,_,M,g,_,M-A,g,_-A,M-A,g,_-A,M-A,g+k,_-A,M-A,g+k,_,M-A,g+k,_,M-A,g])}},_17O:function(e,M,n,P,v,H,g,y){var d=this.gv._buffer;Cl(e,M,P,!0,n,v),hi(e,M,o,!0,o,!0,o,!1),yg(e,M.uDiffuse,H),tp(e,d.vs,new $g(y),M.aPosition),tp(e,d.ns,new $g(g),M.aNormal),Wm(e),ug(e,0,12),fl(e),ab(e,M)}});var rp=E.Raycaster=function(R){this.gv=R,this.maxTriangleTest=1/0,this.backfaceCulling=!0};Eb("Raycaster",l,{intersect:function(l){var e=this,B=e.gv,Y=B.getDataAt(l);return Y?e.intersectObject(l,Y):null},intersectObjects:function(m,r,x){var Q,k,v,M,z=this,d=1/0,l=m.origin||(new Of).fromArray(z.gv.getEye()),G=z.maxTriangleTest,o=[];return r.forEach(function(s){x&&x(s)===!1||s.s("intersect")!==!1&&o.push(s)}),o.sort(function($,o){return l.distanceToSquared2($.p3())-l.distanceToSquared2(o.p3())}),z.countTriangles=0,o.forEach(function(s){z.countTriangles>G||(Q=z.intersectObject(m,s),Q&&(k=l.distanceToSquared(Q.world),d>k&&(v=s,M=Q,d=k)))}),z.countTriangles=0,{data:v,intersect:M}},intersectObject:function(U,e){if(U instanceof vd)return this._intersectObjectImpl(U,e);var I=this,Y=I.gv,J=Y.unproject(U),O=new Of,V=Y.getEye(),l=new Of;if(Y.isOrtho()){var X=new Of(V);l.copy(Y.getCenter()).sub(X).normalize();var i=O.copy(J).sub(X).dot(l);O.copy(l).setLength(-i).add(X.copy(J))}else O.copy(V),l.copy(J).sub(O).normalize();var x=new E.Math.Ray(O,l);return I._intersectObjectImpl(x,e)},_intersectObjectImpl:function(){function l(){var $=new Of;return $.subVectors(Z,Q),S.subVectors(z,Q),$.cross(S).normalize(),$}function f(U,h,s,T,$,n,g){return Xi.barycoordFromPoint(U,h,s,T,q),$.multiplyScalar(q.x),n.multiplyScalar(q.y),g.multiplyScalar(q.z),$.add(n).add(g),$.clone()}function x(K,A,i){Si(K)?K.forEach(function(Z){x(Z,A,i)}):rb(K)?x(dc(A,K),A,i):uq(K)&&(K.shape3d?x(K.shape3d,A,i):i.push(K))}var B=new Me,a=new Me,M=new vd,p=new Of,K=new Of,y=new Of,Y=new Of,O=new Of,z=new Of,Q=new Of,Z=new Of,s=new Qp,F=new Qp,U=new Qp,S=new Of,W={vs:Ye,is:Uq,uv:je},q=new Of;return function(P,w){var u=this.gv.getData3dUI(w),h=w.mat||u.mat;if(h){B.fromArray(h),a.getInverse(B),M.copy(P).applyMatrix4(a);var d,j,G="body",o=u.shapeModel;if(o||(o=dc(u)),o||(w instanceof E.Node&&!(w instanceof E.Shape)?(d=!0,o=W):(j=!0,o=[u.left,u.front,u.right,u.back,u.top,u.bottom])),!o)return console.log("Can not find shape model."),null;Si(o)||(o=[o]);var I,n,b,c,R,T,i,$,_,t,k,J,C,v,e,q,N=1/0,H=["","top_","bottom_"],r=!1,S=this.backfaceCulling,g=[];for(x(o,u,g),I=0,n=g.length;n>I;I++)if(C=g[I])for(b=0,c=H.length;c>b;b++)if(v=H[b],i=C[v+"vs"],$=C[v+"is"],_=C[v+"uv"]||C[v+"tuv"],i){if(e=C[v+"boundingBox"]){var k=M.intersectBox(e);if(!k)continue;if(M.origin.distanceTo(k)>N)continue;q=!1}else C[v+"boundingBox"]=e=new E.Math.Box3,q=!0;for(R=0,T=$?$.length:i.length/3;T>R;R+=3)this.countTriangles++,$?(K.fromArray(i,3*$[R]),y.fromArray(i,3*$[R+1]),Y.fromArray(i,3*$[R+2])):(K.fromArray(i,3*R),y.fromArray(i,3*(R+1)),Y.fromArray(i,3*(R+2))),q&&(e.expandByPoint(K),e.expandByPoint(y),e.expandByPoint(Y)),t=M.intersectTriangle(K,y,Y,S,p),t&&(J=M.origin.distanceTo(t),N>J&&(N=J,O.copy(t),z.copy(K),Q.copy(y),Z.copy(Y),""!==v?G=v.slice(0,-1):d?G=gr[Math.floor(R/6)]:j&&(G=gr[I]),_&&(r=!0,$?(s.fromArray(_,2*$[R]),F.fromArray(_,2*$[R+1]),U.fromArray(_,2*$[R+2])):(s.fromArray(_,2*R),F.fromArray(_,2*(R+1)),U.fromArray(_,2*(R+2))))))}if(!isFinite(N))return null;var V,D=O.clone().applyMatrix4(B);r&&(V=f(O,z,Q,Z,s,F,U));var A=l(z,Q,Z),L=l(z.applyMatrix4(B),Q.applyMatrix4(B),Z.applyMatrix4(B)),X=M.direction.dot(A);return X>0&&(A.multiplyScalar(-1),L.multiplyScalar(-1)),{world:D,local:O.clone(),worldNormal:L,normal:A,uv:V,part:G}}}}()});var Wb=function(Y,U){this.gv=Y,this.s=function(q,X,B){return X==o&&(X=B),X==o?U.getStyle(q):hd(X,U,Y)},this.data=U};pk(Wb,l,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(W,Q,B,j){var a=this,g=a.data;if(!(g instanceof zm)){var L,K,A,S,k,H,q,y=a.gv,c=g._id,b=a.s("alwaysOnTop")||a.s("shape3d.alwaysOnTop")?null:a.s("batch"),h=y._batchIndexMap,C=y._batchModelMap,J=y.isSelectable(g),s=y.getBrightness(g),D=s!=o&&1!==s;if(a.needValidate(W)){if(A=pi(h,C,g,b),a.validate(A,b?tr[b]||ec:o),A&&(S=h[c],k=S.size=A.vs.length/3-S.begin,q=A.rs))for(s=D?s:1,H=0;k>H;H++)q.push(s);if(Sl(g)){var O=y.getWireframeGeometry(g);if(O)Vm(y,g,O);else{var u=y.getWireframe(g);u&&Vm(y,g,u)}}a.labelInfo=a.label2Info=a.noteInfo=a.note2Info=a._38o=o,a._24O($h,"getLabel"),a._24O(Hr,"getLabel2"),a._26O(Fc,"getNote"),a._26O(Hn,"getNote2"),a._15O(),a.interactiveInfo=y.isInteractive(g)?{}:o,a._iv=!1}D&&yg(W,Q.uBrightness,s),yg(W,Q.uAlphaTest,a.s("alphaTest")),yg(W,Q.uUseEnvMap,g.s("envmap")?!0:!1),yg(W,Q.uReflectivity,g.s("envmap")||.01);var w=a.s("3d.clip.direction");if(w){var t=a.s("3d.clip.percent");switch(w){case"left":w=2;break;case"top":w=3;break;case"bottom":w=4;break;case"front":w=5;break;case"back":w=6;break;case"right":default:w=1}if(0===w%2&&(t=1-t),g instanceof E.Shape){var n=g.s3(),$=g.p3(),N=g.getAnchor3d();t=3>w?(t-N.x)*n[0]+$[0]:5>w?(t-N.y)*n[1]+$[1]:(t-N.z)*n[2]+$[2]}else t-=.5;yg(W,Q.uClipPercent,t)}W.uniform1i(Q.uClipDirection,w||0),K=Cl(W,Q,B,J,g,Zr),K&&(Fp(K,h[c],C),Fp(K,y._polylineIndexMap[c],y._polylineModelMap),Fp(K,y._wireframeIndexMap[c],y._wireframeModelMap)),h[c]||a._80o(W,Q,j),y.isLabelVisible(g)&&((L=a.labelInfo)&&(Cl(W,Q,B,J,g,$h),a._28O(L,$h,j)),(L=a.label2Info)&&(Cl(W,Q,B,J,g,Hr),a._28O(L,Hr,j))),y.isNoteVisible(g)&&((L=a.noteInfo)&&(Cl(W,Q,B,J,g,Fc),a._29O(L,Fc,j)),(L=a.note2Info)&&(Cl(W,Q,B,J,g,Hn),a._29O(L,Hn,j))),(L=a._38o)&&a._99O(W,Q,L,B,J,j),D&&yg(W,Q.uBrightness,1),w&&W.uniform1i(Q.uClipDirection,0)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Bj},_80o:function(){},dispose:function(){},_calcAnchorMat:function(H){if(H.hasOwnProperty("_anchor")||H.hasOwnProperty("_anchorElevation")){var J=H.getAnchor3d(),W={x:J.x-.5,y:J.y-.5,z:J.z-.5},q=wo();return ol(q,[-W.x,-W.y,-W.z]),q}},getBodyColor:function($){var O=this.data,C=this.gv.getBodyColor(O);return C?C:$?O.getStyle($):o},getCachedTexture:function(T){var P=this._cachedTextures;return P?P[T||"main"]:null},setCachedTexture:function(R,O){var H=this._cachedTextures;return H||(H=this._cachedTextures={}),H[O||"main"]=R,R},invalidateCachedTexture:function(M){var E=this._cachedTextures;for(var c in E)M.deleteTexture(E[c]);this._cachedTextures={}},_24O:function(r,B){var R=this,z=R.data,A=R.gv,_=R.s,y=A[B](z);if(y!=o){var G=_(r+".scale"),Y=_(r+".max"),X=R[r+"Info"]={label:y,textureScale:_(r+".texture.scale"),color:A[B+"Color"](z),font:_(r+".font"),align:_(r+".align"),background:A[B+"Background"](z)},l=X.rect=Re(X,y);Y>0&&Y<l.width&&(X.labelWidth=l.width,l.width=Y),l.x=l.y=0,l.width*=G,l.height*=G,X.mat=R._16O(_(r+".autorotate"),_(r+".position"),l,_(r+".face"),_(r+".t3"),_(r+".r3"),_(r+".rotationMode"));var d=l.width/2,P=l.height/2;X.vs=new $g([-d,P,0,-d,-P,0,d,-P,0,d,P,0]),l.width/=G,l.height/=G}},_26O:function(Z,P){var w=this,f=w.data,t=w.gv,z=w.s,r=t[P](f);if(r!=o){var m=z(Z+".scale"),q=this[Z+"Info"]={note:r,textureScale:z(Z+".texture.scale"),expanded:z(Z+".expanded"),font:z(Z+".font"),color:z(Z+".color"),align:z(Z+".align"),borderWidth:z(Z+".border.width"),borderColor:z(Z+".border.color"),background:t[P+"Background"](f)};if(q.expanded){var C=z(Z+".max"),T=Re(q,r);T.width+=6,T.height+=2,C>0&&C<T.width&&(q.labelWidth=T.width,T.width=C);var c={x:-T.width/2,y:-8-T.height,width:T.width,height:T.height+8}}else c={x:-6,y:-18,width:12,height:18};q.mat=w._16O(z(Z+".autorotate"),z(Z+".position"),o,z(Z+".face"),z(Z+".t3"),z(Z+".r3"),z(Z+".rotationMode")),q.rect=c,1!==m&&(c=rj(c),c.x*=m,c.height*=m,c.y=-c.height,c.width*=m);var H=c.x,K=c.y,l=c.width,D=c.height;q.vs=new $g([H,-K,0,H,-K-D,0,H+l,-K-D,0,H+l,-K,0])}},_28O:function(X,M,R){if(R(this.s(M+".transparent"))){var Y=X.rect,L=X.textureScale,c=Y.width*L,P=Y.height*L;if(c>=1&&P>=1){var w=yc(c,P);1!==L&&(w.translate(w,Y.x,Y.y),w.scale(L,L),w.translate(w,-Y.x,-Y.y)),Wl(w,X),w.restore(),am(this,M,X.mat,X.vs,!0)}}},_29O:function(O,y,M){if(M(this.s(y+".transparent"))){var T=O.rect,K=O.textureScale,E=T.x,v=T.y,r=T.width*K,i=T.height*K;if(r>=1&&i>=1){T.x=T.y=0;var A=yc(r,i);1!==K&&A.scale(K,K),Cm(A,O),A.restore(),T.x=E,T.y=v,am(this,y,O.mat,O.vs,!1)}}},_99O:function(b,U,C,d,R,D){if(C){var W=this,F=W.gv,y=W.data,A=F._buffer,V=F._1O,J=C.icons;for(var L in J){var e=J[L],t=C.rects[L];if(t&&D(hd(e.transparent,y,F))){Cl(b,U,d,R,y,L);var G=hd(e.shape3d,y,F),z=G?[G]:hd(e.names,y,F),j=z?z.length:0,$=hd(e.textureScale,y,F)||1,k=hd(e.light,y,F);k==o&&(k=G?!0:!1),hi(b,U,hd(e.blend,y,F),k,hd(e.opacity,y,F),hd(e.reverseFlip,y,F),hd(e.reverseColor,y,F),hd(e.reverseCull,y,F));
for(var _=0;j>_;_++){var T=z[_],q=t[_];if(lr(W,q.mat),G)Mf(F,y,dc(W,G),W);else{var s=ng(T);if(s){var p=q.width*$,l=q.height*$;if(p>=1&&l>=1){var r=yc(p,l);li(r,s,hd(e.stretch,y,F),0,0,p,l,y,F),r.restore(),Ke(b,bg,V),Wm(b,U,V,hd(e.discardSelectable,y,F),A.uv,Al),tp(b,A.vs,q.vs,U.aPosition),pl(b,A.ns,Fr,U.aNormal),Io(b,A.is,rk),Bc(b,0,rk.length),fl(b,U,V)}}}Gn(F)}ab(b,U)}}}}});var eb=function(F,E){ii(eb,this,[F,E])};pk(eb,Wb,{_16O:function($,e,L,O,f,Z,g,d,h){var p=this.data,w=p.getFinalScale3d(),x=ip(e,w,L,O,d,h);if(p.hasOwnProperty("_anchor")||p.hasOwnProperty("_anchorElevation")){var U=p.getAnchor3d();x[0]-=(U.x-.5)*w[0],x[1]-=(U.y-.5)*w[1],x[2]-=(U.z-.5)*w[2]}return jk(wo(),x,p.p3(),O,f,Z,g,$,p.getFinalRotation3d(),p.getRotationMode())},clear:function(){var Q=this;Q.faceMat=Q.mat=Q.shapeModel=Q.left=Q.right=Q.front=Q.back=Q.top=Q.bottom=Q.csg=o},needValidate:function(P){if(this._iv)return this._validateFrameId=P._renderInfo.frame,!0;if(this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var E=P._renderInfo.frame;if(this._validateFrameId!==E)return this._validateFrameId=E,!0}return!1},validate:function(I,Z){var b=this,G=b.gv,m=b.data,J=b.shapeName=b.s(dh),z=dc(b,J);b._updateAutoRotation(),b._updateFixSize2d(),b._updateOverlapping(),(this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen"))&&(cr(G,m,"_wireframeModelMap","_wireframeIndexMap"),cr(G,m,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var n=Hi(m,G.getMat(m),z?b.s("shape3d.scaleable"):!0),Y=b._calcAnchorMat(m);if(Y&&$l(n,n,Y),m.mat=n,b.clear(),z||!J)if(I){var C=[];z?Ff(G,m,z,b,b.getBodyColor(),[n],I,C):(Sg(G,m,I,Z,n,Ec,C,Wq),Sg(G,m,I,Z,n,zn,C,Pj),Sg(G,m,I,Z,n,md,C,_d),Sg(G,m,I,Z,n,Il,C,zq),Sg(G,m,I,Z,n,ph,C,Vc),Sg(G,m,I,Z,n,Ic,C,Bq)),C.length&&(ad(I.vs,C),ad(I.ns,jq(C)))}else b.mat=n,(b.shapeModel=z)||(b._cubeUvs=null,b.vf(Ec,0),b.vf(zn,16),b.vf(ph,8),b.vf(Ic,24),b.vf(md,32),b.vf(Il,40))},_updateAutoRotation:function(){var x=new Dd,R=new Me,S=new Of,_=new Of,k=new Of;return function(){var f=this,q=f.data,V=f.s("autorotate")||f.s("shape3d.autorotate");if(!V)return q._dynamicRotation&&delete q._dynamicRotation,void 0;var m=f.gv;k.copy(f.s("shape3d.autorotate.up")||m._up);var t;t="string"==typeof V?[V.indexOf("x")<0?m._eye[0]:m._center[0],V.indexOf("y")<0?m._eye[1]:m._center[1],V.indexOf("z")<0?m._eye[2]:m._center[2]]:m._eye;var g=m._center,L=q.p3();S.copy(L),_.set(t[0]-g[0],t[1]-g[1],t[2]-g[2]).add(S),R.lookAt(_,S,k),x.set(0,0,0,q.getRotationMode(),!0).setFromRotationMatrix(R);var E=q._dynamicRotation;E&&Math.abs(E[0]-x.x)<1e-5&&Math.abs(E[1]-x.y)<1e-5&&Math.abs(E[2]-x.z)<1e-5||(q._dynamicRotation=[x.x,x.y,x.z])}}(),_updateFixSize2d:function(){var q=this,B=q.data,d=q.s("fixSizeOnScreen")||q.s("shape3d.fixSizeOnScreen");if(!d)return B._dynamicScale3d&&delete B._dynamicScale3d,void 0;var F=q.gv,J=Hi(B,F.getMat(B)),z=Mr([0,0,0],J),j=F.toViewPosition(z);if(!isNaN(j.x)&&!isNaN(j.y)){var m=Mr([1,0,0],J),V=F.toViewPosition(m),t=Mr([0,1,0],J),D=F.toViewPosition(t),L=V.x-j.x,G=D.y-j.y;if(L&&G){var K,c,T=B._dynamicScale3d||[1,1,1],Q=ng(B.s("shape3d.image"));if(d[0]>0&&(K=d[0]),d[1]>0&&(c=d[1]),!K||!c){var N=d>0?d:1;K||(K=(rr(Q,B)||B.getWidth())*N),c||(c=(cc(Q,B)||B.getTall())*N)}var b=Math.abs(L/K),e=Math.abs(G/c);Math.abs(b-1)<.001&&Math.abs(e-1)<.001||(B._dynamicScale3d=[T[0]/b,T[1]/e,T[2]])}}},_updateOverlapping:function(){var l=this,C=l.s("hide.overlapping.group");if(!C)return l._rectOverlapping&&(l._rectOverlapping=S),void 0;var y,s,N,b=l.gv,I=l.data,P=Hi(I,b.getMat(I)),t=1/0,D=1/0,X=-1/0,M=-1/0,c=I.getAnchor3d(),V=c.x,h=c.y,n=c.z;for(y=0;8>y;y++){if(s=Mr([(y>>2)-V,(1&y>>1)-h,(1&y)-n],P),N=b.toViewPosition(s),isNaN(N.x)||isNaN(N.y))return;t=Math.min(t,N.x),X=Math.max(X,N.x),D=Math.min(D,N.y),M=Math.max(M,N.y)}var O={x:t,y:D,w:X-t,h:M-D};l._rectOverlapping=b.overlappingBox.isOverlapping(C,O)},getVectorDynamicSize:function(){var V,p=this,t=p.s("shape3d"),I=p.data;if("billboard"===t||"plane"===t||(V=I._currentCubeElementId)!=o){var T,Z,e=p.gv,N=Hi(I,e.getMat(I)),k=I.getAnchor3d(),C=.5-k.x,d=.5-k.y,M=.5-k.z,S=p.s("vector.dynamic.maxsize"),i=function(O,U){O[0]+=C,O[1]+=d,O[2]+=M,U[0]+=C,U[1]+=d,U[2]+=M;var V=e.toViewPosition(Mr(O,N)),k=e.toViewPosition(Mr(U,N)),D=V.x-k.x,h=V.y-k.y;return Math.min(S,Math.sqrt(D*D+h*h))};if("billboard"===t)T=i([-.5,0,0],[.5,0,0]),Z=i([0,-.5,0],[0,.5,0]);else if("plane"===t)T=i([-.5,0,0],[.5,0,0]),Z=i([0,0,-.5],[0,0,.5]);else if(I._currentCubeElementId!=o){var E=3*Uq[V+1],j=3*Uq[V],c=3*Uq[V+2];T=i([Ye[E],Ye[E+1],Ye[E+2]],[Ye[c],Ye[c+1],Ye[c+2]]),Z=i([Ye[E],Ye[E+1],Ye[E+2]],[Ye[j],Ye[j+1],Ye[j+2]])}return[T,Z]}},vf:function(b,x){var r=this;if(r.gv.getFaceVisible(r.data,b)){var K=Qn(r,b);K.mat&&(r.faceMat=!0);var e=K.uv;if(e){var w=r._cubeUvs;w||(w=r._cubeUvs=new $g([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var I=0;8>I;I++)w[x+I]=e[I]}return K}},_billboardInView:function(){var w=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],e=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],N=new nb,r=new Of,L=new Me;return function(Y){var B=this;if(!B.mat)return!0;var k=B.gv.getFrustum(),A="billboard"===Y?w:e;N.makeEmpty(),L.fromArray(B.mat);for(var O=0,E=A.length;E>O;O+=3)N.expandByPoint(r.fromArray(A,O).applyMatrix4(L));return k.intersectsBox(N)}}(),_80o:function(U,g,s){var l=this;if(l._rectOverlapping)return!0;var E=l.shapeModel;if(E||!l.shapeName){var Y=l.s("shape3d");if(("billboard"===Y||"plane"===Y)&&!l._billboardInView(Y))return!0;var q=l.gv,W=l.data,v=q._cube;is(q,l.mat),l.s("shape3d.reflector")&&!U._picking||(E?Mf(q,W,E,l,l.getBodyColor(),s):(tp(U,v.vs,o,g.aPosition),tp(U,v.ns,o,g.aNormal),Br(U,v.is),l._18O(U,g,"left",0,s),l._18O(U,g,"front",6,s),l._18O(U,g,"right",12,s),l._18O(U,g,"back",18,s),l._18O(U,g,"top",24,s),l._18O(U,g,"bottom",30,s))),Gn(q),l.faceMat&&(l._18O(U,g,"left",0,s,!0),l._18O(U,g,"front",6,s,!0),l._18O(U,g,"right",12,s,!0),l._18O(U,g,"back",18,s,!0),l._18O(U,g,"top",24,s,!0),l._18O(U,g,"bottom",30,s,!0))}},_18O:function(S,C,k,d,z,U){var D=this[k];if(D){if(!z(D.transparent))return;if(U&&!D.mat||!U&&D.mat)return;var h=this.data.s("polygonOffset");h&&nn(S,h),U&&is(this.gv,D.mat);var p=this,g=p.data;g._currentCubeElementId=d;var $=p.gv,l=$.getTexture(D.texture,g,k),F=D.uv,J=D.uvScale,E=D.uvOffset,f=D.discardSelectable;l?F?Wm(S,C,l,f,$._buffer.uv,p._cubeUvs,E,J):Wm(S,C,l,f,$._cube.uv,o,E,J):Wm(S),hi(S,C,D.blend,D.light,D.opacity,D.reverseFlip,D.reverseColor,D.reverseCull),yg(S,C.uDiffuse,D.color||t["color.empty"]),Bc(S,d,6),ab(S,C),fl(S,C,l),U&&Gn($),h&&Gg(S),g._currentCubeElementId=null}},drawReflector:function(){var T=new Of,A=new Of,s=new Dd,n=new Me,W=new Of,b=new Of,E=new Of,H=new Of,J=new Me,U=new Me,Z=new as,y=new nl,F=new nl,h=function(k,e,H){k[H]=e[0],k[H+1]=e[1],k[H+2]=e[2]},P=function(U,d){h(U,d.getEye(),0),h(U,d.getCenter(),3),h(U,d.getUp(),6)},d=function(q,O){O._eye=[q[0],q[1],q[2]],O._center=[q[3],q[4],q[5]],O._up=[q[6],q[7],q[8]],O._18Q=o;var H=O._skyBox;H&&(H.p3([q[0],q[1],q[2]]),O.getData3dUI(H).iv())};return function(R,M,X,q,I){var O=this;O._reflectorInfo=null;var $=O.data;if($._reflecting)return!1;var N=O.gv;if(I)return!1;var e=O._reflectorRenderTarget;e?e.setSize(R,M,X):e=O._reflectorRenderTarget=new gl.RenderTarget(N,R,M,X),T.copy($.p3()),A.copy(N.getEye()),n.makeRotationFromEuler(s.set($.r3(),$.getRotationMode(),!0));var a;if(!O._reflectNormal){var a=dc(O,O.s("shape3d"));if(!a)return!1;if(!a.ns&&a.length&&(a=a[0]),!a.ns||!a.vs)return!1;O._reflectNormal=[a.ns[0],a.ns[1],a.ns[2]],O._reflectorVbuffer=Kr.Buffer.createVertexBuffer(R,new Float32Array(a.vs))}if(W.copy(O._reflectNormal),W.applyMatrix4(n),b.subVectors(T,A),b.dot(W)>0)return!1;b.reflect(W).negate(),b.add(T),E.copy(N.getCenter()).negate().add(T),E.reflect(W).negate(),E.add(T),H.copy(N.getUp()),H.reflect(W);var g=[0,0,0,0,0,0,0,0,0];P(g,N),N._eye=b.toArray(),N._center=E.toArray(),N._up=H.toArray(),N._18Q=o;var D=N._skyBox;D&&(D.p3(N._eye),N.getData3dUI(D).iv()),Ag(R,e.frame),R.viewport(0,0,e.width,e.height),R.clearColor(0,0,0,1),R.clear(R.COLOR_BUFFER_BIT);var w=ni(N),h=Ae(N);Z.setFromNormalAndCoplanarPoint(W,T),Z.applyMatrix4(U.fromArray(h)),y.set(Z.normal.x,Z.normal.y,Z.normal.z,Z.constant),F.x=(Math.sign(y.x)+w[8])/w[0],F.y=(Math.sign(y.y)+w[9])/w[5],F.z=-1,F.w=(1+w[10])/w[14],y.multiplyScalar(2/y.dot(F));var p=$.s("shape3d.reflector.clip"),c=p===S?.003:p;w[2]=y.x,w[6]=y.y,w[10]=y.z+1-c,w[14]=y.w;var L=N._computedProjectMatrix;N._computedProjectMatrix=w,$._reflecting=!0,q(),N._computedProjectMatrix=L,J.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),J.multiply(U.fromArray(N._projectMatrix)),J.multiply(U.fromArray(N._viewMatrix)),pe(R),d(g,N);var _=R._compiledShader.reflector;return _||(_=R._compiledShader.reflector=new Kr.Shader(R,Mj.Reflector.vs,Mj.Reflector.fs)),_.bind(),R.activeTexture(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,e.texture),_.uniforms.tDiffuse=0,_.uniforms.color=zh($.s("shape3d.reflector.color")||"rgb(128,128,128)"),_.uniforms.textureMatrix=J.toArray(),_.uniforms.modelMatrix=Hi($),_.uniforms.viewMatrix=Ae(N),_.uniforms.projectionMatrix=ni(N),O._reflectorVbuffer.upload(),_.attributes.pos.pointer(O._reflectorVbuffer),R.drawArrays(R.TRIANGLES,0,6),$._reflecting=!1,R.useProgram(N._prg),!0}}()}),Mj.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Ql=function(s,M){ii(Ql,this,[s,M])};pk(Ql,Wb,{_25Q:1,validate:function(g){var q=this,d=q.gv,K=q.data,j=q.s,T=j("edge.width"),$=K._40I,n=K._41I;if(q.shapeModel=q.info=o,$&&n){var l,a,F,O,Z,r,w,B,C,y,S=K.isLooped(),I=j(os),H=N.getEdgeType(I);if(H){var P=H(K,ap(q,d,K,S,I),d,q._19Q);if(!P.points||P.points.isEmpty())return;r=q.info={},w=P.segments,Z=P.points,B=Z.size();for(var E=$.getElevation(),W=n.getElevation(),D=0;B>D;D++){var f=Z.get(D);f.e==o&&(f.e=E+(W-E)*D/(B-1))}C=jj(Z.get(0)),y=jj(Z.get(B-1));var z=B%2;0===z?(r.c1=jj(Z.get(B/2-1)),r.c2=jj(Z.get(B/2))):r.p3=jj(Z.get((B-z)/2)),r.s1=C,r.s2=jj(Z.get(1)),r.t1=jj(Z.get(B-2)),r.t2=y}else{Z=new Fj,r=q.info={};var t=j("edge.offset"),u=j("edge.center"),c=j("edge.source.t3"),G=j("edge.target.t3"),L=q._getEdge3dHostPoint($,"source"),A=q._getEdge3dHostPoint(n,"target");if(c&&(L[0]+=c[0],L[1]+=c[1],L[2]+=c[2]),G&&(A[0]+=G[0],A[1]+=G[1],A[2]+=G[2]),I===Zq){w=j("edge.segments");var V=r.points=j(Mo)||Ep;if(B=V.size()){C=jj(V.get(0)),y=jj(V.get(B-1)),!u&&t&&(F=Ni(C,L,!0),t=Q(t,Qm(L,C)),L=[L[0]+F[0]*t,L[1]+F[1]*t,L[2]+F[2]*t],F=Ni(A,y,!0),t=Q(t,Qm(y,A)),A=[A[0]-F[0]*t,A[1]-F[1]*t,A[2]-F[2]*t]);var z=B%2;0===z?(l=jj(V.get(B/2-1)),a=jj(V.get(B/2))):r.p3=jj(V.get((B-z)/2)),r.s1=L,r.s2=C,r.t1=y,r.t2=A}else!u&&t&&(F=Ni(A,L,!0),O=Qm(L,A),t=Hm(t,O),L=[L[0]+F[0]*t,L[1]+F[1]*t,L[2]+F[2]*t],A=[A[0]-F[0]*t,A[1]-F[1]*t,A[2]-F[2]*t]),l=L,a=A;Z.add({x:L[0],y:L[2],e:L[1]}),Z.addAll(V),Z.add({x:A[0],y:A[2],e:A[1]})}else{var h=ap(q,d,K,S,I);if(q._19Q||(h=-h),S){var Y=L[0],U=L[1],v=L[2],s=$.getTall()/2+h;l=[Y-h,U+s,v],a=[Y+h,U+s,v],Z.add({x:Y-h,y:v,e:U}),Z.add({x:Y-h,y:v,e:U+s}),Z.add({x:Y+h,y:v,e:U+s}),Z.add({x:Y+h,y:v,e:U})}else{F=Ni(A,L,!0),O=Qm(L,A);var i={x:L[0],y:L[2]},R={x:A[0],y:A[2]},_=Fk(o,i,R,h),e=_.x-i.x,x=_.y-i.y;t=Hm(t,O),F[0]*=t,F[1]*=t,F[2]*=t,l=[L[0]+F[0]+e,L[1]+F[1],L[2]+F[2]+x],a=[A[0]-F[0]+e,A[1]-F[1],A[2]-F[2]+x],u?(Z.add({x:L[0],y:L[2],e:L[1]}),Z.add({x:l[0],y:l[2],e:l[1]}),Z.add({x:a[0],y:a[2],e:a[1]}),Z.add({x:A[0],y:A[2],e:A[1]})):(Z.add({x:l[0],y:l[2],e:l[1]}),Z.add({x:a[0],y:a[2],e:a[1]}))}}r.c1=l,r.c2=a}r.list=j(dh)===Qq?q.createTubeModel(Z,w,T/2,g):q.createLineModel(Z,w,T,"edge","edge.dash")}},_getEdge3dHostPoint:function(t,Q){if(!Sl(t))return t.p3();var H=this;Q="edge."+Q+".anchor.";var y=H.s(Q+"x"),h=H.s(Q+"elevation"),F=H.s(Q+"y"),n=Hi(t,H.gv.getMat(t)),G=t.getAnchor3d();return Mr([(y===S?.5:y)-G.x,(h===S?.5:h)-G.y,(F===S?.5:F)-G.z],n)}});var vr=function(Q,E){ii(vr,this,[Q,E])};pk(vr,eb,{_80o:function(R,b,X){var g=this,Y=g.gv,v=g.shapeModel;is(Y,g.mat),v?Mf(Y,g.data,v,g,g.getBodyColor(),X):(Qb(g,R,b,"left",X),Qb(g,R,b,"front",X),Qb(g,R,b,"right",X),Qb(g,R,b,"back",X),Qb(g,R,b,"top",X),Qb(g,R,b,"bottom",X)),Gn(Y)},validate:function(N,j){var Y,P,e=this,T=e.s,K=e.data,b=K.p3(),O=K._thickness/2,x=K.isClosePath(),E=K.getPoints(),z=K.getSegments(),g=T(Ve),W=N&&N.uv;if(e.clear(),0>O){try{P=e.shapeModel=so(E,z,T(kh),T(oe),g,T(Jo),K.getTall(),K.getShapeElevation(),x)}catch(_){P=e.shapeModel={}}T(pq)?T("shape3d.image")||delete P.uv:(delete P.vs,delete P.ns,delete P.uv),T("shape3d.top.image")||delete P.top_uv,T("shape3d.bottom.image")||delete P.bottom_uv}else if(T(dh)===Qq)Y=Qc(E,z,g,x),P=e.shapeModel={vs:[]},T("shape3d.image")&&(P.uv=[],P.sum=T(Jo)||hh(Y)||1,P.len=0),T(kh)&&!x&&(P.top_vs=[],T("shape3d.top.image")&&(P.top_uv=[])),T(oe)&&!x&&(P.bottom_vs=[],T("shape3d.bottom.image")&&(P.bottom_uv=[])),e._12O(Y,O);else{var H,X,i,M,n,q,k,d,m,Q;if(Y=Qc(E,z,g,x),n=e.vf(ph,W,!1,j),O&&(q=e.vf(Ic,W,!1,j),k=x?o:e.vf(Ec,W,!1,j),d=x?o:e.vf(zn,W,!1,j),m=e.vf(md,W,!1,j),Q=e.vf(Il,W,!1,j)),O){for(var c=0,s=Y.length;s>c;c++)Y[c]=e._tryRemoveBezierPoints(Y[c],O);e._12O(Y,O)}else n&&Y.forEach(function(j){if(M=j.length,M>0)for(H=j[0],i=1;M>i;i++)X=j[i],e.addV(n.vs,H,X),H=X});e._20Q(Y),N||(n&&(n.ns=jq(n.vs),Um(n,"vs"),Um(n,_h)),O&&(q&&(q.ns=jq(q.vs),Um(q,"vs"),Um(q,_h)),k&&(k.ns=jq(k.vs),Um(k,"vs"),Um(k,_h)),d&&(d.ns=jq(d.vs),Um(d,"vs"),Um(d,_h)),m&&(m.ns=jq(m.vs),Um(m,"vs"),Um(m,_h)),Q&&(Q.ns=jq(Q.vs),Um(Q,"vs"),Um(Q,_h))))}var f=e.mat=wo();ol(f,b),Gh(f,K.getFinalRotation3d(),K.getRotationMode());var I=K.getScale3d(),u=K._dynamicScale3d;u&&(I[0]*=u[0],I[1]*=u[1],I[2]*=u[2]),lm(f,I),ol(f,Yc(b)),N&&(ag(e,f,N,P),e.clear())},_20Q:function(F){var G,i,s,N,J,f,M,g=this,X=g.front,e=g.back,V=g.top,A=g.bottom,t=X?X.tuv:o,h=e?e.tuv:o,W=V?V.tuv:o,d=A?A.tuv:o,O=0;(t||h||W||d)&&(G=g.s(Jo)||hh(F)||1,F.forEach(function(K){if(i=K.length,i>0)for(f=K[0],s=1;i>s;s++)M=K[s],N=O/G,O+=Qm(f,M),J=O/G,g._14O(X,N,J),g._14O(e,1-J,1-N),g._14O(V,N,J),g._14O(A,N,J),f=M}))},_14O:function(j,W,T){if(j){var G=j.uv,V=j.tuv;if(V){if(G)var k=G[0]+(G[6]-G[0])*W,$=G[1]+(G[7]-G[1])*W,R=G[2]+(G[4]-G[2])*W,B=G[3]+(G[5]-G[3])*W,Q=G[2]+(G[4]-G[2])*T,F=G[3]+(G[5]-G[3])*T,_=G[0]+(G[6]-G[0])*T,H=G[1]+(G[7]-G[1])*T;else k=W,$=0,R=W,B=1,Q=T,F=1,_=T,H=0;V.push(R,B,Q,F,_,H,_,H,k,$,R,B)}}},_13O:function(L){var D=L.uv,K=L.tuv;K&&(D?K.push(D[2],D[3],D[4],D[5],D[6],D[7],D[6],D[7],D[0],D[1],D[2],D[3]):K.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(c,f){var L=c.length;if(4>L)return c;var w,G,t,J,k,Y,U=!1,b=function(e){return c[e]},d=function(K){return c[L-1-K]};for(k=0;1>=k;k++)for(Y=k?d:b,G=Y(0),t=Y(1),w=2;L-1>w;w++)if(J=Y(w),!J.remove)if(J.b){var q=Fk(G,t,J,f);q.adjust?(J.remove=!0,U=!0):(G=t,t=J)}else G=t,t=J;if(!U)return c;var V=[];for(w=0;L>w;w++)c[w].remove||V.push(c[w]);return V},_12O:function(c,i){var K,W,G,y,$,x=this.s("shape3d.point.epsilon"),a=this;c.forEach(function(s){if($=s.length,$>0)for(K={p:s[0],n:!0},y=1;$>y;y++)W=s[y],G=$-1>y?s[y+1]:o,G&&Math.abs(W.x-G.x)<x&&Math.abs(W.y-G.y)<x||a.addPoint(K,W,G,i,s)})},addPoint:function(P,c,g,l,e){var V,q,s,Q,i,j,W,x,t,k=this,Z=P.p,v=P.f,T=P.b,H=k.s("shape3d.side")||dj,w=k.s("shape3d.start.angle"),A=k.s("shape3d.sweep.angle"),B=k.shapeModel,C=k.data.isClosePath();if(P.n&&(P.n=!1,v=C&&e.length>2?Fk(e[e.length-2],Z,c,l):Fk(o,Z,c,l),T=go(Z,v),B?B.top_vs&&k._10O(T,v,H,w,A,B.top_vs,B.top_uv):(V=k.left)&&(k.addV(V.vs,T,v),k._13O(V))),q=g?Fk(Z,c,g,l):C&&e.length>2?Fk(Z,c,e[1],l):Fk(Z,c,o,l),s=go(c,q),B){var z,D,m=B.vs,K=B.uv,y=B.sum;for(K&&(z=B.len/y,B.len+=Qm(Z,c),D=B.len/y),j=k._9O(T,v,H,w,A),W=k._9O(s,q,H,w,A),x=0;H>x;x++)t=x+1,ad(m,j[t]),ad(m,W[x]),ad(m,j[x]),ad(m,W[x]),ad(m,j[t]),ad(m,W[t]),K&&(Q=x/H,i=t/H,K.push(z,i,D,Q,z,Q,D,Q,z,i,D,i));!g&&B.bottom_vs&&k._10O(s,q,H,w,A,B.bottom_vs,B.bottom_uv,!0)}else!g&&(V=k.right)&&(k.addV(V.vs,q,s),k._13O(V)),(V=k.front)&&k.addV(V.vs,v,q),(V=k.back)&&k.addV(V.vs,s,T),(V=k.top)&&k.addH(V.vs,v,q,s,T,!0),(V=k.bottom)&&k.addH(V.vs,T,s,q,v);P.p=c,P.f=q,P.b=s},_10O:function(I,D,N,T,K,g,L,C){var E,A,o=this,$=o.data,B=o._9O(I,D,N,T,K),F=(I.x+D.x)/2,Z=(I.y+D.y)/2,r=$.getShapeElevation(),y=0;for(y=0;N>y;y++)C?(ad(g,B[y]),ad(g,B[y+1])):(ad(g,B[y+1]),ad(g,B[y])),ad(g,[F,r,Z]),L&&(C?(E=j*(y+1)/N+T,A=j*y/N+T):(E=j*y/N+T,A=j*(y+1)/N+T),L.push(.5-.5*X(A),.5-.5*V(A),.5-.5*X(E),.5-.5*V(E),.5,.5))},_9O:function(r,q,Q,T,x){var S,N,Y=this,w=Y.data,s=[],R=(r.x+q.x)/2,a=(r.y+q.y)/2,_=w.getTall()/2,k=w.getShapeElevation(),y=0;for(x=x||j;Q>=y;y++)S=x*y/Q+T,N=X(S),s.push([R+(r.x-R)*N,k+_*V(S),a+(r.y-a)*N]);return s},addV:function(M,o,R){var h=o.x,j=o.y,p=R.x,W=R.y,Z=this.data,K=Z.getShapeElevation(),T=Z.getTall()/2;M.push(h,K-T,j,p,K-T,W,p,K+T,W,p,K+T,W,h,K+T,j,h,K-T,j)},addH:function(C,N,Y,j,d,m){var b=this.data,r=b.getTall()/2,c=b.getShapeElevation()+(m?r:-r);C.push(N.x,c,N.y,Y.x,c,Y.y,j.x,c,j.y,j.x,c,j.y,d.x,c,d.y,N.x,c,N.y)},vf:function(B,Q,c,F){var D,u=this,b=u.gv.getFaceVisible(u.data,B);return(c||b)&&(D=Qn(u,B,F),D.vs=[],D.tuv=b&&(D.texture||Q)?[]:o,D.visible=b),D}});var pd=function(P,i){ii(pd,this,[P,i])};pk(pd,Wb,{_25Q:1,validate:function(t){var J=this,Q=J.data,L=J.s,Y=Q.getPoints(),y=Y.size();if((!J.s("shape3d.geometry.cache")||!J.shapeModel)&&(J.shapeModel=J.info=o,y>1)){var c=J.info={},d=Q.getSegments(),P=Q.getThickness(),D=jj(Y.get(0)),x=jj(Y.get(y-1)),$=y%2;0===$?(c.c1=jj(Y.get(y/2-1)),c.c2=jj(Y.get(y/2))):c.p3=jj(Y.get((y-$)/2)),c.s1=D,c.s2=jj(Y.get(1)),c.t1=jj(Y.get(y-2)),c.t2=x,c.list=L(dh)===Qq?J.createTubeModel(Y,d,P/2,t):J.createLineModel(Y,d,P,"shape.border","shape.dash")}var h=Q.p3(),M=J.mat=wo();ol(M,h),Gh(M,Q.getFinalRotation3d(),Q.getRotationMode());var Z=Q.getScale3d(),m=Q._dynamicScale3d;m&&(Z[0]*=m[0],Z[1]*=m[1],Z[2]*=m[2]),lm(M,Z),ol(M,Yc(h))},_80o:function(B,A,X){var t=this,d=t.shapeModel;if(d){var a=t.gv;is(a,t.mat),Mf(a,t.data,d,t,t.getBodyColor(),X),Gn(a)}}});var Ze=E.graph3d.VR=function(Z){var v=this;v.gv=Z,v._controllers=[],v.switch=new jr(v),v._enable=!1,v._defaultCallLater=E.Default.callLater,v._defaultCancelLater=bb,"undefined"!=typeof d&&"VRFrameData"in d&&(v._frameData=new d.VRFrameData),v.measureOflength=1,v.eyesOffset=[0,0,0],v._orientation=new E.Math.Quaternion,v._lastHeadPose=[0,0,0],v._offsetToBeAdd=[0,0,0],v._fpsInfo={time:0,fps:0,frames:0}};pk(Ze,l,{ms_fire:!0,_42:function(Q,M,d,$){var Y=this,S=Y.gv;if(!S.drawFilter&&Y._deviceInAction){var T=Y._device;if(T){var I=Y._measureOflength;T.depthNear=S.getNear()*I,T.depthFar=S.getFar()*I;var k=Y._offsetToBeAdd;if(Y.eyesOffset[0]+=k[0],Y.eyesOffset[1]+=k[1],Y.eyesOffset[2]+=k[2],k[0]=0,k[1]=0,k[2]=0,T.isPresenting===!1)return Y._controllers.forEach(function(A){A&&A.update()}),S.iv(),!1;var V=Y._frameData;T.getFrameData(V);var O=V.pose.position;if(O){var e=Y.toViewPosition(O);S.setEye(e),Y._orientation.fromArray(V.pose.orientation);var X=new E.Math.Vector3(0,0,-10*Y._scaleFactor);X.applyQuaternion(Y._orientation),S.setCenter([e[0]+X.x,e[1]+X.y,e[2]+X.z])}Y._controllers.forEach(function(M){M&&M.update()}),S.setViewport(Q,0,0,M/2,d),Y._viewMatrix=Y._copyViewMatrix(V.leftViewMatrix),Y._projectMatrix=Y._copyProjectMatrix(V.leftProjectionMatrix),$(),S.setViewport(Q,M/2,0,M/2,d),Y._viewMatrix=Y._copyViewMatrix(V.rightViewMatrix),Y._projectMatrix=Y._copyProjectMatrix(V.rightProjectionMatrix),$(),Y._lastViewMatrix=Y._viewMatrix,Y._lastProjectMatrix=Y._projectMatrix,Y._viewMatrix=null,Y._projectMatrix=null,Y.submitFrame();var o=Date.now(),H=Y._fpsInfo;return o-H.time>1e3?(H.fps=Math.round(1e3*(H.frames+1)/(o-H.time)),H.time=o,H.frames=0):H.frames++,!0}}},onVRDisplayPresentChange:function(){var N=this.isPresenting();this._injectGraphView(N),this.fp("present",!N,N)},getOrientation:function(){return this._orientation},addController:function(Z){Z=Z||0;var z=this,x=z.getController(Z);return x?x:(x=new Xe(z,Z),z._controllers.push(x),x)},getController:function(W){W=W||0;for(var x=this._controllers,Q=0,N=x.length;N>Q;Q++)if(x[Q]&&x[Q].id===W)return x[Q];return null},removeController:function($){$=$||0;for(var V=this._controllers,I=0,t=V.length;t>I;I++)if(V[I]&&V[I].id===$)return V.splice(I,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(I,v){var C=this,X=C._scaleFactor,k=C._eyesOffset,h=C._lastHeadPose;return h[0]=I[0]*X,h[1]=I[1]*X,h[2]=I[2]*X,v?(v[0]=h[0]+k[0],v[1]=h[1]+k[1],v[2]=h[2]+k[2],v):[h[0]+k[0],h[1]+k[1],h[2]+k[2]]},addEyesOffset:function(o,v,Y){var f=this._offsetToBeAdd;f[0]+=o,f[1]+=v,f[2]+=Y},_copyViewMatrix:function(F){var I=this.dup(F),w=this._scaleFactor;I[12]*=w,I[13]*=w,I[14]*=w;var H=this._eyesOffset;if(H&&(H[0]||H[1]||H[2])){var r=H[0],k=H[1],E=H[2];I[12]-=I[0]*r+I[4]*k+I[8]*E,I[13]-=I[1]*r+I[5]*k+I[9]*E,I[14]-=I[2]*r+I[6]*k+I[10]*E}return I},shutdown:function(){var w=this._device;w&&w.isPresenting&&w.exitPresent()},isPresenting:function(){var s=this._device;return s&&s.isPresenting},_copyProjectMatrix:function(X){var e=this.dup(X),f=this._scaleFactor;return e[14]*=f,e},dup:function(I,C){for(var P=I.length,B=C||new Array(P);P--;)B[P]=I[P];return B},getViewMatrix:function(c){var T=this._viewMatrix;return T?this.dup(T,c):void 0},getProjectMatrix:function(){var R=this._projectMatrix;return R?this.dup(R):void 0},submitFrame:function(){var D=this;if(D._enable&&D._deviceInAction){var B=D._device;B&&B.isPresenting&&(B.submitFrame(),D.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(Z){var n=this.gv;return n.intersectObjects(Z,n.dm().getDatas())},setDevice:function(V){var S=this;S._device=V},_injectGraphView:function(){var g,d,h;return function(f){var i=this.gv;if(!f)return g&&(i.getWidth=g,i.getHeight=d,i.getDevicePixelRatio=h),void 0;var P=this._device,o=P.getEyeParameters("left"),n=o.renderWidth,L=o.renderHeight;g=i.getWidth,d=i.getHeight,h=i.getDevicePixelRatio,i.getWidth=function(){return 2*n},i.getHeight=function(){return L},i.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function($){var x=this;if(!$)return Rg=E.Default.callLater=x._defaultCallLater,bb=E.Default.cancelLater=x._defaultCancelLater,void 0;var x=this;Rg=E.Default.callLater=function(E,O,v,o){var M=x._device;return M&&M.isPresenting?o?W(function(){Rg(E,O,v)},o):M.requestAnimationFrame(function(){x._deviceInAction=!0,E.apply(O,v),x._deviceInAction=!1}):x._defaultCallLater(E,O,v,o)},bb=E.Default.cancelLater=function(A,I){var m=x._device;return m&&m.isPresenting?I?w(A):m.cancelAnimationFrame(A):x._defaultCancelLater(A,I)}}}),l.defineProperties(Ze.prototype,{enable:{get:function(){return this._enable},set:function(I){var Y=this;Y._enable!==I&&(Y._enable=I,I?(Y.switch.showButton(),Y._injectCallLaterFunc(!0)):(Y.shutdown(),Y.switch.hideButton(),Y._injectCallLaterFunc(!1)),Y.fp("enable",!I,I))}},measureOflength:{get:function(){return this._measureOflength},set:function(S){this._measureOflength=S;var _=this._scaleFactor=1/S;this._controllers.forEach(function(f){f&&f._setScaleFactor(_)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(t){this._eyesOffset=t}},controllerModel:{get:function(){return this._controllerModel},set:function(_){var V;"object"==typeof _?(V=_.mtl,_=_.obj):(V=_+".mtl",_+=".obj");var A=this,r=A._controllerModel;r&&r.obj===_&&r.mtl===V||(r=A._controllerModel={obj:_,mtl:V},N.loadObj(_,V,{finishFunc:function(u,D){A._controllerModel===r&&N.setShape3dModel("vrControllerModel",D)}}))}},interactive:{get:function(){return!!this._interactive},set:function(S){!!S!=!!this._interactive&&(this._interactive=S,S&&this.addController(0),this.gv.getCoreInteractor().enableVR(S))}}});var Xe=function(A,p){function Z($){var l=navigator.getGamepads&&navigator.getGamepads();if(l)for(var M=0,Y=0,D=l.length;D>M;M++){var z=l[M];if(z){var o=z.id;if("OpenVR Gamepad"===o||0===o.indexOf("Oculus Touch")||o.indexOf("Controller")>=0){if(Y===$)return z;Y++}}}}function c(A,q,n){return Math.abs(A[0]-q[0])<n&&Math.abs(A[1]-q[1])<n&&Math.abs(A[2]-q[2])<n?!0:!1}var T=this;T.vr=A,T.id=p;var V,v,f=[0,0],L=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],j=new Rd;j.s("shape3d","vrControllerModel"),j.isController=!0,j.s("intersect",!1),T.getGamepad=function(){return v},T.isButtonPressed=function(f){for(var U,W=0,F=L.length;F>W;W++)if(U=L[W],U.id===f)return U.pressed;return!1},T.getNode=function(){return j};var b=.003;T.setRotationEpsilon=function(K){b=K};var F=5e-4,o=F;T.setPositionEpsilon=function(A){F=A,o=A*T.vr._scaleFactor},T._setScaleFactor=function(J){j.s3(J,J,J),o=F*J},T._setScaleFactor(T.vr._scaleFactor);var W,M=new Oh,l=new Me,$=[0,0,0],u=[0,0,0],y=new Dd,O=new Of,H=new vd;T.getRay=function(){return W?(H.origin.fromArray($),H.direction.copy(O),W=!1,H):H},T.update=function(){if(V=v,v=Z(p),V!=v&&console.log("gamepad changed",v),!v||v.pose===S)return v=null,j.s("3d.visible",!1),void 0;if(N.getShape3dModel("vrControllerModel")){j.dm()||A.gv.dm().add(j),j.s("3d.visible",!0);var R=v.pose;if(null!==R){R.position&&(T.vr.toViewPosition(R.position,$),c(j.p3(),$,o)||(W=!0,j.p3($))),R.orientation&&(M.fromArray(R.orientation),O.set(0,0,-1).applyQuaternion(M).normalize(),l.makeRotationFromQuaternion(M),y.set(0,0,0,j.getRotationMode(),!0).setFromRotationMatrix(l),u[0]=y.x,u[1]=y.y,u[2]=y.z,c(j.r3(),u,b)||(W=!0,j.r3(u))),W&&A.fp("gamepad.pose",null,{position:$,rotation:u,id:p});var z=v.axes;(f[0]!==z[0]||f[1]!==z[1])&&(f=[z[0],z[1]],A.fp("gamepad.axes",null,{id:p,axes:f}));var h,s,U,G,e=v.buttons;for(h=0,s=e.length;s>h;h++)if(U=e[h],U&&(G=U.pressed,L[h]||(L[h]={id:"button"+h,pressed:!1}),G!==L[h].pressed)){L[h].pressed=G;var Y={id:p},X="state";Y[X]=Y._62O=G?"down":"up",A.fp("gamepad.button."+L[h].id,null,Y)}}}}},jr=function(r){this.vr=r,this._button=null};pk(jr,l,{showButton:function(){var i=this.assureButton();if(!i.parentNode){var J=this.vr.gv,B=J.getView();J._79O?B.insertBefore(i,J._79O):B.appendChild(i)}},hideButton:function(){var h=this._button;h&&h.parentNode&&h.parentNode.removeChild(h)},assureButton:function(){var f=this._button;return f?f:this._button=this.createButton(this.vr.gv)},createButton:function(r){function c(N,e){N.textContent=e&&e.isPresenting?"关闭 VR 显示":"开启 VR 显示"}function N(N){w.style.display="",w.style.cursor="pointer",w.style.left="calc(50% - 50px)",w.style.width="100px",c(w,N),w.onmouseenter=function(){w.style.opacity="1.0"},w.onmouseleave=function(){w.style.opacity="0.5"},w.onclick=function(){N.isPresenting?N.exitPresent():N.requestPresent([{source:r.getCanvas()}])},r.vr.setDevice(N)}function x(){w.style.display="",w.style.cursor="auto",w.style.left="calc(50% - 75px)",w.style.width="150px",c(w,null),w.onmouseenter=null,w.onmouseleave=null,w.onclick=null,r.vr.setDevice(null)}function y(G){G.style.position="absolute",G.style.bottom="20px",G.style.padding="12px 6px",G.style.border="1px solid #fff",G.style.borderRadius="4px",G.style.color="#000",G.style.font="normal 13px sans-serif",G.style.textAlign="center",G.style.opacity="0.5",G.style.outline="none",G.style.zIndex="999"}if("getVRDisplays"in navigator){var w=this._button=L.createElement("button");return w.style.display="none",y(w),A(d,"vrdisplayconnect",function(q){N(q.display)}),A(d,"vrdisplaydisconnect",function(){x()}),A(d,"vrdisplaypresentchange",function(Z){c(w,Z.display),r.vr.onVRDisplayPresentChange()}),navigator.getVRDisplays().then(function(p){p.length>0?N(p[0]):x()}),w}var Y=L.createElement("a");return Y.href="https://webvr.info",Y.innerHTML="当前不支持 webvr",Y.style.left="calc(50% - 90px)",Y.style.width="180px",Y.style.textDecoration="none",y(Y),Y}}),l.defineProperties(jr.prototype,{});var qn=E.graph3d.PostProcessing=function(q){function r(){if(!k){var i=q.getGL();k=new gl.RenderTarget(q,i,null,null,{samples:t.renderTextureSamples||1}),L=new Kr.Shader(i,n.vs,n.fs),h=Kr.Buffer.createIndexBuffer(i,new Uint16Array([0,2,1,1,2,3])),V=Kr.Buffer.createVertexBuffer(i,new Float32Array([0,0,1,0,0,1,1,1]))}}var k,L,h,V,u=this,f={},M=!1;!function(){l.keys(qn).forEach(function(n){f[n]=new qn[n](q)})}(),u.getModule=function(T){return T?f[T]:u},u.getModuleList=function(){return l.keys(f)},u.handleDataModleChange=function(n,i){n&&(n.setPostProcessingData(u.serialize()),n.removeSerializeListener(u.onDataModelSerialize,u)),i&&(i.addSerializeListener(u.onDataModelSerialize,u),u.deserialize(i.getPostProcessingData()))},u.onDataModelSerialize=function(P){"serialize"===P.type?q.dm()._postProcessingData=u.serialize():"deserialize"===P.type&&u.deserialize(q.dm().getPostProcessingData())},u.serialize=function(){var T,x,u,t,E={};for(x in f)if(u=f[x],t=u.serializeProperties){T={},u.enable&&(T.enable=!0);for(var H in t){var p=u[H];p!=t[H]&&(T[H]=p)}l.keys(T).length&&(E[x.toLowerCase()]=T)}return E},u.deserialize=function(R){var V,w,p,P,c,H={};if(R)for(w in R)if(w&&(V=w[0].toUpperCase()+w.slice(1),p=f[V])){H[V]=!0,P=R[w],u.enableModule(V,!!P.enable),p.resetProperties&&p.resetProperties();for(c in P)"enable"!==c&&(p[c]=P[c])}for(V in f)H[V]||(p=f[V],p.enable=!1,p.resetProperties&&p.resetProperties())},u.decodeShader=function(t){var N,D,_,i="",Z="";for(_=0;_<t.length;_++)N=t[_],"%"===N?N="'":"a"===N?N='"':"]"===N&&(N="\\"),D=String.fromCharCode(N.charCodeAt(0)-1),_%2?Z+=D:i=D+i;return Z+i},u.createShader=function(y,b,V){var T=b.indexOf("^#"),o=u.decodeShader(b.substr(0,T)),C=u.decodeShader(b.substr(T+2));if(V){var h=V(o,C);h&&h.vs&&(o=h.vs),h&&h.fs&&(C=h.fs)}return new Kr.Shader(y,o,C)},u.enableModule=function(C,g){var O,h,o,E=C.split(",");for(O=0,h=E.length;h>O;O++)o=E[O].trim(),f[o]&&(f[o].enable=g);M=!1;for(o in f)if(f[o].enable){M=!0;break}M&&r()};var n={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};u._42=function(A,g,l,Y,s){if(M&&!s){k.setSize(A,g,l),k.bind(A),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT),q.setViewport(A,0,0,g,l),Y(),k.unbind(A);for(var m=0,X=q._glCapabilities.maxAttributes;X>m;m++)A.disableVertexAttribArray(m);var r,Q=k;for(r in f)Q=f[r]._42(A,Q)||Q;return q.setViewport(A,0,0,g,l),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT),L.bind(),A.activeTexture(A.TEXTURE0+0),A.bindTexture(A.TEXTURE_2D,Q.texture),L.uniforms.image=0,h.upload(),V.upload(),L.attributes.pos.pointer(V),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),A.bindTexture(A.TEXTURE_2D,null),A.useProgram(q._prg),!0}}},pr=E.graph3d.PostProcessing.Bloom=function(z){function h(){var E=z.getGL();if(E)for(var Z=z._postProcessing,J=0;s>J;J++)d[J]=Z.createShader(E,pr._35Q,function(B,r){return{fs:r.replace(/DEFINE_VALUE/g,$[J]).replace("%OVERRIDE_ALPHA_DEFINE%",v?"#define OVERRIDE_ALPHA":"")}})}function Q(){var Y=z.getWidth(),w=z.getHeight();if(Y&&w){m=[Y,w],W=!0;var A,v=z.getGL(),d=Math.round(m[0]/2),t=Math.round(m[1]/2);for(a=new gl.RenderTarget(z,v,d,t),A=0;s>A;A++)G.push(new gl.RenderTarget(z,v,d,t)),n.push(new gl.RenderTarget(z,v,d,t)),d=Math.round(d/2),t=Math.round(t/2);var S=z._postProcessing;x=S.createShader(v,pr._34Q),h(),J=S.createShader(v,pr._36Q,function(F,l){return{fs:l.replace(/NUM_MIPS/g,s)}
}),U=S.createShader(v,pr.finalShader),F=Kr.Buffer.createIndexBuffer(v,new Uint16Array([0,2,1,1,2,3])),M=Kr.Buffer.createVertexBuffer(v,new Float32Array([0,0,1,0,0,1,1,1]))}}var T,o,R,v,F,M,C=this,t=!1,W=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0},this.resetProperties=function(){var Q=this.serializeProperties;for(var T in Q)this[T]=Q[T]},l.defineProperties(C,{enable:{get:function(){return t},set:function(o){!!t!=!!o&&(t=o,o&&!W&&Q())}},strength:{get:function(){return T},set:function(Z){T=Z}},threshold:{get:function(){return o},set:function(p){o=p}},radius:{get:function(){return R},set:function(O){R=O}},overrideAlpha:{get:function(){return v},set:function(u){!!v!=!!u&&(v=u,W&&h())}}}),this.resetProperties();var a,x,J,U,m=[256,256],G=[],n=[],s=5,$=[3,5,7,9,11],d=[];C._42=function(c,E){function O(X,h,o,x){Ag(c,h.frame),z.setViewport(c,0,0,h.width,h.height),x?x(c):c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),P!==X&&X.bind();var e=0;for(var p in o){var n=o[p];n instanceof WebGLTexture&&(c.activeTexture(c.TEXTURE0+e),c.bindTexture(c.TEXTURE_2D,n),n=e,e++),X.uniforms[p]=n}for(P!==X&&(F.upload(),M.upload(),X.attributes.pos.pointer(M),P=X),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);e--;)c.activeTexture(c.TEXTURE0+e),c.bindTexture(c.TEXTURE_2D,null);pe(c)}if(t&&(W||(Q(),W))){var P;O(x,a,{smoothWidth:.01,luminosityThreshold:o,tDiffuse:E.texture});var X,u=a,L=Math.round(m[0]/2),I=Math.round(m[1]/2);for(X=0;s>X;X++)O(d[X],G[X],{colorTexture:u.texture,direction:[1,0],texSize:[L,I]}),O(d[X],n[X],{colorTexture:G[X].texture,direction:[0,1],texSize:[L,I]}),L=Math.round(L/2),I=Math.round(I/2),u=n[X];return O(J,G[0],{blurTexture1:n[0].texture,blurTexture2:n[1].texture,blurTexture3:n[2].texture,blurTexture4:n[3].texture,blurTexture5:n[4].texture,bloomStrength:T,bloomRadius:R,bloomTintColor:[1,1,1]}),O(U,E,{image:G[0].texture},function(g){g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.SRC_ALPHA,g.ONE)}),c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),E}}};pr._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",pr._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",pr._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",pr.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var zp=E.graph3d.PostProcessing.Dof=function(n){function H(){C=!0;var L=n.getGL();U=new gl.RenderTarget(n,L),w=n._postProcessing.createShader(L,zp._38Q),s=Kr.Buffer.createIndexBuffer(L,new Uint16Array([0,2,1,1,2,3])),v=Kr.Buffer.createVertexBuffer(L,new Float32Array([0,0,1,0,0,1,1,1]))}var U,w,s,v,A,L,g,c,V=this,K=!1,C=!1;this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var f=this.serializeProperties;for(var c in f)this[c]=f[c]},l.defineProperties(V,{enable:{get:function(){return K},set:function(t){!!K!=!!t&&(K=t,t&&!C&&H())}},image:{get:function(){return L},set:function(P){L!==P&&(L=P,A&&(n.getGL().deleteTexture(A),A=null),n.iv())}},maxblur:{get:function(){return g},set:function(z){g!==z&&(g=z,n.iv())}},aperture:{get:function(){return c},set:function(q){c!==q&&(c=q,n.iv())}}}),this.resetProperties(),V._42=function(b,Z){function $(q,M,k,o){Ag(b,M.frame),n.setViewport(b,0,0,M.width,M.height),o?o(b):b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),X!==q&&q.bind();var N=0;for(var B in k){var e=k[B];e instanceof WebGLTexture&&(b.activeTexture(b.TEXTURE0+N),b.bindTexture(b.TEXTURE_2D,e),e=N,N++),q.uniforms[B]=e}for(X!==q&&(s.upload(),v.upload(),q.attributes.pos.pointer(v),X=q),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);N--;)b.activeTexture(b.TEXTURE0+N),b.bindTexture(b.TEXTURE_2D,null);pe(b)}if(K){C||H();var X;if(!A){var O=ng(this.image);if(!O||!O.tagName)return Z;A=Ke(b,O)}var L=Z.width,p=Z.height;if(L&&p)return U.setSize(b,L,p),$(w,U,{tColor:Z.texture,tDepth:A,aspect:L/p,aperture:this.aperture,maxblur:this.maxblur}),U}}};zp._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdvs<<*!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<fqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<dfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)Ev3ofjsgvpusynf!ug!m>p,b!um!pgdpd<v*t!<5svvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<fqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudjp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!uddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<dd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdUp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|qt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<wV~w!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dwf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|pd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!*<<*!~5sgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!j<o*!!g8mspvbmuc!ggpbes!!+*!!*|!u!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u!~>,g!mmppbdu!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdDm<j*q!!8*s<vm~cgwppej!e+!!n*b!juod)f*s!s|pdwufddf3q!tebp!g+c!m*v!s1</1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<fuj!g>!,)!vmtpfdEf<q*u!i8*s!v|mc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<mp!dep<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<pm~pDfum!t)fE!3|fs!veupygfcum!v>s,!!>m!pwdfd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds!<**!!*8<sv~mcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!)wEf3df3s!veupygfcum!v>s,5!!m>p!dep<g*c!m8vssv!m+c!g1p/e5!<+!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!u<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<mpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdpm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/y<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dyz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!zdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3E",vq(N,{accordionViewExpandIcon:sf(yb),accordionViewCollapseIcon:sf(yb,!0),accordionViewLabelColor:Pm,accordionViewLabelFont:ej,accordionViewTitleBackground:Uf,accordionViewSelectBackground:wn,accordionViewSelectWidth:3,accordionViewSeparatorColor:S,splitViewDividerSize:1,splitViewDividerBackground:Uf,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:gi,rect:[2,2,12,12],background:yb}]},propertyViewLabelColor:Se,propertyViewLabelSelectColor:Pm,propertyViewLabelFont:ej,propertyViewExpandIcon:sf(ve),propertyViewCollapseIcon:sf(ve,!0),propertyViewBackground:Dk,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:Ur,propertyViewColumnLineColor:Ur,propertyViewSelectBackground:wn,listViewLabelColor:Se,listViewLabelSelectColor:Pm,listViewLabelFont:ej,listViewRowLineVisible:!1,listViewRowLineColor:Ur,listViewSelectBackground:wn,treeViewLabelColor:Se,treeViewLabelSelectColor:Pm,treeViewLabelFont:ej,treeViewExpandIcon:sf(Rf),treeViewCollapseIcon:sf(Rf,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:Ur,treeViewSelectBackground:wn,treeViewDoubleClickToToggle:!0,tableViewLabelColor:Se,tableViewLabelSelectColor:Pm,tableViewLabelFont:ej,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:Ur,tableViewColumnLineColor:Ur,tableViewSelectBackground:wn,treeTableViewLabelColor:Se,treeTableViewLabelSelectColor:Pm,treeTableViewLabelFont:ej,treeTableViewExpandIcon:sf(Rf),treeTableViewCollapseIcon:sf(Rf,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:Ur,treeTableViewColumnLineColor:Ur,treeTableViewSelectBackground:wn,tableHeaderLabelColor:Se,tableHeaderLabelFont:ej,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:vm,tableHeaderBackground:Dk,tableHeaderMoveBackground:Jd,tableHeaderInsertColor:wn,tableHeaderSortDescIcon:Gp(ve,!0),tableHeaderSortAscIcon:Gp(ve),tabViewTabGap:1,tabViewLabelColor:Pm,tabViewLabelFont:ej,tabViewTabBackground:Uf,tabViewSelectWidth:3,tabViewSelectBackground:wn,tabViewMoveBackground:Jd,tabViewInsertColor:wn,toolbarLabelColor:Se,toolbarLabelSelectColor:Pm,toolbarLabelFont:ej,toolbarBackground:Dk,toolbarSelectBackground:wn,toolbarItemGap:8,toolbarSeparatorColor:Bd},!0);var fs={translateX:1,sortColumn:1},Dm={sortable:1,sortOrder:1,sortFunc:1},oo={focusData:1},Tj={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Zf={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Sq=function(e,F){F.add(e),e.hasChildren()&&e.eachChild(function(x){Sq(x,F)})},Zp=function(B,h,e,k,t,Q,b,d,D,w,f){var W,Y=e.getValueType(w),A=e.getAlign(w);if(e.getEnumValues(w)){var R=e.toEnumLabel(h,w),G=Zb||0,F=0,H=Q,Z=N.getTextSize(k,R).width;return W=ng(e.toEnumIcon(h,w)),W&&(F=Q+Zb/2,"center"===A?F+=(d-(G+Z))/2:"right"===A&&(F=F+d-(G+Z)),Te(B,W,F,b+D/2,w,f),H=F+Zb/2),R!=o&&(W?qh(B,R,k,t,H,b,d-(H-Q),D):qh(B,R,k,t,Q,b,d,D,A)),void 0}return h=e.formatValue(h),h!=o?Y===lq?(xe(B,Q,b,d,D,h),void 0):Y===xc||!Y&&Vd(h)?(W=ng(h?We:He),Te(B,W,Q+d/2,b+D/2,w,f),void 0):(qh(B,h,k,t,Q,b,d,D,A),void 0):void 0},ci=function(n,e){var f=e.view,Z=mm(n),i=e.column||e.property;f.getDataModel().beginTransaction(),e.editor=n,n.info=e,f.setCurrentEditor(n),f.getView().insertBefore(Z,f._79O),_o(n,e.editorRect),n.setFocus?n.setFocus():qf(n),n.commitValue=function(Q,z){n._17Q&&(n=n._17Q),z||f.setValue(e.data,i,n.getValue?n.getValue():n.value),n.close&&n.close(),tc(Z)},i.onEditorCreated&&i.onEditorCreated(e)},es=function(u,O,Q,H,J){var S=Tc(u,Q),q=O.value,I=O.view,r=J.getValueType(O.data);return S.onblur=S.onchange=function(){I.endEditing()},"input"===u?(q=J.formatValue(q),q!=o&&(S.value=q),S.onkeydown=function(d){lo(d)?I.endEditing():Lq(d)&&I.endEditing(!0)},(r===wc||r===sk)&&A(S,qm,N.numberListener)):u===ih&&H.forEach(function(y){var R=L.createElement("option");R.innerHTML=J.toEnumLabel(y),R.value=y,J.isEnumEqual(q,y)&&(R.selected=!0),xh(S,R)}),ci(S,O),S},yn=E.widget={},Xq=function(y,n,E){pk(x+".widget."+y,n,E)};vq(_l,{ms_value:function(M){M.getValue=function(u){var c=this.getItemById(u),i=c.element;return rb(i)?i:i?i.getValue?i.getValue():i.value:c.selected},M.setValue=function(J,G){var Y=this.getItemById(J);if(Y){var X=Y.element;X&&!rb(X)?X.setValue?X.setValue(G):X.value=G:Vd(G)?(Y.selected=G,this.iv()):(Y.element=G,this.iv())}},M.v=function(N,U){var B=this;if(2===arguments.length)B.setValue(N,U);else{if(!uq(N))return B.getValue(N);for(var b in N)B.setValue(b,N[b])}return B}},_46o:function(i){i._icon=o,i._accessType=o,i._valueType=o,i._editable=!1,i._batchEditable=!0,i._align=Ec,i._nullable=!0,i._emptiable=!1,i.setParent=eh,i.formatValue=function(W){var Q=this,X=Q._valueType;return Q.getEnumValues()?Q.toEnumLabel(W):X===xc?!!W:W!=o&&X===wc?h(W):W},i.setEnum=function(B,S,z,I,W,y,E){var N=this;B&&!Si(B)&&B.values&&(I=B.editable,z=B.icons,S=B.labels,W=B.strict,y=B.maxHeight,E=B.dropDownWidth,B=B.values),oc(B)&&(B=B._as),oc(S)&&(S=S._as),oc(z)&&(z=z._as),N._enumValues=B,N._enumLabels=S,N._enumIcons=z,N._enumEditable=I,N._enumStrict=W==o?!0:W,N._enumMaxHeight=y,N._enumDropDownWidth=E,B&&B.length&&Ie(B[0])&&(N._valueType=sk),N.fp("enum",!1,!0)},i.getEnumDropDownWidth=function(){return this._enumDropDownWidth},i.getEnumMaxHeight=function(){return this._enumMaxHeight},i.isEnumEditable=function(){return this._enumEditable},i.getEnumValues=function(){return this._enumValues},i.getEnumLabels=function(){return this._enumLabels},i.getEnumIcons=function(){return this._enumIcons},i.isEnumStrict=function(){return this._enumStrict},i.isEnumEqual=function(w,$){return this._enumStrict?w===$:w==$},i.toEnumLabel=function(S,e){var m=this,t=m.getEnumValues(e),T=m.getEnumLabels(e);if(t&&T)for(var d=0;d<t.length;d++)if(m.isEnumEqual(S,t[d]))return T[d];return S},i.toEnumIcon=function(J,b){var C=this,X=C.getEnumValues(b),o=C.getEnumIcons(b);if(X&&o)for(var O=0;O<X.length;O++)if(C.isEnumEqual(J,X[O]))return o[O];return S}},_45o:function(Z){Z._87o=function(h,Z,N,D,u,R){if(h){var X=this,M=X._90I,K=Pd(1);X._columnLineVisible&&(u-=1),X._rowLineVisible&&(R-=1),0>=u||0>=R||(X._90I||(M=X._90I={}),M[Z]||(M[Z]=new Fj),_o(K,X.tx()+N,X.ty()+D,u,R),xh(K,h),X._view.insertBefore(K,X._79O),h.onParentAdded&&h.onParentAdded(K),M[Z].add(K))}},Z._76o=function(){var y=this,C=y._90I;if(C){for(var t in C)C[t].each(function(Z){tc(Z)});delete y._90I}},Z._77o=function(g){var M=this;if(M._90I){var a=M._90I[g];a&&(a.each(function(N){tc(N)}),delete M._90I[g])}}},_47o:function($){$.getValue=function(h,b){return b.getValue?b.getValue(h,b,this):jl(h,b.getAccessType(),b.getName())},$.setValue=function(h,U,r){if(U.isEmptiable(h)||""!==r||(r=S),U.isNullable(h)||r!=o){var V=this,y=U.getName(h),z=U.getAccessType(h),v=U.getValueType(h);v===wc&&rb(r)?r=B(r):v===sk&&rb(r)?r=parseFloat(r):v===xc&&rb(r)&&(r="true"===r),V._batchEditable&&U._batchEditable&&V.isSelected(h)?V.sm().each(function(B){U.setValue?U.setValue(B,U,r,V):dq(B,z,y,r)}):U.setValue?U.setValue(h,U,r,V):dq(h,z,y,r)}},$.setCurrentEditor=function(M){this.endEditing(),this._currentEditor=M,this.redraw()},$.isEditing=function(z,E){var u=this,_=u._currentEditor;if(!_)return!1;if(E){var h=_.info;return h?(h.column||h.property)===E&&h.data===z:!1}return!0},$.endEditing=function(L){var k=this,Y=k._currentEditor;Y&&(delete k._currentEditor,Y.commitValue&&Y.commitValue(Y.info,L),k.redraw(),k.getDataModel().endTransaction())},$.beginEditing=function(B){this.endEditing();var H=this,X=B.column||B.property;if(X.beginEditing)X.beginEditing(B);else{var d=B.data,b=B.value,j=H.getSelectBackground(d),x=X.getEnumValues(d),G=X.getSlider(d),u=X.getColorPicker(d);if(G){var T=ur(yn.Slider,G);return T.setValue(b),T.getView().onblur=function(){H.endEditing()},T.isInstant()&&(T.onValueChanged=function(){H.setValue(d,X,T.getValue())}),ci(T,B),void 0}if(u||X.getValueType(d)===lq){var S=ur(yn.ColorPicker,u);return S.setValue(b),S.onClosed=function(){H.endEditing()},S.isInstant()&&(S.onValueChanged=function(g,h){H.setValue(d,X,h)}),ci(S,B),S.open(),void 0}if(x){if(yn.ComboBox){var V=new yn.ComboBox;V.setValue(b),V.setValues(x),V.setLabels(X.getEnumLabels(d)),V.setIcons(X.getEnumIcons(d)),V.setEditable(X.isEnumEditable(d)),V.setStrict(X.isEnumStrict(d)),V.setMaxHeight(X.getEnumMaxHeight(d)),V.setDropDownWidth(X.getEnumDropDownWidth(d)),V.onClosed=function(){H.endEditing()},ci(V,B),V.open()}else es(ih,B,j,x,X);return}var D=X.getValueType(d);if(D===xc||Vd(b))return H.setValue(d,X,!b),void 0;if(X.getItemEditor(d)){var v=kn(X.getItemEditor(d)),K=new v(d,X,H,B),O=K.getView();return O._17Q=K,K.setValue(b),Kf(O),ci(O,B),K.editBeginning&&K.editBeginning(),void 0}es("input",B,j,o,X)}}},_44o:function(f){f.init=function($){var C=this,U=C.th=new fe($),N=C._view=kb(1,C);C.tv=C._tableView=$,xh(N,U.getView()),xh(N,$.getView()),U.mp(function(Z){Z.property===hk&&C.iv()}),C.iv()},f.getTableView=function(){return this.tv},f.getTableHeader=function(){return this.th},f.getDataModel=function(){return this.tv.dm()},f.getColumnModel=function(){return this.tv.getColumnModel()},f.setColumns=function(T){this.tv.setColumns(T)},f.addColumns=function(t){this.tv.addColumns(t)},f.endEditing=function(){this.tv.endEditing()},f.validateImpl=function(){var d=this,A=d.th,$=Tp(A),S={x:0,y:0,width:d.getWidth(),height:$};_o(A,S),S.y=$,S.height=r(0,d.getHeight()-$),_o(d.tv,S)}},ms_vs:function(i){i._41o=function(){return this._29I.height<this._59I},i._43o=function(){var v=this;v._41o()&&(v._58I||(W(function(){v._94O()},Ef),v.iv()),v._58I=new Date)},i._94O=function(){var l=this;if(l._58I){var t=new Date;t.getTime()-l._58I.getTime()>=Ef?(delete l._58I,l.iv()):W(function(){l._94O()},Ef)}},i._93I=function(){var D=this,y=D._27I;if(D._58I||!D._autoHideScrollBar){y||xh(D._79O,y=D._27I=Pd());var I=D._29I,o=I.height,O=D._59I,k=D.getScrollBarSize(),h=I.width-k-2,A=o*(-D.ty()/O),W=o*(o/O),J=y.style;O>o?(qr>W&&(A=A+W/2-qr/2,0>A&&(A=0),A+qr>o&&(A=o-qr),W=qr),J.visibility=Tr,J.background=D.getScrollBarColor(),J.borderRadius=k/2+Yg,_o(y,h,A,k,W)):J.visibility=rc}else y&&(y.style.visibility=rc)}},ms_hs:function(x){x._40o=function(){return this._29I.width<this._91I},x._42o=function(){var L=this;L._40o()&&(L._95O||(W(function(){L._94I()},Ef),L.iv()),L._95O=new Date)},x._94I=function(){var o=this;if(o._95O){var p=new Date;p.getTime()-o._95O.getTime()>=Ef?(delete o._95O,o.iv()):W(function(){o._94I()},Ef)}},x._92I=function(){var Z=this,D=Z._28I;if(Z._95O||!Z._autoHideScrollBar){D||xh(Z._79O,D=Z._28I=Pd());var K=Z._29I,P=K.width,o=Z._91I,V=Z.getScrollBarSize(),n=K.height-V-2,h=P*(-Z.tx()/o),L=P*(P/o),_=D.style;o>P?(qr>L&&(h=h+L/2-qr/2,0>h&&(h=0),h+qr>P&&(h=P-qr),L=qr),_.visibility=Tr,_.background=Z.getScrollBarColor(),_.borderRadius=V/2+Yg,_o(D,h,n,L,V)):_.visibility=rc}else D&&(D.style.visibility=rc)}}}),Dq(We,zl(16,16,[{type:ir,rect:[1,1,14,14],background:wn},{type:Wo,rect:[1,1,14,14],width:1,color:Zg},{type:Fl,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Dq(He,zl(16,16,{type:Wo,rect:[1,1,14,14],width:1,color:Zg})),Dq(kq,zl(16,16,[{type:xf,rect:[2,2,12,12],borderWidth:1,borderColor:Zg,background:"#FFF"},{type:xf,rect:[4,4,8,8],background:wn}])),Dq(Hp,zl(16,16,{type:xf,rect:[2,2,12,12],borderWidth:1,borderColor:Zg})),_l._15Q=function(W){W._29I=qb,W._59I=0,W._91I=0,W._5o=function(A){var g=this;g._30I=new Fj,g._rows=new Fj,g._rowMap={},g._31I=0,g._14I=0,g._view=kb(1,g),g._canvas=ib(g._view),xh(g._view,g._79O=Pd()),g.dm(A?A:new gm)},W.getCheckIcon=function(y){var g=this.sm(),C=g.co(y);return g.sg()?ng(C?kq:Hp):ng(C?We:He)},W.checkData=function(m){var I=this.sm(),X=I.co(m);I.sg()&&X||(this._32o=1,X?I.rs(m):I.as(m),delete this._32o)},W.getDataAt=function(a){a.target&&(a=this.lp(a));var i=P(a.y/this._rowHeight),f=this._rows;return 0>i||i>=f.size()?o:f.get(i)},W.onDataDoubleClicked=function(){},W.onDataClicked=function(){},W.adjustTranslateX=function(){return 0},W.adjustTranslateY=function(o){var g=this.getHeight()-this._59I;return g>o&&(o=g),o>0?0:h(o)},W.onPropertyChanged=function(f){var X=this,I=f.property;Tj[I]?X.ivm():oo[I]||X.redraw(),I===og?X._42o():I===zb&&X._43o()},W.getLabel=function(N){return N.toLabel()},W.getLabelFont=function(){return this._labelFont},W.getLabelColor=function(o){var G=this;if(G.isCheckMode()){if(G._focusData===o)return G._labelSelectColor}else if(G.isSelected(o))return G._labelSelectColor;return G._labelColor},W.getStartRowIndex=function(){return this._31I},W.getEndRowIndex=function(){return this._14I},W.getRowDatas=function(){return this._rows},W.getRowIndex=function(J){return this._rowMap[J._id]},W.getRowSize=function(){return this._rows.size()},W.getViewRect=function(){return rj(this._29I)},W.isVisible=function(M){return this._visibleFunc?this._visibleFunc(M):!0},W.getCurrentSortFunc=function(){return this._sortFunc},W.setDataModel=function(G){var $=this,B=$._dataModel,o=$._selectionModel;B!==G&&(B&&(B.umm($.handleDataModelChange,$),B.umd($.handleDataPropertyChange,$),B.umh($.handleHierarchyChange,$),o||B.sm().ums($.handleSelectionChange,$)),$._dataModel=G,G.mm($.handleDataModelChange,$),G.md($.handleDataPropertyChange,$),G.mh($.handleHierarchyChange,$),o?o._21I(G):G.sm().ms($.handleSelectionChange,$),$.fp("dataModel",B,G))},W.validateModel=function(){var H=this;H._rows.clear(),H._rowMap={},H.buildChildren(H._dataModel._roots);var j=H._rows=H._rows.toList(H.isVisible,H),l=0,y=H.getCurrentSortFunc(),W=j.size();for(y&&j.sort(y);W>l;l++)H._rowMap[j.get(l)._id]=l},W.buildChildren=function(h){var z=this;h.each(function($){z._rows.add($),z.buildChildren($._children)})},W.handleDataModelChange=function(){this.ivm()},W.handleDataPropertyChange=function(U){"parent"===U.property?this.ivm():this.invalidateData(U.data)},W.handleHierarchyChange=function(){this.ivm()},W.handleSelectionChange=function(y){y.datas.each(this.invalidateData,this),this.onSelectionChanged(y)},W.onSelectionChanged=function(u){var Q=this,L=Q.sm();!Q.isAutoMakeVisible()||1!==L.size()||"set"!==u.kind&&"append"!==u.kind||Q._32o||Q.makeVisible(L.ld())},W.handleBackgroundClick=function(j){lg(j)&&!this.isCheckMode()&&this.sm().cs()},W.makeVisible=function(a){a&&(this._23I=a,this.iv())},W.scrollToIndex=function(E){var v=this,Q=v._29I,L=Q.height,t=v._rowHeight,$=t*E;E>=0&&E<v._rows.size()&&L>0&&($+t>Q.y+L?v.ty(-$+L-t):$<Q.y&&v.ty(-$))},W.autoScroll=function($,g){var J=this,A=J._rowHeight,b=A,N=A/4,X=J._29I,o=J.lp($),R={x:J.tx(),y:J.ty()};return A>0&&X&&(o.x-X.x<b?J.translate(N,0):X.x+X.width-o.x<b&&J.translate(-N,0),o.y-X.y<b?J.translate(0,N):X.y+X.height-o.y<b&&J.translate(0,-N)),R.x=J.tx()-R.x,R.y=J.ty()-R.y,g&&(g.x+=R.x,g.y+=R.y),R},W.getTopRowOrderSelection=function(){var z=this.sm().getTopSelection(),Z={},I=new Fj;return z.each(function(q){Z[q._id]=q}),this._rows.each(function(h){Z[h._id]&&I.add(h)}),I},W.getRowOrderSelection=function(){var C=new Fj;return this._rows.each(function(B){this.isSelected(B)&&C.add(B)},this),C},W.ivm=function(){this.invalidateModel()},W.invalidateModel=function(){var t=this;t._96I||(t._96I=1,t._32I=1,delete t._24I),t.iv()},W.redraw=function(){var h=this;h._32I||(h._32I=1,delete h._24I,h.iv())},W.invalidateData=function(n){var P=this;Uk?P.redraw():P._32I||(P._24I||(P._24I={}),P._24I[n._id]=n,P.iv())},W.getFocusData=function(){return this._focusData},W.setFocusDataById=function(n){this.setFocusData(this.dm().getDataById(n))},W.setFocusData=function(z){var F=this,p=F._focusData;p!==z&&(F._focusData=z,F.fp("focusData",p,z),p&&F.invalidateData(p),z&&(F.invalidateData(z),F.isAutoMakeVisible()&&F.makeVisible(z)))},W.drawRowBackground=function(V,$,r,I,o,l,q){var i=this,A=i.isCheckMode();($===i._focusData&&A||r&&!A)&&xe(V,I,o,l,q,i.getSelectBackground($))},W.drawData=function(p,V,v){var F=this,s=F._rowHeight,E=s*v,q=F._29I,H=q.x,i=q.width;p.save(),p.beginPath(),p.rect(H,E,i,s),p.clip(),F._87o(F.drawRow(p,V,F.isSelected(V),H,E,i,s),v,H,E,i,s),p.restore(),F._rowLineVisible&&xe(p,H,E+s-1,i,1,F._rowLineColor)},W._12I=function(L){var g=this,h=g._31I,x=g._29I,t=x.x,y=x.y,V=x.width,R=x.height;for(L.beginPath(),L.rect(t,y,V,R),L.clip(),L.clearRect(t,y,V,R),g._76o(),g._93db(L);h<g._14I;h++)g.drawData(L,g._rows.get(h),h);g._92db(L)},W._13I=function(T){for(var U,Y=this,C=Y._rowHeight,B=Y._29I,Q=B.x,K=B.width,t=Y._31I,O=Y._30I;t<Y._14I;t++)U=Y._rows.get(t),Y._24I[U._id]&&O.add({data:U,index:t});O.isEmpty()||(T.beginPath(),O.each(function(w){T.rect(Q,w.index*C,K,C)}),T.clip(),O.each(function(O){T.clearRect(Q,O.index*C,K,C)}),O.each(function(X){Y._77o(X.index)}),Y._93db(T),O.each(function(l){Y.drawData(T,l.data,l.index)}),Y._92db(T),O.clear())},W.preValidateModel=function(){this.endEditing&&this.endEditing()},W.validateImpl=function(){var s=this,v=s._canvas,z=s.getWidth(),u=s.getHeight(),S=s._rowHeight,h=s._32I;(z!==v.clientWidth||u!==v.clientHeight)&&(km(v,z,u),h=1);var X=y&&!e;s._96I&&!X&&(s.preValidateModel(),s.validateModel());var G=s._29I,b={x:-s.tx(),y:-s.ty(),width:z,height:u},d=s._rows.size(),f=Vn(v),C=s._23I;h||Tl(b,G)||(h=1),s._29I=b,s._59I=d*S+s.getScrollBarSize(),s._31I=P(b.y/S),s._14I=Z((b.y+b.height)/S),s._31I<0&&(s._31I=0),s._14I>d&&(s._14I=d),s._99I&&h&&s._99I(),yr(f,s.tx(),s.ty(),1),h?s._12I(f):s._24I&&s._13I(f),s._93I(),s._92I(),f.restore(),s._32I=s._24I=s._96I=o,C&&(s.scrollToIndex(s.getRowIndex(C)),delete s._23I),s.tx(s.tx()),s.ty(s.ty())}},_l._48o=function(K){K._rootVisible=!0,K._rootData=o,K._35o=function(){this._expandMap={},this._levelMap={}},K.validateModel=function(){var u=this,_=u._rootData;u._rows.clear(),u._levelMap={},u._rowMap={},u._currentLevel=0,_?u._rootVisible?u.isVisible(_)&&u.buildData(_):u.buildChildren(_):u.buildChildren(),delete u._currentLevel},K.buildData=function(k){var d=this,e=k._id,h=d._rows;d._rowMap[e]=h.size(),h.add(k),d._levelMap[e]=d._currentLevel,d.isExpanded(k)&&(d._currentLevel++,d.buildChildren(k),d._currentLevel--)},K.buildChildren=function(w){var y=this,Y=w?w._children:y._dataModel._roots,K=y.getCurrentSortFunc();K&&y.isChildrenSortable(w)?Y.toList(y.isVisible,y).sort(K).each(y.buildData,y):Y.each(function(Z){y.isVisible(Z)&&y.buildData(Z)})},K.getLevel=function(X){return this._levelMap[X._id]},K.getToggleIcon=function(X){var f=this,g=f._loader,s=f._collapseIcon;return g&&!g.isLoaded(X)?s:X.hasChildren()?f.isExpanded(X)?f._expandIcon:s:o},K.isCheckMode=function(){return this._checkMode!=o},K.isChildrenSortable=function(){return!0},K.handleDataModelChange=function(X){var o=this;X.kind===cf?delete o._expandMap[X.data._id]:X.kind===ms&&(o._expandMap={}),o.ivm()},K.toggle=function(e){var $=this;$.isExpanded(e)?$.collapse(e):$.expand(e)},K.isExpanded=function(L){return 1===this._expandMap[L._id]},K.expand=function(m){var G=this,l=G._loader;G.isExpanded(m)||(l&&!l.isLoaded(m)&&l.load(m),G._expandMap[m._id]=1,G.ivm(),G.onExpanded(m))},K.onExpanded=function(){},K.collapse=function(s){var v=this;v.isExpanded(s)&&(delete v._expandMap[s._id],v.ivm(),v.onCollapsed(s))},K.onCollapsed=function(){},K.expandAll=function(d){if(d)this.expand(d),d.eachChild(function(e){this.expandAll(e)},this);else{var $=this;$._dataModel.each(function(v){v.hasChildren()&&($._expandMap[v._id]=1)}),$.ivm()}},K.collapseAll=function(){this._expandMap={},this.ivm()},K.makeVisible=function(b){if(b){var f=this;if(!f._rootData||b.isDescendantOf(f._rootData)){for(var q=b._parent;q;)f.expand(q),q=q._parent;f._23I=b,f.iv()}}},K.checkData=function(O){var V,g=this,D=g._checkMode,r=g.sm(),W=r.co(O);if(!r.sg()||!W){if(g._32o=1,D===pn)W?r.rs(O):r.as(O);else if(D===lf)V=new Fj(O),V.addAll(O._children);else if("descendant"===D)V=new Fj,Sq(O,V);else if("all"===D&&(V=new Fj,Sq(O,V),!W))for(var e=O._parent;e;)V.add(e),e=e._parent;V&&(W?r.rs(V):r.as(V)),delete g._32o}},K._97I=function(z,N,W,Y,i,y,k){var Z=this,_=Z._indent,V=Z._levelMap[N._id],r=Z.getIconWidth(N),J=ng(Z.getToggleIcon(N));J?(Y+=_*V,Te(z,J,Y+_/2,i+k/2,N,Z),Y+=_):Y+=_*(V+1),Z._checkMode&&(Te(z,Z.getCheckIcon(N),Y+_/2,i+k/2,N,Z),Y+=_),Z.drawIcon(z,N,Y,i,r,k),Z.drawLabel(z,N,Y+r,i,k)}},_l._14Q=function(u){u.getIcon=function(l){return l.getIcon()},u.getIconWidth=function(H){return this.getIcon(H)?this._indent:0
},u.drawIcon=function(_,a,g,U,u,z){if(u){var o=this,k=o.getBodyColor(a),n=ng(o.getIcon(a),k);n&&(z-=o.isRowLineVisible()?1:0,li(_,n,Ki,g,U,u,z,a,o,k),Ml(_,o.getBorderColor(a),g,U,u,z))}},u.drawLabel=function(b,F,G,g,P){var C=this;qh(b,C.getLabel(F),C.getLabelFont(F),C.getLabelColor(F),G,g,0,P)}},_l._50o=function(w){w._98I=function(){var w=this,k=w._39o=new gm;w._60I=new Fj,k.mm(w._17o,w),k.md(w._18o,w),k.mh(w._19o,w)},w.setColumns=function(j){this._39o.clear(),this.addColumns(j)},w.addColumns=function(L){var C=this._39o;L.forEach(function(N){if(!(N instanceof Ce)){var g=kn(N.className);N=ur(g?g:Ce,N)}C.add(N)})},w.onColumnClicked=function(){},w.onCheckColumnClicked=function(){},w._3Q=function(U){for(var s,g=0,a=this._60I,j=a.size();j>g;g++)if(s=a.get(g),s.column===U)return s;return o},w.getColumnAt=function(G){var h=this._4Q(G);return h?h.column:o},w._4Q=function(X){for(var b=this,j=X.target?b.lp(X).x:X.x,P=b._60I,f=0;f<P.size();f++){var M=P.get(f),I=M.startX;if(j>=I&&j<I+M.column.getWidth())return M}return o},w.getToolTip=function(Z){var n=this,D=n.getDataAt(Z),V=n.getColumnAt(Z);return D&&V?V.getToolTip(D,n):o},w.adjustTranslateX=function(N){var o=this.getWidth()-this._91I;return o>N&&(N=o),N>0?0:h(N)},w._99I=function(){var c=this,j=c._29I,$=c._60I;$.clear(),c._91I=0,c._39o._roots.each(function(z){if(z.isVisible()){var R=c._91I+z.getWidth();c._91I<=j.x+j.width&&R>=j.x&&$.add({column:z,startX:c._91I}),c._91I=R}}),c._91I+=c.getScrollBarSize()},w.drawData=function(y,e,L){var A=this,Z=A._rowHeight,R=Z*L,X=A.isSelected(e),h=A._29I,n=h.x,w=h.width;A.drawRowBackground(y,e,X,n,R,w,Z),A._60I.each(function(d){var W=d.column,H=d.startX,v=W.getWidth();v>0&&!A.isEditing(e,W)&&(y.save(),y.beginPath(),y.rect(H,R,v,Z),y.clip(),A._87o(A.drawCell(y,e,X,W,H,R,v,Z),L,H,R,v,Z),A._columnLineVisible&&xe(y,H+v-1,R,1,Z,A._columnLineColor),y.restore())}),A._rowLineVisible&&xe(y,n,R+Z-1,w,1,A._rowLineColor)},w.drawCell=function(i,s,B,t,N,b,H,X){var m=this;if(t.drawCell)return t.drawCell(i,s,B,t,N,b,H,X,m);var J=m.getValue(s,t);Zp(i,J,t,m.getLabelFont(s,t,J),m.getLabelColor(s,t,J),N,b,H,X,s,m)},w.getColumnModel=function(){return this._39o},w._17o=function(){this.redraw()},w._18o=function(B){var l=this;B.data===l._sortColumn&&Dm[B.property]?l.ivm():(l._42o(),l.redraw())},w._19o=function(){this.redraw()},w.getCurrentSortFunc=function(){var c=this,D=c._sortColumn;if(D&&D.isSortable()){var n=D.getSortFunc(),r=Or===D.getSortOrder()?1:-1;return n||(n=Zj),function(h,b){return n.call(c,c.getValue(h,D),c.getValue(b,D),h,b)*r}}return c._sortFunc},w.isCellEditable=function(m,f,R){return f.isEditable()&&this.isEditable()?f.isCellEditable?f.isCellEditable(m,f,R,this):!0:!1},w._37O=function(I,E){if(lg(E))for(var c=this,p=c.lp(E),n=c._60I,_=c._rowHeight,A=c._29I,q=A.x,h=A.y,x=A.width,Q=A.height,Y=0;Y<n.size();Y++){var $=n.get(Y),J=$.startX,o=$.column,S=o.getWidth();if(o!==c._31o&&o!==c._4o&&p.x>=J&&p.x<J+S&&c.isCellEditable(I,o,E)){var N={x:J,y:c.getRowIndex(I)*_,width:S,height:_},W={x:N.x+c.tx(),y:N.y+c.ty(),width:N.width,height:N.height},H=0,K=0;return N.x<q?H=N.x-q:N.x+N.width>q+x&&(H=N.x+N.width-q-x),H&&(c.tx(c.tx()-H),W.x-=H),N.y<h?K=N.y-h:N.y+_>h+Q&&(K=N.y+_-h-Q),K&&(c.ty(c.ty()-K),W.y-=K),c.beginEditing({data:I,column:o,value:c.getValue(I,o),event:E,rect:N,editorRect:W,view:c}),void 0}}}},yn.BaseItemEditor=function(D,g,z,m){this._data=D,this._column=g,this._master=z,this._editInfo=m},Xq("BaseItemEditor",l,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Ap=E.Tab=function(){ii(Ap,this)};Eb("Tab",Xd,{ms_ac:["view","closable","disabled","visible"],_icon:o,_closable:!1,_disabled:!1,_visible:!0,setParent:eh});var Ce=E.Column=function(){ii(Ce,this)};Eb("Column",Xd,{_46o:1,ms_ac:["accessType","valueType",Tr,Ko,$m,Ij,"align",lq,"sortOrder",Rn,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Or,_sortFunc:o,_sortable:!0,_clickable:!0,setWidth:function(x){16>x&&(x=16);var s=this._width;this._width=x,this.fp(Ij,s,x)},getToolTip:function(D,c){return this.formatValue(c.getValue(D,this))}});var ig=E.Property=function(){ii(ig,this)};Eb("Property",Xd,{_46o:1,ms_ac:["accessType","valueType",Ko,$m,"categoryName",lq,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:o,getToolTip:function(m,U,J){var I=this;return U?I.formatValue(J.getValue(m,I)):J.getPropertyName(I)}}),yn.AccordionView=function(){var W=this;W._20o={},W._21o=new Fj,W._10o=o,W._9o=o,W._11o=o,W._view=kb(0,W),W.iv()},Xq("AccordionView",l,{ms_v:1,ms_fire:1,ms_ac:[Hb,Td,"titleHeight",ql,Qj,"titleBackground","selectWidth",cm,"orientation","separatorColor"],_expandIcon:N.accordionViewExpandIcon,_collapseIcon:N.accordionViewCollapseIcon,_titleHeight:kp,_labelColor:N.accordionViewLabelColor,_labelFont:N.accordionViewLabelFont,_titleBackground:N.accordionViewTitleBackground,_selectBackground:N.accordionViewSelectBackground,_selectWidth:N.accordionViewSelectWidth,_orientation:"v",_separatorColor:N.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(Y,b,T,g){var Z=this,t=Pd();if(Z._20o[Y])throw Y+" already exists";t.onmousedown=Ge,t.style.cursor=Nq,A(t,Tk?mi:Bn,function(y){Ge(y)}),A(t,Tk?Po:Xk,function(J){Ge(J),lg(J)&&(Z._10o===Y?Z.collapse():Z.expand(Y))}),xh(Z._view,t),Z._20o[Y]={content:b,div:t,canvas:ib(t),icon:g},Z._21o.add(Y),T&&Z.expand(Y),Z.iv()},remove:function($){var d=this,c=d._20o[$];c&&(tc(c.div),delete d._20o[$],d._21o.remove($),d.iv())},clear:function(){var F=this;F._21o.toArray().forEach(F.remove,F),F._20o={},F._21o.clear(),F.iv()},isExpanded:function(l){return this._10o===l},expand:function(H){var X=this;X._20o[H]&&X._10o!==H&&(X._10o=H,X.onExpanded(H),X.iv())},onExpanded:function(){},collapse:function(){var M=this;M._10o&&(M.onCollapsed(M._10o),delete M._10o,M.iv())},onCollapsed:function(){},initCanvas:function(Q,r,N){km(Q,r,N);var h=Vn(Q);return yr(h,0,0,1),h.clearRect(0,0,r,N),h},drawTitle:function(p,O,E,i,d){var G=this,q=ng(d.icon),C=G.isExpanded(O),f=G._titleHeight,K=G._titleBackground,l=G._selectWidth,B=G._separatorColor,x=ng(C?G._expandIcon:G._collapseIcon),b=l+4;xe(p,0,0,E,i,K),C&&l&&xe(p,0,0,l,i,G._selectBackground),(C||G._21o.get(G._21o.size()-1)!==O)&&xe(p,0,i-1,E,1,B?B:Sm(K)),q&&(Te(p,q,b+rr(q)/2,f/2),b+=rr(q)+2),qh(p,O,G.getLabelFont(O),G.getLabelColor(O),b,0,0,f),x&&Te(p,x,E-rr(x)/2-4,f/2)},validateImpl:function(){var O=this,P=O._view,L=0,Q=0,I=O.getWidth(),B=O.getHeight(),R=O._titleHeight,z=O._21o.size()*R,N=O._11o,F=O._9o;delete O._11o,delete O._9o,O._21o.each(function(o){var k,i,U=O._20o[o],V=U.content,H=O._10o===o;Xr(O)?(_o(U.div,L,0,R,B),k=O.initCanvas(U.canvas,R,B),te(k,0,B),Rh(k,-v),O.drawTitle(k,o,B,R,U),k.restore(),H?(i=r(0,I-z),V&&(O._11o=V,O._9o=mm(V),_o(V,L+R,0,i,B)),L+=R+i):L+=R):(_o(U.div,0,Q,I,R),k=O.initCanvas(U.canvas,I,R),O.drawTitle(k,o,I,R,U),k.restore(),H?(i=r(0,B-z),V&&(O._11o=V,O._9o=mm(V),_o(V,0,Q+R,I,i)),Q+=R+i):Q+=R)});var K=O._9o;N&&N!==O._11o&&N.endEditing&&N.endEditing(),K&&K!==F&&xh(P,K),F&&F!==K&&tc(F)}}),yn.SplitView=function(b,y,n,f){var W=this,j=W._dividerDiv=Pd(),B=W._60O=ib(),z=W._61O=ib(),D=B.style,F=z.style;W._view=kb(1,W),xh(W._view,j),D.msTouchAction=ud,D.pointerEvents=ud,D.cursor=Nq,F.msTouchAction=ud,F.pointerEvents=ud,F.cursor=Nq,b&&W.setLeftView(b),y&&W.setRightView(y),n&&W.setOrientation(n),f!=o&&W.setPosition(f),W.setStatus(qg),new Eo(W)},Xq("SplitView",l,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:N.splitViewDividerSize,_dividerBackground:N.splitViewDividerBackground,_dragOpacity:N.splitViewDragOpacity,_toggleIcon:N.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(N,L){var n=this,t=n._position;isNaN(N)||(L||(n._82O=0>N?-1:N>1?1:0),n._position=N,n.fp(ie,t,N))},getLeftView:function(){return this._leftView},setLeftView:function(I){var w=this,n=w._leftView,U=w._view;if(w._leftView!==I){if(n&&n!==w._rightView){var T=mm(n);T.parentNode===U&&tc(T)}if(w._leftView=I,I){var K=mm(I);K.parentNode!==U&&U.insertBefore(K,w._dividerDiv)}w.fp("leftView",n,I)}},getRightView:function(){return this._rightView},setRightView:function(P){var q=this,N=q._rightView,k=q._view;if(q._rightView!==P){if(N&&N!==q._leftView){var K=mm(N);K.parentNode===k&&tc(K)}if(q._rightView=P,P){var H=mm(P);H.parentNode!==k&&k.insertBefore(H,q._dividerDiv)}q.fp("rightView",N,P)}},validateImpl:function(){var g=this,p=g._draggable,N=g._position,F=g.getWidth(),U=g.getHeight(),H=g._dividerSize,k=g._dividerBackground,P=Tk?18:8,e=g._dividerDiv,O=g._82O,$=g._60O,o=g._61O,i=g._toggleIcon,J=g._status,c=e.style,S=null,A=Tk?20:4,K=i.comps[0];H>=P||0===H?g._coverDiv&&(tc(g._coverDiv),delete g._coverDiv):g._coverDiv||(g._coverDiv=Pd(),dl&&(g._coverDiv.style.background=Pp),xh(e,g._coverDiv)),g._togglable?$.parentNode||(xh(e,$),xh(e,o)):(tc($),tc(o));var f=g._coverDiv,l=g._leftView,u=g._rightView;if(Xr(g)){if(H>F&&(H=F),J===qg)if(1===O)var I=Q(N,F),T=r(0,F-H-I);else-1===O?(T=Q(-N,F),I=r(0,F-H-T)):(I=h((F-H)*N),T=r(0,F-H-I));else"cl"===J?(I=0,T=r(0,F-H)):"cr"===J&&(T=0,I=r(0,F-H));l&&_o(l,0,0,I,U),u&&_o(u,I+H,0,T,U),_o(e,I,0,H,U),g._22o=I,f&&(_o(f,H/2-P/2,0,P,U),f.style.cursor=p?Ac:""),e.style.cursor=p?Ac:"";var n=e.clientHeight/2,V=e.clientWidth;km($,V,V),_o($,0,n-V-A,V,V),S=Vn($),yr(S,0,0,1),K.rotation=-v,sq(S,i,0,0,V,V),S.restore(),km(o,V,V),_o(o,0,n+A,V,V),S=Vn(o),yr(S,0,0,1),K.rotation=v,sq(S,i,0,0,V,V),S.restore()}else{if(H>U&&(H=U),J===qg)if(1===O)var B=Q(N,U),M=r(0,U-H-B);else-1===O?(M=Q(-N,U),B=r(0,U-H-M)):(B=h((U-H)*N),M=r(0,U-H-B));else"cl"===J?(B=0,M=r(0,U-H)):"cr"===J&&(M=0,B=r(0,U-H));l&&_o(l,0,0,F,B),u&&_o(u,0,B+H,F,M),_o(e,0,B,F,H),g._22o=B,f&&(_o(f,0,H/2-P/2,F,P),f.style.cursor=p?Mh:""),c.cursor=p?Mh:"";var t=e.clientWidth/2,V=e.clientHeight;km($,V,V),_o($,t-V-A,0,V,V),S=Vn($),yr(S,0,0,1),K.rotation=0,sq(S,i,0,0,V,V),S.restore(),km(o,V,V),_o(o,t+A,0,V,V),S=Vn(o),yr(S,0,0,1),K.rotation=s,sq(S,i,0,0,V,V),S.restore()}c.background=k}});var Eo=function(Q){this.sv=Q,this.addListeners()};pk(Eo,l,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(K){var D=this,c=D.sv,I=c._dividerDiv,X=c._60O,i=c._61O,N=c._status,f=K.target;if(f===X)N===qg?c.setStatus("cl"):"cr"===N&&c.setStatus(qg);else if(f===i)N===qg?c.setStatus("cr"):"cl"===N&&c.setStatus(qg);else if(df(K)&&(f===I||f===c._coverDiv)&&(Ge(K),c.isDraggable())){c.getLeftView(),c.getRightView();var p=D.maskDiv=Pd();if(p.style.left=0,p.style.top=0,p.style.width=c.getWidth()+"px",p.style.height=c.getHeight()+"px",c.getView().appendChild(p),!c.isContinuousLayout()){var o=D.resizeDiv=Pd();o.style.left=I.style.left,o.style.top=I.style.top,o.style.width=I.style.width,o.style.height=I.style.height,o.style.opacity=c.getDragOpacity(),o.style.background=c.getDividerBackground(),xh(D.getView(),o)}D._lastAbsPosition=c._22o,D._86o=Xr(c)?uk(K).x:uk(K).y,Ho(D,K)}},handleWindowTouchMove:function(p){df(p)&&this.update(p,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(g){var H=this;H.update(g,!0),H.sv.setStatus(qg),H.maskDiv&&tc(H.maskDiv),H.resizeDiv&&tc(H.resizeDiv),H.maskDiv=H.resizeDiv=o},handle_mousedown:function(j){lg(j)&&this.handle_touchstart(j)},handleWindowMouseMove:function(u){this.handleWindowTouchMove(u)},handleWindowMouseUp:function(W){this.handleWindowTouchEnd(W)},update:function(x,X){var g=this,r=g.sv,B=Xr(r)?r.getWidth():r.getHeight(),q=r._dividerSize,c=g._lastAbsPosition-g._86o;Xr(r)?(c+=uk(x).x,c>B-q&&(c=B-q),0>c&&(c=0),g.resizeDiv&&(g.resizeDiv.style.left=c+Yg)):(c+=uk(x).y,c>B-q&&(c=B-q),0>c&&(c=0),g.resizeDiv&&(g.resizeDiv.style.top=c+Yg)),X&&B!==q&&(1===r._82O?r.setPosition(c,1):-1===r._82O?r.setPosition(c-B+q,1):r.setPosition(c/(B-q),1))}}),yn.TabView=function(){var $=this,C=$._view=kb(1,$),A=$._91O=Pd(1),I=$._tabModel=new gm,q=I.sm(),N=$.invalidate;$._7o=new Fj,$._canvas=ib(A),xh(C,A),xh(C,$._92O=Pd(1)),q.setSelectionMode(Wf),q.ms($.handleSelectionChange,$),I.mm(N,$),I.mh(N,$),I.md(N,$),$._interactor=new Qg($),$.iv()},Xq("TabView",l,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",ql,Qj,"tabHPadding","tabBackground","selectWidth",cm,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:md,_tabHeight:kp,_tabGap:N.tabViewTabGap,_labelColor:N.tabViewLabelColor,_labelFont:N.tabViewLabelFont,_tabBackground:N.tabViewTabBackground,_selectWidth:N.tabViewSelectWidth,_selectBackground:N.tabViewSelectBackground,_moveBackground:N.tabViewMoveBackground,_insertColor:N.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(D,v,f){var i,g=this._tabModel;return D instanceof Ap?(i=D,v&&i.setView(v)):(i=new Ap,i.setName(D),i.setView(v)),g.add(i),f&&g.sm().ss(i),i},getLabel:function(e){return e.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(_){this._23o=_,this.iv()},get:function(u){var D=this,a=D._tabModel;if(Ie(u))return a._roots.get(u);if(rb(u)){var I;return a.each(function(O){u===D.getLabel(O)&&(I=O)}),I}return u instanceof Ap?u:o},select:function(K){this._tabModel.sm().ss(this.get(K))},remove:function(_){var x=this;if(_=x.get(_)){var p=x._tabModel,T=p._roots.indexOf(_);x._tabModel.remove(_),x.selectByIndex(--T)}},getCurrentTab:function(){return this._8o},hideTabView:function(K,t){t.parentNode===this._92O&&(Jn(t)?(t.style.display=hg,t._tab_=K):tc(t),mh())},showTabView:function(v,M){Jn(M)&&(M.style.display="block",M._tab_=v),M.parentNode!==this._92O&&(xh(this._92O,M),mh())},_24o:function(){var h,Z=this,H=Z._8o,M=Z._9o,T=Z._tabModel.sm().ld();T&&(h=mm(T.getView())),h!==M&&(M&&(H.getView()&&H.getView().endEditing&&H.getView().endEditing(),Z.hideTabView(H,M)),h&&Z.showTabView(T,h)),Z._8o=T,Z._9o=h,H!==T&&Z.onTabChanged(H,T)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function($,k){this.selectByIndex(--k)},selectByIndex:function(y){var S=this,f=S._tabModel,$=f.size();if($&&!f.sm().ld()){y==o&&(y=0),y>=$&&(y=$-1),0>y&&(y=0);for(var K=y;K>=0;K--){var L=S.get(K);if(!L.isDisabled())return S.select(L),L}for(K=y+1;$>K;K++)if(L=S.get(K),!L.isDisabled())return S.select(L),L}},getTabWidth:function(M){var Y=this.getTabHPadding(),v=4+2*Y,A=ng(M.getIcon());A&&(v+=rr(A,M)+4);var J=this.getLabel(M);return J&&(v+=np(this.getLabelFont(M),J).width+4),M.isClosable()&&(v+=10),v},drawTab:function(S,x,E,Y,l,j,F){var Z,y=this,u=y._tabPosition,Q=this.getTabHPadding(),f=E+4+Q,d=y._selectWidth,H=ng(x.getIcon()),T=x.isDisabled(),M=y.getLabelColor(x),n=y.getLabelFont(x),C=y.getLabel(x),g=y._selectBackground,c=u===Ec+"-vertical",A=u===zn+"-vertical";(c||A)&&(f=Y+4+Q),T&&(S.globalAlpha=Lh),xe(S,E,Y,l,j,F),x===y._8o&&d&&(u===md?xe(S,E,Y+j-d,l,d,g):u===Ec?xe(S,E+l-d,Y,d,j,g):u===zn?xe(S,E,Y,d,j,g):c?xe(S,E+l-d,Y,d,j,g):A?xe(S,E,Y,d,j,g):xe(S,E,Y,l,d,g));var B=l/2;if(c&&(te(S,B,Y+j/2),Rh(S,s),te(S,-B,-Y-j/2)),H){var P=cc(H,x),X=rr(H,x);if(c||A){var p=E+l/2,$=f+P/2;te(S,p,$),Rh(S,v),te(S,-p,-$),Te(S,H,E+l/2,f+P/2,x,y),te(S,p,$),Rh(S,-v),te(S,-p,-$),f+=P+4}else Te(S,H,f+X/2,Y+j/2,x,y),f+=X+4}return c||A?(te(S,l/2,f+l/2),Rh(S,v),te(S,-l/2,-f-l/2),qh(S,C,n,M,E,f,j,l),te(S,l/2,f+l/2),Rh(S,-v),te(S,-l/2,-f-l/2)):qh(S,C,n,M,f,Y,l,j),c&&(te(S,B,Y+j/2),Rh(S,-s),te(S,-B,-Y-j/2)),x.isClosable()&&(Z=A?{x:E+l-12,y:Y+j-12,width:12,height:12}:{x:E+l-12,y:Y+2,width:12,height:12},this.drawCloseIcon(x,S,M,Z)),T&&(S.globalAlpha=1),Z},drawCloseIcon:function(l,q,B,I){var L=I.x,h=I.y;q.strokeStyle=B,q.lineWidth=1,q.beginPath(),q.moveTo(L+2,h+8),q.lineTo(L+8,h+2),q.moveTo(L+8,h+8),q.lineTo(L+2,h+2),q.stroke()},getTabAt:function(g){var I=this._interactor._8Q(g);return I?I.tab:null},validateImpl:function(){var M=this;M._24o();var $,x=M._canvas,V=M._tabPosition,T=M._91O,Y=M._92O,F=M._tabModel,k=M.getWidth(),u=M.getHeight(),P=M._tabHeight,j=M._7o,z=M._tabGap,D=V===md,N=V===Ec,p=V===zn,W=V===Ec+"-vertical",X=V===zn+"-vertical",I=M._23o,f=0;if((N||p)&&F._roots.each(function(b){f=r(M.getTabWidth(b),f)}),D?(_o(T,0,0,k,P),$={x:0,y:P,width:k,height:r(0,u-P)}):N?(_o(T,0,0,f,u),$={x:f,y:0,width:r(0,k-f),height:u}):p?(_o(T,k-f,0,f,u),$={x:0,y:0,width:r(0,k-f),height:u}):W?(_o(T,0,0,P,u),$={x:P,y:0,width:r(0,k-P),height:u}):X?(_o(T,k-P,0,P,u),$={x:0,y:0,width:r(0,k-P),height:u}):(_o(T,0,u-P,k,P),$={x:0,y:0,width:k,height:r(0,u-P)}),_o(Y,$),W||X){M._9o&&($.x=0,_o(M._8o.getView(),$)),km(x,P,u);var q=Vn(x),O=0;if(yr(q,0,M.ty(),1),q.clearRect(0,0,P,u),j.clear(),F._roots.each(function(y){if(y.isVisible()){var G,t=M.getTabWidth(y);I&&I.tab===y||(G=M.drawTab(q,y,0,O,P,t,M._tabBackground)),j.add({_75o:G,tab:y,startY:O,endY:O+t,height:t}),O+=t+z}}),M._23Q=r(0,O-z),I){var v=I.position;M.drawTab(q,I.tab,0,I.startY,P,I.height,M._moveBackground),xe(q,0,v,P,1,M._insertColor)}if(q.restore(),M._selectionChanged){M._selectionChanged=!1;for(var J=M.ty(),K=0;K<j.size();K++){var o=j.get(K);if(o.tab===M._8o){if(o.endY+J<0){M.ty(-o.startY);break}if(o.startY+J>u){M.ty(u-o.endY);break}}}}M.ty(M.ty())}else if(N||p){M._9o&&($.x=0,_o(M._8o.getView(),$)),km(x,f,u);var q=Vn(x),O=0;if(yr(q,0,M.ty(),1),q.clearRect(0,0,f,u),j.clear(),F._roots.each(function(K){if(K.isVisible()){var X;I&&I.tab===K||(X=M.drawTab(q,K,0,O,f,P,M._tabBackground)),j.add({_75o:X,tab:K,startY:O,endY:O+P,height:P}),O+=P+z}}),M._23Q=r(0,O-z),I){var v=I.position;M.drawTab(q,I.tab,0,I.startY,f,I.height,M._moveBackground),xe(q,0,v,f,1,M._insertColor)}if(q.restore(),M._selectionChanged){M._selectionChanged=!1;for(var J=M.ty(),K=0;K<j.size();K++){var o=j.get(K);if(o.tab===M._8o){if(o.endY+J<0){M.ty(-o.startY);break}if(o.startY+J>u){M.ty(u-o.endY);break}}}}M.ty(M.ty())}else{M._9o&&($.y=0,_o(M._8o.getView(),$)),km(x,k,P);var q=Vn(x),S=0;if(yr(q,M.tx(),0,1),q.clearRect(0,0,k,P),j.clear(),F._roots.each(function(A){if(A.isVisible()){var r,C=M.getTabWidth(A);I&&I.tab===A||(r=M.drawTab(q,A,S,0,C,P,M._tabBackground)),j.add({_75o:r,tab:A,startX:S,endX:S+C,width:C}),S+=C+z}}),M._64I=r(0,S-z),I){var v=I.position;M.drawTab(q,I.tab,I.startX,0,I.width,P,M._moveBackground),Kn(q,M._insertColor,v,0,P)}if(q.restore(),M._selectionChanged){M._selectionChanged=!1;for(var b=M.tx(),K=0;K<j.size();K++){var o=j.get(K);if(o.tab===M._8o){if(o.endX+b<0){M.tx(-o.startX);break}if(o.startX+b>k){M.tx(k-o.endX);break}}}}M.tx(M.tx())}for(var n=[],g=Y.children,K=0;K<g.length;K++){var h=g[K],Z=h._tab_;Z&&!F.contains(Z)&&n.push(h)}n.forEach(function(S){Y.removeChild(S)})}});var Qg=function(d){this.tv=d,this.addListeners()};pk(Qg,l,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(A){this.handleScroll(A,10*(A.wheelDelta/40))},handle_DOMMouseScroll:function($){this.handleScroll($,10*-$.detail)},handleScroll:function(K,m){Ge(K);var p=this.tv,i=p._tabPosition;!p._40o()||i!==md&&i!==Il||p.tx(this.tv.tx()+m),!p._41o()||i!==Ec&&i!==zn&&i!==Ec+"-vertical"&&i!==zn+"-vertical"||p.ty(this.tv.ty()+m)},_8Q:function(P){var t,Z,M=this.tv,d=M._tabPosition,g=M._7o;if(d===md||d===Il){var m=M.lp(P).x;for(t=0;t<g.size();t++)if(Z=g.get(t),Z.startX<=m&&m<=Z.endX)return Z}else if(d===Ec||d===zn||d===Ec+"-vertical"||d===zn+"-vertical"){var A=M.lp(P).y;for(t=0;t<g.size();t++)if(Z=g.get(t),Z.startY<=A&&A<=Z.endY)return Z}return o},isClickable:function(l){var O=this.tv,S=O._tabPosition,I=this._73o=this._8Q(l);return!O._40o()||S!==md&&S!==Il?!O._41o()||S!==Ec&&S!==zn&&S!==Ec+"-vertical"&&S!==zn+"-vertical"?I&&(!I.tab.isDisabled()||O.isMovable()):!0:!0},handle_mousemove:function(o){var e=this;Wc?e._74o=e._8Q(o):e.getView().style.cursor=e.isClickable(o)?Nq:""},handle_mousedown:function(z){this.handle_mousemove(z),this.handle_touchstart(z)},handle_touchstart:function(T){var X=this,s=X.tv,t=s._tabPosition;Ge(T),lg(T)&&X.isClickable(T)&&(t===md||t===Il?(X.x=uk(T).x,X.lp=s.lp(T),X.tx=s.tx()):(X.y=uk(T).y,X.lp=s.lp(T),X.ty=s.ty()),Ho(X,T))},handleWindowMouseMove:function(u){this.handleWindowTouchMove(u)},handleWindowTouchMove:function(Z){var V,x=this,N=x.tv,O=N._tabPosition,y=x._73o;if(O===md||O===Il){if(V=uk(Z).x-x.x,!x._25o&&!x.moving&&D(V)>2&&(N._40o()&&!Xl(Z)?x._25o=1:y&&N.isMovable()&&(x.moving=1)),x._25o)N.tx(x.tx+V);else if(x.moving){var j=x.lp.x+V,I=N._tabGap/2;N._7o.each(function(O){var U=O.endX,p=j-O.startX<U-j;j>=O.startX&&U>=j&&N._7Q({tab:y.tab,startX:y.startX+V,width:y.width,front:p,insertTab:O.tab,position:p?r(0,O.startX-I):Q(N._64I,U+I)})})}}else if(V=uk(Z).y-x.y,!x._25o&&!x.moving&&D(V)>2&&(N._41o()&&!Xl(Z)?x._25o=1:y&&N.isMovable()&&(x.moving=1)),x._25o)N.ty(x.ty+V);else if(x.moving){var R=x.lp.y+V,I=N._tabGap/2;N._7o.each(function(o){var a=o.endY,s=R-o.startY<a-R;R>=o.startY&&a>=R&&N._7Q({tab:y.tab,startY:y.startY+V,height:y.height,front:s,insertTab:o.tab,position:s?r(0,o.startY-I):Q(N._23Q,a+I)})})}},handleWindowMouseUp:function(B){this.handleWindowTouchEnd(B)},handleWindowTouchEnd:function(){var H=this,g=H.tv,T=g._tabPosition,Q=g.getTabModel(),y=Q._roots,u=H._73o;if(H.moving){var s=g._23o;if(s&&s.insertTab!==s.tab){var e=s.tab,J=y.remove(e),W=y.indexOf(s.insertTab);W>=0&&(s.front||W++,W<=y.size()&&(y.add(e,W),Q._38I(e,J,W)))}g._7Q(o),delete H.moving}else if(!H._25o&&u){e=u.tab;var v=H._74o;if(!v||v.tab===e)if(!e.isDisabled()&&Ib(u._75o,H.lp)){var K=function(){var W=y.indexOf(e);Q.remove(e),g.onTabClosed(e,W)};g.onTabClosing(e,K)&&K()}else e.isDisabled()||g._8o===e||Q.sm().ss(e)}H._25o=H._73o=H._74o=T===md||T===Il?H.x=H.lp=H.tx=o:H.y=H.lp=H.ty=o}}),yn.PropertyView=function(j){var n=this;n._view=kb(1,n),n._canvas=ib(n._view),xh(n._view,n._79O=Pd()),n._rows=new Fj,n._28o=new Fj,n._26o={},n._26Q={};var $=n._propertyModel=new gm,k=n.ivm;$.mm(k,n),$.md(k,n),$.mh(k,n),n.dm(j?j:new gm),new cg(n)},Xq("PropertyView",l,{ms_ac:[ql,Nn,Qj,Ko,$m,"categorizable",an,Rn,ll,Hb,Td,kj,ge,jo,"selectRowIndex",cm,"background",tj,Nm,Hc,Eq,un],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:qb,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Zb,_background:N.propertyViewBackground,_expandIcon:N.propertyViewExpandIcon,_collapseIcon:N.propertyViewCollapseIcon,_scrollBarColor:cl,_scrollBarSize:xl,_autoHideScrollBar:$d,_selectBackground:N.propertyViewSelectBackground,_rowHeight:Yb,_rowLineVisible:N.propertyViewRowLineVisible,_rowLineColor:N.propertyViewRowLineColor,_10I:.5,_columnLineVisible:N.propertyViewColumnLineVisible,_columnLineColor:N.propertyViewColumnLineColor,_labelColor:N.propertyViewLabelColor,_labelSelectColor:N.propertyViewLabelSelectColor,_labelFont:N.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(p){0>p&&(p=0),p>1&&(p=1);var l=this,E=l._10I;l._10I=p,l.fp("columnPosition",E,p)},getPropertyName:function(k){return k.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(d,e,A){return A===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function($,J){return J===this._selectRowIndex?this._labelSelectColor:$.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(R){var N=this.getHeight()-this._59I;return N>R&&(R=N),R>0?0:h(R)},isExpanded:function(o){if(!o)return!0;var p=this._26o[o];return p?p.isExpanded:!(this._26Q[o]===!1)},toggle:function(D){var F=this;F.isExpanded(D)?F.collapse(D):F.expand(D)},expandAll:function(){this.validate();for(var j in this._26o)this.expand(j)},expand:function(i){if(i&&i!==hg){var d=this,k=d._26o[i];k&&!k.isExpanded&&(k.isExpanded=!0,d.onExpanded(i),d.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var F in this._26o)this.collapse(F)},collapse:function(n){if(n&&n!==hg){var N=this,b=N._26o[n];b&&b.isExpanded&&(b.isExpanded=!1,N.onCollapsed(n),N.ivm())}},onCollapsed:function(){},getCategoryName:function(k){if(!this.isCategorizable())return hg;var T=k.getCategoryName();return T?T:hg},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(C){var x=this,$=x._dataModel;$!==C&&($&&($.umd(x.handlePropertyChange,x),x._selectionModel||$.sm().ums(x.handleSelectionChange,x)),x._dataModel=C,C.md(x.handlePropertyChange,x),x._selectionModel?x._selectionModel._21I(C):C.sm().ms(x.handleSelectionChange,x),x.fp(Nh,$,C))},isVisible:function(Z){return this._visibleFunc?this._visibleFunc(Z):!0},onPropertyChanged:function(r){var O=this,c=r.property;Zf[c]?O.ivm():O.iv(),c===zb&&O._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Ep},handlePropertyChange:function(x){this._27o===x.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var J=this;J._96I||(J.setSelectRowIndex(-1),J._96I=1,J.iv())},redraw:function(){this.iv()},validateModel:function(){var _=this,J=_._rows,G=_._28o,m={},H=new Fj,e=_._27o;_.updateCurrentData(),e!==_._27o&&_.endEditing(),J.clear(),G.clear(),_.getRawProperties().each(function(j){if(_.isVisible(j)){H.add(j);var b=_.getCategoryName(j);m[b]||(G.add(b,b===hg?0:S),m[b]={isExpanded:_.isExpanded(b),properties:new Fj})}}),_._sortFunc&&H.sort(_._sortFunc);for(var s in _._26o)_._26Q[s]=_.isExpanded(s);_._26o=m,G.each(function(W){W!==hg&&J.add(W);var Y=m[W];Y.isExpanded&&H.each(function($){_.getCategoryName($)===W&&(Y.properties.add($),J.add({property:$,data:_._27o}))},_)})},validateImpl:function(){var A=this;A._76o(),A._96I&&(A.validateModel(),delete A._96I);var H=A._canvas,T=A.getWidth(),p=A.getHeight(),I=-A.ty(),e=A._rowHeight,E=A._indent,l=T-E,$=A._rows,S=$.size(),i=A._9I=E+l*A._10I,V=A._59I=S*e;km(H,T,p),A._29I={x:0,y:I,width:T,height:p},A._31I=P(I/e),A._14I=Z((I+p)/e),A._31I<0&&(A._31I=0),A._14I>S&&(A._14I=S);var a,m=Vn(H),t=A._background;yr(m,0,-I,1),m.beginPath(),m.rect(0,I,T,p),m.clip(),m.clearRect(0,I,T,p),A._93db(m),t&&xe(m,0,0,E,V,t);for(var U=A._31I;U<A._14I;U++){var Y=$.get(U),I=e*U;if(rb(Y))t&&xe(m,E,I,l,e,t),a=ng(A.isExpanded(Y)?A._expandIcon:A._collapseIcon),a&&li(m,a,Ki,0,I,E,e),m.save(),m.beginPath(),m.rect(E,I,l,e),m.clip(),A.drawCategoryName(m,Y,U,E,I,l,e),m.restore();else{var n=Y.property,Q=Y.data,a=ng(n.getIcon()),f=A._selectRowIndex===U?A.getSelectBackground():o;if(a&&li(m,a,Ki,0,I,E,e),f&&xe(m,E,I,l,e,f),m.save(),m.beginPath(),m.rect(E,I,i-E,e),m.clip(),A.drawPropertyName(m,n,U,E,I,i-E,e),m.restore(),!A.isEditing(Q,n)){var D=i+1,z=T-i-1;m.save(),m.beginPath(),m.rect(D,I,z,e),m.clip(),A._87o(A.drawPropertyValue(m,n,A.getValue(Q,n),U,D,I,z,e,Q),U,D,I,z,e),m.restore()}}A._rowLineVisible&&xe(m,E,I+e-1,l,1,A._rowLineColor)}A._columnLineVisible&&(xe(m,i,0,1,V,A._columnLineColor),xe(m,T-1,0,1,V)),A._92db(m),A._93I(),m.restore(),A.ty(A.ty())},drawCategoryName:function(u,E,B,H,q,T,L){qh(u,E,this.getCategoryFont(E),this.getCategoryColor(E),H,q,T,L)},drawPropertyName:function(V,h,f,C,e,z,O){return h.drawPropertyName?(h.drawPropertyName(V,h,f,C,e,z,O,this),void 0):(qh(V,this.getPropertyName(h),this.getPropertyFont(h,f),this.getPropertyColor(h,f),C,e,z,O),void 0)},drawPropertyValue:function(E,F,c,N,S,u,H,U,y){return F.drawPropertyValue?F.drawPropertyValue(E,F,c,N,S,u,H,U,y,this):(Zp(E,c,F,this.getLabelFont(F,c,N),this.getLabelColor(F,c,N),S,u,H,U,y,this),void 0)},isPropertyEditable:function(S){return S.isEditable()&&this.isEditable()},setProperties:function(v){this._propertyModel.clear(),this.addProperties(v)},addProperties:function(w){if(w){var O=this._propertyModel;w.forEach(function(Y){if(!(Y instanceof ig)){var k=kn(Y.className);Y=ur(k?k:ig,Y)}O.add(Y)})}},getRowIndexAt:function(j){var b=this,w=P(b.lp(j).y/b._rowHeight);return w>=0&&w<b._rows.size()?w:-1},getPropertyAt:function(f){var y=this,v=y.getRowIndexAt(f);return v>=0?y._rows.get(v).property:o},getToolTip:function(x){var M=this,I=M.getPropertyAt(x),D=M._27o;return I&&D?I.getToolTip(D,M._9I<M.lp(x).x,M):o}});var cg=function(d){this.pv=d,this.addListeners()};pk(cg,l,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(e){this.getView().style.cursor=e},clear:function(){var b=this;b._62O=b.cp=b.ty=b.p=o,b.setCursor(pn)},handle_mousedown:function(G){this.handle_touchstart(G)},handle_touchstart:function(q){var O=this,S=O.pv;Ge(q),S.setFocus(q)&&(lg(q)?(O.cp=uk(q),O.ty=S.ty(),O.p=S.getColumnPosition(),O.handle_touchmove(q)):S.setSelectRowIndex(S.getRowIndexAt(q)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(K){this.handle_touchend(K)},handle_touchend:function(V){var L=this;if(L.cp&&!L._62O){var g=L.pv,s=g.lp(V),a=s.x,A=s.y,h=g._indent,e=g.getRowIndexAt(V),T=g._9I;if(e>=0){var Z=g._rowHeight,G=Z*e,F=g._rows.get(e),r=F.property;if(rb(F))ng(g.isExpanded(F)?g._expandIcon:g._collapseIcon)&&a>=0&&h>=a&&A>=G&&G+Z>=A?g.toggle(F):Yj(V)&&g.toggle(F);else if(a>T&&g.isPropertyEditable(r,V)){var D={x:T+1,y:G,width:g.getWidth()-T-1,height:Z},i={x:D.x+g.tx(),y:D.y+g.ty(),width:D.width,height:D.height},j=0,W=g._29I;D.y<W.y?j=D.y-W.y:D.y+Z>W.y+W.height&&(j=D.y+Z-W.y-W.height),j&&(g.ty(g.ty()-j),i.y-=j),g.beginEditing({data:F.data,property:r,value:g.getValue(F.data,r),event:V,rect:D,editorRect:i,view:g})}}g.setSelectRowIndex(e)}L.clear()},handleWindowMouseMove:function(e){this.handleWindowTouchMove(e)},handleWindowTouchMove:function(r){var K=this,J=K.pv,h=K.ty,$=K.cp,w=uk(r),N=K._62O;if("p"===N)J.setTranslateY(h+w.y-$.y);else if("c"===N){var Y=J.getWidth()-J._indent;if(Y>16){var b=K.p-($.x-w.x)/Y,R=16/Y;R>b&&(b=R),b>1-R&&(b=1-R),J.setColumnPosition(b)}}else"s"===N&&J.setTranslateY(h+($.y-w.y)*J._59I/J._29I.height)},handle_mousemove:function(i){this.handle_touchmove(i)},handle_touchmove:function(z){if(!Wc&&lg(z)){var W=this,U=W.pv,T=D(U.lp(z).x-U._9I)<=(Tk?8:3);W.cp?W._62O||(T?(W._62O="c",Ho(W)):D(uk(z).y-W.cp.y)>=2&&(W._62O=W.isV(z)?"s":"p",Ho(W))):(T?W.setCursor(Ac):W.setCursor(pn),W.isV(z)&&U._43o())}},isV:function(Z){var $=this.pv,M=$._29I;return $._41o()&&M.x+M.width-$.lp(Z).x<$p},handle_mousewheel:function(s){this.handleScroll(s,s.wheelDelta/40)},handle_DOMMouseScroll:function(G){2===G.axis&&this.handleScroll(G,-G.detail)},handleScroll:function(s,O){var A=this.pv;Ge(s),A.endEditing(),A.translate(0,O*A.getRowHeight())},handle_keydown:function(Q){var j=this.pv,L=j._rows.size(),a=j._selectRowIndex+(mr(Q)?-1:1);(mr(Q)||jn(Q))&&(0>a&&(a=0),a>=L&&(a=L-1),j.setSelectRowIndex(a))}}),yn.ListView=function(s){this._5o(s),new Hd(this)},Xq("ListView",l,{ms_ac:[ql,Nn,Qj,tj,an,Nm,Hc,Rn,ll,kj,ge,jo,wh,cm],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Zb,_rowHeight:Yb,_rowLineVisible:N.listViewRowLineVisible,_rowLineColor:N.listViewRowLineColor,_scrollBarColor:cl,_scrollBarSize:xl,_autoMakeVisible:Ip,_autoHideScrollBar:$d,_selectBackground:N.listViewSelectBackground,_labelColor:N.listViewLabelColor,_labelSelectColor:N.listViewLabelSelectColor,_labelFont:N.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(w){var v=this,O=v._checkMode;v._checkMode=w,v.fp(Zd,O,w)},drawRow:function(G,c,U,d,O,Y,$){var g=this,q=0,y=g._indent,x=g.getIconWidth(c);g.drawRowBackground(G,c,U,d,O,Y,$),g._checkMode&&(Te(G,ng(g.getCheckIcon(c)),q+y/2,O+$/2,c,g),q+=y),g.drawIcon(G,c,q,O,x,$),g.drawLabel(G,c,q+x,O,$)}});var Hd=function(s){this.list=s,this._lastSelectDataTime=Hg(),this.addListeners()};
pk(Hd,l,{ms_listener:1,getView:function(){return this.list._view},clear:function(_){var n=this,E=n.list;_&&"d"===n._62O&&!n.dragCancel&&E.handleDragAndDrop(_,"end"),E.draggingData&&(E.draggingData=null,E.redraw()),n.dragCancel=n._62O=n._isV=n._isH=n.cp=n.tx=n.ty=o},handle_mousedown:function(E){this.handle_touchstart(E)},handle_touchstart:function(t){var s=this,_=s.list;if(Ge(t),_.setFocus(t)){var u=_.getDataAt(t);s.cp=uk(t),s.tx=_.tx(),s.ty=_.ty(),lg(t)?u&&_.handleDragAndDrop&&!s.isV(t)&&!s.isH(t)&&(_.draggingData=u,_.redraw(),_.handleDragAndDrop(t,"prepare")):(u&&s._33o(t,u),s.clear(t))}},handleWindowMouseUp:function(Z){this.clear(Z)},handleWindowTouchEnd:function(L){this.clear(L)},handle_mouseup:function(Z){this.handle_touchend(Z)},handle_touchend:function(j){var E=this,I=E.list;if(!E._isV&&!E._isH&&E.cp&&!E._62O){var $=I.getDataAt(j);$?(I.isCheckMode()?E._34o(j,$):E._33o(j,$),Yj(j)?I.onDataDoubleClicked($,j):I.onDataClicked($,j)):I.handleBackgroundClick(j)}E.clear(j)},handleWindowMouseMove:function(R){this.handleWindowTouchMove(R)},handleWindowTouchMove:function(d){var N=this,m=N.list,T=N._62O,x=N.tx,z=N.ty,a=N.cp,q=uk(d),u=m._29I;"p"===T?m.setTranslate(x+q.x-a.x,z+q.y-a.y):"v"===T?m.ty(z+(a.y-q.y)*m._59I/u.height):"h"===T?m.tx(x+(a.x-q.x)*m._91I/u.width):"d"===T&&(N.dragCancel||m.handleDragAndDrop(d,"between"))},handle_mousemove:function(V){this.handle_touchmove(V)},handle_touchmove:function(b){if(!Wc&&lg(b)){var j=this,l=j.list;if(j._isV=j.isV(b),j._isH=j.isH(b),j.cp){if(!j._62O){if(Qm(uk(b),j.cp)<2)return;j._isV?j._62O="v":j._isH?j._62O="h":l.draggingData&&!this.dragCancel?(j._62O="d",l.handleDragAndDrop(b,"begin")):j._62O="p",j._62O&&"d"!==j._62O&&l.draggingData&&(l.draggingData=null,l.redraw()),Ho(j)}}else j._isV&&l._43o(),j._isH&&l._42o()}},isV:function(S){var Z=this.list,a=Z._29I;return Z._41o()&&a.x+a.width-Z.lp(S).x<$p},isH:function(J){var l=this.list,V=l._29I;return l._40o()&&V.y+V.height-l.lp(J).y<$p},handle_mousewheel:function(V){this.handleScroll(V,V.wheelDelta/40,V.wheelDelta!==V.wheelDeltaX)},handle_DOMMouseScroll:function(U){this.handleScroll(U,-U.detail,1)},handleScroll:function(V,F,y){var X=this.list;Ge(V),X.endEditing&&X.endEditing(),y&&X._41o()?X.translate(0,F*X.getRowHeight()):X._40o()&&X.translate(10*F,0)},handle_keydown:function(i){if(!N.isInput(i.target)){var W,m=this.list,b=m.sm(),t=m._rows,M=t.size();if(qo(i))m.selectAll();else if(Lc(i))m.handleDelete&&m.handleDelete(i);else if(Lq(i))"d"!==this._62O||this.dragCancel||(m.handleDragAndDrop(i,"cancel"),this.dragCancel=!0);else if(Pe(i))m.isCheckMode()&&(W=m.getFocusData(),W&&m.checkData(W));else if(mr(i)||jn(i)){var u=m.isCheckMode();if(W=u?m.getFocusData():b.ld()){var k=m.getRowIndex(W);k>=0&&(mr(i)?0!==k&&(W=t.get(k-1),u?m.setFocusData(W):b.ss(W)):k!==M-1&&(W=t.get(k+1),u?m.setFocusData(W):b.ss(W)))}else M>0&&(W=t.get(0),u?m.setFocusData(W):b.ss(W))}}},_34o:function(u,o){var D=this.list,K=D.lp(u).x;return K>=0&&K<=D._indent?(D.checkData(o),void 0):(D.setFocusData(o),void 0)},_33o:function(N,E){var $=this.list,v=$.sm(),x=v.ld();if(Xl(N))$.isSelected(E)?v.rs(E):v.as(E);else if($q(N))if(x)for(var A=$.getRowIndex(x),b=$.getRowIndex(E);A!==b;)A+=b>A?1:-1,v.as($._rows.get(A));else v.ss(E);else if(lg(N)){var l=Hg();if(v.contains(E)){var j=l-this._lastSelectDataTime;$.handleDataDoubleSelect&&j>500&&1500>j&&$.handleDataDoubleSelect(N,E)}v.ss(E),this._lastSelectDataTime=l}else v.contains(E)||v.ss(E)}}),yn.TreeView=function(R){var h=this;h._35o(),h._5o(R),new th(h)},Xq("TreeView",l,{ms_ac:[ql,Nn,Qj,"rootVisible",Zd,"rootData",Rn,ll,kj,ge,jo,an,tj,Nm,Hc,Hb,Td,wh,cm,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:o,_indent:Zb,_rowHeight:Yb,_rowLineVisible:N.treeViewRowLineVisible,_rowLineColor:N.treeViewRowLineColor,_scrollBarColor:cl,_scrollBarSize:xl,_autoHideScrollBar:$d,_expandIcon:N.treeViewExpandIcon,_collapseIcon:N.treeViewCollapseIcon,_autoMakeVisible:Ip,_selectBackground:N.treeViewSelectBackground,_labelColor:N.treeViewLabelColor,_labelSelectColor:N.treeViewLabelSelectColor,_labelFont:N.treeViewLabelFont,_doubleClickToToggle:N.treeViewDoubleClickToToggle,drawRow:function(u,d,c,n,T,N,Z){var p=this;p.drawRowBackground(u,d,c,n,T,N,Z),p._97I(u,d,c,0,T,N,Z)},isOnToggleIcon:function(U){var C=this.getDataAt(U);if(C){var x=this.getIndent(),i=this.lp(U).x;if(ng(this.getToggleIcon(C))){var u=x*this.getLevel(C);if(i>=u&&u+x>=i)return!0}}return!1}});var th=function(d){ii(th,this,[d])};pk(th,Hd,{toggle:function(Q,N,z,v){var U=this.list,G=U.lp(Q).x;if(ng(U.getToggleIcon(N))){var D=z*v;if(G>=D&&D+z>=G)return U.toggle(N),!0}return U.isDoubleClickToToggle()&&Yj(Q)?(U.toggle(N),!0):!1},_34o:function(E,e){var b=this.list,U=b.lp(E).x,I=b._levelMap[e._id],h=b._indent,V=h*(I+1);return U>=V&&V+h>=U?(b.checkData(e),void 0):(this.toggle(E,e,h,I)||b.setFocusData(e),void 0)},_33o:function(L,V){var T=this,e=T.list;if(!T.toggle(L,V,e._indent,e.getLevel(V)))if($q(L)){var X=e.sm();if(X.size()>0){for(var I=e._rows,S=null,l=0,E=I.size();E>l;l++)if(e.isSelected(I.get(l))){S=l;break}for(var i=null,l=I.size()-1;l>=0;l--)if(e.isSelected(I.get(l))){i=l;break}var A,s,u=e.getRowIndex(V);for(S>u?(A=u-1,s=S):u>i?(A=i,s=u):(A=S,s=i);A!==s;)A++,X.as(e._rows.get(A))}else X.ss(V)}else th.superClass._33o.call(T,L,V)},handle_keydown:function(g){if(Di(g)||vc(g)){var E=this.list,s=E._rows,Z=E.isCheckMode(),y=E.sm(),K=Z?E.getFocusData():y.ld();K?K.hasChildren()&&(Di(g)?E.collapse(K):E.expand(K)):s.size()>0&&(K=s.get(0),Z?E.setFocusData(K):y.ss(K))}else th.superClass.handle_keydown.call(this,g)}});var Jp=yn.TableView=function(d){this._98I(),this._5o(d),new bi(this)};Xq("TableView",l,{ms_ac:[ql,Nn,Qj,"sortMode",Ko,$m,tj,Nm,Hc,Eq,un,"sortColumn",Rn,ll,kj,ge,jo,wh,cm],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:hp,_editable:!0,_batchEditable:!1,_rowHeight:Yb,_rowLineVisible:N.tableViewRowLineVisible,_rowLineColor:N.tableViewRowLineColor,_columnLineVisible:N.tableViewColumnLineVisible,_columnLineColor:N.tableViewColumnLineColor,_scrollBarColor:cl,_scrollBarSize:xl,_autoHideScrollBar:$d,_autoMakeVisible:Ip,_selectBackground:N.tableViewSelectBackground,_labelColor:N.tableViewLabelColor,_labelSelectColor:N.tableViewLabelSelectColor,_labelFont:N.tableViewLabelFont,getCheckColumn:function(){var W=this;if(!W._31o){var P=W._31o=new Ce;P.setEditable(!0),P.setWidth(40),P.getValue=W.getCheckColumValue,P.drawCell=W.drawCheckColumnCell}return W._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(Z){var Y=this,U=Y._39o,S=Y.getCheckColumn();Z!==Y.isCheckMode()&&(Z?U.add(S,0):U.remove(S),Y.fp(Zd,!Z,Z))},getCheckColumValue:function(h,W,z){return z.isSelected(h)},drawCheckColumnCell:function(g,O,D,T,R,I,C,V,q){Te(g,q.getCheckIcon(O),R+C/2,I+V/2,O,q)}});var bi=function(P){ii(bi,this,[P])};pk(bi,Hd,{_34o:function(Z,S){var $=this.list,Q=$._31o;if($.isCellEditable(S,Q,Z)){var b=$._3Q(Q),v=$.lp(Z).x;if(b&&v>=b.startX&&v<b.startX+Q.getWidth())return $.checkData(S),void 0}$._37O(S,Z),$.setFocusData(S)},_33o:function(a,v){this.list._37O(v,a),bi.superClass._33o.apply(this,arguments)}});var vk=yn.TreeTableView=function(q){var W=this,N=W._4o=new Ce;W._35o(),W._98I(),W._5o(q),N.setDisplayName("Name"),N.setEditable(!0),N.setWidth(180),N.drawCell=Bs,N.getValue=Am,W._39o.add(N),new Sr(W)},Bs=function(B,L,c,a,n,R,K,w,p){p._97I(B,L,c,n,R,K,w)},Am=function(W,M,r){return r.getLabel(W)};Xq("TreeTableView",l,{ms_ac:[ql,Nn,Qj,"sortMode",Ko,$m,an,Zd,"rootData","rootVisible",Rn,ll,"sortColumn",Hb,Td,kj,ge,jo,wh,Hc,tj,Nm,Eq,un,cm,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:hp,_checkMode:o,_editable:!0,_batchEditable:!1,_indent:Zb,_rowHeight:Yb,_rowLineVisible:N.treeTableViewRowLineVisible,_rowLineColor:N.treeTableViewRowLineColor,_columnLineVisible:N.treeTableViewColumnLineVisible,_columnLineColor:N.treeTableViewColumnLineColor,_expandIcon:N.treeTableViewExpandIcon,_collapseIcon:N.treeTableViewCollapseIcon,_scrollBarColor:cl,_scrollBarSize:xl,_autoHideScrollBar:$d,_autoMakeVisible:Ip,_selectBackground:N.treeTableViewSelectBackground,_labelColor:N.treeTableViewLabelColor,_labelSelectColor:N.treeTableViewLabelSelectColor,_labelFont:N.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Sr=function(W){ii(Sr,this,[W])};pk(Sr,Hd,{_34o:function(J,U){var i=this.list,r=i._4o,T=i._3Q(r),o=i.lp(J).x;if(T){var h=i._indent,K=T.startX+h*i.getLevel(U);if(ng(i.getToggleIcon(U))&&o>=K&&K+h>=o)return i.toggle(U),void 0;if(i.isCellEditable(U,r)&&(K+=h,o>=K&&K+h>=o))return i.checkData(U),void 0}i._37O(U,J),i.setFocusData(U)},_33o:function(J,T){var p=this.list,O=p.lp(J).x;if(ng(p.getToggleIcon(T))){var h=p._3Q(p._4o);if(h){var F=p._indent,Q=h.startX+F*p.getLevel(T);if(O>=Q&&Q+F>=O)return p.toggle(T),void 0}}p._37O(T,J),Sr.superClass._33o.apply(this,arguments)}});var fe=yn.TableHeader=function(r){var W=this,e=W._view=kb(1,W),C=W._39o=r.getColumnModel(),F=W.iv;W.tv=W._tableView=r,W._60I=new Fj,W._canvas=ib(e),e.style.background=N.tableHeaderBackground||"",e.style.height=Ng+Yg,C.mm(F,W),C.md(F,W),C.mh(F,W),r.mp(function(J){fs[J.property]&&W.iv()},W),new sd(W),W.iv()};Xq("TableHeader",l,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",ql,Qj,an,"moveBackground","insertColor",Eq,un,"resizable","movable"],_checkIcon:He,_movable:!0,_resizable:!0,_labelColor:N.tableHeaderLabelColor,_labelFont:N.tableHeaderLabelFont,_columnLineColor:N.tableHeaderColumnLineColor,_columnLineVisible:N.tableHeaderColumnLineVisible,_sortDescIcon:N.tableHeaderSortDescIcon,_sortAscIcon:N.tableHeaderSortAscIcon,_moveBackground:N.tableHeaderMoveBackground,_insertColor:N.tableHeaderInsertColor,_indent:Zb,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(K){return K.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(v){return v.getColor()||this._labelColor},getLabelAlign:function(d){return d._align},onPropertyChanged:function(){this.iv()},_5Q:function(M){this._61I=M,this.iv()},getLogicalPoint:function(Q){return Zl(Q,this._canvas,this.tv.tx())},validateImpl:function(){var j=this,m=j._canvas,z=j.getWidth(),V=j.getHeight(),O=j.tv,F=j._60I,b=j._61I,$=-O.tx(),p=0;(z!==m.clientWidth||V!==m.clientHeight)&&km(m,z,V),F.clear(),j._39o._roots.each(function(H){if(H.isVisible()){var i=p+H.getWidth();$+z>=p&&i>=$&&F.add({column:H,startX:p}),p=i}});var W=Vn(m);if(yr(W,-$,0,1),W.beginPath(),W.rect($,0,z,V),W.clip(),W.clearRect($,0,z,V),F.each(function(C){var K=C.column,Q=C.startX,R=K.getWidth();R>0&&(W.save(),W.beginPath(),W.rect(Q,0,R,V),W.clip(),b&&b.column===K||j.drawColumn(W,K,Q,0,R,V),j._columnLineVisible&&xe(W,Q+R-1,0,1,V,j._columnLineColor),W.restore())}),b){var M=b.column,p=b.startX,D=b.position,n=M.getWidth();W.save(),W.beginPath(),W.rect(p,0,n,V),W.clip(),W.fillStyle=j._moveBackground,W.fill(),j.drawColumn(W,M,p,0,n,V),W.restore(),Kn(W,j._insertColor,D,0,V)}W.restore()},_6Q:function(b){var C=this.tv;return C._31o===b&&C.sm().getSelectionMode()===ys},drawColumn:function(E,O,Q,c,e,x){var W=this,v=W.tv,u=ng(O.getIcon()),F=W.getLabelAlign(O);if(W._6Q(O)){var s=ng(W._checkIcon);Te(E,s,Q+e/2,c+x/2,O,W)}else{var Z=W.getLabel(O),l=W.getLabelFont(O),C=W.getLabelColor(O),b=np(l,Z).width,g=u?W._indent:0;F===Ec?(u&&li(E,u,Ki,Q,c,g,x),qh(E,Z,l,C,Q+g,c,e,x,Ec)):F===zn?(u&&li(E,u,Ki,Q+e-b-g,c,g,x),qh(E,Z,l,C,Q,c,e,x,zn)):(u&&li(E,u,Ki,Q+(e-b-g)/2,c,g,x),qh(E,Z,l,C,Q+(e-b+g)/2,c,0,x,Ec))}if(O.isSortable()&&v.getSortColumn()===O&&(u=ng(O.getSortOrder()===Or?W._sortAscIcon:W._sortDescIcon))){var M=rr(u,O)/2+2;Te(E,u,F===zn?Q+M:Q+e-M,c+x/2,O,v)}}});var sd=function(L){var H=this;H.th=L,H.tv=L._tableView,H.addListeners()};pk(sd,l,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(R){this.getView().style.cursor=R},handle_mousemove:function(o){if(!Wc){var y=this;delete y._29o,y.setCursor(pn);for(var q=y.th,h=q._60I,$=q.lp(o).x,i=h.size()-1;i>=0;i--){var n=h.get(i),v=n.column,j=n.startX+v.getWidth();if(q.isResizable()&&D(j-$)<=(Tk?10:3))return y._29o=n,y.setCursor(Ac),void 0;$>n.startX&&j>$&&(y._29o=n),(v.isClickable()||v.isSortable()||q.isMovable()||y.tv.getCheckColumn&&v===y.tv.getCheckColumn())&&$>n.startX&&j>$&&y.setCursor(Nq)}}},handle_mousedown:function(D){this.handle_touchstart(D)},handle_touchstart:function(X){var B=this;Ge(X),B.tv.endEditing(),B.handle_mousemove(X),B._29o&&(B.x=uk(X).x,B.lx=B.th.lp(X).x,B.w=B._29o.column.getWidth(),Ho(B,X))},handleWindowMouseMove:function(g){this.handleWindowTouchMove(g)},handleWindowTouchMove:function(e){var F=this,I=F.th,W=F.getView().style.cursor,r=F._29o,y=uk(e).x-F.x;if(F.resizing||F.moving||(W===Ac?F.resizing=1:I.isMovable()&&W===Nq&&D(y)>2&&(F.moving=1)),F.resizing)r.column.setWidth(F.w+y);else if(F.moving){var s=F.lx+y;I._60I.each(function(v){var k=v.startX,x=k+v.column.getWidth();if(s>=k&&x>=s){var d={column:r.column,startX:r.startX+y,front:x-s>s-k,insertColumn:v.column};d.position=d.front?k:x,I._5Q(d)}})}},_16Q:function(V,h){var D=this,A=D.tv,E=D.th,U=E._checkIcon;if(E._6Q(V)){var c=ng(U),C=D.lx,I=V.getWidth(),z=rr(c,V);if(C>=h+I/2-z&&h+I/2+z>=C){E.setCheckIcon(U===We?He:We);var r=A.sm(),Q=A._rows;return U===We?r.rs(Q):r.ss(Q),A.onCheckColumnClicked(V),!0}}return!1},handleWindowMouseUp:function(K){this.handleWindowTouchEnd(K)},handleWindowTouchEnd:function(D){var b=this,p=b.tv,V=b.th,_=b._29o;if(b.moving){var A=V._61I;if(A&&A.insertColumn!==A.column){var l=A.column,q=p.getColumnModel()._roots,N=q.remove(l),Z=q.indexOf(A.insertColumn);Z>=0&&(A.front||Z++,Z<=q.size()&&(q.add(l,Z),p.getColumnModel()._38I(l,N,Z)))}V._5Q(o),delete b.moving}else if(!b.resizing&&_){l=_.column;var Q=V.lp(D).x,s=_.startX,X=!0;if(V.onColumnClicked){var j=V.onColumnClicked(l,D,s);j===!1&&(X=!1)}if(X&&Q>=s&&Q<=s+l.getWidth()&&!b._16Q(l,s)){if(l.isSortable()){var x=p.getSortMode(),R=l.getSortOrder();x===hp?p.getSortColumn()===l?(R===fi&&p.setSortColumn(o),l.setSortOrder(R===Or?fi:Or)):p.setSortColumn(l):"bistate"===x&&(p.getSortColumn()===l?l.setSortOrder(R===Or?fi:Or):p.setSortColumn(l))}p.onColumnClicked(l,D,s)}}b._29o=b.resizing=b.x=b.lx=b.w=o}}),yn.TablePane=function(c){this.init(new Jp(c))},Xq("TablePane",l,{ms_v:1,_44o:1}),yn.TreeTablePane=function(R){this.init(new vk(R))},Xq("TreeTablePane",l,{ms_v:1,_44o:1}),yn.Toolbar=function(y){var B=this,v=B._view=kb(1,B),T=v.style;T.background=N.toolbarBackground||"",T.height=kp+Yg,B._canvas=ib(v),B._30o=new Fj,B._90I=new Fj,B.setItems(y||[]),v.handleGroupSelectedChanged=function(M){if(M.isSelected()){var f=M.getGroupId();null!=f&&B._items.forEach(function(y){var d=y.element;d&&d!==M&&d.setSelected&&d.getGroupId&&d.getGroupId()===f&&d.setSelected(!1)})}},new Uj(B)},Xq("Toolbar",l,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[or,ql,Qj,Nn,cm,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:N.toolbarLabelColor,_labelSelectColor:N.toolbarLabelSelectColor,_labelFont:N.toolbarLabelFont,_selectBackground:N.toolbarSelectBackground,_itemGap:N.toolbarItemGap,_separatorColor:N.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(_){var R=this.getItemInfoAt(_);return R?R.item.toolTip:o},getLabelColor:function(E){return E&&E.selected&&E.type!==We&&E.type!==cp?this._labelSelectColor:this._labelColor},onPropertyChanged:function(f){this.iv(),f.property===or&&this._items.forEach(function(v){Fb(v)})},redraw:function(){this.iv()},addItem:function(e,h){var P=this._items;h==o?P.push(e):P.splice(h,0,e),this.fp(or,o,P)},removeItem:function(I){if(I)for(var $=this._items,B=0;B<$.length;B++)I===$[B]&&($.splice(B,1),this.fp(or,o,$))},removeItemById:function(k){if(k!=o)for(var r=this._items,z=0;z<r.length;z++)if(k===r[z].id){var W=r.splice(z,1)[0];return this.fp(or,o,r),W}},getItemById:function(i){if(i!=o)for(var y=this._items,w=0;w<y.length;w++){var $=y[w];if(i===$.id)return $}},setItemVisible:function(E,A){var q=this.getItemById(E);q&&(q.visible=A)},getItemInfos:function(){return this._30o},getItemInfoAt:function(p){var g=this,x=0,S=g._30o,y=g.lp(p),t=y.x,$=y.y;if($>=0&&$<=g.getHeight())for(;x<S.size();x++){var F=S.get(x);if(F.startX<=t&&t<=F.endX)return F}return o},drawItem:function(B,t,m,g,e){if(t.visible===!1)return 0;if(fd(t.visible)&&!t.visible())return 0;var y=this,p=t.disabled;p&&(B.globalAlpha=Lh);var P=y.drawItemImpl(B,t,m,g,e),h=y._itemGap;return p&&(B.globalAlpha=1),this._currentItem!==t||"separator"===t||t.separator===!0||t.unfocusable||Ml(B,y._separatorColor,m-h/2,0,P+h,g),P},drawItemImpl:function(C,H,f,n,b){var D=this,c=D._view,X=D._itemGap,W=n/2,J=H.type,K=H.element,A=H.label;rb(K)&&(A=K,K=o);var x,N=D.getLabelFont(H),l=D.getLabelColor(H),i=H.selected,U=ng(H.icon),I=rr(U,H),O=0,w=I+(A?np(N,A).width:0);if("separator"===H||H.separator===!0)return Kn(C,D._separatorColor,f,n/4,W),1;if(K){U&&Te(C,U,f+I/2,W,H,D),qh(C,A,N,l,f+I,0,0,n);var t=mm(K);b||D._90I.add(t),t.parentNode!==c&&xh(c,t),K.iv&&K.iv(),K.validate&&K.validate();var F=t.getBoundingClientRect(),e=F.width,M=t.style;return Kf(t),M.left=D.tx()+f+w+Yg,M.top=(n-F.height)/2+Yg,w+e}return J===cp?x=ng(i?kq:Hp):J===We&&(x=ng(i?We:He)),x?(O=rr(x,H),Te(C,x,f+O/2,W,H,D),f+=O,w+=O):i&&xe(C,f-X/2,0,w+X,n,D.getSelectBackground(H)),U&&Te(C,U,f+I/2,W,H,D),qh(C,A,N,l,f+I,0,0,n),w},validateImpl:function(){var m=this,M=m._canvas,l=m.getWidth(),y=m.getHeight(),G=m._30o,n=m._items;km(M,l,y);var h=Vn(M),$=m._itemGap,I=$/2;yr(h,m.tx(),0,1),h.clearRect(0,0,l,y);var c=m._90I;m._90I=new Fj,G.clear(),n.forEach(function(q){var E=m.drawItem(h,q,I,y);G.add({item:q,startX:I,endX:I+E,width:E}),E&&(I+=E+$)}),c.each(function(X){m._90I.contains(X)||tc(X)});var H=m._64I;m._64I=r(0,I),h.restore(),m._stickToRight?(m._65O=0,h=Vn(M),I=l-m._64I+$,yr(h,0,0,1),h.clearRect(0,0,l,y),G.clear(),n.forEach(function(A){var e=m.drawItem(h,A,I,y,!0);G.add({item:A,startX:I,endX:I+e,width:e}),e&&(I+=e+$)}),h.restore()):m.tx(m.tx()),H!==m._64I&&m.onSumWidthChanged(H,m._64I)},onSumWidthChanged:function(){},handleClick:function(W,M){var S=this,L=W.type,A=W.action,Y=W.groupId,a=W.selected;W.disabled||(Y!=o?a||(W.selected=!0,this._items.forEach(function(q){q.groupId===Y&&W!==q&&(q.selected=!1)}),A&&W.action(W,S,M)):L===We||"toggle"===L?(W.selected=!a,A&&W.action(W,S,M)):A&&W.action(W,S,M)),mh(),S.iv()}});var Uj=function($){this.tb=$,this.addListeners()};pk(Uj,l,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(F){this.handleScroll(F,10*(F.wheelDelta/40))},handle_DOMMouseScroll:function(R){this.handleScroll(R,10*-R.detail)},handleScroll:function(V,x){Ge(V);var l=this.tb;l.isScrollable()&&!l._stickToRight&&(l.tx(l.tx()+x),Ed())},handle_mousemove:function(n){var Z=this;Wc||Z.setItem(n)},handle_mouseout:function(F){var P=this;F.target===P.getView()?P.tb.setCurrentItem(o):P.handle_mousemove(F)},handle_mousedown:function(F){this.handle_mousemove(F),this.handle_touchstart(F)},handle_touchstart:function(X){var R=this,u=R.tb,g=X.target;lg(X)&&(g===R.getView()||g===u._canvas)&&(Ge(X),u.setFocus(X)&&(this.setItem(X,!0),(u.isScrollable()||R.info&&!R.info.item.disabled)&&(R.x=uk(X).x,R.tx=u.tx(),Ho(R,X))))},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(I){var E=this,V=E.tb;if(!V._stickToRight){var p=uk(I).x-E.x;!E._25o&&D(p)>2&&V.isScrollable()&&(E._25o=1),E._25o&&V.tx(E.tx+p)}},handleWindowMouseUp:function(n){this.handleWindowTouchEnd(n)},handleWindowTouchEnd:function(O){var t=this,W=t.tb,l=t.info,E=t.tb.getItemInfoAt(O);if(!t._25o&&l){var R=l.item;E&&E.item===R&&W.handleClick(R,O)}t._25o=t.x=t.tx=o,t.setItem()},setItem:function(e,B){var v=this,g=v.tb,f=v.info=e?g.getItemInfoAt(e):o,q=f?f.item:o;g.setCurrentItem(q),B&&q&&fd(q.onDown)&&q.onDown(e)}}),yn.BorderPane=function(){this._view=kb(1,this),this.iv()},Xq("BorderPane",l,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(V,B){this._12o("leftView",V),B!=o&&this.setLeftWidth(B)},getRightView:function(){return this._rightView},setRightView:function(N,T){this._12o("rightView",N),T!=o&&this.setRightWidth(T)},getTopView:function(){return this._topView},setTopView:function(Z,g){this._12o("topView",Z),g!=o&&this.setTopHeight(g)},getBottomView:function(){return this._bottomView},setBottomView:function(j,c){this._12o("bottomView",j),c!=o&&this.setBottomHeight(c)},getCenterView:function(){return this._centerView},setCenterView:function(o){this._12o("centerView",o)},_12o:function(S,Z){var T=this,K="_"+S,i=T._view,U=T[K];U!==Z&&(U&&(U.getView?tc(U.getView()):tc(U)),T[K]=Z,Z&&(Z.getView?xh(i,Z.getView(),1):xh(i,Z,1)),T.fp(S,U,Z))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var K=this,V=K._topView,z=K._bottomView,N=K._leftView,m=K._rightView,G=K._centerView,P=K.getWidth(),v=K.getHeight(),u=0,E=0,k=P,t=v,e=0,s=0,l=0,X=0;V&&(e=K._topHeight==o?Tp(V):K._topHeight,E=e),z&&(s=K._bottomHeight==o?Tp(z):K._bottomHeight,t=v-s),N&&(l=K._leftWidth==o?Jb(N):K._leftWidth,u=l),m&&(X=K._rightWidth==o?Jb(m):K._rightWidth,k=P-X);var Q=r(0,k-u),O=r(0,t-E);V&&_o(V,0,0,P,e),z&&_o(z,0,t,P,s),N&&_o(N,0,E,l,O),m&&_o(m,k,E,X,O),G&&_o(G,u,E,Q,O)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);