!function(g,Y,_){"use strict";var M=g.ht;M.Astar={},function(N){var n=N();g.AStar=n.astar,g.AStar.Graph=n.Graph}(function(){function T(M){for(var N=M,i=[];N.parent;)i.unshift(N),N=N.parent;return i}function k(){return new N(function(l){return l.f})}function v(B,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var j=0;j<B.length;j++){this.grid[j]=[];for(var Z=0,u=B[j];Z<u.length;Z++){var d=new m(j,Z,u[Z]);this.grid[j][Z]=d,this.nodes.push(d)}}this.$13x()}function m(L,y,e){this.x=L,this.y=y,this.weight=e}function N(t){this.content=[],this.scoreFunction=t}var h={search:function(e,x,Q,L){e.$6x(),L=L||{};var g=L.heuristic;g||(g=e.diagonal?h.$4x.diagonal:h.$4x.manhattan);var O=L.closest||!1,M=L.punish,N=k(),$=x;for(x.h=g(x,Q),e.$7x(x),N.push(x);N.size()>0;){var E=N.pop();if(E===Q)return T(E);E.closed=!0;for(var c=e.neighbors(E),V=0,X=c.length;X>V;++V){var C=c[V];if(!C.closed&&!C.$9x()){var m=E.g+C.getCost(E,M),K=C.visited;(!K||m<C.g)&&(C.visited=!0,C.parent=E,C.h=C.h||g(C,Q),C.g=m,C.f=C.g+C.h,e.$7x(C),O&&(C.h<$.h||C.h===$.h&&C.g<$.g)&&($=C),K?N.$10x(C):N.push(C))}}}return O?T($):[]},$4x:{manhattan:function(Z,w){var L=Math.abs(w.x-Z.x),j=Math.abs(w.y-Z.y);return L+j},diagonal:function(k,F){var R=1,j=Math.sqrt(2),C=Math.abs(F.x-k.x),E=Math.abs(F.y-k.y);return R*(C+E)+(j-2*R)*Math.min(C,E)}},$5x:function(D){D.f=0,D.g=0,D.h=0,D.visited=!1,D.closed=!1,D.parent=null}};return v.prototype.$13x=function(){this.dirtyNodes=[];for(var m=0;m<this.nodes.length;m++)h.$5x(this.nodes[m])},v.prototype.$6x=function(){for(var L=0;L<this.dirtyNodes.length;L++)h.$5x(this.dirtyNodes[L]);this.dirtyNodes=[]},v.prototype.$7x=function(G){this.dirtyNodes.push(G)},v.prototype.neighbors=function(Q){var o=[],Y=Q.x,H=Q.y,m=this.grid;return m[Y-1]&&m[Y-1][H]&&o.push(m[Y-1][H]),m[Y+1]&&m[Y+1][H]&&o.push(m[Y+1][H]),m[Y]&&m[Y][H-1]&&o.push(m[Y][H-1]),m[Y]&&m[Y][H+1]&&o.push(m[Y][H+1]),this.diagonal&&(m[Y-1]&&m[Y-1][H-1]&&o.push(m[Y-1][H-1]),m[Y+1]&&m[Y+1][H-1]&&o.push(m[Y+1][H-1]),m[Y-1]&&m[Y-1][H+1]&&o.push(m[Y-1][H+1]),m[Y+1]&&m[Y+1][H+1]&&o.push(m[Y+1][H+1])),o},v.prototype.toString=function(){for(var K=[],i=this.grid,N=0;N<i.length;N++){for(var s=[],y=i[N],S=0;S<y.length;S++)s.push(y[S].weight);K.push(s.join(" "))}return K.join("\n")},m.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},m.prototype.getCost=function(m,B){var v;if(v=m&&m.x!=this.x&&m.y!=this.y?1.41421*this.weight:this.weight,B){var y=m;if(!y)return v;var D=y.parent;return D?Math.abs(D.x+this.x-2*y.x)>1e-5?v+B:Math.abs(D.y+this.y-2*y.y)>1e-5?v+B:v:v}},m.prototype.$9x=function(){return 0===this.weight},N.prototype={push:function(O){this.content.push(O),this.$11x(this.content.length-1)},pop:function(){var c=this.content[0],B=this.content.pop();return this.content.length>0&&(this.content[0]=B,this.$12x(0)),c},remove:function(m){var M=this.content.indexOf(m),i=this.content.pop();M!==this.content.length-1&&(this.content[M]=i,this.scoreFunction(i)<this.scoreFunction(m)?this.$11x(M):this.$12x(M))},size:function(){return this.content.length},$10x:function(q){this.$11x(this.content.indexOf(q))},$11x:function(G){for(var o=this.content[G];G>0;){var O=(G+1>>1)-1,X=this.content[O];if(!(this.scoreFunction(o)<this.scoreFunction(X)))break;this.content[O]=o,this.content[G]=X,G=O}},$12x:function(d){for(var S=this.content.length,v=this.content[d],w=this.scoreFunction(v);;){var D,O=d+1<<1,a=O-1,U=null;if(S>a){var c=this.content[a];D=this.scoreFunction(c),w>D&&(U=a)}if(S>O){var q=this.content[O],s=this.scoreFunction(q);(null===U?w:D)>s&&(U=O)}if(null===U)break;this.content[d]=this.content[U],this.content[U]=v,d=U}}},{astar:h,Graph:v}});var p=M.Astar.Finder=function(o,l){var C=this;C.gv=o,C.$13x(l),C.refreshMap()};p.prototype={},p.prototype.constructor=p,Y.defineProperties(p.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(q){this.gv._astarDebugInfo=q}}}),p.prototype.$13x=function(I){var f=this,a=f.$14x={};I=I||{};var S=I.gridSize||10;a.gridSizeX=I.gridSizeX||S,a.gridSizeY=I.gridSizeY||S,a.rect=I.rect,a.filter=I.filter,a.extendBlocks=I.extendBlocks||3,a.fastOverlap=I.fastOverlap===_?!0:I.fastOverlap,a.nodeRectExtend=I.nodeRectExtend||0,a.diagonal=I.diagonal===_?!0:I.diagonal,a.turnPunish=I.turnPunish===_?.1:I.turnPunish,a.simplify=I.simplify===_?!0:I.simplify,a.toGridCenter=I.toGridCenter===_?!1:I.toGridCenter,a.closest=I.closest===_?!0:I.closest},p.prototype.refreshMap=function(){var s,e=this,c=e.$14x,T=c.gridSizeX,l=c.gridSizeY,D=c.extendBlocks;c.rect?s=c.rect:(s=e.$15x(),M.Default.grow(s,T*D,l*D)),M.Default.grow(s,T,l);var W=Math.floor(s.x/T)*T,q=Math.floor(s.y/l)*l,$=Math.ceil(s.width/T),R=Math.ceil(s.height/l),H=$*T,p=R*l;e.$16x={x:W,y:q,w:H,h:p,gridX:T,gridY:l,xLen:$,yLen:R},e.$17x(),e.$21x()},p.prototype.$15x=function(){var R=this.gv;if(R instanceof M.graph.GraphView)return R.getContentRect();var l,F=M.Default.unionRect;return R.dm().each(function(p){R.isVisible(p)&&p.getRect&&(l=F(l,p.getRect()))}),l},p.prototype.$17x=function(){var G,B,y,n,D=this,s=D.$16x,v=s.xLen,_=s.yLen;for(G=new Array(v),y=0;v>y;y++)for(G[y]=B=new Array(_),n=_;n--;)B[n]=1;var h=D.$14x.filter;for(D.gv.dm().each(function(l){h&&h(l)===!1||(!D._debugInfo||l!==D._debugInfo.grid&&l!=D._debugInfo.path)&&D.$1cw(G,l)}),y=0;v>y;y++)G[y][0]=1,G[y][_-1]=1;for(n=0;_>n;n++)G[0][n]=1,G[v-1][n]=1;D.grid=G;var u=new AStar.Graph(G,{diagonal:D.$14x.diagonal});D.graph=u},p.prototype.$18x=function(T,N,s,h,m,J,Y,K){var X=this.$19x,A=X(s-T,m-Y,h-N,J-K);if(1e-6>=A&&A>=-1e-6)return!1;var d=X(m-T,m-Y,J-N,J-K)/A;if(0>d||d>1)return!1;var P=X(s-T,m-T,h-N,J-N)/A;return 0>P||P>1?!1:!0},p.prototype.$19x=function(g,$,z,R){return g*R-$*z},p.prototype.$1aw=function(r,m,y,C){for(var L=[-(m[1]-r[1]),m[0]-r[0]],o=L[0]*(y[0]-r[0])+L[1]*(y[1]-r[1])>=0,W=0,$=C.length;$>W;W+=2)if(L[0]*(C[W]-r[0])+L[1]*(C[W+1]-r[1])>=0===o)return!1;return!0},p.prototype.$1bw=function(V,k){for(var G,d,y=this,f=0,e=V.length;e>f;f+=2)if(G=f===e-2?0:f+2,d=G===e-2?0:G+2,y.$1aw([V[f],V[f+1]],[V[G],V[G+1]],[V[d],V[d+1]],k))return!1;for(var f=0,e=k.length;e>f;f+=2)if(G=f===e-2?0:f+2,d=G===e-2?0:G+2,y.$1aw([k[f],k[f+1]],[k[G],k[G+1]],[k[d],k[d+1]],V))return!1;return!0},p.prototype.$1cw=function(u,Z){if(Z.getRect){var S=this,p=Z.getRect();M.Default.grow(p,S.$14x.nodeRectExtend);var w,J,E,$,e,V,F,o,x,G,n,X=S.$1dw({x:p.x,y:p.y}),H=S.$1dw({x:p.x+p.width,y:p.y+p.height}),j=S.$14x.fastOverlap;if(!j){var Q=Z.getCorners();F=[],Q.forEach(function(W){F.push(W.x,W.y)}),G=S.$14x.gridSizeX/2,n=S.$14x.gridSizeY/2}for(J=Math.max(0,X.x),E=Math.min(H.x,u.length-1),e=Math.max(0,X.y),V=Math.min(H.y,u.length?u[0].length-1:-1),w=J;E>=w;w++)for($=e;V>=$;$++)if(j)u[w][$]=0;else{x=S.$1ew({x:w,y:$});var i=x.x-G,D=x.x+G,k=x.y-n,d=x.y+n;o=[i,k,i,d,D,d,D,k],S.$1bw(F,o)&&(u[w][$]=0)}}},p.prototype.$1dw=function(Z,W){var C=this,V=C.$16x,n=(Z.x-V.x)/V.gridX,Q=(Z.y-V.y)/V.gridY;return W!==!1&&(n=Math.round(n),Q=Math.round(Q)),{x:n,y:Q}},p.prototype.$1ew=function(f){var j=this,w=j.$16x;return{x:f.x*w.gridX+w.x,y:f.y*w.gridY+w.y}},p.prototype.$1fw=function(k){var w=this,I=w.$16x,X=I.xLen,a=I.yLen;if(k.x>=0&&k.x<X&&k.y>=0&&k.y<a)return k;var x={x:k.x,y:k.y};return x.x<0?x.x=0:x.x>=X&&(x.x=X-1),x.y<0?x.y=0:x.y>=a&&(x.y=a-1),x},p.prototype.findPath=function(P,U){var v,A,V,Y,L=this,M=L.$1dw(P),m=L.$1dw(U);if(V=L.$1fw(M),Y=L.$1fw(m),V!==M&&Y!==m){var B=L.$16x,S=B.x-B.gridX/2,i=B.y-B.gridY/2,E=S+B.gridX*B.xLen,O=i+B.gridY*B.yLen;if(!(L.$18x(P.x,P.y,U.x,U.y,S,i,E,i)||L.$18x(P.x,P.y,U.x,U.y,E,i,E,O)||L.$18x(P.x,P.y,U.x,U.y,E,O,S,O)||L.$18x(P.x,P.y,U.x,U.y,S,O,S,i)))return[P,U]}V!==M&&(v=!0,M=V),Y!==m&&(A=!0,m=Y);var R=L.graph.grid[M.x][M.y],n=L.graph.grid[m.x][m.y],d=AStar.search(L.graph,R,n,{closest:L.$14x.closest,punish:L.$14x.turnPunish});if(!d||!d.length)return null;var l=[];l.push(P),v&&l.push(L.$1ew(d[0]));for(var y=1,e=d.length;e-1>y;y++)l.push(L.$1ew(d[y]));if(A)l.push(L.$1ew(d[e-1])),l.push(U);else{var z=d[e-1];m.x!==z.x||m.y!==z.y||L.$14x.toGridCenter?l.push(L.$1ew(z)):l.push(U)}return L.$14x.simplify&&(l=L.simplifyPath(l)),L.$20x=l,L.$21x(),l},p.prototype.debugOn=function(m){this.debugFlag=!0,this.debugSettings=m||{},this.$21x()},p.prototype.simplifyPath=function(C){var G=C.length;if(2>=G)return C;var _,u,P=[C[0],C[1]],S=P[0],M=P[1],d=1e-5;for(_=2;G>_;_++)u=C[_],Math.abs((M.x-S.x)*(u.y-S.y)-(M.y-S.y)*(u.x-S.x))<d?M=P[P.length-1]=u:(S=M,M=u,P.push(u));return P},p.prototype.$21x=function(){var a=this;if(a.$22x(),this.debugFlag){var l=a.grid;if(l){var L,k=a.gv;if(a.debugSettings.$16x!==!1){L=[];for(var C,I,v,x,j,y=[],Z=a.$14x.gridSizeX/2,n=a.$14x.gridSizeY/2,V=l.length,Q=V?l[0].length:0,i=1;V-1>i;i++)for(var W=1;Q-1>W;W++)l[i][W]||(C=a.$1ew({x:i,y:W}),I=C.x-Z,v=C.x+Z,x=C.y-n,j=C.y+n,L.push({x:I,y:x},{x:I,y:j},{x:v,y:j},{x:v,y:x}),y.push(1,2,2,2,5));var d=new M.Shape;d.s("shape.border.color","rgba(50, 50, 50, 0.2)"),d.s("shape.border.width",1),d.s("shape.background","rgba(200, 50, 100, 0.2)"),d.s("2d.editable",!1),d.s("2d.selectable",!1),d.setPoints(L),d.setSegments(y),a._debugInfo={grid:d},k.dm().add(d)}a.debugSettings.path!==!1&&(L=new M.Shape,a.$20x&&(L.setPoints(a.$20x),L.s("shape.border.color","red"),L.s("shape.border.width",1),L.s("2d.editable",!1),L.s("2d.selectable",!1),L.s("shape.background",null),a._debugInfo||(a._debugInfo={}),a._debugInfo.path=L,k.dm().add(L)))}}},p.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},p.prototype.$22x=function(){var A=this;if(A._debugInfo){var o=A._debugInfo.grid,x=A._debugInfo.path,y=A.gv;o&&y.dm().remove(o),x&&y.dm().remove(x),A._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);