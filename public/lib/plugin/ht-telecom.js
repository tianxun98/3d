!function(E,y){"use strict";var N=ht.AlarmSeverity=function(i,C,j,T,b){this.value=i,this.name=C,this.nickName=j,this.color=T,this.displayName=b};ht.Default.def("ht.AlarmSeverity",y,{toString:function(){return this.displayName||this.name}}),function(){N.severities=new ht.List,N._vm={},N._nm={},N._cp=function(I,X){if(I&&X){var G=I.value-X.value;return G>0?1:0>G?-1:0}return I&&!X?1:!I&&X?-1:0},N.each=function(H,Z){N.severities.each(H,Z)},N.getSortFunction=function(){return N._cp},N.setSortFunction=function(w){N._cp=w,N.severities.sort(w)},N.add=function(O,u,E,Q,V){var P=new N(O,u,E,Q,V);return N._vm[O]=P,N._nm[u]=P,N.severities.add(P),N.severities.sort(N._cp),P},N.remove=function(t){var j=N._nm[t];return j&&(delete N._nm[t],delete N._vm[j.value],N.severities.remove(j)),j},N.CRITICAL=N.add(500,"Critical","C","#FF0000"),N.MAJOR=N.add(400,"Major","M","#FFA000"),N.MINOR=N.add(300,"Minor","m","#FFFF00"),N.WARNING=N.add(200,"Warning","W","#00FFFF"),N.INDETERMINATE=N.add(100,"Indeterminate","N","#C800FF"),N.CLEARED=N.add(0,"Cleared","R","#00FF00"),N.isClearedAlarmSeverity=function(p){return p?0===p.value:!1},N.getByName=function(c){return N._nm[c]},N.getByValue=function(A){return N._vm[A]},N.clear=function(){N.severities.clear(),N._vm={},N._nm={}},N.compare=function(H,L){return N._cp(H,L)}}();var t=ht.AlarmState=function(U){this._d=U,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",y,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var c=null;for(var z in this._am)z=N.getByName(z),N.isClearedAlarmSeverity(z)||0!==this.getAcknowledgedAlarmCount(z)&&(c=c?N.compare(c,z)>0?c:z:z);this._haa=c},_c2:function(){var U=null;for(var u in this._nm)u=N.getByName(u),N.isClearedAlarmSeverity(u)||0!==this.getNewAlarmCount(u)&&(U=U?N.compare(U,u)>0?U:u:u);this._hna=U},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var O in this._nm)if(O=N.getByName(O),!N.isClearedAlarmSeverity(O)&&0!==this.getNewAlarmCount(O)&&N.compare(this._hna,O)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var d=this._haa,w=this._hna,F=this._ps;this._hoa=d,N.compare(w,this._hoa)>0&&(this._hoa=w),N.compare(F,this._hoa)>0&&(this._hoa=F)},_c5:function(){var G=this._haa,g=this._hna;this._hta=G,N.compare(g,this._hta)>0&&(this._hta=g)},increaseAcknowledgedAlarm:function(e,v){if(0!==v){v=v||1;var y=this._am[e.name]||0;y+=v,this._am[e.name]=y,this._f()}},increaseNewAlarm:function(n,$){if(0!==$){$=$||1;var K=this._nm[n.name]||0;K+=$,this._nm[n.name]=K,this._f()}},decreaseAcknowledgedAlarm:function(N,r){if(0!==r){r||(r=1);var f=this._am[N.name]||0;if(f-=r,0>f)throw"Alarm count can not be negative";this._am[N.name]=f,this._f()}},decreaseNewAlarm:function(c,T){if(0!==T){T||(T=1);var C=this._nm[c.name]||0;if(C-=T,0>C)throw"Alarm count can not be negative";this._nm[c.name]=C,this._f()}},acknowledgeAlarm:function(T){this.decreaseNewAlarm(T,1),this.increaseAcknowledgedAlarm(T,1)},acknowledgeAllAlarms:function(l){if(l){var x=this.getNewAlarmCount(l);this.decreaseNewAlarm(l,x),this.increaseAcknowledgedAlarm(l,x)}else for(var B in this._nm)this.acknowledgeAllAlarms(N.getByName(B))},_c6:function(){this._aac=0;for(var p in this._am)p=N.getByName(p),this._aac+=this.getAcknowledgedAlarmCount(p)},getAcknowledgedAlarmCount:function(h){return h?this._am[h.name]||0:this._aac},getAlarmCount:function(M){return this.getAcknowledgedAlarmCount(M)+this.getNewAlarmCount(M)},_c7:function(){this._nac=0;for(var n in this._nm)this._nac+=this.getNewAlarmCount(N.getByName(n))},getNewAlarmCount:function(r){return r?this._nm[r.name]||0:this._nac},setNewAlarmCount:function(e,z){this._nm[e.name]=z,this._f()},removeAllNewAlarms:function(x){x?delete this._nm[x]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,t){this._am[a.name]=t,this._f()},removeAllAcknowledgedAlarms:function(g){g?delete this._am[g.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(E){if(this._ep||(E=null),this._ps!==E){var i=this._ps;this._ps=E,this._f(),this._d.fp("propagateSeverity",i,E)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(C){var s=this._ep;this._ep=C,this._d.fp("enablePropagation",s,C)&&(C||this.setPropagateSeverity(null))}});var A=ht.AlarmStatePropagator=function(T){this._dataModel=T,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",y,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function($){this._enable!==$&&(this._enable=$,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(V){this.propagate(V)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(C){C.data&&this.propagate(C.data)},handleDataPropertyChange:function(r){if("alarmState"===r.property||"enablePropagation"===r.property)this.propagate(r.data);else if("parent"===r.property){var p=r.oldValue;p&&this.propagate(p),this.propagate(r.data)}},propagate:function(P){P&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(P),this._isPropagating=!1)},propagateToTop:function(q){for(this.propagateToParent(null,q);q&&q.getParent();)this.propagateToParent(q,q.getParent()),q=q.getParent()},propagateToParent:function(I,v){var z=null;v.getChildren().each(function(B){var K=B.getAlarmState().getHighestOverallAlarmSeverity();N.compare(K,z)>0&&(z=K)}),v.getAlarmState().setPropagateSeverity(z)}}),ht.AlarmStateStatistics=function(r){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(r)},ht.Default.def("ht.AlarmStateStatistics",y,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(P){var I=this._dataModel;I!==P&&(I&&(I.umd(this.handleDataPropertyChange,this),I.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=P,this.reset(),P.md(this.handleDataPropertyChange,this),P.mm(this.handleDataModelChange,this),this.fp("dataModel",I,P))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(E){"alarmState"===E.property&&(this.increase(E.data),this.fireAlarmStateChange())},handleDataModelChange:function(l){"add"===l.kind?(this.increase(l.data),this.fireAlarmStateChange()):"remove"===l.kind?(this.decrease(l.data),this.fireAlarmStateChange()):"clear"===l.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,N.each(function(z){var R=this.getSumInfo(z);this.sumAcked+=R.ackedCount,this.sumNew+=R.newCount,this.sumTotal+=R.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(D){if(!D)return this.sumNew;var K=this.getSumInfo(D);return K.newCount},getAcknowledgedAlarmCount:function(L){if(!L)return this.sumAcked;var u=this.getSumInfo(L);return u.ackedCount},getTotalAlarmCount:function(W){if(!W)return this.sumTotal;var Y=this.getSumInfo(W);return Y.totalCount},getSumInfo:function(g){var r=this.severtiyMap[g.name];return r||(r={},r.newCount=0,r.ackedCount=0,r.totalCount=0,this.severtiyMap[g.name]=r),r},decrease:function(q){var M=this.dataMap[q.getId()];M&&(delete this.dataMap[q.getId()],N.each(function(U){var c=M[U.name],L=this.getSumInfo(U);L.newCount=L.newCount-c.newCount,L.ackedCount=L.ackedCount-c.ackedCount,L.totalCount=L.totalCount-c.totalCount},this))},increase:function(q){if(this.decrease(q),!this._filterFunc||this._filterFunc(q)){var F={},w=q.getAlarmState();this.dataMap[q.getId()]=F,N.each(function(u){var l={};l.newCount=w.getNewAlarmCount(u),l.ackedCount=w.getAcknowledgedAlarmCount(u),l.totalCount=w.getAlarmCount(u),F[u.name]=l;var Y=this.getSumInfo(u);Y.newCount=Y.newCount+l.newCount,Y.ackedCount=Y.ackedCount+l.ackedCount,Y.totalCount=Y.totalCount+l.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(s){var v=this._filterFunc;this._filterFunc=s,this.reset(),this.fp("filterFunc",v,s)},getFilterFunc:function(){return this._filterFunc}});var r=ht.Data.prototype;r.getAlarmState=function(){return this._alarmState||(this._alarmState=new t(this))},r=ht.DataModel.prototype,r.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},r.setEnableAlarmStatePropagator=function(i){i!=this.isEnableAlarmStatePropagator()&&(i?(this._alarmStatePropagator=new A(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},r=ht.graph.GraphView.prototype,r.getNote2=function(R){var Z=R.getAlarmState().getHighestNewAlarmSeverity();if(Z){var y=R.getAlarmState().getNewAlarmCount(Z)+Z.nickName;return R.getAlarmState().hasLessSevereNewAlarms()&&(y+="+"),y}return R.s("note2")},r.getNote2Background=function(V){var m=V.getAlarmState().getHighestNewAlarmSeverity();return m?m.color:V.s("note2.background")},r.getBodyColor=function(I){var P=I.getAlarmState().getHighestNativeAlarmSeverity();return P?P.color:I.s("body.color")},r.getBorderColor=function(y){var D=y.getAlarmState().getPropagateSeverity();return D?D.color:y.s("border.color")},r=ht.widget.TreeView.prototype,r.getBorderColor=function(Z){var G=Z.getAlarmState().getPropagateSeverity();return G?G.color:Z.s("border.color")},r.getIcon=function(u){return u.getIcon()?"__alarmIcon__":null},r=ht.widget.TreeTableView.prototype,r.getBorderColor=function(B){var N=B.getAlarmState().getPropagateSeverity();return N?N.color:B.s("border.color")},r.getIcon=function(j){return j.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(Y){return Y.getIcon()}},color:{func:function(f){var p=f.getAlarmState().getHighestNativeAlarmSeverity();return p?p.color:f.s("body.color")}},rect:[0,0,16,16]}]});var b=ht.Style;b["note2.expanded"]=!0,b["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);