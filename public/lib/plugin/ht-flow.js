!function(q){"use strict";var B="ht",j=q[B],y=j.Default,r=Math,Y=r.PI,U=2*Y,O=r.sin,d=r.cos,p=r.atan2,A=r.sqrt,W=r.max,S=r.floor,l=(r.round,r.ceil),Q=r.abs,f=j.Shape,R=j.Edge,T=j.List,G=j.Style,J=j.graph,L=y.getInternal(),c=L.ui(),$=null,P="__segmentLengths",w="__lineTotalLength",D="__linePoints",g="__distance0",X="flow.count",k="flow.step",i="flow.element.max",m="flow.element.count",n="flow.element.min",M="flow.element.space",E="flow.element.autorotate",C="flow.element.background",x="flow.element.shadow.max",a="flow.element.shadow.min",e="flow.element.shadow.begincolor",s="flow.element.shadow.endcolor",u="flow.element.shadow.visible",Z="flow.element.image",H="flow",t="prototype",_=J.GraphView[t],z=j.Data[t],F=c.DataUI[t],o=c.ShapeUI[t],K=c.EdgeUI[t],V=j.DataModel[t],h=o._80o,I=K._80o,v=V.prepareRemove,N=K._79o,b=o._79o,gn=_.setDataModel,ej=function(m){return document.createElement(m)};_.calculatePointLength=function(c,Q,R){var d=this,k=d.getDataUI(c);R==$&&(R=.1);var p=co(k),m=[];if(p){for(var A=p.length,O=0;A>O;O++){var F=p[O];F._as&&(F=F._as);for(var s=F[0],T=1;T<F.length;T++)m.push([s,F[T]]),s=F[T]}for(var i=[],O=0;O<m.length;O++){var C=Jo(m[O][0],m[O][1],Q);i.push(C)}var t=i.slice(0);t.sort(function(X,M){return X.z>M.z?1:X.z<M.z?-1:0});var L=t[0];if(L.z<R){for(var J=i.indexOf(L),X=0,O=0;J>=O;O++)X+=J>O?y.getDistance(m[O][0],m[O][1]):y.getDistance(m[O][0],L);return X}}},y.calculatePointLength=function(k,M,V,w){w==$&&(w=.1);var x=co($,k,M),M=[];if(x){for(var n=x.length,G=0;n>G;G++){var s=x[G];s._as&&(s=s._as);for(var Y=s[0],U=1;U<s.length;U++)M.push([Y,s[U]]),Y=s[U]}for(var E=[],G=0;G<M.length;G++){var f=Jo(M[G][0],M[G][1],V);E.push(f)}var Z=E.slice(0);Z.sort(function(_,p){return _.z>p.z?1:_.z<p.z?-1:0});var H=Z[0];if(H.z<w){for(var N=E.indexOf(H),d=0,G=0;N>=G;G++)d+=N>G?y.getDistance(M[G][0],M[G][1]):y.getDistance(M[G][0],H);return d}}},_.calculateClosestPoint=function(g,U){var C=this,W=C.getDataUI(g),Y=co(W),j=[];if(Y){for(var p=Y.length,f=0;p>f;f++){var m=Y[f];m._as&&(m=m._as);for(var n=m[0],l=1;l<m.length;l++)j.push([n,m[l]]),n=m[l]}for(var i=[],f=0;f<j.length;f++){var H=Jo(j[f][0],j[f][1],U);i.push(H)}return i.sort(function(z,Q){return z.z>Q.z?1:z.z<Q.z?-1:0}),i[0]}},y.calculateClosestPoint=function(e,d,G){var l=co($,e,d),d=[];if(l){for(var r=l.length,Z=0;r>Z;Z++){var P=l[Z];P._as&&(P=P._as);for(var Q=P[0],j=1;j<P.length;j++)d.push([Q,P[j]]),Q=P[j]}for(var s=[],Z=0;Z<d.length;Z++){var Y=Jo(d[Z][0],d[Z][1],G);s.push(Y)}return s.sort(function(K,k){return K.z>k.z?1:K.z<k.z?-1:0}),s[0]}},_.getPercentAngle=function(z,C){var G=this,j=G.getDataUI(z),J=z.getRotation?z.getRotation():0,w=co(j);if(w)if(0===C){var x=w[0][0],r=w[0][1];J+=p(r.y-x.y,r.x-x.x)}else if(100===C){w=w[w.length-1];var x=w[w.length-2],r=w[w.length-1];J+=p(r.y-x.y,r.x-x.x)}else{for(var L=0,Y=[],y=w.length,E=0;y>E;E++){var i=w[E],M=Ao(i);L+=M,Y.push(M)}for(var X=L*C/100,q=ns(X,Y),Q=0,I=0;q>I;I++)Q+=Y[I];X-=Q;for(var U=qd(w[q],X),W=w[q],N=0,f=0,t=0;t<W.length-1;t++){var Z=W[t],l=W[t+1],m=l.x-Z.x,o=l.y-Z.y,K=A(m*m+o*o);if(N+=K,N>X){f=t;break}}var T=W[f];J+=p(U.y-T.y,U.x-T.x)}return J},y.getPercentAngle=function(s,Y,R){var h=0,w=co($,s,Y);if(w)if(0===R){var v=w[0][0],V=w[0][1];h+=p(V.y-v.y,V.x-v.x)}else if(100===R){w=w[w.length-1];var v=w[w.length-2],V=w[w.length-1];h+=p(V.y-v.y,V.x-v.x)}else{for(var O=0,c=[],X=w.length,q=0;X>q;q++){var o=w[q],P=Ao(o);O+=P,c.push(P)}for(var W=O*R/100,F=ns(W,c),J=0,f=0;F>f;f++)J+=c[f];W-=J;for(var r=qd(w[F],W),i=w[F],k=0,G=0,K=0;K<i.length-1;K++){var I=i[K],z=i[K+1],t=z.x-I.x,n=z.y-I.y,M=A(t*t+n*n);if(k+=M,k>W){G=K;break}}var d=i[G];h+=p(r.y-d.y,r.x-d.x)}return h},_.calculateLength=function(R){var v=this,X=v.getDataUI(R),p=co(X),i=0;if(p)if(Array.isArray(p[0]))for(var N=p.length,P=0;N>P;P++){var z=p[P],q=Ao(z);i+=q}else i=Ao(p);return i},y.calculateLength=function(c,v){var c=co($,c,v),b=0;if(c)if(Array.isArray(c[0]))for(var a=c.length,Q=0;a>Q;Q++){var x=c[Q],B=Ao(x);b+=B}else b=Ao(c);return b};var Jo=y.calculateClosestPointOnLine=function(n,M,r){var K=n.x,D=n.y,g=M.x,H=M.y,A=r.x,j=r.y,p={},Q=g-K,V=H-D,I=Math.sqrt(Q*Q+V*V),t=Q/I,S=V/I,R=(-K+A)*t+(-D+j)*S;return p.x=K+R*t,p.y=D+R*S,Gd(p,n,M)||(p.x=Math.abs(p.x-n.x)<Math.abs(p.x-M.x)?n.x:M.x,p.y=Math.abs(p.y-n.y)<Math.abs(p.y-M.y)?n.y:M.y),Q=A-p.x,V=j-p.y,p.z=Math.sqrt(Q*Q+V*V),p},Gd=function($,e,p){return $.x>=Math.min(e.x,p.x)&&$.x<=Math.max(e.x,p.x)&&$.y>=Math.min(e.y,p.y)&&$.y<=Math.max(e.y,p.y)},Ao=function(S){for(var o=0,Z=S.length-1,R=0;Z>R;R++){var r=S[R],h=S[R+1],I=h.x-r.x,X=h.y-r.y,K=A(I*I+X*X);o+=K}return o},qd=function(B,T){for(var P=0,V=0,J=0,X=B.length-1,c=0;X>c;c++){var u=B[c],N=B[c+1],G=N.x-u.x,b=N.y-u.y;if(J=A(G*G+b*b),P+=J,P>T){P-=J,V=c;break}}var S=B[V],K=B[V+1],Q=p(K.y-S.y,K.x-S.x),H=T-P,b=O(Q)*H,G=d(Q)*H;return{x:S.x+G,y:S.y+b}},Aq=function(Z,F,x,E){var G=d(E),X=O(E),a=G*F-X*x,$=X*F+G*x;return Z?{x:Z.x+a,y:Z.y+$}:{x:a,y:$}},mq=function(h,x){h[P]=h[w]=h[D]=x[g]=$},ir=function(s,a,p,k,X,z){var L,e,D,J,m,x,u,i,M,h,q,$=[];if(Q(k)>U&&(k=U),m=l(Q(k)/(Y/4)),L=k/m,e=-L,D=-p,m>0){x=s+d(p)*X,u=a+O(-p)*z,$.push({x:x,y:u});for(var j=0;m>j;j++)D+=e,J=D-e/2,i=s+d(D)*X,M=a+O(D)*z,h=s+d(J)*(X/d(e/2)),q=a+O(J)*(z/d(e/2)),$.push({x:h,y:q}),$.push({x:i,y:M})}return $},co=function(d,I,V){if(I==$){var z=d._data;if(z instanceof f){if(I=z.getPoints(),V=z.getSegments(),(!V||0===V.size())&&I){V=new j.List([1]);for(var Q=1;Q<I.size();Q++)V.add(2)}}else if(z instanceof R){var c=d._78o;if(c){var a=c.type,t=c.points,H=c.segments,i=c.edgeTypeInfo;if(!a||t){var F=c.sourcePoint,A=F.x,p=F.y,u=c.targetPoint,v=u.x,s=u.y;if(a)H?(I=new T({x:A,y:p}),I.addAll(t),I.add({x:v,y:s}),V=new T(H._as)):(I=new T({x:A,y:p}),V=new T([1]),t.each(function(t){I.add(t),V.add(2)}),I.add({x:v,y:s}),V.add(2));else if(c.looped){I=new T(ir(A,p,0,U,c.radius,c.radius)),V=new T([1]);for(var Q=0;Q<(I.size()-1)/2;Q++)V.add(3)}else I=new T,c.center?(I.add({x:c.c1.x,y:c.c1.y}),I.add({x:A,y:p}),I.add({x:v,y:s}),I.add({x:c.c2.x,y:c.c2.y}),V=new T([1,2,2,2])):(I.add({x:A,y:p}),I.add({x:v,y:s}),V=new T([1,2]))}else if(i)if(I=new T(i.points._as),i.segments)V=new T(i.segments._as);else{V=new T([1]);for(var Q=1;Q<i.points.size();Q++)V.add(2)}}}}if(I){if(Array.isArray(I)&&(I=new T(I)),"number"==typeof I.get(0)){for(var q=new j.List,Q=0;Q<I.size();Q+=2)q.add({x:I.get(Q),y:I.get(Q+1)});I=q}if(!V){V=[];for(var Q=0;Q<I.size();Q++)0===Q?V.push(1):V.push(2)}Array.isArray(V)&&(V=new T(V));for(var _=L.toPointsArray(I._as,V._as,50),M=_.length,O=[],Q=0;M>Q;Q++){var P=_[Q];P.length>1&&O.push(P)}return O}},Ln=function(c){var g=c._data,N=co(c);if(N){g.s("flow.reverse")&&(N.reverse(),N.forEach(function(t){t.reverse()}));for(var q=0,U=[],l=N.length,E=0;l>E;E++){var B=N[E],M=Ao(B);q+=M,U.push(M)}if(g[P]=U,g[w]=q,g[D]=N,g instanceof R){var t=y.unionPoint(N),x=t.x+t.width/2,K=t.y+t.height/2;g.$10e={x:x,y:K}}ye(c,!0)}},ye=(y.getPercentPositionOnPoints=function(M,c,w){if(M){var C=co($,M,c);if(C){var S;if(0===w)S=C[0][0];else if(100===w)C=C[C.length-1],S=C[C.length-1];else{for(var O=0,l=[],Z=C.length,_=0;Z>_;_++){var v=C[_],z=Ao(v);O+=z,l.push(z)}for(var X=O*w/100,U=ns(X,l),m=0,K=0;U>K;K++)m+=l[K];X-=m,S=qd(C[U],X)}return S}}},_.getPercentPosition=function(I,U){var c=this,Z=c.getDataUI(I),y=co(Z);if(y){var N;if(0===U)N=y[0][0];else if(100===U)y=y[y.length-1],N=y[y.length-1];else{for(var e=0,Q=[],m=y.length,H=0;m>H;H++){var D=y[H],d=Ao(D);e+=d,Q.push(d)}for(var g=e*U/100,Y=ns(g,Q),R=0,s=0;Y>s;s++)R+=Q[s];g-=R,N=qd(y[Y],g)}return N}},function(s,Q){var d=s._data,h=d[w],W=d.s(X),b=d.s(k),H=0,R=d[P],z=d.s(i),o=d.s(n),u=d.s(m),c=(z-o)/(u-1),v=[];if(R){if(1===u)v.push(z);else if(2===u)v.push(z),v.push(o);else{if(!(u>2))return;v.push(z);for(var D=u-2;D>0;D--)v.push(o+c*D);v.push(o)}var t=0,S=0;v.forEach(function(H){u-1>t&&(S+=d.getFlowElementSpace(H)),t++}),S+=(z+o)/2,H=(h-W*S+S)/W;var I=s[g];for(null==I&&(I=0),Q||(I+=b);I>h+S;){var N=s._overCount;N?N++:N=1,N>=W&&(N=null),s._overCount=N,d.s("flow.autoreverse")?N?I-=H+S:(I=0,d.s("flow.reverse",!d.s("flow.reverse"))):I-=H+S}s[g]=I}}),Sk=function(y){var b=y.data,w=this.dm();if(b&&"add"===y.kind){var S=w.$3e;S&&b.s(H)&&S.indexOf(b)<0&&S.push(b)}"clear"===y.kind&&(w.$3e=[])},Qr=function(X){var D=X.property,G=X.data,H=X.newValue,W=this.dm().$3e;if(W&&"s:flow"===D)if(H)W.indexOf(G)<0&&W.push(G);else for(var E=W.length,s=0;E>s;s++)if(W[s]===G){W.splice(s,1);break}},ns=ns=function($,Z){for(var B=0,N=Z.length,t=0;N>t;t++){var O=Z[t];if(B+=O,B>$)return t}return Math.min(t,N-1)},Ee=function(Q){var z=this,Z=z._data,C=Z[w],H=Z[P],r=Z[D],B=Z.s(X),y=0,t=z[g],e=Z.s(i),h=Z.s(n),O=Z.s(m),d=Z.s(a),s=Z.s(x),T=Z.s(E),Y=(s-d)/(O-1),K=(e-h)/(O-1),j=Z.getRotation?Z.getRotation():0,M=Z.getPosition?Z.p():Z.$10e,L=[],W=[];if(t!=$){if(1===O)L.push(e);else if(2===O)L.push(e),L.push(h);else{if(!(O>2))return;L.push(e);for(var b=O-2;b>0;b--)L.push(h+K*b);L.push(h)}if(1===O)W.push(s);else if(2===O)W.push(s),W.push(d);else{if(!(O>2))return;W.push(s);for(var b=O-2;b>0;b--)W.push(d+Y*b);W.push(d)}var o=0,I=0;L.forEach(function(p){O-1>o&&(I+=Z.getFlowElementSpace(p)),o++}),I+=(e+h)/2,y=(C-B*I+I)/B,Q.save();for(var b=0;B>b;b++){var G=t,v=0,l=z._overCount,J=0;Z.s("flow.autoreverse")&&l&&l>B-(b+1)||(G-=b*(y+I),o=0,L.forEach(function(E){var h=G-v;if(h>=0&&C>h){var y=!0,g=ns(h,H);J=0;for(var _=0;g>_;_++)J+=H[_];if(h-=J,y){var u=qd(r[g],h),O=j;if(T){for(var I=r[g],V=0,F=0,$=0;$<I.length-1;$++){var S=I[$],f=I[$+1],i=f.x-S.x,k=f.y-S.y,N=A(i*i+k*k);if(V+=N,V>h){F=$;break}}var P=I[F];O+=p(u.y-P.y,u.x-P.x)}j&&(u=Aq(M,u.x-M.x,u.y-M.y,j)),z.$5e(Q,u,E,W[o],O)}}v+=Z.getFlowElementSpace(L[o]),o++}))}Q.restore()}},sd=function(){var M=this,a=M._data,B=a.s(i),Q=!1,q=$;if(M._6I||(Q=!0),q=a instanceof R?N.call(M):b.call(M),a.s(H)&&Q){var T=a.s(x),k=a.s(u);k&&T>B&&(B=T),B>0&&y.grow(q,l(B/2)),Ln(M)}return!a.s(H)&&Q&&mq(a,M),q};z.getFlowElementSpace=function(){return this.s(M)},o._79o=sd,K._79o=sd,G[i]==$&&(G[i]=7),G[n]==$&&(G[n]=0),G[X]==$&&(G[X]=1),G[k]==$&&(G[k]=3),G[m]==$&&(G[m]=10),G[M]==$&&(G[M]=3.5),G[E]==$&&(G[E]=!1),G[C]==$&&(G[C]="rgba(255, 255, 114, 0.4)"),G[e]==$&&(G[e]="rgba(255, 255, 0, 0.3)"),G[s]==$&&(G[s]="rgba(255, 255, 0, 0)"),G[u]==$&&(G[u]=1),G[x]==$&&(G[x]=22),G[a]==$&&(G[a]=4),V.prepareRemove=function(U){v.call(this,U);var d=U._dataModel,G=d.$3e;if(G)for(var J=G.length,u=0;J>u;u++)if(G[u]===U){G.splice(u,1);break}},_.setDataModel=function(o){var N=this,y=N._dataModel;if(y!==o){y&&(y.umm(Sk,N),y.umd(Qr,N),y.$3e=[]),o.mm(Sk,N),o.md(Qr,N);var q=o.$3e=[];o.each(function(u){u.s(H)&&q.indexOf(u)<0&&q.push(u)}),gn.call(N,o)}},_.setFlowInterval=function(n){var b=this,l=b.$11e;b.$11e=n,b.fp("flowInterval",l,n),b.$7e!=$&&(clearInterval(b.$7e),delete b.$7e,b.enableFlow(n))},_.getFlowInterval=function(){return this.$11e},_.$9e=function(){var F,u,P,j=this,U=j.tx(),b=j.ty(),Q=j.getZoom(),m=j.getWidth(),c=j.getHeight(),w={x:-U/Q,y:-b/Q,width:m/Q,height:c/Q},H=j.dm().$3e,B=j._56I,f=new T;if(H.forEach(function(r){B[r.getId()]&&(F=j.getDataUI(r),F&&(P=F._79o(),P&&f.add(P)))}),0!==f.size()&&(f.each(function(e){y.intersectsRect(w,e)&&(u=y.unionRect(u,e))}),u&&(u&&(y.grow(u,W(1,1/Q)),u.x=S(u.x*Q)/Q,u.y=S(u.y*Q)/Q,u.width=l(u.width*Q)/Q,u.height=l(u.height*Q)/Q,u=y.intersection(w,u)),u))){var n=j._canvas.getContext("2d");n.save(),n.lineCap=y.lineCap,n.lineJoin=y.lineJoin,L.translateAndScale(n,U,b,Q),n.beginPath(),n.rect(u.x,u.y,u.width,u.height),n.clip(),n.clearRect(u.x,u.y,u.width,u.height),j.$6e(n,u),n.restore()}},_.$6e=function(l,z){var J,j,m=this;m._93db(l),m.each(function(w){m._56I[w._id]&&(J=m.getDataUI(w),J&&(j=J._79o(),(!z||y.intersectsRect(z,j))&&J._42(l)))}),m._92db(l)},_.enableFlow=function(r){var m=this,Y=m.dm(),E=Y.$3e;m.$7e==$&&(E.forEach(function(V){var J=m.getDataUI(V);Ln(J)}),m.$7e=setInterval(function(){Y.$3e.forEach(function(T){ye(m.getDataUI(T))}),m.$9e()},r||m.$11e||50))},_.disableFlow=function(){var E=this;clearInterval(E.$7e),delete E.$7e;var g=E.dm().$3e;g&&E.$9e()},F.$5e=function(h,p,R,O,l){var r=this,Y=r._data,F=r.gv,n=Y.s(C),I=Y.s(e),N=Y.s(s),g=Y.s(u),S=F.$8e,A=Y.s(Z);if(S==$&&(S=F.$8e={}),h.beginPath(),A!=$){var X=y.getImage(A),x=R/2;h.translate(p.x,p.y),h.rotate(l),h.translate(-p.x,-p.y),y.drawImage(h,X,p.x-x,p.y-x,R,R,Y),h.translate(p.x,p.y),h.rotate(-l),h.translate(-p.x,-p.y)}else h.fillStyle=n,h.arc(p.x,p.y,R/2,0,U,!0),h.fill();if(g){var w=22,W=w+"_"+I+"_"+N,E=S[W];if(E==$){var q=ej("canvas");L.setCanvas(q,w,w);var i=q.getContext("2d"),G=w/2,M=G,o=G;L.translateAndScale(i,0,0,1),i.beginPath();var P=i.createRadialGradient(M,o,0,M,M,G);P.addColorStop(0,I),P.addColorStop(1,N),i.fillStyle=P,i.arc(M,o,G,0,U,!0),i.fill(),E=S[W]=q}var x=O/2;y.drawImage(h,E,p.x-x,p.y-x,O,O,Y)}},K._80o=function(L){I.call(this,L);var v=this,u=v._data,n=v.gv;u.s(H)&&n.$7e!=$&&Ee.call(v,L)},o._80o=function(e){h.call(this,e);var J=this,P=J._data,Z=J.gv;P.s(H)&&Z.$7e!=$&&Ee.call(J,e)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);